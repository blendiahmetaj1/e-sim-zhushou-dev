// ==UserScript==
// @name         e-sim助手
// @namespace    esim
// @version      2.5.7-release
// @description  e-sim增强功能
// @author       E-sim插件开发组
// @match        http://*.e-sim.org/*
// @match        https://*.e-sim.org/*
// @require      http://cdn.e-sim.org/js/jquery-1.8.3.min.js
// @grant        GM_setClipboard
// @grant        GM_addStyle
// @grant        unsafewindow
// ==/UserScript==

// 前排提醒：如果你发现网页显示有问题，请先自行尝试 Ctrl+F5 刷新，如果问题依旧再来向开发组求助
// 前排提醒：如果战场输出或补充体力时出现404错误，请删除cookies并重新登录（chrome可以进入 chrome://settings/siteData 搜索服务器名，点▶进去，除了本地存储和数据库存储外全删）
// 前排提醒：如果你需要在游戏内截图并分享给国外玩家，请先关闭esim插件再截图

// 招人：E-sim插件开发组长期招收程序设计、编写、测试、优化、女装人员，要求：是活人就行
// 插件开发群：462288323 ，各位大佬进来拿插件也行呀

// ChangeLog
// 2.5.7版本：发送战况到discord；简单的自动攻击；战斗显示网络错误信息；战场页终止请求；战斗方国旗修正；特殊道具页快捷菜单；在线玩家页增强功能；装备属性刷新和升级提示；请求超时设定；一些细节改进；
// 2.5.6版本：删除语音闹钟功能；修正国旗问题（请不要再使用其他修正国旗错位插件）；预约战场；快捷站点；个人消耗统计；记录玩家暴击和免体buff；修正战场飞行结果判断问题；一些优化和改进；
// 2.5.5版本：紧凑式战场界面；战场列表筛选、复制战场信息、显示T5时间；分解确认；观战列表点击国家可以查看在线玩家；在线玩家详细信息；存储战场飞行设置；替换会员原观战框；
// 2.5.4版本：添加显示全部战场功能；添加战场消耗统计功能；战场飞行可以在原网页刷新攻击框；攻击返回404时切换协议；战场飞行显示机票数量；应对profile界面更改；一些优化和改进；更新jqplot
// 2.5.3版本：插件内所有后生成的国旗均使用新国旗样式；更改本地加成地区判断；添加对联盟成员国的显示；添加桌面通知战场提醒；给闹钟加音效（大文件会有延迟）；上调“直接使用医疗包”按钮位置；修正Kekistan的国家缩写；战场界面功能框下移；会员上移观战框；修正一些小问题；稍微更改界面；
// 2.5.2版本：修正非起义战的防守方本地加成地区；添加国旗选择列的清空和锁定功能；添加战场中无需确认使用医疗包的功能；战场页面修改网页标题
// 2.5.1版本：修正从2.4.8版本以来因页面样式更新导致的各种功能失效的问题；添加显示货币市场玩家国籍的功能；在战场推测观战玩家中添加根据联盟分类玩家的功能；添加隐藏首页左上角提醒框的功能
//------------2.4.8及之前版本开发者：c*******, z*****，之后版本均由E-sim插件开发组维护------------

var ajaxs=[],oldAjaxOrigin=unsafeWindow.$.ajax,oldAjaxScript=$.ajax;function abortAll(){$.each(ajaxs,function(t,e){e.abort()}),ajaxs=[]}function main(){if("/maintenance.html"!=location.pathname)if(2===$(".time").length){if(2!=$(".time:first").text().match(/-/g).length)return console.log("官方脚本还未执行，e-sim助手等待0.5秒"),void setTimeout(main,500);if($("#ehIcon2").length>0)console.log("已运行e-sim助手");else if(fetchMap(),enhanceCountrySelect(),addIcon(),fetchMe(),enhanceQuickButton(),enhanceCurrency(),quickSite(),fixFlagInline(),-1!=document.URL.search("html")){var t=document.URL.match("/([a-zA-Z0-9]+).html")[1];switch(document.title="e-Sim - "+location.host.split(".")[0]+" - "+t,t){case"index":hideFrontPagePushQuestion();break;case"profile":var e=parseInt(document.URL.match("/profile.html[?]id=([0-9]+)")[1]);updateOneCitizenPage(e,$("body")),enhanceProfile(e);break;case"citizensOnline":enhanceCitizensOnline();break;case"militaryUnitCompanies":case"companies":enhanceMilitaryUnitCompanies();break;case"myMilitaryUnit":case"militaryUnit":enhanceMyMilitaryUnit();break;case"statistics":enhanceStatistics();break;case"storage":enhanceStorage();break;case"monetaryMarket":updateCurrencyRatio($("body")),ShowPlayerCitizenship();break;case"battle":enhanceBattle();break;case"battles":preEnhanceBattleList();break;case"battleStatistics":enhanceBattleStatistics();break;case"showEquipment":equipmentUpgradeHelper();break;case"companyAllWorkers":returnToCompanyPage();break;default:console.log(t)}}else hideFrontPagePushQuestion()}else console.log("未登录，e-sim助手停止运行");else setTimeout(function(){location.pathname="/index.html"},1e4)}function hideFrontPagePushQuestion(){var t=$("#frontPagePushQuestion");t.length>0&&t.hide()}function fixFlagInline(){GM_addStyle(".xflagsSmall{display:inline-block;vertical-align:bottom;margin:1px!important;padding:0!important;} .xflagsMedium{display:inline-block;} .xflagsBig{display:inline-block;} ")}function getCountryFormXflagsClass(t){var e=t.split(" ")[1];return e.substring(e.indexOf("-")+1)}function getEpoch(){return parseInt($("#time2").text())}function getEpochFromString(t,e){var i=e.split(":"),a=t.split("-"),s=new Date(a[2],parseInt(a[1])-1,a[0],i[0],i[1],i[2],0);return Date.parse(s)}function isEpochOutdated(t,e){return!(getEpoch()-t<1e3*e)}function isObjectOutdated(t,e){return!(t&&"date"in t)||isEpochOutdated(t.date,e)}function isLocalStorageOutdated(t,e){return isObjectOutdated(JSON.parse(localStorage.getItem(t)),e)}function setUpdatedDate(t){t.date=getEpoch()}function epochToTime(t){var e=parseInt(t/864e5);t-=24*e*3600*1e3;var i=parseInt(t/36e5);t-=3600*i*1e3;var a=parseInt(t/6e4),s="";return e>0&&(s+=e+"d"),i>0&&(s+=i+"h"),a>0&&(s+=a+"m"),s||"0m"}function epochToTime2(t){var e=parseInt(t/864e5);t-=24*e*3600*1e3;var i=parseInt(t/36e5);t-=3600*i*1e3;var a=parseInt(t/6e4);return e>0?e+"d":i>0?i+"h":a>0?a+"m":"0m"}function addCheckBoxSettingFrame(t,e,i,a,s){var n=$("<input>",{type:"checkbox",id:e}),r=$("<label>",{class:"checkboxlabel",for:e,text:i}),o=localStorage.getItem(a);null===o?(localStorage.setItem(a,s),n.attr("checked","true"==s)):n.attr("checked","true"==o),t.append(n,r),n.click(function(){n.is(":checked")?localStorage.setItem(a,!0):localStorage.setItem(a,!1)})}function addSelectSettingFrame(t,e,i,a,s,n){for(var r=$("<p>",{style:"padding:3px; margin:3px",text:e}),o=$("<select>",{style:"padding:3px; margin:3px",id:s}).appendTo(r),l=0;l<i.length;l++)$("<option>",{value:i[l],text:a[l]}).appendTo(o);var h=localStorage.getItem(s);null===h?(localStorage.setItem(s,n),o.val(n)):o.val(h),t.append(r),o.change(function(){localStorage.setItem(s,o.val())})}function addTextboxSettingFrame(t,e,i,a){var s=$("<input>",{type:"text",id:i,style:"vertical-align:5px;width:"+e+"px;"}).appendTo(t),n=localStorage.getItem(i);null===n?(localStorage.setItem(i,a),s.val(a)):s.val(n),t.append(s),s.focus(function(){s.css("background-color","#FFFFFF")}),s.blur(function(){""===s.val()&&s.val(a),s.css("background-color","#79FF79"),localStorage.setItem(i,s.val())})}function addIcon(){config={},allies=JSON.parse(localStorage.getItem("allies")),enemies=JSON.parse(localStorage.getItem("enemies")),null!==allies&&null!==enemies||(allies=[],enemies=[]),coalitionMembers=JSON.parse(localStorage.getItem("coalitionMembers")),null===coalitionMembers&&(coalitionMembers=[]),currencyRatio=JSON.parse(localStorage.getItem("currencyRatio")),currencyRatio=null===currencyRatio?{}:currencyRatio,topCountryIds=JSON.parse(localStorage.getItem("topCountryIds")),topCountryIds=null===topCountryIds?[]:topCountryIds;var t=$("<li>",{id:"ehIcon2"}).insertBefore($("#userAvatar")),e=$("<a>",{"data-dropdown":"contentDropEh",style:"padding:0 5px;",href:"#"}).appendTo(t),i=($("<img>",{align:"absmiddle",class:"smallAvatar",style:"height:36px; width:36px;",src:"https://suna.e-sim.org:3000/avatars/140351_small"}).appendTo(e),$("#contentDrop").clone().attr("id","contentDropEh").empty().insertBefore($("#contentDrop")));$("<b>",{text:"e-sim助手 版本 "+GM_info.script.version+" "}).appendTo(i),$("<div>",{style:"text-align:left;line-height:30px;",text:"使用此脚本造成的一切后果（包括但不限于封号、经济损失）与作者无关"}).appendTo(i);for(var a,s=$("<table>",{id:"Eh2Config",style:"width:100%;"}).appendTo(i),n=$("<tr>",{style:"line-height:30px;"}).appendTo(s),r=[["fetchCurrency","统计汇率 ","统计汇率和常用物资的价格",["currencyRatio","topCountryIds"],"扫描大国"],["fetchCitizen","统计玩家 ","估算玩家buff时间等",["citizenInfo","citizenPage","muInfo"],"扫描本页"]],o=0;o<r.length;++o){a=$("<td>",{style:"text-align:left; background-color:SlateGray;"}).appendTo(n);var l=$("<label>",{class:"checkboxlabel",for:r[o][0]+"Checkbox",text:r[o][1]}).appendTo(a),h=$("<input>",{id:r[o][0]+"Checkbox",type:"checkbox",style:"vertical-align:5px;",text:" "}).prependTo(l),d=$("<button>",{id:r[o][0]+"ClearButton",class:"foundation-style",style:"padding:5px; margin:5px",target:r[o][3].join(" "),text:"清除"}).appendTo(a);$("<button>",{id:r[o][0]+"Scan",class:"foundation-style",style:"padding:5px; margin:5px",text:r[o][4]}).appendTo(a);h.click(function(){var t=$(this).attr("id")+"Disabled";$(this).is(":checked")?localStorage.removeItem(t):localStorage.setItem(t,"1")}),localStorage.getItem(r[o][0]+"CheckboxDisabled")?(config[r[o][0]+"Disabled"]=!0,h.attr("checked",!1)):(config[r[o][0]+"Disabled"]=!1,h.attr("checked",!0)),d.click(function(){for(var t=$(this).attr("target").split(" "),e=0;e<t.length;++e)console.log("清除",t[e]),localStorage.removeItem(t[e])})}config.fetchCitizenDisabled?$("#fetchCitizenScan").hide():$("#fetchCitizenScan").click(function(){$(this).attr("disabled",!0);var t=[];$("a[href*='profile.html'").each(function(){var e=parseInt($(this).attr("href").match(/profile\.html[?]id=([0-9]+)/)[1]);-1===$.inArray(e,t)&&t.push(e)});var e=t.length;$(this).text("剩余"+e+"个"),$.each(t,function(t,i){$.ajax({url:"profile.html?id="+i,success:function(t){if(2!==$(".time",t).length)return console.log(i,"抓取错误，重新抓取"),void $.ajax(this);updateOneCitizenPage(i,t),$("#fetchCitizenScan").text("剩余"+--e+"个"),0==e&&$("#fetchCitizenScan").text("扫描完成")},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})})}),s=$("<table>",{style:"width:100%; text-align:left;"}).insertBefore($("#Eh2Config")),n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>",{id:"Eh2Homeland",text:"祖国: "}).appendTo(n);var c=$("<select>",{style:"padding:3px; margin:3px",id:"Eh2HomelandSelect"}).appendTo(a);for(o=0;o<countryIds.length;++o)$("<option>",{value:countryIds[o],text:countryInfo[countryIds[o]].name}).appendTo(c);var p=$("option",c).sort(function(t,e){return $(t).text().localeCompare($(e).text())});c.html(p),c.change(g);var u=$("<button>",{id:"refreshAlliesAndEnemies",class:"foundation-style",style:"padding:5px; margin:5px",text:"更新盟国和敌国"}).appendTo(a);u.click(g),n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>",{text:"盟国: "}).appendTo(n);$("<b>",{id:"Eh2Allies",text:"更新中..."}).appendTo(a);function g(){var t=parseInt(c.val());c.attr("disabled",!0),u.attr("disabled",!0),$("~ div.xflagsSmall",c).remove(),$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[t].flagName,style:"vertical-align:middle;",value:t,title:countryInfo[t].name}).insertAfter(c),console.log("正在更新"+countryInfo[t].name+"的盟国和敌国信息"),allies=[t],enemies=[],coalitionMembers=[],$("#Eh2Allies").html("更新中..."),$("#Eh2Enemies").html("更新中..."),$("#Eh2CoalitionMembers").html("更新中..."),$.ajax({url:"countryPoliticalStatistics.html?countryId="+t,success:function(e){$("div.xflagsMedium",$("table.dataTable:last",e)).each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),allies.push(countryInfo[t].id)}),$("div.xflagsMedium",$("table.dataTable:eq(-2)",e)).each(function(){var e=getCountryFormXflagsClass($(this).attr("class"));countryInfo[e].id!==t&&enemies.push(countryInfo[e].id)});var i,a=$("h2",e);"Coalition"==(i=a.length>4?a[2]:a[1]).innerText.split(" ")[0]&&$(i,e).nextAll("div.xflagsSmall").each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),coalitionMembers.push(countryInfo[t].id)});localStorage.setItem("allies",JSON.stringify(allies)),localStorage.setItem("enemies",JSON.stringify(enemies)),localStorage.setItem("coalitionMembers",JSON.stringify(coalitionMembers)),f(),c.attr("disabled",!1),u.attr("disabled",!1)},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})}function f(){$("~ div.xflagsSmall",c).remove(),$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[allies[0]].flagName,style:"vertical-align:middle;",value:allies[0],title:countryInfo[allies[0]].name}).insertAfter(c),$("#Eh2Allies").text(""),$("#Eh2Enemies").text(""),$("#Eh2CoalitionMembers").text("");for(var t=1;t<allies.length;++t)countryId=allies[t],$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2Allies"));for(t=0;t<enemies.length;++t)countryId=enemies[t],$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2Enemies"));for(t=0;t<coalitionMembers.length;++t)countryId=coalitionMembers[t],$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2CoalitionMembers"))}if(n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>",{text:"敌国: "}).appendTo(n),$("<b>",{id:"Eh2Enemies",text:"更新中..."}).appendTo(a),n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>",{text:"联盟成员国: "}).appendTo(n),$("<b>",{id:"Eh2CoalitionMembers",text:"更新中..."}).appendTo(a),0===allies.length?(c.selectedIndex=1,g()):(c.val(allies[0]),f()),config.fetchCurrencyDisabled)$("#fetchCurrencyScan").hide();else{s=$("<table>",{id:"Eh2CurrencyRatios",style:"width:100%;"}).appendTo(i);0===topCountryIds.length?(console.log("查看人口和生产力前5的国家"),$.ajax({url:"countryStatistics.html?statisticType=PRODUCTIVITY",success:function(t){$("div.xflagsMedium:lt(5)",t).each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),topCountryIds.push(t)}),10===topCountryIds.length&&m()},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}}),$.ajax({url:"countryStatistics.html?statisticType=CITIZENS",success:function(t){$("div.xflagsMedium:lt(5)",t).each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),topCountryIds.push(t)}),10===topCountryIds.length&&m()},error:function(t,e){console.log(name,"抓取错误 (",e,")，重新抓取"),$.ajax(this)}})):m()}function m(){if(!config.fetchCurrencyDisabled){for(var t=[parseInt($("#Eh2HomelandSelect").val())],e=0;e<topCountryIds.length;++e)if(topCountryIds[e]&&countryInfo[topCountryIds[e]]){var i=countryInfo[topCountryIds[e]].id;-1===$.inArray(i,t)&&t.push(i)}topCountryIds=t,localStorage.setItem("topCountryIds",JSON.stringify(topCountryIds)),(s=$("#Eh2CurrencyRatios")).empty();var a=$("<tr>",{style:"line-height:30px;"}).appendTo(s),n=$("<td>",{style:"background-color:DarkSlateGray;",text:"货币"}).appendTo(a),r=$("<tr>",{style:"line-height:30px;"}).appendTo(s),o=$("<td>",{style:"background-color:DarkSlateGray;",html:"买 1<div class='xflagsSmall xflagsSmall-Gold' style='vertical-align:middle;' />"}).appendTo(r),l=$("<tr>",{style:"line-height:30px;"}).appendTo(s),h=$("<td>",{style:"background-color:DarkSlateGray;",html:"卖 1<div class='xflagsSmall xflagsSmall-Gold' style='vertical-align:middle;' />"}).appendTo(l);for(e=0;e<topCountryIds.length;++e){var d=topCountryIds[e],c=n.clone().text("").insertAfter(n);$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[d].flagName,style:"vertical-align:middle;"}).appendTo(c),c=o.clone().text("").insertAfter(o);var p=$("<a>",{href:"monetaryMarket.html?buyerCurrencyId=0&sellerCurrencyId="+d,text:"???"}).appendTo(c);void 0!==currencyRatio[d]&&void 0!==currencyRatio[d].sell&&p.html(""+parseFloat(currencyRatio[d].sell.ratio).toFixed(2)).after($("<div>",{style:"font-size:10px;",text:epochToTime2(getEpoch()-currencyRatio[d].sell.date)})),c=h.clone().text("").insertAfter(h),p=$("<a>",{href:"monetaryMarket.html?buyerCurrencyId="+d+"&sellerCurrencyId=0",text:"???"}).appendTo(c),void 0!==currencyRatio[d]&&void 0!==currencyRatio[d].buy&&p.html(""+parseFloat(currencyRatio[d].buy.ratio).toFixed(2)).after($("<div>",{style:"font-size:10px;",text:epochToTime2(getEpoch()-currencyRatio[d].buy.date)}))}var u=$("#fetchCurrencyScan");u.click(function(){var t=$("a",$("#Eh2CurrencyRatios")).length;$(this).attr("disabled",!0).text("剩余"+t+"个"),$("a",$("#Eh2CurrencyRatios")).each(function(){$.ajax({url:$(this).attr("href"),success:function(e){if(2!==$(".time",e).length)return console.log("汇率抓取错误，重新抓取"),void $.ajax(this);updateCurrencyRatio(e),u.text("剩余"+--t+"个"),0===t&&($("#fetchCurrencyScan").text("扫描完成"),m())},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})})})}}s=$("<table>",{style:"width:100%; text-align:left;"}).insertBefore($("#Eh2Config")),n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>",{id:"FavoriteCountriesConfig"}).appendTo(n),$("<button>",{id:"clearFavoriteCountries",class:"foundation-style",style:"padding:5px; margin:5px",text:"清空国旗选择列"}).appendTo(a).click(function(){$(this).attr("disabled",!0),localStorage.removeItem("favoriteCountries")}),addCheckBoxSettingFrame(a,"lockFavoriteCountries","锁定国旗选择列","lockFavoriteCountries",!1),n=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(s),a=$("<td>").appendTo(n);var b=$("<button>",{id:"btnBattleSettings",class:"foundation-style",style:"padding:5px; margin:5px",text:"战场设置"}).appendTo(a);b.click(function(){b.attr({disabled:!0}),createSettingWindow()}),varEnableBattleAjaxTimeout=localStorage.getItem("enableBattleAjaxTimeout"),"true"!=varEnableBattleAjaxTimeout?varEnableBattleAjaxTimeout=!1:varEnableBattleAjaxTimeout=!0,varBattleAjaxTimeout=parseInt(localStorage.getItem("battleAjaxTimeout")),varBattleAjaxTimeout<0&&(varBattleAjaxTimeout=5)}function ShowPlayerCitizenship(){var t=$("table.dataTable:first"),e=$("<div class='testDivblue'></div>");t.before(e);var i=$("<table></table>");e.append(i);var a=$("<input type='button' id='gcbtn' value='检查卖家国籍'></input> ");i.append(a),i.append("检查需要等待一段时间"),$("#gcbtn").click(function(){e.remove();for(var t=$("a.profileLink"),i=1;i<t.length;i++)ShowPlayerCitizenshipAjax(t[i])})}function ShowPlayerCitizenshipAjax(t){var e=$(t).attr("href").split("=")[1];$.ajax({url:"apiCitizenById.html?id="+e,success:function(i){var a=JSON.parse(i);console.log("用户",e,"API抓取成功");var s=a.citizenshipId;$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[s].flagName,style:"vertical-align:middle;"}).insertBefore(t)},error:function(t,i){console.log("用户",e,"API抓取错误 (",i,")，重新抓取"),$.ajax(this)}})}function GetQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}function enhanceStorage(){var t=GetQueryString("storageType");"EQUIPMENT"==t?preEnhanceEquipment():"SPECIAL_ITEM"!=t&&"SPECIAL_ITEMS"!=t||(updateBuffTime(),enhanceSpecialItem())}function preEnhanceEquipment(){var t=$("#mergeItem"),e=$("<input type='button' style='display:inline-block;' id='eeqbtn' value='自定义拍卖'></input> ");e.prependTo(t),$("#eeqbtn").click(function(){enhanceEquipment(),$("#eeqbtn").attr({disabled:!0}),$("#eeqbtn").remove()});var i=$("<div>",{id:"confirmSplitTable",style:"display:inline-block;"});e.after(i);var a=$("<input>",{type:"checkbox",id:"confirmSplitCheckbox"}).appendTo(i),s=($("<label>",{class:"checkboxlabel",for:"confirmSplitCheckbox",text:"分解前确认"}).appendTo(i),localStorage.getItem("confirmSplit"));null!==s&&(a.attr("checked","true"==s),"true"===s&&$(".foundation-style.button.splitItemsButton").parent().attr("onSubmit","return confirm('确定要分解吗？')")),a.click(function(){a.is(":checked")?localStorage.setItem("confirmSplit",!0):localStorage.setItem("confirmSplit",!1),location=location})}function enhanceStatistics(){"MILITARY_UNIT"==GetQueryString("selectedSite")&&enhanceMilitaryUnitStatistics()}function fetchMap(){countryIds=JSON.parse(localStorage.getItem("countryIds")),countryInfo=JSON.parse(localStorage.getItem("countryInfo")),regionInfo=JSON.parse(localStorage.getItem("regionInfo")),muInfo=JSON.parse(localStorage.getItem("muInfo"))||{};for(var t=[["apiCountries.html",86400],["apiRegions.html",86400],["apiMap.html",600]],e=t.length,i=0;i<t.length;++i){var a=t[i][0],s=t[i][1];isEpochOutdated(localStorage.getItem(a+".date"),s)?n(a):e--}function n(t){$.ajax({url:t,success:function(i){localStorage.setItem(t,i),localStorage.setItem(t+".date",getEpoch()),console.log(t,"抓取成功"),0==--e&&function(){countryInfo={},countryIds=[];for(var t=JSON.parse(localStorage.getItem("apiCountries.html")),e=0;e<t.length;++e){var i=t[e];i.flagName=i.name.replace(/ /g,"-"),countryIds.push(i.id),countryInfo[i.id]=i,countryInfo[i.name]=i,countryInfo[i.shortName]=i,countryInfo[i.flagName]=i,countryInfo[i.currencyName]=i}regionInfo=[];var a=JSON.parse(localStorage.getItem("apiMap.html")),s=JSON.parse(localStorage.getItem("apiRegions.html"));for(e=0;e<a.length;++e)regionInfo[a[e].regionId]=a[e];for(e=0;e<s.length;++e){var n=s[e].id;for(var r in s[e])regionInfo[n][r]=s[e][r]}for(var o={},e=0;e<regionInfo.length;++e){var i=regionInfo[e];i&&(o[i.id]=i,o[i.name]=i)}localStorage.setItem("countryIds",JSON.stringify(countryIds)),localStorage.setItem("countryInfo",JSON.stringify(countryInfo)),localStorage.setItem("regionInfo",JSON.stringify(o)),console.log("国家和地图信息已更新")}()},error:function(e,i){console.log(t,"抓取错误 (",i,")，重新抓取",t),$.ajax(this)}})}}function fetchMe(){var t=$("a[href^='profile.html']",$("#userAvatar")).attr("href");userId=parseInt(t.replace("profile.html?id=","")),citizenInfo=JSON.parse(localStorage.getItem("citizenInfo")),null===citizenInfo&&(citizenInfo={}),citizenPage=JSON.parse(localStorage.getItem("citizenPage")),null===citizenPage&&(citizenPage={}),fetchAndUpdateOneCitizenInfo(userId),fetchAndUpdateOneCitizenPage(userId)}function UpdateOneCitizenInfo(t,e){config.fetchCitizenDisabled&&t.id!==userId||(void 0===e&&(e=!0),console.log("玩家",t.id,"(",t.login,") API已更新"),setUpdatedDate(t),citizenInfo[t.id]=t,e&&localStorage.setItem("citizenInfo",JSON.stringify(citizenInfo)))}function fetchAndUpdateOneCitizenInfo(t,e){if(!config.fetchCitizenDisabled||t===userId){var i=citizenInfo[t];(void 0===i||isObjectOutdated(i,600))&&$.ajax({url:"apiCitizenById.html?id="+t,success:function(t){UpdateOneCitizenInfo(JSON.parse(t),e)},error:function(e,i){console.log("用户",t,"API抓取错误 (",i,")，重新抓取"),$.ajax(this)}})}}function updateOneCitizenPage(t,e,i){if((!config.fetchCitizenDisabled||t===userId)&&0!==$("#indexShortcut",e).length){void 0===i&&(i=!0),console.log("玩家",t,"(",$(".big-login",e).text(),")页面已更新"),page=citizenPage[t],void 0===page&&(page={}),page.avatar=$(".bigAvatar",e).attr("src").trim(),page.premium=1==$("img[src$='star_32.png']",e).length,page.buffIcons=[],$("img[src$='_positive.png']",e).each(function(){if("smallhelp"!=$(this).attr("class"))return!0;-1==page.buffIcons.indexOf(this)&&page.buffIcons.push($(this).attr("src"))}),page.debuffIcons=[],$("img[src$='_negative.png']",e).each(function(){if("smallhelp"!=$(this).attr("class"))return!0;-1==page.debuffIcons.indexOf(this)&&page.debuffIcons.push($(this).attr("src"))});for(var a=getEpoch(),s=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"],n=[24,24,24,24,1,10,25,24,24,24],r=0;r<s.length;++r)$.each(page.buffIcons,function(){this.indexOf(s[r])>0&&l(s[r],a-3600*n[r]*1e3,a)}),$.each(page.debuffIcons,function(){this.indexOf(s[r])>0&&(page.premium?l(s[r],a-2*n[r]*3600*1e3,a-3600*n[r]*1e3):l(s[r],a-3*n[r]*3600*1e3,a-3600*n[r]*1e3))}),void 0===page[s[r]]&&(page[s[r]]=[a,a+864e8]);var o=[];$(".equipmentBack",e).each(function(){$(this).attr("class").indexOf("rewardEQ")<0&&o.push($(this).attr("class").split(" ").pop())}),page.equipments=o,0!=$("div.rank :eq(0)",e).parent().children("div.profile-row:eq(7)").children("span.data").length&&(page.lowHit=parseInt($("div#hitHelp",e).text().split("/")[0].replace(",","")),page.highHit=parseInt($("div#hitHelp",e).text().split("/")[1].replace(",","")),page.critical=parseFloat($("#criticalHelp",e).text().trim().split(" ")[0]),page.miss=parseFloat($("#missHelp",e).text().trim().split(" ")[0]),page.avoid=parseFloat($("#avoidHelp",e).text().trim().split(" ")[0]),page.power=parseInt((page.lowHit+page.highHit)/2*(1-page.miss/100)*(1+page.critical/100)/(1-page.avoid/100)*37*5*1.2*1.2*1.2),page.strength=parseInt($("div.rank :eq(0)",e).parent().children("div.profile-row:eq(4)").children("span.data").text()),page.totalDamage=parseInt($("div.rank :eq(0)",e).parent().children("div.profile-row:eq(2)").children("span.data").text().replace(/,/g,""))),setUpdatedDate(page),citizenPage[t]=page,i&&localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}function l(t,e,i){if(void 0===page[t])page[t]=[e,i];else{var a=page[t][0]>e?page[t][0]:e,s=page[t][1]<i?page[t][1]:i;page[t]=a>s?[e,i]:[a,s]}}}function fetchAndUpdateOneCitizenPage(t,e,i){if(!config.fetchCitizenDisabled||t===userId){var a=citizenPage[t];void 0===a||isObjectOutdated(a,600)?$.ajax({url:"profile.html?id="+t,success:function(a){updateOneCitizenPage(t,a,e),"function"==typeof i&&i()},error:function(e,i){var a=t%10*.5+1,s=this;console.log("用户",t,"页面抓取错误 (",i,")，",a,"秒后重新抓取"),setTimeout(function(){$.ajax(s)},1e3*a)}}):"function"==typeof i&&i()}}function getMuMemberInfo(t,e){muInfo[t]||(muInfo[t]={});var i=muInfo[t];isObjectOutdated(i.member,172800)?$.ajax({url:"apiMilitaryUnitMembers.html?id="+t,success:function(t){for(var a=JSON.parse(t),s=0;s<a.length;++s)UpdateOneCitizenInfo(a[s],!1);i.member={},setUpdatedDate(i.member),localStorage.setItem("citizenInfo",JSON.stringify(citizenInfo)),localStorage.setItem("muInfo",JSON.stringify(muInfo)),"function"==typeof e&&e()},error:function(e,i){var a=t%10*.5+1,s=this;console.log("军团",t,"的成员API抓取错误 (",i,")，",a,"秒后重新抓取"),setTimeout(function(){$.ajax(s)},1e3*a)}}):(console.log("军团",t,"的成员API无需抓取"),"function"==typeof e&&e())}function enhanceProfile(t){if(!config.fetchCitizenDisabled||t===userId){var e=getEpoch();$("img[src$='_positive.png']").after("<br>"),$("img[src$='_negative.png']").after("<br>");for(var i=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"],a=[24,24,24,24,1,10,25,24,24,24],s=0;s<i.length;++s){var n=$("img[src$='"+i[s]+"_positive.png']:first")[0],r=$("img[src$='"+i[s]+"_negative.png']:first")[0],o=citizenPage[t][i[s]];if(n&&"smallhelp"==$(n).attr("class")){var l=o[0]+3600*a[s]*1e3-e;(h=o[1]+3600*a[s]*1e3-e)-l<6e4?$("<b>",{text:epochToTime(l)}).insertAfter(n):$("<b>",{text:epochToTime(l)+" - "+epochToTime(h)}).insertAfter(n)}if(r&&"smallhelp"==$(r).attr("class")){l=o[0]+2*a[s]*3600*1e3-e;var h=o[1]+2*a[s]*3600*1e3-e;citizenPage[t].premium||(l+=3600*a[s]*1e3,h+=3600*a[s]*1e3),h-l<6e4?$("<b>",{text:epochToTime(h)}).insertAfter(r):$("<b>",{text:epochToTime(l)+" - "+epochToTime(h)}).insertAfter(r)}}}}function updateBuffTime(){var t=$(".time:first").text().trim().split(", "),e=getEpochFromString(t[1],t[0]),i=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"],a=[24,24,24,24,1,10,25,24,24,24],s=1===$("#userAvatar span.premiumStar").length;$(".specialItemInventory").each(function(){var n=$(this),r=$("strong",n);if(0!==r.length){var o=getEpochFromString((t=r.text().split(" "))[0],t[1]),l=epochToTime(o-e);r.append(" ("+l+")");for(var h=$("img:first",n).attr("src"),d=0;d<i.length;++d)if(h.indexOf(i[d])>=0){if(d<4){var c=getEpoch()+o-e-1728e5;s||(c-=864e5)}else c=getEpoch()+o-e-3600*a[d]*1e3;citizenPage[userId][i[d]]=[c,c+1],localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}}})}function enhanceSpecialItem(){var t=$("<table id='quickBuffTable' UpdateCount='0'></table>").prependTo($("#storageConteiner")),e=$("<tr>").appendTo(t),i=$("<tr>").appendTo(t),a=$("<tr>").appendTo(t);function s(e,i,a,s){var r=["#EAC100","#00BB00","#00BB00","#FF5809","#FF5809","#9F4D95","#9F4D95","#9F4D95","#7373B9","#7373B9"];$.each(["medkit_big","vacations_big","spa_big","steroids_big","tank_big","painDealer1h_big","painDealer10h_big","painDealer25h_big","resistance_big","bunker_big"],function(o,l){var h=$("img[src$='"+l+".png']",e).parent();if(h.length<=0)return!0;var d=$(".smallhelp",h);if(0===d.length)return!0;var c=$('<td bgcolor="'+r[o]+'"></td>').appendTo(i);d.clone().appendTo(c);var p=$("span",h).text();""!=p?$("<br><b>"+p+"</b>").appendTo(c):$("<br><br>").appendTo(c);var u=$('<td bgcolor="'+r[o]+'"></td>').appendTo(a),g=$('<td bgcolor="'+r[o]+'"></td>').appendTo(s),f=$(".siForms",h),m=$("form",f);if(m.length<1)return!0;if(1==m.length){if($("select",m).length<1){var b=$('input[name="item"]',m).attr("value");(x=$("<input type='button' class='foundation-style button' value='使用'></input>").appendTo(u)).click(function(){var e=parseInt(t.attr("UpdateCount"))+1;t.attr("UpdateCount",e),x.attr({disabled:!0}),$.ajax({type:"POST",url:"storage.html",data:"item="+b+"&storageType=SPECIAL_ITEM&action=USE",success:function(t){n(t,e),console.log("使用"+b+"：成功响应")},error:function(t,e){x.val("使用失败"),console.log("使用"+b+"时发生错误")}})})}else{b=$('input[name="itemType"]',m).attr("value");(v=$("<input type='button' class='foundation-style button' value='购买'></input>").appendTo(g)).click(function(){var e=parseInt(t.attr("UpdateCount"))+1;t.attr("UpdateCount",e),v.attr({disabled:!0}),$.ajax({type:"POST",url:"storage.html",data:"itemType="+b+"&storageType=SPECIAL_ITEM&action=BUY&quantity=1",success:function(t){n(t,e),console.log("购买"+b+"：成功响应")},error:function(t,e){v.val("购买失败"),console.log("购买"+b+"时发生错误")}})})}}else{var x,v;b=$('input[name="itemType"]',m).attr("value");(x=$("<input type='button' class='foundation-style button' value='使用'></input>").appendTo(u)).click(function(){var e=parseInt(t.attr("UpdateCount"))+1;t.attr("UpdateCount",e),x.attr({disabled:!0}),$.ajax({type:"POST",url:"storage.html",data:"item="+b+"&storageType=SPECIAL_ITEM&action=USE",success:function(t){n(t,e),console.log("使用"+b+"：成功响应")},error:function(t,e){x.val("使用失败"),console.log("使用"+b+"时发生错误")}})}),(v=$("<input type='button' class='foundation-style button' value='购买'></input>").appendTo(g)).click(function(){var e=parseInt(t.attr("UpdateCount"))+1;t.attr("UpdateCount",e),v.attr({disabled:!0}),$.ajax({type:"POST",url:"storage.html",data:"itemType="+b+"&storageType=SPECIAL_ITEM&action=BUY&quantity=1",success:function(t){n(t,e),console.log("购买"+b+"：成功响应")},error:function(t,e){v.val("购买失败"),console.log("购买"+b+"时发生错误")}})})}})}function n(n,r){r>=t.attr("UpdateCount")&&($("td",t).remove(),s($(".specialItemInventory",n).parent(),e,i,a))}s($(".specialItemInventory").parent(),e,i,a)}function createSettingWindow(){var t=$("<div>",{class:"battleSettingsDiv",style:"overflow:auto; width:450px; height:350px; display:block; position:absolute; top:50%; left:50%; margin-left: -225px; margin-top: -150px; padding-bottom: 20px; text-align:center;background-color:lightgray;"}).appendTo($("body")),e=($('<br>战场设置<br><table class="battleSettingsTable" style="text-align:left"></table><button class="battleSettingsCancel">关闭</button><br>').appendTo(t),$(".battleSettingsTable")),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i);addCheckBoxSettingFrame(a,"battleEnhanceDivPlacement","战场界面功能框下移","battleEnhanceDivPlacement",!1),$("<p>",{text:"观战玩家变动不会改变按钮位置。"}).appendTo(a),i=$("<tr>").appendTo(e),addCheckBoxSettingFrame(a=$("<td>").appendTo(i),"battleBorderless","战场页面缩小框体间距","battleBorderless",!1),$("<p>",{text:"能看到下面的玩家输出排行和实时输出伤害。"}).appendTo(a),i=$("<tr>").appendTo(e),addCheckBoxSettingFrame(a=$("<td>").appendTo(i),"enableBattleAjaxTimeout","设定请求超时时间：","enableBattleAjaxTimeout",!1),addTextboxSettingFrame(a,60,"battleAjaxTimeout","5"),$("<span>",{text:" 秒"}).appendTo(a),$("<p>",{text:"缓解因网络环境差，同时进行的请求数量多，导致后续请求被堵塞。"}).appendTo(a),i=$("<tr>").appendTo(e),addCheckBoxSettingFrame(a=$("<td>").appendTo(i),"EnableAutoFight","启用自动打枪功能","EnableAutoFight",!1),$("<p>",{text:"珍惜账号，慎用自动。"}).appendTo(a),$(".battleSettingsCancel").click(function(){$("#btnBattleSettings").attr({disabled:!1}),t.remove()})}function quickSite(){var t=$('<li class="has-dropdown">').appendTo($("ul.foundation-left")),e=($('<a id="quickSite" href="#"><i class="icon-pin"></i>快捷站点</a>').appendTo(t),$('<ul class="dropdown">').appendTo(t));$('<li><a href="#" class="quickSiteSettings">快捷站点设置</a></li>').appendTo(e);$(".quickSiteSettings").click(function(){!function(){var t=$("<div>",{class:"quickSiteDiv",style:"overflow:auto; width:450px; height:300px; display:block; position:absolute; top:50%; left:50%; margin-left: -225px; margin-top: -150px; padding-bottom: 20px; text-align:center;background-color:lightgray;"}).appendTo($("body")),e=($('<br>注意: 留空“名称”一栏则表示删除该行，修改后请保存，刷新后生效<br>站外链接请以http或https开头<br>举例：名称：EC在线玩家 链接：citizensOnline.html?countryId=28<br>举例：名称：Esim贴吧 链接：https://tieba.baidu.com/f?kw=esim<table style="text-align:center; margin:auto"><tbody><tr class="EHQS"><td>名称</td><td>链接</td></tr></tbody></table><button class="quickSiteAdd">增加站点</button><button class="quickSiteComplete">保存</button><button class="quickSiteCancel">取消</button><br>').appendTo(t),$(".EHQS").parent());$(".quickSiteAdd").click(function(){$('<tr><td><input class="EHQSSites" type="text" style="width:100px;"></td><td><input class="EHQSSites" type="text" style="width:300px;"></td></tr>').appendTo(e)});var i=JSON.parse(localStorage.getItem("quickSite"));if(null!=i)for(var a=0;a<i.length;a++)$('<tr><td><input class="EHQSSites" type="text" style="width:100px;" value="'+i[a].name+'"></td><td><input class="EHQSSites" type="text" style="width:300px;" value="'+i[a].url+'"></td></tr>').appendTo(e);$(".quickSiteComplete").click(function(){var e=[],i=$("tr:gt(0)",$(".EHQS").parent());i.each(function(){var t=$(this),i=$("td:eq(0)",t).find("input")[0].value;""!=i&&e.push({name:i,url:$("td:eq(1)",t).find("input")[0].value})}),localStorage.setItem("quickSite",JSON.stringify(e)),t.remove()}),$(".quickSiteCancel").click(function(){t.remove()})}()});var i=JSON.parse(localStorage.getItem("quickSite"));if(null!=i)for(var a=0;a<i.length;a++)$('<li><a href="'+i[a].url+'" target="_blank">'+i[a].name+"</a></li>").appendTo(e)}function enhanceCountrySelect(){$("select").each(function(){var t=$(this),e=$("option",t);if(!(e.length<countryIds.length-3)){for(var i=!1,a=!1,s=!0,n=0;n<e.length;++n){var r=parseInt(e.eq(n).val());if(0!==r)if(-1!==r){if(r<-1)return;if(-1===$.inArray(r,countryIds))return;-1===e.eq(n).text().indexOf(countryInfo[r].currencyName)&&(s=!1)}else a=!0;else i=!0}var o=$("~ input[type='submit']",t);t.after("<br />");var l=JSON.parse(localStorage.getItem("favoriteCountries"));if(null===l&&(l=[28]),$.each(l,function(e,i){countryInfo[i]&&$("<div>",{class:(s?"xflagsSmall xflagsSmall-":"xflagsMedium xflagsMedium-")+countryInfo[i].flagName,style:"vertical-align:middle;",value:i,title:countryInfo[i].name}).insertAfter(t).click(function(){t.val($(this).val()),1===o.length&&o.click()})}),!s&&(i&&!a||!i&&a))$("<div>",{class:" xflagsMedium xflagsMedium-Adminland",style:"vertical-align:middle;",title:"全世界"}).insertAfter(t).click(function(){t.val(i?0:-1),1===o.length&&o.click()});if(i&&s)$("<div>",{class:"xflagsSmall xflagsSmall-Gold",style:"vertical-align:middle;"}).insertAfter(t).click(function(){t.val(0),1===o.length&&o.click()});1===o.length?o.click(function(){h(parseInt(t.val()))}):t.change(function(){h(parseInt(t.val()))})}function h(t){var e=localStorage.getItem("lockFavoriteCountries");if(null==e||"true"!=e){if(t>0){var i=$.inArray(t,l);i>-1&&l.splice(i,1),l.push(t)}localStorage.setItem("favoriteCountries",JSON.stringify(l.slice(-9)))}}})}function enhanceQuickButton(){var t=$("#editCitizenId").parent(),e=JSON.parse(localStorage.getItem("citizenNumber"));function i(e){if("disabled"!==e){var i=0,a=0;1==$("#foodLimit").length?(i=parseInt($("#foodLimit").text()),a=parseInt($("#giftLimit").text())):(i=parseInt($("#foodLimit2").text()),a=parseInt($("#giftLimit2").text()));var s=[["bread","Food",5,"5-FOOD","Q5食物",10*Math.floor(4*Math.random()+2)],["gift","Gift",5,"5-GIFT","Q5礼物",10*Math.floor(4*Math.random()+2)],["tank","Weapon",5,"5-WEAPON","Q5武器",10*Math.floor(10*Math.random()+15)],["ticket ","Ticket",5,"5-TICKET","Q5机票",10],["bread","Food",3,"3-FOOD","Q3食物",10],["gift","Gift",3,"3-GIFT","Q3礼物",10],["tank","Weapon",1,"1-WEAPON","Q1武器",10*Math.floor(10*Math.random()+15)],["ticket ","Ticket",1,"1-TICKET","Q1机票",10]],n=$('<ul id="storageTable" class="button foundation-center foundation-style-group"></ul>');t.parent().after(n),$.each(s,function(t,i){var a=$("<li></li>"),s=($("#storageTable").append(a),i[5]),n=$("<button>",{id:"send"+i[3],style:"width:41px; margin:1px;",class:"button foundation-style smallhelp only-icon profileButton",title:"从军团仓库取"+s+"个"+i[4]}).appendTo(a);$("<img>",{src:"//cdn.e-sim.org/img/productIcons/"+i[1]+".png",style:"width:28px; height:28px;"}).appendTo(n),$("<span>",{text:"x"+s,style:"position: absolute; top: 26px; right: 1px;"}).appendTo(n);n.append($("<br />"));$("<img>",{src:"//cdn.e-sim.org/img/productIcons/q"+i[2]+".png",style:"width:28px;"}).appendTo(n);n.click(function(){n.attr({disabled:!0});var t={product:i[3],quantity:s,reason:" "};t[e]=userId,$.ajax({url:"militaryUnitStorage.html",type:"POST",data:t,success:function(t){console.log("已从军团仓库取了"+s+"个"+i[4]),n.attr({disabled:!1})},error:function(t,e){console.log("从军团仓库取"+s+"个"+i[4]+"时发生错误 (",e,")，重新尝试"),$.ajax(this)}})})});var r=$("<input type='button' id='gsnbtn' value='获取仓库物资数目'></input> ");t.parent().after(r),r.click(function(){var t;t=e,$.ajax({url:"storage.html?storageType=PRODUCT",success:function(e){for(var n=$("div.storage",e),r=[0,0,0,0,0,0],o=[0,0,0,0,0,0],l=[0,0,0,0,0,0],h=[0,0,0,0,0,0],d=0;d<n.length;d++){var c,p,u;c=parseInt("0"+n[d].children[0].innerText.trim());var g=$(n[d]).children()[1];u=$(g.children[0]).attr("src").split("/")[6],null!=(p=$(g.children[1]).attr("src"))&&(p=(p=p.split("/")[6]).substring(1,2),"Food.png"==u?r[parseInt(p)]=c:"Gift.png"==u?o[parseInt(p)]=c:"Weapon.png"==u?l[parseInt(p)]=c:"Ticket.png"==u&&(h[parseInt(p)]=c))}var f=parseInt(5*(i+a+40)*100/(100-citizenPage[userId].avoid));console.log(i,a,r,o,l,h,f),s=[["bread","Food",5,"5-FOOD","Q5食物",r[5]<i+25,i+30-r[5],30],["gift","Gift",5,"5-GIFT","Q5礼物",o[5]<a+15,a+20-o[5],20],["tank","Weapon",5,"5-WEAPON","Q5武器",l[5]<f,f-l[5]+30,250],["ticket ","Ticket",5,"5-TICKET","Q5机票",h[5]<6,10-h[5],10],["bread","Food",3,"3-FOOD","Q3食物",r[3]<10,10-r[3],10],["gift","Gift",3,"3-GIFT","Q3礼物",o[3]<10,10-o[3],10],["tank","Weapon",1,"1-WEAPON","Q1武器",l[1]<f,f-l[1]+30,250],["ticket ","Ticket",1,"1-TICKET","Q1机票",h[1]<6,10-h[1],10]],$("ul#storageTable").html(""),$.each(s,function(e,i){var a=$("<li></li>"),s=($("#storageTable").append(a),i[5]?"red;":"black;"),n=i[5]?i[6]:i[7],r=$("<button>",{id:"send"+i[3],style:"width:41px; margin:1px; border-color:"+s,class:"button foundation-style smallhelp only-icon profileButton",title:"从军团仓库取"+n+"个"+i[4]+(i[5]?", 补足2天的用量":"")}).appendTo(a);$("<img>",{src:"//cdn.e-sim.org/img/productIcons/"+i[1]+".png",style:"width:28px; height:28px;"}).appendTo(r),$("<span>",{text:"x"+n,style:"position: absolute; top: 26px; right: 1px;"}).appendTo(r),r.append($("<br />")),$("<img>",{src:"//cdn.e-sim.org/img/productIcons/q"+i[2]+".png",style:"width:28px;"}).appendTo(r),r.click(function(){r.attr({disabled:!0});var e={product:i[3],quantity:n,reason:" "};e[t]=userId,$.ajax({url:"militaryUnitStorage.html",type:"POST",data:e,success:function(t){console.log("已从军团仓库取了"+n+"个"+i[4]),r.attr({disabled:!1})},error:function(t,e){console.log("从军团仓库取"+n+"个"+i[4]+"时发生错误 (",e,")，重新尝试"),$.ajax(this)}})})})},error:function(t,e){console.log("获取物资时发生错误 (",e,")，重新尝试"),$.ajax(this)}}),r.remove()})}}null===e||isObjectOutdated(e,86400)?$.ajax({url:"militaryUnitStorage.html",success:function(t){e=function(t){var e=$("input[value='"+userId+"']",t),i={};1===e.length?i.cn=e.attr("name"):i.cn="disabled";return setUpdatedDate(i),localStorage.setItem("citizenNumber",JSON.stringify(i)),i.cn}(t),console.log("团员编号为",e),i(e)},error:function(t,e){console.log("抓取团员编号时发生错误 (",e,")，重新尝试"),$.ajax(this)}}):i(e.cn)}function enhanceMilitaryUnitCompanies(){var t=$("table.dataTable:last").width("100%");t.parent().attr("style","width:98% !important;");var e=$("tr:gt(0)",t).sort(function(t,e){return $("td:eq(1)",t).html().localeCompare($("td:eq(1)",e).html())});$("tr:gt(0)",t).remove();var i=$("tr",t);i.after(e),$("td:first",i).append(" ("+e.length+")");var a=$("<button>",{class:"foundation-style button",text:"查看全部"}).appendTo($("<td>").appendTo(i));a.click(function(){a.attr("disabled",!0),setTimeout(function(){a.attr("disabled",!1)},1e4),$('button[id^="ehShow"]').click()}),e.each(function(){var t=$(this);if(0!==parseInt($("td:eq(3)",t).text())){var e=parseInt($('td:first a[href^="company.html?id="]',t).attr("href").match(/([0-9]+)$/)[1]);t.attr("id","ehRow"+e);var i=$("<button>",{class:"foundation-style button",style:"padding:10px;",id:"ehShow"+e,text:"查看工作情况",target:e}).appendTo($("<td>").appendTo(t));i.click(function(){i.attr("disabled",!0);var t=i.attr("target");$.ajax({url:"companyWorkResults.html?id="+t,success:function(e){i.remove();var a=$("table.dataTable:last",e);if(1!==$("tr",a).length){var s=$("<tr>").insertAfter($("#ehRow"+t)),n=$("<td colspan=5></td>").appendTo(s);a.appendTo(n)}},error:function(e,a){console.log("工厂",t,"抓取错误 (",a,")"),i.click()}})})}else t.append($("<td>"))})}function returnToCompanyPage(){var t=$("<button>",{id:"returnButton",class:"foundation-style",style:"padding:5px; margin:5px",text:"回到工厂页面"});t.click(function(){var t=GetQueryString("id");document.location=location.origin+"/company.html?id="+t}),$(".darkTable").before(t)}function enhanceMyMilitaryUnit(){var t=$("#orderForm > select");if(1==t.length){for(var e=[],i=0;i<allies.length;++i)e.push("("+countryInfo[allies[i]].shortName);var a=$("option",t).sort(function(t,e){return $(t).text().localeCompare($(e).text())});a.each(function(){for(var t=$(this),i=0;i<e.length;++i)-1!=t.text().indexOf(e[i]+" ")&&(0==i?t.attr("style","background:pink;"):t.attr("style","background:lavender;"))}),t.html(a)}}function preEnhanceBattleList(){var t=$(".dataTable :first"),e=$("<div class='foundation-style'></div>");e.insertBefore(t);var i=$("<table align='right'></table>");e.append(i);var a=$("<tr align='right'></tr>");i.append(a);var s=$("<input type='button' class='foundation-style button' id='btnShowEndTime' value='显示T5时间'></input> ");a.append(s);var n=$("<input type='button' class='foundation-style button' id='btnCloseShowEndTime' value='关闭T5时间'></input> ");n.hide(),a.append(n);var r=$("<input type='button' class='foundation-style button' id='btnShowBattleID' value='显示战场ID'></input> ");a.append(r);var o=$("<input type='button' class='foundation-style button' id='btnCloseShowBattleID' value='关闭战场ID'></input> ");o.hide(),a.append(o);var l=$("<tr align='right'></tr>");i.append(l);var h=$("<input type='button' class='foundation-style button' id='btnDeleteTourment' value='隐藏Cup战场'></input> ");l.append(h);var d=$("<input type='button' class='foundation-style button' id='btnFilter' value='筛选战场'></input> ");l.append(d);var c=$("<input type='button' class='foundation-style button' id='btnCloseFilter' value='关闭筛选'></input> ");c.hide(),l.append(c);var p=$("<input type='button' class='foundation-style button' id='btnDeleteCheckedBattle' value='隐藏选中战场'></input> ");p.attr("disabled",!0),l.append(p);var u=$("<input type='button' class='foundation-style button' id='btnDeleteUncheckedBattle' value='保留选中战场'></input> ");u.attr("disabled",!0),l.append(u);var g=$("<input type='button' class='foundation-style button' id='btnCopyCheckedBattleInfo' value='复制选中战场信息'></input> ");g.attr("disabled",!0),l.append(g),p.click(function(){$("#battlesTable tr:gt(0)").each(function(t,e){!0===$("input:checkbox",e).is(":checked")&&e.remove()})}),u.click(function(){$("#battlesTable tr:gt(0)").each(function(t,e){!1===$("input:checkbox",e).is(":checked")&&e.remove()})}),h.click(function(){$("#battlesTable tr:gt(0)").each(function(t,e){var i=$("a[href*='battle.html']",e);if(null==i)return!0;"Cup tournament"==i.text()&&e.remove()})}),d.click(function(){d.hide(),c.show();var t=$("<td exid='filter'><input type='checkbox'></input></td>");$("#battlesTable tr:eq(0)").append($("<td exid='filter'><input id='filterSelectAll' type='checkbox'></input>全选</td>")),$("#battlesTable tr:gt(0)").append(t),p.attr("disabled",!1),u.attr("disabled",!1),g.attr("disabled",!1),$("#filterSelectAll").click(function(){$("#battlesTable tr:gt(0)").each(function(t,e){$("input:checkbox",e).attr("checked",$("#filterSelectAll").is(":checked"))})})}),c.click(function(){d.show(),c.hide(),$("#battlesTable td[exid='filter']").remove(),p.attr("disabled",!0),u.attr("disabled",!0),g.attr("disabled",!0)}),s.click(function(){s.hide(),n.show(),$("#battlesTable tr:eq(0)").append($("<td exid='endTime'>T5时间</td>")),$("#battlesTable tr:gt(0)").each(function(t,e){var i,a=$("a[href*='battle.html']",e),s=(a.text(),$("span.is-countdown",e));if(1!==s.length)i=$("<td exid='endTime'>未知</td>");else{var n=s.text().split(":");if(n.length<3)i=$("<td exid='endTime'>已过期</td>");else{var r=new Date,o=60*parseInt(n[0])*60*1e3+60*parseInt(n[1])*1e3+1e3*parseInt(n[2])-3e5,l=new Date(r.getTime()+o);(i=$("<td exid='endTime'></td>")).text(l.toLocaleTimeString());var h=a.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1],d=$("<input type='button' class='foundation-style button' id='btnAutoPopup-"+h+"' value='T5自动打开战场' title='首次使用可能会被浏览器拦截，加入白名单即可' endtime='"+Date.parse(l)+"'></input> ");i.append(d),d.click(function(){var t=$(this),e=new Date,i=new Date(parseInt(t.attr("endtime")));setTimeout(function(){window.open(a.attr("href"),"Battle"+h,"resizable,scrollbars,width=1200,height=600")},i-e),console.log("在"+(i-e)/1e3+"秒后打开"+a.attr("href")),t.attr("disabled",!0),t.val("预约成功"),t.attr("title","请勿关闭或刷新该网页")})}}$(e).append(i)})}),n.click(function(){s.show(),n.hide(),$("#battlesTable td[exid='endTime']").remove()}),r.click(function(){r.hide(),o.show(),$("#battlesTable tr:eq(0)").append($("<td exid='battleID'>战场ID</td>")),$("#battlesTable tr:gt(0)").each(function(t,e){var i=$("a[href*='battle.html']",e);if(null==i)return!0;var a=i.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1];$(e).append($("<td exid='battleID'>"+a+"</td>"))})}),o.click(function(){r.show(),o.hide(),$("#battlesTable td[exid='battleID']").remove()}),g.click(function(){var t="";$("#battlesTable tr:gt(0)").each(function(e,i){if(!0===$("input:checkbox",i).is(":checked")){var a=$("a[href*='battle.html']",i),s=a.text(),n=$("span.is-countdown",i);if(1!==n.length)t=t+a[0].href+"  "+s+"\r\n";else{var r=n.text().split(":"),o=new Date,l=new Date(o.getTime()+60*parseInt(r[0])*60*1e3+60*parseInt(r[1])*1e3+1e3*parseInt(r[2])-3e5);t=t+a[0].href+"  "+s+" T5时间："+l.toLocaleTimeString()+"\r\n"}}}),GM_setClipboard(t)});var f=$("<button>",{text:"按结束时间排序",class:"foundation-style button"}).appendTo($("#battlesTable tr:first td:first").empty());if(f.click(function(){f.attr("disabled",!0),setTimeout(function(){f.attr("disabled",!1)},1e3);var t=[];$("#battlesTable tr:gt(0)").each(function(e,i){var a=$("a[href*='battle.html']",i);if(null==a)return!0;var s=parseInt(a.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1]);$(this).attr("id","battle-"+s);var n=$("span.is-countdown",i);1===n.length&&t.push(n.text()+" "+$(this).attr("id"))}),t.sort().reverse(),$.each(t,function(t,e){var i=e.split(" ").pop();$("#battlesTable #"+i).insertAfter($("#battlesTable tr:first"))})}),$("#pagination-digg").length>0){var m=$("<button>",{text:"加载其他页的战场",class:"foundation-style button",title:"如果需要加载所有战场，请尽快点击该按钮，否则可能会出现重复战场而导致插件失效"}).appendTo($("#battlesTable tr:first td:first"));m.click(function(){m.attr("disabled",!0);var t,e=$("li.next"),i=parseInt($("li.active")[0].innerHTML),a=(t=e.length>0?parseInt(e.prev().children().attr("href").split("page=")[1]):i)-1;m.text("剩余"+a+"个");for(var s=1;s<=t;s++)if(s!=i){var n=document.URL;n=n.indexOf("page")>0?n.substring(0,n.indexOf("page"))+"page="+s:n.indexOf("?")>0?n+"&page="+s:n+"?page="+s,$.ajax({url:n,success:function(e){if(2!==$(".time",e).length)return console.log(citizenId,"抓取错误，重新抓取"),void $.ajax(this);for(var i=$("#battlesTable").children("tbody"),s=e.split('<table id="battlesTable"')[1],n=(s=s.split("</table>")[0]).substring(s.indexOf("</tr>")+5).split("<tr>"),r=[],o=[],l=[],h=[],d=[],c=1;c<n.length;c++){var p=n[c].split('<script type="text/javascript">');if(p.length>1){r[c]=p[0];var u=p[1].split("<\/script>");r[c]=r[c]+u[1],r[c]=r[c].split("</tr>")[0],o[c]=u[0],d[c]=r[c].split("?id=")[1],d[c]=d[c].substring(0,d[c].indexOf('"')),$("<tr>",{id:"battle-"+d[c]}).appendTo(i),$("#battle-"+d[c]).html(r[c]);for(var g=o[c].split("+"),f=[],b=1;b<g.length;b++)f[b]=g[b].substring(0,g[b].indexOf(")"));l[c]=new Date,l[c].setHours(l[c].getHours()+parseInt(f[1])),l[c].setMinutes(l[c].getMinutes()+parseInt(f[2])),l[c].setSeconds(l[c].getSeconds()+parseInt(f[3])),h[c]=$("<span>",{id:"fundraisingTimer"+d[c]}).appendTo($("a[href='battle.html?id="+d[c]+"']").parent()),unsafeWindow.$("#fundraisingTimer"+d[c]).countdown({until:l[c],compact:!0,format:"dHMS",expiryText:"这个回合已经结束"})}else d[c]=n[c].split("?id=")[1],d[c]=d[c].substring(0,d[c].indexOf('"')),$("<tr>",{id:"battle-"+d[c]}).appendTo(i),r[c]=n[c].split("</tr>")[0],$("#battle-"+d[c]).html(r[c])}m.text("剩余"+--a+"个"),a<=0&&m.text("加载完成，共"+t+"页")},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})}});var b=$("<button>",{text:"加载详情",class:"foundation-style button",style:"padding:5px; margin:5px;",title:"加载刷新战场详情功能"}).appendTo($("#battlesTable tr:first td:last").empty());b.click(function(){b.attr("disabled",!0),b.remove(),enhanceBattleList()})}else enhanceBattleList()}function enhanceBattleList(){$("#battlesTable tr:gt(0)").each(function(t,e){if(!($("div.teamBlack",e).length>0)){var i=$("span.is-countdown",e);if(1===i.length){var a=$("a[href*='battle.html']",e),s=parseInt(a.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1]);$(this).attr("id","battle-"+s);var n=a.text();1===$("~ b",a).length?n+="起义":n+="进攻";var r=getCountryFormXflagsClass($("div.xflagsMedium:first",e).attr("class")).replace(/-/g," "),o=getCountryFormXflagsClass($("div.xflagsMedium:last",e).attr("class")).replace(/-/g," "),l=$("div.ui-progressbar-value",e),h=$("<div>",{id:"wall"+s,style:"text-align:center;"}).insertAfter($("div.ui-progressbar",e)),d=$("<div>",{id:"defenderBattleHero"+s,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:first",e)),c=$("<div>",{id:"defenderScore"+s,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:first",e)),p=$("<div>",{id:"attackerBattleHero"+s,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:last",e)),u=$("<div>",{id:"attackerScore"+s,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:last",e)),g=$("<div>",{id:"showSpectators"+s,text:"Show spectators",style:"color:#3787ea; cursor:pointer;"}).appendTo($("td:first",e)).click(function(){m.children().show(),g.hide(),f.show()}).hide(),f=$("<div>",{id:"hideSpectators"+s,text:"Hide spectators",style:"color:#3787ea; cursor:pointer;"}).appendTo($("td:first",e)).click(function(){m.children().hide(),g.show(),f.hide()}).hide(),m=$("<div>",{id:"spectators"+s,class:"battleDiv",style:"width:100%; text-align:center;"}).appendTo($("td:first",e)),b=$("<div>",{style:"width:33%; border:0; padding:0; margin:0; display:inline-block;",text:" defenders"}).appendTo(m),x=$("<i>",{id:"totaldefenders"+s,text:"0"}).prependTo(b),v=$("<div>",{id:"defendersMenu"+s}).appendTo(b),y=$("<div>",{style:"width:34%; border:0; padding:0; margin:0; display:inline-block; text-align:center;",text:" spectators"}).appendTo(m),k=$("<i>",{id:"totalspectators"+s,text:"0"}).prependTo(y),S=$("<div>",{id:"spectatorsMenu"+s}).appendTo(y),w=$("<div>",{style:"width:33%; border:0; padding:0; margin:0; display:inline-block; text-align:center;",text:" attackers"}).appendTo(m),_=$("<i>",{id:"totalattackers"+s,text:"0"}).prependTo(w),T=$("<div>",{id:"attackersMenu"+s}).appendTo(w);m.children().hide();var I=$("<div>",{id:"dsOrHospital"+s}).appendTo(i.parent().parent()),C=$("<img>",{src:$("#userAvatar img").attr("src")}).insertAfter(I).hide(),D=$("<div>",{id:"myDamage"+s}).insertAfter(C),M=$("<button>",{id:"peek"+s,text:"刷新",class:"foundation-style button",style:"padding:6px; margin:3px;"}).appendTo($("td:eq(3)",e)),q=$("<button>",{id:"copy"+s,text:"复制",class:"foundation-style button",style:"padding:6px; margin:3px;",title:n+": "+a[0].href+"\n"}).appendTo($("td:eq(3)",e)).hide(),j=$("<div>").appendTo($("td:eq(3)",e)),A=$("<span>",{id:"lastPeek"+s}).appendTo(j),F=$("<span>",{id:"2lastPeek"+s,text:"秒前更新"}).hide().appendTo(j);M.click(function(){M.attr("disabled",!0),$.ajax({url:"battle.html?id="+s,success:function(t){if(2!==$(".time",t).length)return console.log(s,"抓取错误，重新抓取"),void $.ajax(this);c.text($("#defenderScore",t).text()),u.text($("#attackerScore",t).text());var i=parseInt($("#defenderScore",t).text().replace(/,/g,"").replace(/\xA0/g,""))-parseInt($("#attackerScore",t).text().replace(/,/g,"").replace(/\xA0/g,""));0===i?(h.text(""),h.attr("title",0===c?"双方无伤害":"双方伤害相同")):i>0?(h.text(">> "+i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>"),h.attr("title",r+" 领先 "+o+" "+(i/1e6).toFixed(2)+"M")):(h.text("<< "+(-i).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<"),h.attr("title",o+" 领先 "+r+" "+(-i/1e6).toFixed(2)+"M")),l.attr("style","width:"+$("#leftStat",t).text().replace(" ","")+"; margin:0;"),d.html($("#topDefender1 > div",t).attr("style","width:100%;")),p.html($("#topAttacker1 > div",t).attr("style","width:100%;")),p.height()<d.height()&&p.parent().height(d.parent().height()),$("td:first > div:first >div:last",e).hide(),$("div.product",t).length>0&&I.empty().append($("div.product",t));var a=$("#topPlayerHit",t).text();"0"!==a&&(C.show(),D.text(a)),1===$("#userAvatar span.premiumStar").length&&(x.text($("#totaldefenders",t).text()),v.html($("#defendersMenu",t).html()),k.text($("#totalspectators",t).text()),S.html($("#spectatorsMenu",t).html()),_.text($("#totalattackers",t).text()),T.html($("#attackersMenu",t).html()),f.is(":visible")||g.show()),A.text("0"),F.show(),M.attr("disabled",!1),q.show()},error:function(t,e){console.log("战场",s,"抓取错误 (",e,")"),$.ajax(this)}})}),q.click(function(){GM_setClipboard(q.attr("title")+i.text()+", "+h.attr("title")+" ("+j.text()+")")})}}}),setInterval(function(){$("span[id^='lastPeek']").each(function(){var t=parseInt($(this).text());isNaN(t)||$(this).text(t+1)})},1e3);var t=$("<button>",{text:"刷新全部",class:"foundation-style button",style:"padding:5px; margin:5px;"}).appendTo($("#battlesTable tr:first td:eq(3)").empty());t.click(function(){t.attr("disabled",!0),$("#battlesTable tr:gt(0) button[id^='peek']").click(),setTimeout(function(){t.attr("disabled",!1)},1e4)})}function enhanceEquipment(){var t=[.1,1,5,12,35,100,400],e=$(".time").first().text().split(" ")[0].split(":")[0],s=20>e?20-e+24:20-e+48;console.log("距离波兰时间",20,"点还有约",s,"小时"),console.log("各等级装备的起价是 ",t);var n=$(".equipmentInStorage");for(i=0;i<n.length;++i){var r=$(".equipmentActions",n[i])[0],o=$(r).children()[4];if(o=$(o).children()[0],null==$(o).attr("title"))var l=5;else l=parseInt($(o).attr("title").substring(1))-1;var h=$(r).children()[2],d=$("input",$(h)),c=$(r).children();for(a=0;a<c.length;++a)"<hr>"==c[a].outerHTML&&r.removeChild(c[a]);for(j=0;j<d.length;++j)switch(d[j].name){case"price":d[j].setAttribute("value",t[l]),d[j].setAttribute("type","text"),d[j].setAttribute("style","width:30px"),d.eq(j).before("起价: "),d.eq(j).after("<div></div>");break;case"length":d[j].setAttribute("value",s),d[j].setAttribute("type","text"),d[j].setAttribute("style","width:30px"),d.eq(j).before("时间: "),d.eq(j).after("<i></i>")}}}function equipmentUpgradeHelper(){var t,e=[.1,.2,.4,.6,.8,1.1],i=[.2,.4,.6,.8,1.1,1.4],a=[.5,1,1.5,2,3,4],s=[1,1.5,2,3,4,5.5],n=[0,1.5,3,4.5,6,7.5],r=[1.5,3,4.5,6,7.5,9],o=[0,1,2,3,4,6],l=[1,2,3,4,6,8],h=[0,1,2,3,4,6],d=[1,2,3,4,6,8],c=[0,1,2,3,4,6],p=[1,2,3,4,6,8],u=[0,2,4,6,8,12],g=[2,4,6,8,12,16],f=[10,16,20,24,28,40],m=[16,20,24,28,40,60],b=[20,40,50,60,70,90],x=[40,50,60,70,90,130],v=[3,4,5,6,7,8],y=[4,5,6,7,8,10],k=[2,2.5,3,3.5,4,4.5],S=[2.5,3,3.5,4,4.5,5],w=[1,1,1,1,1,1,1,0,0,0,0],_=[1,1,1,1,1,1,1,0,0,0,0],T=[1,1,1,1,1,1,1,0,0,0,0],I=[1,1,1,1,1,1,1,0,1,0,0],C=[1,1,1,1,1,1,1,0,1,0,0],D=[1,1,1,1,1,1,1,0,0,0,0],M=[1,1,1,1,1,1,1,0,0,0,0],q=[1,1,0,0,1,0,0,1,1,0,0],j=[1,0,1,1,1,0,0,1,0,0,0],A=[1,0,1,1,1,0,0,0,0,0,0],F=[1,0,1,1,1,0,0,1,0,0,0],R=[1,0,1,1,1,0,0,0,0,0,0],P=[1,0,1,1,1,0,0,0,0,0,0],O=[1,1,1,1,1,0,0,0,0,0,0],N=[1,1,1,1,1,0,0,0,0,0,0],H=[1,1,0,0,1,0,0,1,1,0,0],B=[0,1,1,0,0,1,1,0,0,0,1],E=[1,1,1,0,0,1,1,0,0,0,1],L=[0,1,1,0,0,1,1,0,0,0,1],z=[0,1,1,0,0,1,1,0,0,0,1],G=[0,1,1,0,0,1,1,0,0,0,1],W=[0,1,1,1,0,1,1,0,0,0,1],Q=[0,1,1,1,0,1,1,0,0,0,1],U=[1,1,0,0,1,0,0,1,1,0,0],J=[1,1,1,1,1,0,0,0,1,1,0],Y=[1,1,1,1,1,0,0,0,1,1,0],X=[1,1,1,1,1,0,0,0,1,1,0],V=[1,1,1,1,1,0,0,1,1,1,0],K=[1,1,1,1,1,0,0,0,1,1,0],Z=[1,1,1,1,1,1,1,0,1,1,0],tt=[1,1,1,1,1,1,1,0,1,1,0],et=[1,1,0,0,1,0,0,1,1,0,0],it=[0,1,1,0,1,0,0,0,0,1,1],at=[0,1,1,0,1,0,0,1,0,1,1],st=[0,1,1,0,1,0,0,0,0,1,1],nt=[0,1,1,0,1,0,0,0,0,1,1],rt=[0,1,1,0,1,0,0,0,0,1,1],ot=[0,1,1,0,1,0,0,1,0,1,1],lt=[0,1,1,0,1,0,0,1,0,1,1],ht=[1,1,0,0,1,0,0,1,1,0,0],dt=["pirate","postapo","future","ee"],ct=["helmet","vision","armor","pants","shoes","weapon","offhand","charm"],pt=["Reduce miss chance","Increase critical chance","Increase maximum damage","Increase damage","Increase chance to avoid damage","Increase strength","Increase hit","Increase economy skill","Increase chance for free flight","Increase chance to use less weapons for Berserk","Increase chance to find a weapon"];function ut(t){switch(t){case 0:return"miss";case 1:return"暴击";case 2:return"大伤";case 3:return"小伤";case 4:return"免体";case 5:return"力量";case 6:return"伤害点";case 7:return"经济技能";case 8:return"免费飞行";case 9:return"减少连击消耗";case 10:return"捡到手枪";default:return"[未知属性]"}}function gt(t){for(var e=0;e<ct.length;e++)if(t==ct[e])return e;return-1}t=$(".equipmentBack",$(".testDivblue")).attr("class"),t=parseInt(t.substring(t.length-1))-1,$("h4").each(function(){var $=this.innerText,w=function(t){var e=t.split(" by "),i=e[0].trim(),a=e[1].trim();"%"==a.substring(a.length-1)&&(a=a.substring(0,a.length-1).trim());for(var s=[0,0],n=0;n<pt.length;n++)if(i==pt[n]){s[0]=n;break}return s[1]=parseFloat(a),s}($),_=function(t,$){var w=[0,0];switch(t){case 0:return w[0]=n[$],w[1]=r[$],w;case 1:return w[0]=o[$],w[1]=l[$],w;case 2:return w[0]=u[$],w[1]=g[$],w;case 3:return w[0]=c[$],w[1]=p[$],w;case 4:return w[0]=h[$],w[1]=d[$],w;case 5:return w[0]=f[$],w[1]=m[$],w;case 6:return w[0]=b[$],w[1]=x[$],w;case 7:return w[0]=e[$],w[1]=i[$],w;case 8:return w[0]=a[$],w[1]=s[$],w;case 9:return w[0]=v[$],w[1]=y[$],w;case 10:return w[0]=k[$],w[1]=S[$],w;default:return console.log("获取装备属性数值范围时parameter越界："+t),w[0]=0,w[1]=0,w}}(w[0],t),T=(_[1]-w[1])/3,I=.9*(_[1]-_[0])+_[0];w[1]<I?this.append("（强化+"+T.toFixed(2)+"）"):this.append("（无法强化）")}),function(){var t,e,i=$(".equipmentBack",$(".testDivblue")).children().attr("class"),a=(i=(i=i.split(" ")[1]).substring(0,i.length-1)).split("_");1==a.length?(t=0,e=gt(a[0])):(t=function(t){for(var e=0;e<dt.length;e++)if(t==dt[e])return e+1;return-1}(a[0]),e=gt(a[1]));for(var s=function(t,e){if(0==t)return 0==e?w:1==e?_:2==e?T:3==e?I:4==e?C:5==e?D:6==e?M:7==e?q:[0,0,0,0,0,0,0,0,0,0,0];if(1==t)return 0==e?j:1==e?A:2==e?F:3==e?R:4==e?P:5==e?O:6==e?N:7==e?H:[0,0,0,0,0,0,0,0,0,0,0];if(2==t)return 0==e?B:1==e?E:2==e?L:3==e?z:4==e?G:5==e?W:6==e?Q:7==e?U:[0,0,0,0,0,0,0,0,0,0,0];if(3==t)return 0==e?J:1==e?Y:2==e?X:3==e?V:4==e?K:5==e?Z:6==e?tt:7==e?et:[0,0,0,0,0,0,0,0,0,0,0];if(4==t)return 0==e?it:1==e?at:2==e?st:3==e?nt:4==e?rt:5==e?ot:6==e?lt:7==e?ht:[0,0,0,0,0,0,0,0,0,0,0];return[0,0,0,0,0,0,0,0,0,0,0]}(t,e),n="可以刷出的属性：",r=0;r<s.length;r++)s[r]>0&&(n=n+ut(r)+"、");var o=$(".dashedLine :eq(1)");o.before("<br />"),o.before(n)}()}function enhanceMilitaryUnitStatistics(){var t=$(".statisticsTable"),e=$("tr",t);function i(t){var e=parseInt(t.replace(/,/g,"").replace(/\xA0/g,""));return e>1e6?(e/1e6).toFixed(1)+"M":t}e.eq(0).append('<td><button class="foundation-style" id="ehShowAll">查看所有</button></td>'),$("#ehShowAll").click(function(){$(this).attr("disabled","disabled"),setTimeout(function(){$("#ehShowAll").attr("disabled",!1)},1e4),$('[id^="ehShow_"]').click()});for(var a=1;a<e.length;++a){var s=e.eq(a);$("td:eq(5)",s).text(i($("td:eq(5)",s).text())),$("td:eq(6)",s).text(i($("td:eq(6)",s).text()));var n=$('a[href^="militaryUnit.html?id="]',s).attr("href").replace("militaryUnit.html?id=",""),r=$('<button style="padding:10px;" class="foundation-style" id="ehShow_'+n+'">查看军令</button>');s.append($("<td>").append(r)),r.click(function(){$(this).attr("disabled","disabled");var t=$(this).attr("id").replace("ehShow_","");$.ajax({url:"militaryUnit.html?id="+t,timeout:9e3,success:function(e){var i=$("#ehShow_"+t),a=$('img[src="//cdn.e-sim.org//img/newOnline.png"]',e).prev(),s=a.prev(),n=s.prev(),r=$("td:eq(3)",i.parent().parent());r.append('<b title="统计在线的人数">('+a.length+"人在线)</b>");for(var o=0;o<a.length;++o)r.append($("<div>",{style:"text-align:left;"}).append(n.eq(o),s.eq(o),a.eq(o)));$("#pagination-digg",e).length>0&&$.ajax({url:"militaryUnit.html?id="+t+"&page=2",success:function(t){var e=$('img[src="//cdn.e-sim.org//img/newOnline.png"]',t).prev(),i=e.prev(),a=i.prev(),s=parseInt(r.find("b:eq(1)").text().replace(/[^0-9]/g,""));s+=e.length,r.find("b:eq(1)").text("("+s.toString()+"人在线)");for(var n=0;n<e.length;++n)r.append($("<div>",{style:"text-align:left;"}).append(a.eq(n),i.eq(n),e.eq(n)))},error:function(t,e){$.ajax(this)}});var l=$('div.battleDiv a[href^="battle.html"]',e).parent(),h=$("div.xflagsMedium",$("div.battleDiv",e).parent().parent());if(3!=h.length)return i.after("无军令"),void i.remove();if(h.eq(0).attr("class")===h.eq(2).attr("class")){h.eq(0).attr("style","vertical-align:middle;");var d=getCountryFormXflagsClass(h.eq(1).attr("class"));h.eq(1).attr("class","xflagsSmall xflagsSmall-"+d),h.eq(1).attr("style","vertical-align:middle;")}else{h.eq(1).attr("style","vertical-align:middle;");d=getCountryFormXflagsClass(h.eq(0).attr("class"));h.eq(0).attr("class","xflagsSmall xflagsSmall-"+d),h.eq(0).attr("style","vertical-align:middle;")}i.after(l,h.eq(0),"vs",h.eq(1)),i.remove()},error:function(e,i){console.log(url,"抓取错误 (",i,")"),$("#ehShow_"+t).click()}})})}}function updateCurrencyRatio(t){if(!config.fetchCurrencyDisabled&&1!==$(".dataTable:first tr:eq(1) td",t).length){var e=getCountryFormXflagsClass($(".dataTable:first tr:eq(1) td:eq(1) div.xflagsSmall",t).attr("class")),i=parseFloat($(".dataTable:first tr:eq(1) td:eq(2) b",t).text().replace(",",".")),a=getCountryFormXflagsClass($(".dataTable:first tr:eq(1) td:eq(2) div.xflagsSmall",t).attr("class"));if("Gold"===a){var s=countryInfo[e].id;void 0===currencyRatio[s]&&(currencyRatio[s]={}),void 0===(n=currencyRatio[s]).buy&&(n.buy={}),n.buy.ratio=1/i,setUpdatedDate(n.buy),localStorage.setItem("currencyRatio",JSON.stringify(currencyRatio))}else{var n;s=countryInfo[a].id;void 0===currencyRatio[s]&&(currencyRatio[s]={}),void 0===(n=currencyRatio[s]).sell&&(n.sell={}),n.sell.ratio=i,setUpdatedDate(n.sell),localStorage.setItem("currencyRatio",JSON.stringify(currencyRatio))}}}function enhanceCurrency(){$("div.xflagsSmall + b").each(function(){var t=$(this);if(!isNaN(t.text())){var e=getCountryFormXflagsClass(t.prev().attr("class")),i=countryInfo[e]&&countryInfo[e].id;if(i&&currencyRatio[i]&&currencyRatio[i].sell&&currencyRatio[i].buy){var a=countryInfo[i]&&countryInfo[i].currencyName;if(-1!==t.parent().text().indexOf(t.text()+" "+a)){var s=parseFloat(t.text()),n=currencyRatio[i].sell.ratio,r=s/n,o=currencyRatio[i].buy.ratio,l=s/o,h=Math.abs(r-l)<.01,d=((n+o)/2).toPrecision(4),c=((r+l)/2).toPrecision(4);r=r.toPrecision(4),l=l.toPrecision(4),h?1===t.next().length?t.next().before("(",$("<b>",{text:c,title:d+" "+a+" = 1 Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")"):t.parent().append("(",$("<b>",{text:c,title:d+" "+a+" = 1 Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")"):1===t.next().length?t.next().before("(",$("<b>",{text:l+" 或 "+r,title:"用 "+l+" Gold买 "+s+" "+a+"，或用 "+s+" "+a+"卖 "+r+" Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")"):t.parent().append("(",$("<b>",{text:l+" 或 "+r,title:"用 "+l+" Gold买 "+s+" "+a+"，或用 "+s+" "+a+"卖 "+r+" Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")")}}}}),$("td b").each(function(){var t=$(this).text().trim().split(" ");if(2===t.length&&!isNaN(t[0])&&countryInfo[t[1]]){parseFloat(t[0]);var e=t[1],i=countryInfo[e]&&countryInfo[e].id;if(i&&currencyRatio[i]&&currencyRatio[i].sell&&currencyRatio[i].buy){var a=parseFloat(t[1]),s=currencyRatio[i].sell.ratio,n=a/s,r=currencyRatio[i].buy.ratio,o=a/r,l=Math.abs(n-o)<.1,h=((s+r)/2).toPrecision(4),d=((n+o)/2).toPrecision(4);n=n.toPrecision(4),o=o.toPrecision(4),l?$(this).after(" (",$("<b>",{text:d,title:h+" "+e+" = 1 Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")"):$(this).after(" (",$("<b>",{text:o+" 或 "+n,title:"用 "+o+" Gold买 "+a+" "+e+"，或用 "+a+" "+e+"卖 "+n+" Gold"}),$("<div>",{class:"xflagsSmall xflagsSmall-Gold"}),")")}}})}function enhanceBattle(){clipWithFlag=!1,$("#battleHeaderImage").attr("style","height:85px; background-color:#222"),$("#battleHeaderImage img").remove();var t=$(".small-2").eq(1);t.attr("id","ehPanel"),t.prev().attr("class",t.prev().attr("class").replace("small-4","small-2")),t.next().attr("class",t.next().attr("class").replace("small-4","small-2")),t.attr("class",t.attr("class").replace("small-2","small-3")),t.after($("<div>",{class:t.attr("class"),id:"ehRefresh"})),t.empty();for(var e=[["调试","Debug","bug"],["飞行","Flight","airplane"],["统计","Statistics","stocks"],["特殊","Special","uniF00F"],["观战","Spectator","eye"],["详细","SpectatorDetail","users"],["闹钟","Alarm","uptime"],["高级","Advanced","uniF478"]],i="padding:6px 2px 6px 2px;",a=0;a<e.length;++a){var s=$('<button class="small button foundation-style" style="'+i+'" id="ehButton'+e[a][1]+'"> <i class="icon-'+e[a][2]+'"></i>'+e[a][0]+"</button> "),n=$("<div>",{class:"foundation-radius fightContainer foundation-base-font",style:"display:none;",id:"ehDiv"+e[a][1]});s.click(function(){this.getAttribute("style")==i?($("[id^=ehButton]").attr("style",i),$("[id^=ehDiv]").attr("style","display:none;"),this.setAttribute("style","padding:6px 2px 6px 2px; color:orange;"),$("#"+this.getAttribute("id").replace("Button","Div")).attr("style","display:block;")):($("[id^=ehButton]").attr("style",i),$("[id^=ehDiv]").attr("style","display:none;"))}),t.append(s);var r=localStorage.getItem("battleEnhanceDivPlacement");null==r||"true"!=r?t.parent().after(n):$("#battleSelectable:first").before(n)}setupDebug(),setupWall(),setupRefresh(),setupFlight(),setupStatistics(),setupSpecial(),setupSpectator(),setupAlarm(),setupSpectatorDetail(),setupFight(),setupFightButton(),markAlliance(),fixFightFlag(),setupAdvanced(),addMedkitButton(),"true"===localStorage.getItem("battleBorderless")&&BorderlessBattlePage(),$("#recentDefenders").parent().parent().prependTo($("#recentDefenders").parent().parent().parent().parent()),$("#minimalChatpanel").remove()}function BorderlessBattlePage(){GM_addStyle("#newFightView .fightContainer { margin: 0em!important;padding: .3em!important;border-style:none;}"),GM_addStyle("#newFightView .fightContainer .topPlayer { padding-top: 0px!important;}"),GM_addStyle("#newFightView .fightContainer .topPlayer a img { margin: 0px auto!important;}"),GM_addStyle("#newFightView .fightContainer .fightRounds { margin: 0em!important;}"),GM_addStyle("#newFightView .fightContainer #roundCountdown { font-size: 2.4em!important;margin:0 0!important;}"),GM_addStyle("#battleSelectable #selectable4, #battleSelectable #selectable5, #battleSelectable #selectable6 { height: 30px!important;}"),GM_addStyle("#battleSelectable #selectable4 li, #battleSelectable #selectable5 li, #battleSelectable #selectable6 li { height: 30px!important;}"),GM_addStyle(".laurelssprite { height: 90px!important;}"),$("i.icon-bread.ui-selectee").remove(),$("i.icon-gift-2.ui-selectee").remove(),$("i.icon-uniF470.ui-selectee").remove(),$("i.icon-tank.ui-selectee").remove();for(var t=$(".topPlayer").children(),e=0;e<t.length;++e)"<br>"==t[e].outerHTML&&$(".topPlayer")[0].removeChild(t[e]);$("#moreBattleStats").parent().remove()}function addMedkitButton(){var t=$("#medkitForm");if(t.length>0){var e=$("<button>",{id:"sendMedkitRequest",class:"button smallhelp foundation-style",text:"无需确认直接使用医疗包（当前页面不会刷新额度显示）"}).prependTo(t.parent());e.click(function(){e.attr({disabled:!0});$.ajax({type:"POST",url:"storage.html",data:"item=MEDKIT&storageType=SPECIAL_ITEM&action=USE",success:function(){e.attr({disabled:!1}),console.log("使用医疗包：成功响应")},error:function(t,e){console.log("使用医疗包时发生错误")}})})}}function getEhTime(){isNaN(endEpoch)&&(endEpoch=(new Date).getTime()+1e3*getPageTime());var t=parseInt((endEpoch-(new Date).getTime())/1e3)-timeBias;return t<0?0:t}function getPageTime(){var t=$("#roundCountdown");return hmsArray=t.text().split(/:| /),3600*parseInt(hmsArray[0])+60*parseInt(hmsArray[1])+parseInt(hmsArray[2])}function getTimeString(t){var e=parseInt(t/60)%60,i=t%60;return"0"+parseInt(t/3600)+(e<10?":0":":")+e+(i<10?":0":":")+i}function setupDebug(){$("#ehDivDebug").append($("<div>",{style:"text-align:left;"}));var t=$('a[href^="region.html?id="][href!="region.html?id="]');if(userId=parseInt($("#userName").attr("href").replace("profile.html?id=","")),userName=$("#userName").text(),userLocationId=parseInt(t.first().attr("href").replace("region.html?id=","")),userLocationName=t.first().text(),userCitizenshipId=parseInt($('li > a[href^="battles.html?countryId="][href$="&sorting=BY_TOTAL_DAMAGE&_substidedOnly=on"]').attr("href").match(/.+?countryId=([0-9]+).+?/)[1]),battleId=parseInt($('a[href^="battleStatistics.html?id="]').attr("href").replace("battleStatistics.html?id=","")),battleName=$("#fightName a[class=fightFont]").text().trim(),battleLocationId=parseInt(1==t.length?-1:t.last().attr("href").replace("region.html?id=","")),battleLocationName=-1==battleLocationId?"无":battleName,isResistance=$("#fightName div").length>0,roundId=parseInt($("span.fightFont").text().match("[0-9]+$")[0]),battleRoundId=parseInt($("#battleRoundId").val()),$(".xflagsBig").length>0?(defenderName=$(".xflagsBig:first").attr("class").split(" ").pop(),defenderName=defenderName.substring(defenderName.indexOf("-")+1),attackerName=$(".xflagsBig:last").attr("class").split(" ").pop(),attackerName=attackerName.substring(attackerName.indexOf("-")+1)):$(".flags-big").length>0?(defenderName=$(".flags-big:first").attr("class").split(" ").pop(),attackerName=$(".flags-big:last").attr("class").split(" ").pop()):$(".muAvatar").length>0?(defenderName=$(".alliesList.leftList.fightFont").text().trim(),attackerName=$(".alliesList.rightList.fightFont").text().trim()):(defenderName="未知",attackerName="未知"),defenderId=countryInfo[defenderName]&&countryInfo[defenderName].id,attackerId=countryInfo[attackerName]&&countryInfo[attackerName].id,defenderScore=$('img[src$="/img/blue_ball.png"]').length,attackerScore=$('img[src$="/img/red_ball.png"]').length,defenderDescription=battleName+", "+defenderName+"方",attackerDescription=battleName+", "+attackerName+"方",isActive=roundId>defenderScore+attackerScore,isPremium=$("#totalspectators").length>0,log("玩家id=",userId,", 玩家名字=",userName,", 国籍=",userCitizenshipId,", 会员=",isPremium,", 当前位置=",userLocationName," (",userLocationId,")"),log("战斗id=",battleId,", 战斗名字=",battleName,", 战斗地点=",battleLocationName," (",battleLocationId,")"),log("起义战=",isResistance,", 局数=",roundId,", battleRoundId=",battleRoundId,", 战斗中=",isActive),log(defenderName," v.s. ",attackerName,", 比分",defenderScore,":",attackerScore),timeBias=0,endEpoch=(new Date).getTime()+72e5,clipWithFlag?(defenderNameOrFlag="/"+defenderName.slice(0,5),attackerNameOrFlag="/"+attackerName.slice(0,5)):(defenderNameOrFlag=defenderName,attackerNameOrFlag=attackerName),-1==battleLocationId)document.title=battleName;else{var e=countryInfo[defenderName].shortName,i=countryInfo[attackerName].shortName;"Kekistan"==defenderName&&(e="KK"),"Kekistan"==attackerName&&(i="KK"),document.title=e+" vs "+i+" @"+battleName}}function log(){var t=$("#ehDivDebug > div");t.append($(".time").first().text().split(" ")[0].slice(0,-1),": ");for(var e=0;e<arguments.length;e++)t.append(arguments[e].toString()," ");t.append("<br />")}function setupFightButton(){var t,e,i,a,s,n,r,o=$(".fightButton").length;function l(t){var e=jQuery.parseJSON(t);$("#foodLimit").html(e.foodLimit),$("#giftLimit").html(e.giftLimit),$("#foodLimit2").html(e.foodLimit),$("#giftLimit2").html(e.giftLimit),$("#wellness").html(e.wellness),$("#healthBar").html(e.wellness),$("#healthProgress .ui-progressbar-value").animate({width:e.wellness+"%"},{queue:!1}),$("#actualHealth").html(e.wellness),$("#foodQ1").html("<b>Q1</b><br>"+e.q1FoodStorage),$("#foodQ2").html("<b>Q2</b><br>"+e.q2FoodStorage),$("#foodQ3").html("<b>Q3</b><br>"+e.q3FoodStorage),$("#foodQ4").html("<b>Q4</b><br>"+e.q4FoodStorage),$("#foodQ5").html("<b>Q5</b><br>"+e.q5FoodStorage),$("#giftQ1").html("<b>Q1</b><br>"+e.q1GiftStorage),$("#giftQ2").html("<b>Q2</b><br>"+e.q2GiftStorage),$("#giftQ3").html("<b>Q3</b><br>"+e.q3GiftStorage),$("#giftQ4").html("<b>Q4</b><br>"+e.q4GiftStorage),$("#giftQ5").html("<b>Q5</b><br>"+e.q5GiftStorage),$("#sfoodQ1").html("<b>Q1</b><br>"+e.q1FoodStorage),$("#sfoodQ2").html("<b>Q2</b><br>"+e.q2FoodStorage),$("#sfoodQ3").html("<b>Q3</b><br>"+e.q3FoodStorage),$("#sfoodQ4").html("<b>Q4</b><br>"+e.q4FoodStorage),$("#sfoodQ5").html("<b>Q5</b><br>"+e.q5FoodStorage),$("#sgiftQ1").html("<b>Q1</b><br>"+e.q1GiftStorage),$("#sgiftQ2").html("<b>Q2</b><br>"+e.q2GiftStorage),$("#sgiftQ3").html("<b>Q3</b><br>"+e.q3GiftStorage),$("#sgiftQ4").html("<b>Q4</b><br>"+e.q4GiftStorage),$("#sgiftQ5").html("<b>Q5</b><br>"+e.q5GiftStorage)}2===o?(t=$("#fightButtonBerserk1").parent(),r=$("#fightButtonBerserk1").attr("name"),t.append("<br />"),i=$("<a id='foodWithFight1' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' href='#' title='' value='Berserk' name='"+r+"'> Hit & food</a>"),t.append(i),s=$("<a id='giftWithFight1' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' href='#' title='' value='Berserk' name='"+r+"'>Hit & gift</a>"),t.append(s)):4===o&&(t=$("#fightButtonBerserk1").parent(),r=$("#fightButtonBerserk1").attr("name"),t.append("<br />"),i=$("<a id='foodWithFight1' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+r+"'> Hit & food</a>"),t.append(i),s=$("<a id='giftWithFight1' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+r+"'>Hit & gift</a>"),t.append(s),e=$("#fightButtonBerserk2").parent(),r=$("#fightButtonBerserk2").attr("name"),e.append("<br />"),a=$("<a id='foodWithFight2' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+r+"'> Hit & food</a>"),e.append(a),n=$("<a id='giftWithFight2' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+r+"'>Hit & gift</a>"),e.append(n),a.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)"),n.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)")),0!==o&&(i.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)"),s.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)")),$(".foodWithFight").click(function(t){return t.preventDefault(),t.stopPropagation(),(parseFloat($("#actualHealth").html())<=51||getPageTime()%5==0)&&function(){var t="quality="+$("#foodQuality").val();if(0==varEnableBattleAjaxTimeout)$.ajax({type:"POST",url:"eat.html",data:t,success:function(t){l(t)}});else var e=$.ajax({type:"POST",url:"eat.html",timeout:1e3*varBattleAjaxTimeout,data:t,success:function(t){l(t)},error:function(t,i,a){"timeout"==i&&e.abort()}})}(),sendFightRequest($(this)[0].name,$(this).attr("value")),!1}),$(".giftWithFight").click(function(t){return t.preventDefault(),t.stopPropagation(),(parseFloat($("#actualHealth").html())<=51||getPageTime()%5==0)&&function(){var t="quality="+$("#giftQuality").val();if(0==varEnableBattleAjaxTimeout)$.ajax({type:"POST",url:"gift.html",data:t,success:function(t){l(t)}});else var e=$.ajax({type:"POST",url:"gift.html",timeout:1e3*varBattleAjaxTimeout,data:t,success:function(t){l(t)},error:function(t,i,a){"timeout"==i&&e.abort()}})}(),sendFightRequest($(this)[0].name,$(this).attr("value")),!1})}function sendFightRequest(t,e){var i="weaponQuality="+$("#weaponQuality").attr("value")+"&battleRoundId="+$("#battleRoundId").val()+"&side="+t+"&value="+e;if(0==varEnableBattleAjaxTimeout)$.ajax({type:"POST",url:"fight.html",data:i,success:function(t){$("#fightResponse > div").replaceWith(t),showDamege($(t));var e=$("#healthUpdate",t).text();if(""!==e){var i=e.substr(0,e.length-3);i<100&&$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right"),$("#healthProgress .ui-progressbar-value").animate({width:i+"%"},{queue:!1}),$("#healthProgress").attr("title",i+" / 100"),$("#actualHealth").html(i)}},error:function(t,e,i){if("404"==t.status){var a=window.location.protocol,s=window.location.href;"http:"==a?(s="https:"+s.substring(5),alert("404错误！点击“确认”立刻切换协议为：https！\r\n建议删除cookie以解决此问题。"),location=s):"https:"==a?(s="http:"+s.substring(6),alert("404错误！点击“确认”立刻切换协议为：http！\r\n建议删除cookie以解决此问题。"),location=s):alert("404错误！请立刻切换协议！\r\n建议删除cookie以解决此问题。")}else{var n=$("#showMsg");n.text("错误："+t.status),n.show(),n.fadeOut(2e3)}}});else var a=$.ajax({type:"POST",url:"fight.html",timeout:1e3*varBattleAjaxTimeout,data:i,success:function(t){$("#fightResponse > div").replaceWith(t),showDamege($(t));var e=$("#healthUpdate",t).text();if(""!==e){var i=e.substr(0,e.length-3);i<100&&$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right"),$("#healthProgress .ui-progressbar-value").animate({width:i+"%"},{queue:!1}),$("#healthProgress").attr("title",i+" / 100"),$("#actualHealth").html(i)}},error:function(t,e,i){if("404"==t.status){var s=window.location.protocol,n=window.location.href;"http:"==s?(n="https:"+n.substring(5),alert("404错误！点击“确认”立刻切换协议为：https！\r\n建议删除cookie以解决此问题。"),location=n):"https:"==s?(n="http:"+n.substring(6),alert("404错误！点击“确认”立刻切换协议为：http！\r\n建议删除cookie以解决此问题。"),location=n):alert("404错误！请立刻切换协议！\r\n建议删除cookie以解决此问题。")}else if("timeout"==e){a.abort(),(r=$("#showMsg")).text("请求超时"),r.show(),r.fadeOut(2e3)}else{var r;(r=$("#showMsg")).text("错误："+t.status),r.show(),r.fadeOut(2e3)}}})}function showDamege(t){var e=$("#showMsg");e.text(""),e.show();var i=$("#DamageDone",t);if(i.length>0){for(var a=parseInt(i.text().replace(/,/g,"").replace(/\xA0/g,"")),s=$(".fightsprite",i.parent().parent()),n={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]},r={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]},o=0;o<s.length;++o){var l=s.eq(o).attr("class").split(" ").pop();if(l in r){var h=r[l];n[h[0]]=h[1]}}var d="",c=n.xp;delete n.xp;for(o in n)d='<i style="color:'+n[o][0]+';" class="icon-'+o+'" title="'+n[o][1]+'"></i>'+d;d+='<b title="'+c+'次攻击">x'+c+"</b>";var p=$("#fightHistory"),u=$("div[class^=foundation-style]",p);6===u.length&&$("#ehHistoryExpand").show(),u.slice(0,2).attr("style","opacity:0.6;"),u.slice(2,4).attr("style","opacity:0.3;"),!1===$("#ehHistoryExpand").is(":hidden")&&u.slice(4,6).hide(),-1!==$("#fightResult>div").attr("class").split(" ").pop().indexOf("critical")?p.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:d}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right critical",text:i.text()})):p.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:d}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right",text:i.text()})),$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+c),$("#ehTotalDamage").text((parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}else e.text($("#fightResponse").text().trim()),e.fadeOut(2e3)}function setupFlight(){if(isActive&&-1!=battleLocationId){var t=$("#ehDivFlight"),e=$("<div>"),i=$("<td>",{id:"defenderRegions",style:"text-align:left; font-size:9px; width:280px"}),a=$("<td>",{id:"attackerRegions",style:"text-align:right; font-size:9px; width:280px"}),s=$("<td>",{style:"text-align:center; width:250px"});e.append(i,s,a),t.append(e);for(var n=$("<select>",{id:"ticketQuality",name:"ticketQuality",style:"padding:3px; margin:3px"}),r=1;r<=5;++r)n.append($('<option value="'+r+'">Q'+r+"</option>"));var o=localStorage.getItem("ticketSelectQuality");null!==o&&n.val(o),n.change(function(){localStorage.setItem("ticketSelectQuality",n.val())});var l=$("<button>",{text:"飞行",class:"small button foundation-style",style:"padding:5px; margin:3px;"}),h=$("<input>",{type:"checkbox",id:"newFightFrameCheckbox"}),d=$("<label>",{class:"checkboxlabel",for:"newFightFrameCheckbox",text:"刷新攻击框 ",title:"飞行后不刷新网页，只刷新攻击框"}),c=localStorage.getItem("newFightFrame");null==c?localStorage.setItem("newFightFrame","false"):h.attr("checked","true"==c),h.click(function(){$("input[type='radio']:disabled",e).removeAttr("disabled"),h.is(":checked")?localStorage.setItem("newFightFrame",!0):localStorage.setItem("newFightFrame",!1)});var p=$("<div>");s.append(n,l,p);var u=$("<b>",{text:"强制刷新",style:"text-align:right;color:#0066cc;text-decoration:underline;cursor:pointer"});u.click(function(){p.text("正在更新..."),x(location)}),s.append(h,d,u);var g=$("form[action='travel.html']");if(g.length>0){var f,m=g.children(".foundation-text-center").children("select#ticketQuality");for(r=1;r<=5;++r){var b=m.find("option[value="+r+"]");b.length<1?f=0:(f=b.text().split("(")[1].split(")")[0]).indexOf(",")>0&&(f=f.split(",")[0]),""!==f?$("#ticketQuality option[value='"+r+"']").text("Q"+r+" ("+f+")"):$("#ticketQuality option[value='"+r+"']").text("Q"+r+" (0)")}}else $.ajax({url:"travel.html",success:function(t){console.log("获取机票数量成功");for(var e,i=$("select#ticketQuality",t),a=1;a<=5;++a){var s=i.find("option[value="+a+"]");s.length<1?e=0:(e=s.text().split("(")[1].split(")")[0]).indexOf(",")>0&&(e=e.split(",")[0]),""!==e?$("#ticketQuality option[value='"+a+"']").text("Q"+a+" ("+e+")"):$("#ticketQuality option[value='"+a+"']").text("Q"+a+" (0)")}},error:function(t,e){console.log("获取机票数量失败 (",e,")，重新抓取"),$.ajax(this)}});processRegions(),"true"==c&&$("input[type='radio']:disabled",e).removeAttr("disabled"),l.click(function(){var t=$("input[type='radio']:checked",e);if(0!==t.length){var i=parseInt(n.val()),a=parseInt(t.attr("countryId")),s=parseInt(t.val());p.text("使用Q"+i+"机票飞往 "+countryInfo[a].name+" 的 "+regionInfo[s].name),$.ajax({url:"travel.html",type:"POST",data:{countryId:a,regionId:s,ticketQuality:i},success:function(t){var e;!0===$("#newFightFrameCheckbox").is(":checked")?1===(e=$("div.testDivred",t)).length?p.text("飞行失败："+e.text().trim()):(p.text("飞行成功！更新攻击框中……"),x(location)):1===(e=$("div.testDivred",t)).length?p.text("飞行失败："+e.text().trim()):(p.text("飞行成功！"),0===$("#fightButtonBerserk1").length&&(location=location))},error:function(t,e){console.log("飞行错误 (",e,")")}})}else p.text("请选择地区")})}else $("#ehButtonFlight").attr("disabled",!0);function x(t){$.ajax({url:t,success:function(t){var e=$("link[href='//cdn.e-sim.org//css/fight.css']",t).parent();if($("#fightLeft").length>0){$("#fightRight").empty(),$("#fightRight").append(e.children());var i=$("[id^=fightButton]").parent().parent();$("[id^=fightButton] > i",i).remove()}else $("link[href='//cdn.e-sim.org//css/fight.css'] :first").parent().replaceWith(e),setupFight();var a=parseFloat($("#actualHealth",t).html());$("#healthProgress .ui-progressbar-value").animate({width:a+"%"},{queue:!1}),$("#healthProgress").attr("title",a+" / 100"),$("#actualHealth").html(a),$(".fightButton").click(function(t){return t.preventDefault(),t.stopPropagation(),sendFightRequest($(this)[0].name,$(this).attr("value")),!1}),setupFightButton(),fixFightFlag(),setupAdvancedFightChooseTable("advancedFightChooseTable");var s=$('a[href^="region.html?id="][href!="region.html?id="]').first().parent(),n=$('a[href^="region.html?id="][href!="region.html?id="]',t).first().parent();s.replaceWith(n),p.text("更新完毕！")}})}}function markAlliance(){if(isActive)if(defenderId==allies[0]?$(".xflagsBig-"+defenderName).after('<div class="fightFont">祖国</div>'):allies.indexOf(defenderId)>0?$(".xflagsBig-"+defenderName).after('<div class="fightFont">盟国</div>'):-1!==enemies.indexOf(defenderId)?$(".xflagsBig-"+defenderName).after('<div class="fightFont">敌国</div>'):coalitionMembers.indexOf(defenderId)>0&&$(".xflagsBig-"+defenderName).after('<div class="fightFont">联盟成员国</div>'),attackerId==allies[0]?$(".xflagsBig-"+attackerName).after('<div class="fightFont">祖国</div>'):allies.indexOf(attackerId)>0?$(".xflagsBig-"+attackerName).after('<div class="fightFont">盟国</div>'):-1!==enemies.indexOf(attackerId)?$(".xflagsBig-"+attackerName).after('<div class="fightFont">敌国</div>'):coalitionMembers.indexOf(attackerId)>0&&$(".xflagsBig-"+attackerName).after('<div class="fightFont">联盟成员国</div>'),-1!==allies.indexOf(defenderId)&&-1===allies.indexOf(attackerId)){var t=defenderId==allies[0]?"祖国":"盟国";$(".flags-medium."+defenderName).after('<b style="color:lightgreen"><i class="icon-uniF479" />帮助'+t+"</b>"),$(".flags-medium."+attackerName).after('<b style="color:pink"><i class="icon-uniF478" />打反'+t+"</b>")}else if(-1===allies.indexOf(defenderId)&&-1!==allies.indexOf(attackerId)){t=attackerId==allies[0]?"祖国":"盟国";$(".flags-medium."+attackerName).after('<b style="color:lightgreen"><i class="icon-uniF479" />帮助'+t+"</b>"),$(".flags-medium."+defenderName).after('<b style="color:pink"><i class="icon-uniF478" />打反'+t+"</b>"),$("#copySideAttacker").attr("checked",!0)}else-1!==enemies.indexOf(defenderId)&&-1===enemies.indexOf(attackerId)?($(".flags-medium."+attackerName).after('<b style="color:lightgreen"><i class="icon-uniF479" />攻击敌国</b>'),$(".flags-medium."+defenderName).after('<b style="color:pink"><i class="icon-uniF478" />帮助敌国</b>'),$("#copySideAttacker").attr("checked",!0)):-1===enemies.indexOf(defenderId)&&-1!==enemies.indexOf(attackerId)&&($(".flags-medium."+defenderName).after('<b style="color:lightgreen"><i class="icon-uniF479" />攻击敌国</b>'),$(".flags-medium."+attackerName).after('<b style="color:pink"><i class="icon-uniF478" />帮助敌国</b>'))}function fixFightFlag(){$(".flags-medium."+defenderName).attr("class","xflagsMedium xflagsMedium-"+defenderName),$(".flags-medium."+attackerName).attr("class","xflagsMedium xflagsMedium-"+attackerName)}function processRegions(){function t(t,e){for(var i=[],a=0;a<regionInfo[t].neighbours.length;++a){var s=regionInfo[t].neighbours[a];regionInfo[s].occupantId==e&&i.push(s)}return i}function e(e,i,a){var s=[],n=[e],r=a,o=!1;for(r.push(e);n.length>0;){var l=n.pop();s.push(l),regionInfo[l].homeCountry==i&&(o=!0);for(var h=t(l,i),d=0;d<h.length;++d){var c=h[d];-1==r.indexOf(c)&&(n.push(c),r.push(c))}}return[s,o]}function i(t,e,i){var a=regionInfo[e].name,s=$("<input>",{type:"radio",name:"regionId",id:"rR"+t.selector.substring(1,2)+"-"+e,value:e,countryId:regionInfo[e].occupantId}),n='<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[e].occupantId].flagName+'" />';return regionInfo[e].occupantId!=regionInfo[e].homeCountry&&(n+='(<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[e].homeCountry].flagName+'" />)'),n+='<label for="rR'+t.selector.substring(1,2)+"-"+e+'"> '+regionInfo[e].name+"</label>",regionInfo[e].battle&&(n+=' <i title="'+regionInfo[e].name+'正在被攻击" class="icon-cannon"></i> '),i||(n+=" (被包围)",a+="(被包围)"),userLocationId==e&&s.attr("disabled","disabled")&&(n+=" (你在这里)"),t.append(s,n,"<br />"),a}defenderId=countryInfo[defenderName].id,attackerId=countryInfo[attackerName].id;var a=e(battleLocationId,defenderId,[]),s=a[1];a=a[0],log("防守方被包围：",!s),isAttackerLinkage=!1,isDefenderLinkage=!1;var n=t(battleLocationId,defenderId);if(0===n.length)isDefenderLinkage=!1,log(battleName,"不与防守方其它地区相连，所以",battleName,"不是守方连接地");else{var r=e(n[0],defenderId,[battleLocationId]),o=r[1];if((r=r[0]).length==a.length-1)log(battleName,"丢掉后，防守方现在相连的地区仍相连，所以",battleName,"不是守方连接地");else if(o)for(var l=1;l<n.length;++l){if(-1==r.indexOf(n[l]))e(n[l],defenderId,[battleLocationId])[1]?(isDefenderLinkage=!1,log(battleName,"丢掉后，防守方现在相连的地区被切断，但都与本土相连，因此",battleName,"不是守方连接地")):(isDefenderLinkage=!0,log(battleName,"丢掉后，防守方现在相连的地区被切断，且",regionInfo[n[l]].name,"不与本土相连，因此",battleName,"是守方连接地"))}else isDefenderLinkage=!0,log(battleName,"丢掉后，防守方现在相连的地区被切断，且",regionInfo[n[0]].name,"不与本土相连，因此",battleName,"是守方连接地")}defenderLocationText=i($("#defenderRegions"),battleLocationId,s),attackerLocationText="",isResistance&&(attackerLocationText=i($("#attackerRegions"),battleLocationId,!0));for(var h=t(battleLocationId,defenderId),d=!1,c=0;c<h.length;++c)d=e(h[c],defenderId,[])[1],defenderLocationText+=(""!==defenderLocationText?" 或 ":"")+i($("#defenderRegions"),h[c],d);var p=t(battleLocationId,attackerId),u=[],g=[],f=!1,m=!1,b=null;for(c=0;c<p.length;++c){var x=p[c];if(-1==u.indexOf(x)){m=c>0,(f=(g=e(p[c],attackerId,[]))[1])||(b=p[c]),g=g[0];for(l=0;l<p.length;++l)-1!=g.indexOf(p[l])&&(isResistance||(attackerLocationText+=(""!==attackerLocationText?" 或 ":"")+i($("#attackerRegions"),p[l],f)),u.push(p[l]))}}m?null===b?(isAttackerLinkage=!1,log(battleName,"攻克后，进攻方的两组地区连成一片，但它们已与本土相连，因此",battleName,"不是夺回连接地")):(isAttackerLinkage=!0,log(battleName,"攻克后，进攻方被包围的"+regionInfo[b].name+"将与另一地区相连，因此",battleName,"是夺回连接地")):(isAttackerLinkage=!1,log(battleName,"攻克后，进攻方没连接新的地区，因此",battleName,"不是夺回连接地"));var v=' <div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[battleLocationId].homeCountry].flagName+'" />',y=battleLocationName;if(regionInfo[battleLocationId].capital&&(v+='<img style="height:16px" src="https://cdn.e-sim.org/img/map/house.png"> ',y+=" (首都)"),"HIGH"===regionInfo[battleLocationId].rawRichness){var k=regionInfo[battleLocationId].raw.toLowerCase();v+='<img style="height:16px" src="http://cdn.e-sim.org/img/productIcons/'+(k=k.charAt(0).toUpperCase()+k.slice(1))+'.png"> ',y+=" ("+k+")"}isDefenderLinkage&&(v+=' (<div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+defenderName+'" />防守连接地) '),isAttackerLinkage&&(v+=' (<div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+attackerName+'" />收复连接地) '),$("#fightName a[class=fightFont]").append(v);var S=(isResistance?4:0)+(isDefenderLinkage?2:0)+(isAttackerLinkage?1:0),w=[defenderNameOrFlag+" 在 "+y+"防守"+attackerNameOrFlag,defenderNameOrFlag+" 防守 "+y+", 保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 在连接地 "+y+"防守"+attackerNameOrFlag,defenderNameOrFlag+" 防守连接地 "+y+", 并保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 镇压 "+attackerNameOrFlag+" 在 "+y+" 的起义",defenderNameOrFlag+" 镇压 "+y+" 的起义, 保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 镇压 "+attackerNameOrFlag+" 在连接地 "+y+" 的起义",defenderNameOrFlag+" 镇压连接地 "+y+" 的起义, 并保持"+attackerNameOrFlag+"断路"],_=[attackerNameOrFlag+" 进攻 "+defenderNameOrFlag+" 的 "+y,attackerNameOrFlag+" 进攻 "+defenderNameOrFlag+", 收复连接地 "+y,attackerNameOrFlag+" 进攻 "+y+", 使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 收复连接地 "+y+", 同时使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 在 "+y+" 起义反抗 "+defenderNameOrFlag,attackerNameOrFlag+" 在 "+y+" 起义反抗 "+defenderNameOrFlag+", 收复连接地",attackerNameOrFlag+" 在 "+y+" 发起起义, 使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 在 "+y+" 发起起义, 收复连接地并使"+defenderNameOrFlag+"断路"];defenderDescription=w[S],attackerDescription=_[S],log(defenderDescription),log(attackerDescription)}function setupWall(){$("#battleProgressStats").append('<div id="wallStat"></div>'),endEpoch=(new Date).getTime()+1e3*getPageTime(),window.setInterval(function(){var t=getEhTime();$("#ehCountdown").text(getTimeString(t));var e=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,"")),i=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,"")),a=e-i;0===a?$("#wallStat").text(""):a>0?$("#wallStat").text(">> "+a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>"):$("#wallStat").text("<< "+(-a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<"),$("#autoCopy").is(":checked")&&setClipboard(),t>0&&t<clutchStandard&&(defenderHistoryClutch.length<=1?(lastUpdatedSeconds=t,defenderHistoryClutch.push([-t,e]),attackerHistoryClutch.push([-t,i])):(defenderHistoryClutch[defenderHistoryClutch.length-1][1]<e||attackerHistoryClutch[attackerHistoryClutch.length-1][1]<i)&&(lastUpdatedSeconds=t,defenderHistoryClutch.push([-t,e]),attackerHistoryClutch.push([-t,i])),$("#wallStat").append(' <b style="font-size:12px;">('+(lastUpdatedSeconds-t)+"秒前更新)</b>"),lastUpdatedSeconds<=t&&(function(){var t=defenderHistoryClutch.length-1;if(!(t<=1)){for(var e=t-1;e>0&&defenderHistoryClutch[e][0]>defenderHistoryClutch[t][0]-15;)e--;e++;var i=defenderHistoryClutch[t][0]-defenderHistoryClutch[e][0],a=(defenderHistoryClutch[t][1]-defenderHistoryClutch[e][1])/i,s=(attackerHistoryClutch[t][1]-attackerHistoryClutch[e][1])/i;$("#defenderFirepower").text((15*a/1e6).toFixed(1)),$("#attackerFirepower").text((15*s/1e6).toFixed(1))}}(),-1!=$("#ehDivStatistics").attr("style").indexOf("display:block")&&drawChartClutch()))},1e3)}function setupRefresh(){var t=$("#ehRefresh"),e=$("<div>"),i=$("<button>",{type:"button",class:"small button foundation-style",id:"manualRefresh",style:"padding:6px;",html:'<i class="icon-search"></i>刷新',title:"刷新双方的总伤害"}),a=$("<input>",{type:"checkbox",class:"foundation-style",id:"autoRefresh",text:"自动"}),s=$("<input>",{type:"radio",id:"copySideDefender",name:"copySide",value:"defender",checked:"checked"});$("#fightName a[class=fightFont]").text().trim();if($(".xflagsBig").length>0)var n=$("div.xflagsBig").first().attr("class").split(" ")[2],r=$("<p>",{style:"vertical-align:middle;",class:"xflagsSmall xflagsSmall-"+n.substring(n.indexOf("-")+1)});else if($(".flags-big").length>0)r=$("<p>",{style:"vertical-align:middle;",class:"xflagsSmall xflagsSmall-"+$("div.fightFlag.flags-big").first().attr("class").split(" ")[2]});else r=$("<span>",{style:"vertical-align:middle;",class:"icon-uniF472"});e.append(i,a,"自动",s,r);var o=$("<div>"),l=$("<button>",{type:"button",class:"small button foundation-style",id:"manualCopy",style:"padding:6px;",html:'<i class="icon-comment2"></i>复制',title:"复制战场状态到剪贴板"}),h=$("<input>",{type:"checkbox",class:"foundation-style",id:"autoCopy",text:"自动"}),d=$("<input>",{type:"radio",id:"copySideAttacker",name:"copySide",value:"attacker"});if($(".xflagsBig").length>0)var c=$("div.xflagsBig").last().attr("class").split(" ")[2],p=$("<p>",{style:"vertical-align:middle;",class:"xflagsSmall xflagsSmall-"+c.substring(c.indexOf("-")+1)});else if($(".flags-big").length>0)p=$("<p>",{style:"vertical-align:middle;",class:"xflagsSmall xflagsSmall-"+$("div.fightFlag.flags-big").last().attr("class").split(" ")[2]});else p=$("<span>",{style:"vertical-align:middle;",class:"icon-uniF473"});o.append(l,h,"自动",d,p),t.append(e,o),$("#defenderScore").after('<div title="防守方即时输出，仅在自动刷新时显示">防守火力: <b id="defenderFirepower" style="color:lightblue">?</b> M/15秒</div>'),$("#attackerScore").after('<div title="进攻方即时输出，仅在自动刷新时显示">进攻火力: <b id="attackerFirepower" style="color:pink">?</b> M/15秒</div>'),$("#manualRefresh").click(sendUpdateRequest2),$("#manualCopy").click(setClipboard);var u=0;if($("#autoRefresh").click(function(){$(this).is(":checked")?(getEhTime()>0&&(u=window.setInterval(sendUpdateRequest2,7e3)),$("#manualRefresh").attr("disabled",!0)):(window.clearInterval(u),$("#manualRefresh").attr("disabled",!1))}),$("#autoCopy").click(function(){$(this).is(":checked")?$("#manualCopy").attr("disabled",!0):$("#manualCopy").attr("disabled",!1)}),"function"==typeof unsafeWindow.sendUpdateRequest){var g=unsafeWindow.sendUpdateRequest.toString().replace(/dataString \+\= \'&at\=.+?;/,";").replace(/dataString \+\= \'&ci\=.+?;/,";").replace(/\s+/g,""),f=1075;isPremium&&(f=1100),g.length===f?log("sendUpdateRequest已检查，无变化（字数："+f+"）"):(alert("页面中的 sendUpdateRequest 函数有更新，请联系e-sim helper的开发者。刷新功能暂时禁用。\n"),$("#autoRefresh").attr("disabled",!0),$("#manualRefresh").attr("disabled",!0),log("sendUpdateRequest已检查，有变化"))}else log("sendUpdateRequest未检查");isActive||($("#autoRefresh").attr("disabled",!0),$("#manualRefresh").attr("disabled",!0),$("#autoCopy").attr("disabled",!0),$("#manualCopy").attr("disabled",!0),$("#copySideAttacker").attr("disabled",!0),$("#copySideDefender").attr("disabled",!0))}function setClipboard(){function t(t,e){var i=t.toString()+":"+e.toString();return t===e?i:t>e?i+(8===t?"获胜":"领先"):i+(8===e?"失利":"落后")}var e=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,"")),i=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,"")),a=((e-i)/1e6).toFixed(2),s=getEhTime(),n="";if(s>=120||s%5==0){var r=document.URL.match(/.+?battle.html\?id=[0-9]+/).toString();r.indexOf("https")>=0?(n+=r+"\n",n+=r.replace(/https/,"http")+"\n"):r.indexOf("http")>=0?(n+=r.replace(/http/,"https")+"\n",n+=r+"\n"):n+=document.URL.match(/.+?battle.html\?id=[0-9]+/)+"\n"}if(s>=120)$("#copySideDefender").is(":checked")?n+="第"+roundId+"局(总比分"+t(defenderScore,attackerScore)+"), t"+parseInt(s/60)+"墙高"+a.toString()+"M\n"+defenderDescription+(-1==battleLocationId?"":"\n加成地点"+defenderLocationText):n+="第"+roundId+"局(总比分"+t(attackerScore,defenderScore)+"), t"+parseInt(s/60)+"墙高"+(-a).toString()+"M\n"+attackerDescription+(-1==battleLocationId?"":"\n加成地点"+attackerLocationText);else if(s>0){n+=s.toString()+"秒, ";var o=parseFloat($("#defenderFirepower").text()),l=parseFloat($("#attackerFirepower").text());$("#copySideDefender").is(":checked")?(n+=a.toString()+"M ("+(lastUpdatedSeconds-s)+"秒前更新)",isNaN(o)||(n+=", "+defenderNameOrFlag+"火力 "+o+(o<l?"M < ":"M ≥ ")+l+"M")):(n+=(-a).toString()+"M ("+(lastUpdatedSeconds-s)+"秒前更新)",isNaN(o)||(n+=", "+attackerNameOrFlag+"火力 "+l+(l<o?"M < ":"M ≥ ")+o+"M"))}else n+=battleName+"第"+roundId+"局结束, ",$("#copySideDefender").is(":checked")?n+=e>=i?"防守方"+defenderNameOrFlag+"获胜("+a.toString()+"M), 总比分"+t(defenderScore+1,attackerScore):"防守方"+defenderNameOrFlag+"失利("+a.toString()+"M), 总比分"+t(defenderScore,attackerScore+1):n+=i>=e?"进攻方"+attackerNameOrFlag+"获胜("+(-a).toString()+"M), 总比分"+t(attackerScore+1,defenderScore):"进攻方"+attackerNameOrFlag+"失利("+(-a).toString()+"M), 总比分"+t(attackerScore,defenderScore+1);GM_setClipboard(n)}function adjustTime(t){var e=getEhTime(),i=timeBias;t<e?timeBias+=e-t:timeBias>0&&e%6==0&&timeBias--,console.log("实际时间≤"+t+", 页面时间="+getPageTime()+", eh计时="+e+", 修正值="+i,"->",timeBias)}function sendUpdateRequest2(t){var e="id="+battleRoundId;e+="&at="+userId,e+="&ci="+userCitizenshipId,(isPremium||!0===t)&&(log("以高级会员身份抓取数据"),e+="&premium=1"),$.ajax({type:"GET",url:"battleScore.html",data:e,dataType:"json",success:function(e){if(historyLen=defenderHistoryClutch.length,!(historyLen>0&&(defenderHistoryClutch[historyLen-1][1]>parseInt(e.defenderScore.replace(/,/g,"").replace(/\xA0/g,""))||attackerHistoryClutch[historyLen-1][1]>parseInt(e.attackerScore.replace(/,/g,"").replace(/\xA0/g,""))))){e=cloneInto(e,unsafeWindow),unsafeWindow.updateStatus(e.attackerScore,e.defenderScore,e.remainingTimeInSeconds,e.percentAttackers),adjustTime(e.remainingTimeInSeconds),e.remainingTimeInSeconds<=clutchStandard&&(lastUpdatedSeconds=e.remainingTimeInSeconds<0?0:e.remainingTimeInSeconds,defenderHistoryClutch.push([-lastUpdatedSeconds,parseInt(e.defenderScore.replace(/,/g,"").replace(/\xA0/g,""))]),attackerHistoryClutch.push([-lastUpdatedSeconds,parseInt(e.attackerScore.replace(/,/g,"").replace(/\xA0/g,""))]),lastUpdatedSeconds>0&&-1!=$("#ehDivStatistics").attr("style").indexOf("display:block")&&drawChartClutch()),unsafeWindow.updateBattleHeros(e.topAttackers,e.topDefenders),unsafeWindow.updateTop10(e.top10Attackers,e.top10Defenders),isPremium||!1!==t?($("#ehTotaldefenders").html(e.defendersOnline),$("#ehTotalattackers").html(e.attackersOnline),$("#ehTotalspectators").html(e.spectatorsOnline),$("#ehDefendersMenu").html(e.defendersByCountries),$("#ehAttackersMenu").html(e.attackersByCountries),$("#ehSpectatorsMenu").html(e.spectatorsByCountries),$(".countryNameTranslated").attr("onclick","window.open('citizensOnline.html?countryId=' + countryInfo[this.innerText].id);")):unsafeWindow.updateBattleMonitor(e),unsafeWindow.updatePlace(e.yourPlace),unsafeWindow.updateTotalDamage(e.totalPlayerDamage);for(var i=0;i<e.recentAttackers.length;i++)if(e.recentAttackers[i].id==unsafeWindow.latestAttackerId){e.recentAttackers=cloneInto(e.recentAttackers.slice(0,i),unsafeWindow);break}for(i=0;i<e.recentDefenders.length;i++)if(e.recentDefenders[i].id==unsafeWindow.latestDefenderId){e.recentDefenders=cloneInto(e.recentDefenders.slice(0,i),unsafeWindow);break}0!==e.recentAttackers.length&&(unsafeWindow.latestAttackerId=e.recentAttackers[0].id,unsafeWindow.attackerHits=e.recentAttackers),0!==e.recentDefenders.length&&(unsafeWindow.latestDefenderId=e.recentDefenders[0].id,unsafeWindow.defenderHits=e.recentDefenders)}}})}function convertDateString(t){return t.slice(6,10)+"/"+t.slice(3,5)+"/"+t.slice(0,2)+t.slice(10,t.indexOf(":")+6)}function drawChartForFinishedBattle(t){var e=JSON.parse(t),i=new Date(convertDateString(e[e.length-1].time)),a=new Date(convertDateString(e[0].time));$("<div>",{text:"服务器时间 "+i.toLocaleString()+" - "+a.toLocaleString()}).prependTo($("#ehBattleDescription")),i=i.getTime();var s=parseInt((a.getTime()-i)/6e4);s<10?(i=a-6e5,s=10):s<120&&(i=a-72e5,s=120);for(var n={true:[],false:[]},r=0;r<=s;++r)n[!0][r]=0,n[!1][r]=0;var o={true:{},false:{}},l={true:{},false:{}},h={true:{},false:{}},d=0;for(r=0;r<e.length;++r){d+=(v=e[r]).berserk?5:1;var c=parseInt((Date.parse(convertDateString(v.time))-i)/6e4);n[v.defenderSide][c]=n[v.defenderSide][c]+v.damage;var p=v.citizenship;o[v.defenderSide][p]=o[v.defenderSide][p]?o[v.defenderSide][p]+v.damage:v.damage;var u=v.citizenId;h[v.defenderSide][u]=h[v.defenderSide][u]?h[v.defenderSide][u]+v.damage:v.damage;var g=v.militaryUnit;g&&(l[v.defenderSide][g]=l[v.defenderSide][g]?l[v.defenderSide][g]+v.damage:v.damage)}$("<div>",{text:"本局掉落Q5装备"+(d/3e4).toFixed(2)+"件，Q4装备"+(d/1e4).toFixed(2)+"件"}).prependTo($("#ehBattleDescription"));var f=new Array(s+1),m=new Array(s+1);for(f[0]=n[!0][0],m[0]=n[!1][0],r=1;r<=s;++r)f[r]=f[r-1]+n[!0][r],m[r]=m[r-1]+n[!1][r];var b=Math.pow(10,Math.floor(Math.log10(Math.max(f[s],m[s]))));$.jqplot("ehChart120m",[f,m],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"时间 (分钟)",max:s,min:0,tickOptions:{formatString:"%d"}},yaxis:{min:0,tickInterval:b,pad:1.1,tickOptions:{formatString:"%'d"}}}});var x=180;for(n={true:[],false:[]},r=0;r<=x;++r)n[!0][r]=0,n[!1][r]=0;h={true:{},false:{}};for(r=0;r<e.length;++r){var v=e[r];if(c=(c=parseInt((a-Date.parse(convertDateString(v.time)))/1e3))>=x?x:c,n[v.defenderSide][c]=n[v.defenderSide][c]+v.damage,c<x){u=v.citizenId;h[v.defenderSide][u]?(h[v.defenderSide][u].damage+=v.damage,h[v.defenderSide][u].hitNumber[v.weapon]+=v.berserk?5:1,h[v.defenderSide][u].first=c):(h[v.defenderSide][u]={},h[v.defenderSide][u].citizenId=u,h[v.defenderSide][u].damage=v.damage,h[v.defenderSide][u].hitNumber=[0,0,0,0,0,0],h[v.defenderSide][u].hitNumber[v.weapon]=v.berserk?5:1,h[v.defenderSide][u].citizenship=v.citizenship,h[v.defenderSide][u].militaryUnit=v.militaryUnit,h[v.defenderSide][u].first=c,h[v.defenderSide][u].last=c)}}var y=n[!0][x],k=n[!1][x];for(f=[[-x,y]],m=[[-x,k]],r=179;r>=0;--r)y+=n[!0][r],k+=n[!1][r],f.push([-r,y]),m.push([-r,k]);function S(t,e){var i=Object.keys(t).map(function(e){return t[e]});i.sort(function(t,e){return e.damage-t.damage});var a=$("<div>",{style:"text-align: left; margin:1em 1.6em 1em 1em; font-size:.9em;"}).appendTo(e),s=$("<table>",{style:"width:100%;"}).appendTo(a);$("<tr>").appendTo(s).append($("<td>",{text:"玩家",style:"text-align:center;"}),$("<td>",{colspan:2,text:"时段",style:"text-align:center;"}),$("<td>",{text:"次数",style:"text-align:right;"}),$("<td>",{text:"Q5",style:"text-align:right;"}),$("<td>",{text:"伤害值",style:"text-align:right;"}));$.each(i,function(t,e){var i=$("<tr>").appendTo(s),a=$("<td>").appendTo(i);$("<b>",{style:"float:left;padding: 0 .5em 0 0",text:t+1}).appendTo(a),$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[e.citizenship].flagName}).appendTo(a),citizenPage[e.citizenId]?$("<img>",{align:"absmiddle",class:"smallAvatar",src:citizenPage[e.citizenId].avatar.replace("normal","small")}).appendTo(a):$("<img>",{align:"absmiddle",class:"smallAvatar",src:"//cdn.e-sim.org/img/blank-avatar.png"}).appendTo(a),$("<a>",{class:"profileLink",href:"profile.html?id="+e.citizenId,text:citizenInfo[e.citizenId]?citizenInfo[e.citizenId].login:"???"}).appendTo(a),$("<td>",{style:"text-align:right;",text:e.first+"~"}).appendTo(i),$("<td>",{style:"text-align:right;",text:e.last+"s"}).appendTo(i);var n=0;$.each(e.hitNumber,function(t,e){n+=e}),$("<td>",{style:"text-align:right;",text:n}).appendTo(i),$("<td>",{style:"text-align:right;",text:e.hitNumber[5]}).appendTo(i),$("<td>",{style:"text-align:right;",text:e.damage.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}).appendTo(i)})}$.jqplot("ehChartClutch",[f,m],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"时间 (秒)",max:0,min:-x,tickOptions:{formatString:"%d"}},yaxis:{min:0,tickInterval:b,pad:1.1,tickOptions:{formatString:"%'d"}}}}),S(h[!0],$("#ehTableClutchDefenders")),S(h[!1],$("#ehTableClutchAttackers"))}function drawChartClutch(){getEhTime()>=clutchStandard?$("#ehChartClutch").text("压秒趋势图仅在战场结束前"+clutchStandard+"秒内显示"):($("#ehChartClutch").text(""),console.log(getEhTime(),"重绘压秒趋势图"),chartClutch&&chartClutch.destroy(),chartClutch=$.jqplot("ehChartClutch",[defenderHistoryClutch,attackerHistoryClutch],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"倒计时",max:0,pad:1.1,tickOptions:{formatString:"%d"}},yaxis:{min:0,pad:1.1,tickOptions:{formatString:"%'d"}}}}))}function setupStatistics(){isActive?($("#ehDivStatistics").append('<br /> <div style="font-size:24px;"> 压秒趋势图 </div>'),$("#ehDivStatistics").append($("<div>",{id:"ehChartClutch",style:"height:300px;width:750px;"})),defenderHistoryClutch=[[]],attackerHistoryClutch=[[]],chartClutch=null,clutchStandard=300,lastUpdatedSeconds=getEhTime(),$("#ehButtonStatistics").click(drawChartClutch)):($("#ehButtonStatistics").click(),$("#ehDivStatistics").append($("<div>",{id:"ehBattleDescription"})),$("#ehDivStatistics").append('<br /> <div style="font-size:24px;"> 全场趋势图 </div>'),$("#ehDivStatistics").append($("<div>",{id:"ehChart120m",style:"height:300px;width:750px;"})),$("<table>",{id:"ehTable120m"}).hide().appendTo($("#ehDivStatistics")),$("#ehDivStatistics").append('<br /> <br /> <br /> <div style="font-size:24px;"> 压秒趋势图 </div>'),$("#ehDivStatistics").append($("<div>",{id:"ehChartClutch",style:"height:300px;width:750px;"})),$("<div>",{id:"ehTableClutchDefenders",class:"foundation-style small-5 columns"}).appendTo($("#ehDivStatistics")),$("<div>",{id:"ehTableClutchAttackers",class:"foundation-style small-5 columns"}).appendTo($("#ehDivStatistics")),$.ajax({url:"apiFights.html?battleId="+battleId+"&roundId="+roundId,timeout:5e3,success:drawChartForFinishedBattle,error:function(t,e){log("战斗记录抓取错误 (",e,")，重新抓取"),$.ajax(this)}}))}function setupSpecial(){var t=$("#ehDivSpecial"),e=$("<table>",{style:"width:100%;line-height:1px;"}).appendTo(t),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i),s=$("<p>",{class:"AjaxStat",text:"准备中……"}).appendTo(a);function n(t,e,i){""!=t&&""!=e&&""!=i?$.ajax({type:"POST",url:"https://discordapp.com/api/channels/"+i+"/messages",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US","Content-Type":"application/json",Authorization:e},data:JSON.stringify({content:t})}):alert("发送失败：缺少参数")}setInterval(function(){for(var t=ajaxs.length,e=0;e<t;e++)4!=ajaxs[e].readyState&&0!=ajaxs[e].readyState||(ajaxs.splice(e,1),e-=1,t-=1);(t=ajaxs.length)<=0?s.text("当前网页共有"+t+"个未完成请求，网络畅通。"):t<6?s.text("当前网页共有"+t+"个未完成请求，网络畅通。"):(s.text("当前网页共有"+t+"个未完成请求，网络堵塞，后续请求无法立即响应。"),$("#AutoAbortAllAjax").is(":checked")&&t>10&&abortAll())},3e3),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i),$("<button>",{text:"终止所有未完成请求",class:"small button foundation-style"}).appendTo(a).click(function(){abortAll()}),addCheckBoxSettingFrame(a,"AutoAbortAllAjax","自动清理请求","AutoAbortAllAjax",!1),$("<p>发送到Discord</p>").appendTo(t),e=$("<table>",{style:"width:100%;line-height:1px;"}).appendTo(t),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i),$("<p>登录网页版discord，开启F12控制台的Network页，在discord频道里</p><p>发送一条信息，点击控制台Network里出现的messages，在右边往下</p><p>找到Request Headers的authorization：右边内容复制到这里</p>").appendTo(a),a=$("<td>").appendTo(i),$("<p>",{text:"右击discord频道，选择复制ID粘贴进来"}).appendTo(a),i=$("<tr>").appendTo(e),a=$("<td>").appendTo(i),$("<span>",{text:"authToken："}).appendTo(a),addTextboxSettingFrame(a,300,"discordAuthToken",""),a=$("<td>").appendTo(i),$("<span>",{text:"channelID："}).appendTo(a),addTextboxSettingFrame(a,200,"discordChannelID",""),i=$("<tr>").appendTo(e),addCheckBoxSettingFrame(a=$("<td>").appendTo(i),"diyMessageToDiscord","自定义发送消息","diyMessageToDiscord",!1),addTextboxSettingFrame(a,200,"diyMessageToDiscordText",""),a=$("<td>").appendTo(i),$("<button>",{text:"发送到Discord",id:"sendToDiscordButton",class:"small button foundation-style"}).appendTo(a).click(function(){$("#diyMessageToDiscord").is(":checked")?n($("#diyMessageToDiscordText").val(),localStorage.getItem("discordAuthToken"),localStorage.getItem("discordChannelID")):n(function(){function t(t,e){var i=t.toString()+":"+e.toString();return t===e?i:t>e?i+(8===t?"获胜":"领先"):i+(8===e?"失利":"落后")}var e=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,"")),i=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,"")),a=((e-i)/1e6).toFixed(2),s=getEhTime(),n="",r=document.URL.match(/.+?battle.html\?id=[0-9]+/).toString();r.indexOf("https")>=0?(n+=r+"\n",n+=r.replace(/https/,"http")+"\n"):r.indexOf("http")>=0?(n+=r.replace(/http/,"https")+"\n",n+=r+"\n"):n+=document.URL.match(/.+?battle.html\?id=[0-9]+/)+"\n";s>0?$("#copySideDefender").is(":checked")?n+="第"+roundId+"局(总比分"+t(defenderScore,attackerScore)+"), t"+parseInt(s/60)+"墙高"+a.toString()+"M\n"+defenderDescription:n+="第"+roundId+"局(总比分"+t(attackerScore,defenderScore)+"), t"+parseInt(s/60)+"墙高"+(-a).toString()+"M\n"+attackerDescription:(n+=battleName+"第"+roundId+"局结束, ",$("#copySideDefender").is(":checked")?n+=e>=i?"防守方"+defenderNameOrFlag+"获胜("+a.toString()+"M), 总比分"+t(defenderScore+1,attackerScore):"防守方"+defenderNameOrFlag+"失利("+a.toString()+"M), 总比分"+t(defenderScore,attackerScore+1):n+=i>=e?"进攻方"+attackerNameOrFlag+"获胜("+(-a).toString()+"M), 总比分"+t(attackerScore+1,defenderScore):"进攻方"+attackerNameOrFlag+"失利("+(-a).toString()+"M), 总比分"+t(attackerScore,defenderScore+1));return n}(),localStorage.getItem("discordAuthToken"),localStorage.getItem("discordChannelID"))}),addCheckBoxSettingFrame(a,"autoSendMessageToDiscord","T5自动发送(不用记得去掉)","autoSendMessageToDiscord",!1)}unsafeWindow.$.ajax=function(){var t=Array.prototype.slice.call(arguments),e=oldAjaxOrigin.apply(this,t);return ajaxs.push(e),e},$.ajax=function(){var t=Array.prototype.slice.call(arguments),e=oldAjaxScript.apply(this,t);return ajaxs.push(e),e},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(t,e){function i(t,e,i,a){return!(t.selector!=e.selector||t.context!=e.context||i&&i.$lqguid!=e.fn.$lqguid||a&&a.$lqguid!=e.fn2.$lqguid)}t.extend(t.fn,{livequery:function(e,s){var n,r=this;return t.each(a.queries,function(t,a){return i(r,a,e,s)?(n=a)&&!1:void 0}),(n=n||new a(r.selector,r.context,e,s)).stopped=!1,n.run(),r},expire:function(e,s){var n=this;return t.each(a.queries,function(t,r){i(n,r,e,s)&&!n.stopped&&a.stop(r.id)}),n}});var a=t.livequery=function(e,i,s,n){var r=this;return r.selector=e,r.context=i,r.fn=s,r.fn2=n,r.elements=t([]),r.stopped=!1,r.id=a.queries.push(r)-1,s.$lqguid=s.$lqguid||a.guid++,n&&(n.$lqguid=n.$lqguid||a.guid++),r};a.prototype={stop:function(){var e=this;e.stopped||(e.fn2&&e.elements.each(e.fn2),e.elements=t([]),e.stopped=!0)},run:function(){var e=this;if(!e.stopped){var i=e.elements,a=t(e.selector,e.context),s=a.not(i),n=i.not(a);e.elements=a,s.each(e.fn),e.fn2&&n.each(e.fn2)}}},t.extend(a,{guid:0,queries:[],queue:[],running:!1,timeout:null,registered:[],checkQueue:function(){if(a.running&&a.queue.length)for(var t=a.queue.length;t--;)a.queries[a.queue.shift()].run()},pause:function(){a.running=!1},play:function(){a.running=!0,a.run()},registerPlugin:function(){t.each(arguments,function(e,i){if(t.fn[i]&&!(t.inArray(i,a.registered)>0)){var s=t.fn[i];t.fn[i]=function(){var t=s.apply(this,arguments);return a.run(),t},a.registered.push(i)}})},run:function(i){i!==e?t.inArray(i,a.queue)<0&&a.queue.push(i):t.each(a.queries,function(e){t.inArray(e,a.queue)<0&&a.queue.push(e)}),a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.checkQueue,20)},stop:function(i){i!==e?a.queries[i].stop():t.each(a.queries,a.prototype.stop)}}),a.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html","prop","removeProp"),t(function(){a.play()})}),main();var setupAdvancedIsAutoFighting=!1;function setupAdvancedFightChooseTable(t){var e=$("."+t);e.length>0&&e.remove();var i="defender",a="attacker",s="undefined",n="Berserk",r=$("<table>",{class:t,style:"width:100%;line-height:1px;"}),o=$("<tr>",{style:"background-color:DarkSlateGray;",height:"30px"}).appendTo(r),l=$("<td>").appendTo(o);if($("<span>输出选择：</span>").appendTo(l),$("#fightButton2").length>0){l=$("<td>").appendTo(o),$("<span>防守方：</span>").appendTo(l);$("<input>",{type:"radio",id:"AFHitStyleLeftHit",name:"AFHitStyle","data-AFSide":i,"data-AFValue":s}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleLeftHit",text:"打一下"}).appendTo(l),$("<input>",{type:"radio",id:"AFHitStyleLeftBerserk",name:"AFHitStyle","data-AFSide":i,"data-AFValue":n}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleLeftBerserk",text:"打五下"}).appendTo(l);l=$("<td>").appendTo(o),$("<span>进攻方：</span>").appendTo(l);$("<input>",{type:"radio",id:"AFHitStyleRightHit",name:"AFHitStyle","data-AFSide":a,"data-AFValue":s}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleRightHit",text:"打一下"}).appendTo(l),$("<input>",{type:"radio",id:"AFHitStyleRightBerserk",name:"AFHitStyle","data-AFSide":a,"data-AFValue":n}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleRightBerserk",text:"打五下"}).appendTo(l)}else if($("#fightButton1").length>0){l=$("<td>").appendTo(o);$("<input>",{type:"radio",id:"AFHitStyleHit",name:"AFHitStyle","data-AFSide":"side","data-AFValue":s}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleHit",text:"打一下"}).appendTo(l),$("<input>",{type:"radio",id:"AFHitStyleBerserk",name:"AFHitStyle",checked:"checked","data-AFSide":"side","data-AFValue":n}).appendTo(l),$("<label>",{class:"checkboxlabel",for:"AFHitStyleBerserk",text:"打五下"}).appendTo(l)}else l=$("<td>").appendTo(o),$("<span>当前所在地无法输出</span>").appendTo(l);$(".setupAdvancedTable").after(r)}function setupAdvanced(){var t=$("#ehDivAdvanced");if("true"===localStorage.getItem("EnableAutoFight")){var e,i,a=$("<p>",{class:"advancedStat",text:"使用自动打枪有可能受到封号惩罚。使用前你必须清楚其原理作用和可能产生的后果。"}).appendTo(t),s=!1,n=0,r=0,o=0,l=[];!function(){var a=$("<div>",{class:"foundation-style small-10 columns foundation-text-center"}).appendTo(t),n=$("<table>",{align:"right"}).appendTo(a),r=$("<button>",{type:"button",class:"small button foundation-style",id:"AFManualStart",text:"开始自动打枪"}).appendTo(n);r.attr("disabled",!0);var o=$("<button>",{type:"button",class:"small button foundation-style",id:"AFStopButton",text:"停止自动打枪"}).appendTo(n);o.attr("disabled",!0);var l,u,g=$("<table>",{class:"setupAdvancedTable",style:"width:100%;line-height:1px;height:200px;"}).appendTo(t);l=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(g),u=$("<td>",{width:"25%"}).appendTo(l),$("<span>补充额度顺序：</span>").appendTo(u),addSelectSettingFrame(u=$("<td>",{width:"25%"}).appendTo(l),"优先：",[0,1,2],["无","食物","礼物"],"AFRestoreHealth1",2),addSelectSettingFrame(u=$("<td>",{width:"25%"}).appendTo(l),"其次：",[0,1,2],["无","食物","礼物"],"AFRestoreHealth2",1),$("<td>",{width:"25%"}).appendTo(l),l=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(g),addCheckBoxSettingFrame(u=$("<td>").appendTo(l),"AFRestrictHitCount","限制攻击次数：","AFRestrictHitCount",!1),$("<span>最多</span>").appendTo(u),addTextboxSettingFrame(u,60,"AFRestrictHitCountTextbox","15"),$("<span>次攻击</span>").appendTo(u),addCheckBoxSettingFrame(u=$("<td>").appendTo(l),"AFRestrictDamage","限制伤害：","AFRestrictDamage",!1),$("<span>总伤害超过</span>").appendTo(u),addTextboxSettingFrame(u,60,"AFRestrictDamageTextbox","1000000"),$("<span>后停止</span>").appendTo(u),addCheckBoxSettingFrame(u=$("<td>").appendTo(l),"AFRestrictTime","限制时间：","AFRestrictTime",!1),$("<span>自动打枪</span>").appendTo(u),addTextboxSettingFrame(u,60,"AFRestrictTimeTextbox","10"),$("<span>秒后停止</span>").appendTo(u),u=$("<td>").appendTo(l),l=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(g),u=$("<td>").appendTo(l);var f=$("<input>",{type:"radio",id:"AFStartModeAuto",name:"AFSelectStartMode","data-startmode":"auto"}).appendTo(u);$("<label>",{class:"checkboxlabel",for:"AFStartModeAuto",text:"自动开始："}).appendTo(u);$("<span>在S</span>").appendTo(u),addTextboxSettingFrame(u,40,"AFStartModeAutoStartTextbox","15"),$("<span>到S</span>").appendTo(u),addTextboxSettingFrame(u,40,"AFStartModeAutoEndTextbox","10"),$("<span>之间任意时间</span>").appendTo(u),u=$("<td>").appendTo(l);var m=$("<input>",{type:"radio",id:"AFStartModeManual",name:"AFSelectStartMode","data-startmode":"manual"}).appendTo(u),b=($("<label>",{class:"checkboxlabel",for:"AFStartModeManual",text:"手动开始"}).appendTo(u),localStorage.getItem("AFStartModeSettings"));null===b?(localStorage.setItem("AFStartModeSettings","1"),m.attr("checked",!0)):"0"==b?f.attr("checked",!0):m.attr("checked",!0);f.change(function(){f.is(":checked")?localStorage.setItem("AFStartModeSettings","0"):localStorage.setItem("AFStartModeSettings","1")}),m.change(function(){m.is(":checked")?localStorage.setItem("AFStartModeSettings","1"):localStorage.setItem("AFStartModeSettings","0")}),u=$("<td>").appendTo(l),u=$("<td>").appendTo(l),l=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(g),u=$("<td>").appendTo(l),$("<span>每次攻击间隔（毫秒）：</span>").appendTo(u),addTextboxSettingFrame(u=$("<td>").appendTo(l),60,"AFIntervalStart","500"),$("<span>到</span>").appendTo(u),addTextboxSettingFrame(u,60,"AFIntervalEnd","1500"),u=$("<td>").appendTo(l),$("<span>未响应请求允许数量：</span>").appendTo(u),addTextboxSettingFrame(u=$("<td>").appendTo(l),60,"AFMaxNotRespondRequest","12");var x=$("<table>",{align:"right"}).appendTo(t);l=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(x),u=$("<td>").appendTo(l),$("<span>总伤害： </span>").appendTo(u);$("<span>",{id:"AFNowTotalDamage"}).appendTo(u);u=$("<td>").appendTo(l),$("<span>攻击次数： </span>").appendTo(u);$("<span>",{id:"AFNowHitCount"}).appendTo(u);$("<span> 次</span>").appendTo(u),u=$("<td>").appendTo(l),$("<span>压秒用时： </span>").appendTo(u);$("<span>",{id:"AFNowSpendTime"}).appendTo(u);$("<span> 秒</span>").appendTo(u),u=$("<td>").appendTo(l),$("<span>未完成请求：</span>").appendTo(u);$("<span>",{id:"AFAjaxCount"}).appendTo(u);$("<span> 次</span>").appendTo(u),setupAdvancedFightChooseTable("advancedFightChooseTable"),r.attr("disabled",!1),r.click(function(){var t=$("input[name='AFSelectStartMode']:checked");if(t.length<=0)h("未选择开始方式");else if(r.attr("disabled",!0),o.attr("disabled",!1),"auto"==t.attr("data-startmode")){var a=c(parseInt($("#AFStartModeAutoStartTextbox").val()),parseInt($("#AFStartModeAutoEndTextbox").val()));getEhTime()<=a?(h("当前时间已经超过预定时间"),r.attr("disabled",!1),o.attr("disabled",!0)):(h("预订于剩余 "+a+" 秒时开始自动攻击"),e=setInterval(function(){getEhTime()<=a&&(clearInterval(e),i=new Date,s=!0,d(),p(parseInt($("#AFIntervalStart").val()),parseInt($("#AFIntervalEnd").val())))},1e3))}else i=new Date,s=!0,d(),p(parseInt($("#AFIntervalStart").val()),parseInt($("#AFIntervalEnd").val()))}),o.click(function(){r.attr("disabled",!1),o.attr("disabled",!0);var t=$("input[name='AFSelectStartMode']:checked");"auto"==t.attr("data-startmode")&&void 0!=e?(h("停止计时"),clearInterval(e)):(h("停止攻击"),s=!1)})}()}else $("<p>",{class:"advancedStat",text:"未启用自动打枪。"}).appendTo(t);function h(t){a.text(t)}function d(){n=0,r=0,o=0}function c(t,e){var i=e-t,a=Math.random()*i+t;return a=parseInt(a,10)}function p(t,e){$("#AFNowTotalDamage").text(n),$("#AFNowHitCount").text(r),o=parseInt(new Date-i)/1e3,$("#AFNowSpendTime").text(o);for(var a=l.length,d=0;d<a;d++)4!=l[d].readyState&&0!=l[d].readyState||(l.splice(d,1),d-=1,a-=1);if($("#AFAjaxCount").text(l.length),a>parseInt($("#AFMaxNotRespondRequest").val())&&(abortAll(),l=[]),1!=s)return $("#AFManualStart").attr("disabled",!1),void $("#AFStopButton").attr("disabled",!0);if($("#AFRestrictHitCount").is(":checked")&&r>=parseInt($("#AFRestrictHitCountTextbox").val()))return h("攻击次数超限，停止攻击"),s=!1,$("#AFManualStart").attr("disabled",!1),void $("#AFStopButton").attr("disabled",!0);if($("#AFRestrictDamage").is(":checked")&&n>=parseInt($("#AFRestrictDamageTextbox").val()))return h("总伤害超限，停止攻击"),s=!1,$("#AFManualStart").attr("disabled",!1),void $("#AFStopButton").attr("disabled",!0);if($("#AFRestrictTime").is(":checked")&&o>=parseInt($("#AFRestrictTimeTextbox").val()))return h("时间超限，停止攻击"),s=!1,$("#AFManualStart").attr("disabled",!1),void $("#AFStopButton").attr("disabled",!0);if(0==function(){if(parseFloat($("#actualHealth").html())<=50&&(t=$("#AFRestoreHealth1").val(),e=$("#AFRestoreHealth2").val(),!(1==t?g(!0)||2==e&&g(!1):2==t?g(!1)||1==e&&g(!0):(h("补充体力选择错误"),0))))return!1;var t,e;var i=parseInt($("#weaponQuality").val());if(i>0){var a=parseInt($("span#Q"+i+"WeaponStock").text());if(a<=0)return h("武器不足"),!1}var s=$("input[name='AFHitStyle']:checked");if(s.length<=0)return h("未选择输出方"),!1;var o=s.attr("data-AFSide"),d=s.attr("data-AFValue");c=o,p=d,u="weaponQuality="+$("#weaponQuality").attr("value")+"&battleRoundId="+$("#battleRoundId").val()+"&side="+c+"&value="+p,f=$.ajax({type:"POST",url:"fight.html",data:u,success:function(t){$("#fightResponse > div").replaceWith(t),function(t){var e=$("#showMsg");e.text(""),e.show();var i=$("#DamageDone",t);if(i.length>0){var a=parseInt(i.text().replace(/,/g,"").replace(/\xA0/g,""));n+=a;for(var s=$(".fightsprite",i.parent().parent()),o={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]},l={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]},h=0;h<s.length;++h){var d=s.eq(h).attr("class").split(" ").pop();if(d in l){var c=l[d];o[c[0]]=c[1]}}var p="",u=o.xp;delete o.xp;for(h in o)p='<i style="color:'+o[h][0]+';" class="icon-'+h+'" title="'+o[h][1]+'"></i>'+p;p+='<b title="'+u+'次攻击">x'+u+"</b>",r+=u;var g=$("#fightHistory"),f=$("div[class^=foundation-style]",g);6===f.length&&$("#ehHistoryExpand").show(),f.slice(0,2).attr("style","opacity:0.6;"),f.slice(2,4).attr("style","opacity:0.3;"),!1===$("#ehHistoryExpand").is(":hidden")&&f.slice(4,6).hide();var m=-1!==$("#fightResult>div").attr("class").split(" ").pop().indexOf("critical");m?g.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:p}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right critical",text:i.text()})):g.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:p}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right",text:i.text()})),$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+u),$("#ehTotalDamage").text((parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}else e.text($("#fightResponse").text().trim()),e.fadeOut(2e3)}($(t));var e=$("#healthUpdate",t).text();if(""!==e){var i=e.substr(0,e.length-3);i<100&&$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right"),$("#healthProgress .ui-progressbar-value").animate({width:i+"%"},{queue:!1}),$("#healthProgress").attr("title",i+" / 100"),$("#actualHealth").html(i)}},error:function(t,e,i){var a=$("#showMsg");a.text("错误："+t.status),a.show(),a.fadeOut(2e3)}}),l.push(f);var c,p,u,f}())return s=!1,$("#AFManualStart").attr("disabled",!1),void $("#AFStopButton").attr("disabled",!0);var u=c(t,e);h(u+"毫秒后输出"),setTimeout(function(){p(t,e)},u)}function u(t){var e=jQuery.parseJSON(t);$("#foodLimit").html(e.foodLimit),$("#giftLimit").html(e.giftLimit),$("#foodLimit2").html(e.foodLimit),$("#giftLimit2").html(e.giftLimit),$("#wellness").html(e.wellness),$("#healthBar").html(e.wellness),$("#healthProgress .ui-progressbar-value").animate({width:e.wellness+"%"},{queue:!1}),$("#actualHealth").html(e.wellness),$("#foodQ1").html("<b>Q1</b><br>"+e.q1FoodStorage),$("#foodQ2").html("<b>Q2</b><br>"+e.q2FoodStorage),$("#foodQ3").html("<b>Q3</b><br>"+e.q3FoodStorage),$("#foodQ4").html("<b>Q4</b><br>"+e.q4FoodStorage),$("#foodQ5").html("<b>Q5</b><br>"+e.q5FoodStorage),$("#giftQ1").html("<b>Q1</b><br>"+e.q1GiftStorage),$("#giftQ2").html("<b>Q2</b><br>"+e.q2GiftStorage),$("#giftQ3").html("<b>Q3</b><br>"+e.q3GiftStorage),$("#giftQ4").html("<b>Q4</b><br>"+e.q4GiftStorage),$("#giftQ5").html("<b>Q5</b><br>"+e.q5GiftStorage),$("#sfoodQ1").html("<b>Q1</b><br>"+e.q1FoodStorage),$("#sfoodQ2").html("<b>Q2</b><br>"+e.q2FoodStorage),$("#sfoodQ3").html("<b>Q3</b><br>"+e.q3FoodStorage),$("#sfoodQ4").html("<b>Q4</b><br>"+e.q4FoodStorage),$("#sfoodQ5").html("<b>Q5</b><br>"+e.q5FoodStorage),$("#sgiftQ1").html("<b>Q1</b><br>"+e.q1GiftStorage),$("#sgiftQ2").html("<b>Q2</b><br>"+e.q2GiftStorage),$("#sgiftQ3").html("<b>Q3</b><br>"+e.q3GiftStorage),$("#sgiftQ4").html("<b>Q4</b><br>"+e.q4GiftStorage),$("#sgiftQ5").html("<b>Q5</b><br>"+e.q5GiftStorage)}function g(t){if(t){if(parseInt($("#foodLimit2").text())>0){var e=parseInt($("#foodQuality").val());return parseInt($("span#sfoodQ"+e)[0].childNodes[2].nodeValue)>0?(s="quality="+$("#foodQuality").val(),n=$.ajax({type:"POST",url:"eat.html",data:s,success:function(t){u(t)}}),l.push(n),!0):(h("食物不足"),!1)}return h("食物额度不足"),!1}var i,a,s,n;if(parseInt($("#giftLimit2").text())>0){var r=parseInt($("#giftQuality").val());return parseInt($("span#sgiftQ"+r)[0].childNodes[2].nodeValue)>0?(i="quality="+$("#giftQuality").val(),a=$.ajax({type:"POST",url:"gift.html",data:i,success:function(t){u(t)}}),l.push(a),!0):(h("礼物不足"),!1)}return h("礼物额度不足"),!1}}function setupSpectator(){if(isActive)if(isPremium){$(".battleMonitorDiv").remove(),(e=$("#ehDivSpectator")).append($("<button>",{type:"button",class:"small button foundation-style",id:"showSpectator",text:"刷新观战玩家",style:"height:20px;width:100px;",click:function(){sendUpdateRequest2(!0)}}));var t=$("<div>");e.append(t),t.append('<div class="foundation-style small-3 columns">  <b>Total defenders online:</b> <i id="ehTotaldefenders"  style="display: inline;">0</i>  <br> <div align="center" id="ehDefendersMenu" >No one <br> </div>  </div>'),t.append('<div class="foundation-style small-4 columns">  <b>Total spectators online:</b><i id="ehTotalspectators"                         >0</i>  <br> <div align="center" id="ehSpectatorsMenu">No one <br> </div>  </div>'),t.append('<div class="foundation-style small-3 columns">  <b>Total attackers online:</b> <i id="ehTotalattackers"  style="display: inline;">0</i>  <br> <div align="center" id="ehAttackersMenu" >No one <br> </div>  </div>')}else{var e;(e=$("#ehDivSpectator")).append($("<div>",{style:"font-color:red; font-size:24px;",text:"此功能利用了e-sim的小漏洞，有一定危险性，请自行承担后果"})),e.append($("<button>",{type:"button",class:"small button foundation-style",id:"showSpectator",text:"我知道了，还是想看！",click:function(){sendUpdateRequest2(!0)}}));t=$("<div>");e.append(t),t.append('<div class="foundation-style small-3 columns">  <b>Total defenders online:</b> <i id="ehTotaldefenders"  style="display: inline;">0</i>  <br> <div align="center" id="ehDefendersMenu" >No one <br> </div>  </div>'),t.append('<div class="foundation-style small-4 columns">  <b>Total spectators online:</b><i id="ehTotalspectators"                         >0</i>  <br> <div align="center" id="ehSpectatorsMenu">No one <br> </div>  </div>'),t.append('<div class="foundation-style small-3 columns">  <b>Total attackers online:</b> <i id="ehTotalattackers"  style="display: inline;">0</i>  <br> <div align="center" id="ehAttackersMenu" >No one <br> </div>  </div>')}else $("#ehButtonSpectator").attr("disabled",!0)}function setupAlarm(){if(isActive){var t=getEhTime(),e=$("<div>"),i=$("<input>",{type:"checkbox",id:"PopupCheckbox"}).appendTo(e),a=($("<label>",{class:"checkboxlabel",for:"PopupCheckbox",text:"自动弹窗（首次使用可能会被浏览器拦截，加入白名单即可）"}).appendTo(e),localStorage.getItem("battlePopup"));null==a?localStorage.setItem("battlePopup","false"):i.attr("checked","true"==a),i.click(function(){i.is(":checked")?localStorage.setItem("battlePopup",!0):localStorage.setItem("battlePopup",!1)});$("<button>",{type:"button",class:"small button foundation-style",id:"testNotification",text:"测试",click:function(){$("#PopupCheckbox").is(":checked")&&!window.opener?window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600"):alert(battleName+"：测试")}}).appendTo(e);$("#ehDivAlarm").append(e);var s=$("<div>",{class:"foundation-style small-2 columns"});s.append($("<i>",{class:"icon-uptime",style:"font-size:20px;"})),s.append($("<input>",{type:"checkbox",class:"foundation-style",id:"alarmEnable10",value:10})," t10提醒");var n=$("<div>",{class:"foundation-style small-3 columns"});n.append($("<i>",{class:"icon-uptime",style:"font-size:20px;"})),n.append($("<input>",{type:"checkbox",class:"foundation-style",id:"alarmEnable5",value:5})," t5提醒");var r=$("<div>",{class:"foundation-style small-3 columns"});r.append($("<i>",{class:"icon-uptime",style:"font-size:20px;"})),r.append($("<input>",{type:"checkbox",class:"foundation-style",id:"alarmEnable2",value:2})," t2提醒");var o=$("<div>",{class:"foundation-style small-2 columns"});o.append($("<i>",{class:"icon-uptime",style:"font-size:20px;"})),o.append($("<input>",{type:"checkbox",class:"foundation-style",id:"alarmEnable1",value:1})," t1提醒"),$("#ehDivAlarm").append(s,n,r,o),t<=600?$("#alarmEnable10").attr("disabled",!0):setTimeout(function(){$("#alarmEnable10").is(":checked")&&($("#PopupCheckbox").is(":checked")&&!window.opener?window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600"):alert(battleName+"倒计时10分钟")),$("#alarmEnable10").attr("disabled",!0)},1e3*(t-600)),t<=300?$("#alarmEnable5").attr("disabled",!0):setTimeout(function(){if($("#alarmEnable5").is(":checked")&&($("#PopupCheckbox").is(":checked")&&!window.opener?window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600"):alert(battleName+"倒计时5分钟")),"true"==localStorage.getItem("autoSendMessageToDiscord")){var t=$("#sendToDiscordButton");1==t.length&&t.click()}$("#alarmEnable5").attr("disabled",!0)},1e3*(t-300)),t<=120?$("#alarmEnable2").attr("disabled",!0):setTimeout(function(){$("#alarmEnable2").is(":checked")&&($("#PopupCheckbox").is(":checked")&&!window.opener?window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600"):alert(battleName+"倒计时2分钟")),$("#alarmEnable2").attr("disabled",!0)},1e3*(t-120)),t<=60?$("#alarmEnable1").attr("disabled",!0):setTimeout(function(){$("#alarmEnable1").is(":checked")&&($("#PopupCheckbox").is(":checked")&&!window.opener?window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600"):alert(battleName+"倒计时1分钟")),$("#alarmEnable1").attr("disabled",!0)},1e3*(t-60)),setInterval(updateClock,1e3)}else $("#ehButtonAlarm").attr("disabled",!0)}function updateClock(){var t=getEhTime();if(-1!=document.title.indexOf("："))var e=document.title.split("：")[1];else e=document.title;if(t>99)var i="T"+parseInt(t/60).toString();else i="S"+t.toString();document.title=i+"："+e}function setupFight(){var t=$("[id^=fightButton]");if(0!==t.length){GM_addStyle(".critical { color:red; }");var e=t.parent().parent();$("[id^=fightButton] > i",e).remove();var i=$("<div>",{id:"fightLeft",class:"foundation-style small-3 columns",style:"font-size:12px;"}),a=$("<div>",{id:"fightRight",class:"foundation-style small-7 columns foundation-text-center"});a.append(e.children()),e.append(i,a);var s=$("<div>",{class:"foundation-style small-5 columns foundation-text-left",html:'<b id="ehCountdown">00:00:00</b>',title:"点击刷新按钮可校准"}),n=$("<div>",{class:"foundation-style small-1 columns foundation-text-right",html:'x<b id="ehHitsNumber">0</b>',title:"在当前页面上攻击的次数, 刷新页面会清零"}),r=$("<div>",{class:"foundation-style small-4 columns foundation-text-right",html:'<div id="ehTotalDamage">0</div>',title:"在当前页面上攻击的总伤害, 刷新页面会清零"}),o=$("<div>",{id:"fightHistory"}),l=$("<div>",{html:'<b id="showMsg"></b>'});i.append(s,n,r,o,l),o.append('<div id="ehHistoryExpand" class="small-6"><i class="icon-uniF475" title="展开所有伤害记录"></i></div>','<div id="ehHistoryContract" class="small-6"><i class="icon-uniF474" title="收起输出伤害"></i></div>'),$("#ehHistoryExpand").hide().click(function(){$("#fightHistory > div").slice(6).show(),$(this).hide()}),$("#ehHistoryContract").hide().click(function(){$("#fightHistory > div").slice(6).hide(),$("#ehHistoryExpand").show()}),$(".pico-content").livequery(function(){var t=$("#DamageDone",$(this));if(t.length>0){for(var e=parseInt(t.text().replace(/,/g,"").replace(/\xA0/g,"")),i=$(".fightsprite",t.parent().parent()),a={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]},s={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]},n=0;n<i.length;++n){var r=i.eq(n).attr("class").split(" ").pop();if(r in s){var l=s[r];a[l[0]]=l[1]}}var h="",d=a.xp;delete a.xp;for(n in a)h='<i style="color:'+a[n][0]+';" class="icon-'+n+'" title="'+a[n][1]+'"></i>'+h;h+='<b title="'+d+'次攻击">x'+d+"</b>";var c=$("div[class^=foundation-style]",o);6===c.length&&$("#ehHistoryExpand").show(),c.slice(0,2).attr("style","opacity:0.6;"),c.slice(2,4).attr("style","opacity:0.3;"),!1===$("#ehHistoryExpand").is(":hidden")&&c.slice(4,6).hide(),-1!==$("#fightResult>div").attr("class").split(" ").pop().indexOf("critical")?o.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:h}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right critical",text:t.text()})):o.prepend($("<div>",{class:"foundation-style small-6 columns foundation-text-right",html:h}),$("<div>",{class:"foundation-style small-4 columns foundation-text-right",text:t.text()})),$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+d),$("#ehTotalDamage").text((parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}})}}function setupSpectatorDetail(){var t=$("#ehDivSpectatorDetail"),e=$("<button>",{id:"eh2ShowSpectatorDetail",text:"推测观战玩家（必须先查看过观战人员）",class:"foundation-style button",style:"padding:10px; margin:5px;"}).appendTo($("<div>").appendTo(t)),i=$("<button>",{id:"eh2ShowSpectatorBuff",text:"显示玩家状态",class:"foundation-style button",style:"padding:10px; margin:5px;",disabled:!0}).insertAfter(e),a=($("<INPUT TYPE='checkbox' id='eh2CheckCoalition'>按联盟分类玩家</INPUT>").insertAfter(i),$("<div>",{id:"eh2Defenders",style:"text-align:left;"}).appendTo($("<div>",{class:"foundation-style columns",style:"width:33%;",text:"可能的防御者"}).appendTo(t))),s=$("<div>",{id:"eh2Strangers",style:"text-align:left;"}).appendTo($("<div>",{class:"foundation-style columns",style:"width:34%;",text:"其他人"}).appendTo(t)),n=$("<div>",{id:"eh2Attackers",style:"text-align:left;"}).appendTo($("<div>",{class:"foundation-style columns",style:"width:33%;",text:"可能的进攻者"}).appendTo(t)),r={defenderRegions:[],attackerRegions:[]};function o(){if(r.onlineCitizens&&r.defenderMus&&r.attackerMus&&r.defenderAllies&&r.attackerAllies){a.empty(),n.empty(),s.empty();var t=[];$.each(r.onlineCitizens,function(e,i){var o=i.citizenId,l=citizenInfo[o],h=s,d=100*i.a/i.b,c=$("<div>",{id:"citizen"+o,style:"font-size:12px;"}),p=$("<i>",{class:"icon-bookmark"}).appendTo(c);if(l&&-1!==$.inArray(l.militaryUnitId,r.defenderMus)?(h=a,p.attr("style","color:SkyBlue;")):l&&-1!==$.inArray(l.militaryUnitId,r.attackerMus)?(h=n,p.attr("style","color:Crimson;")):(p.attr("style","color:rgb(77, 77, 77);"),d-=1e-4),0!==r.defenderRegions.length){var u=$("<i>",{class:"icon-airplane"}).appendTo(c);-1!==$.inArray(i.locationId,r.defenderRegions)?-1!==$.inArray(i.locationId,r.attackerRegions)?u.attr("style","color:SeaGreen;"):(h===s&&(h=a),u.attr("style","color:SkyBlue;")):-1!==$.inArray(i.locationId,r.attackerRegions)?(u.attr("style","color:Crimson;"),h===s&&(h=n)):(u.attr("style","color:rgb(77, 77, 77);"),d-=2e-4)}c.append($("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[i.countryId].flagName}),i.avatar,i.profile," ("+parseInt(100*i.a/i.b)+"%)"),h===s&&(-1!==$.inArray(i.countryId,r.defenderAllies)?h=a:-1!==$.inArray(i.countryId,r.attackerAllies)?h=n:d-=4e-4),t.push([d,c,h])}),t.sort(function(t,e){return e[0]-t[0]}),$.each(t,function(t,e){isResistance&&"color:SeaGreen;"===$(".icon-airplane",e[1]).attr("style")&&(e[2]===a?$(".icon-airplane",e[1]).attr("style","color:SkyBlue;"):e[2]===n&&$(".icon-airplane",e[1]).attr("style","color:Crimson;")),e[1].appendTo(e[2])}),e.attr("disabled",!1),i.attr("disabled",!1)}}$("#defenderRegions input").each(function(){r.defenderRegions.push(parseInt($(this).attr("value")))}),$("#attackerRegions input").each(function(){r.attackerRegions.push(parseInt($(this).attr("value")))}),e.click(function(){var t,a,s;e.attr("disabled",!0),i.attr("disabled",!0),t=$("#ehSpectatorsMenu").text().replace(/-[ \n\r]*/g,"- ").replace(/[\n\r]+ +/g,"\n").trim().split("\n"),a=[],s=t.length,$.each(t,function(t,e){var i=e.split(" - "),n=i[0],l=countryInfo[i[1]]&&countryInfo[i[1]].id;l?$.ajax({url:"citizensOnline.html?countryId="+l,success:function(t){var e=$("table.dataTable:last tr:gt(0)",t),i=e.length;console.log(countryInfo[l].name,"共有"+i+"名在线玩家"),e.each(function(){if(1===$("td",$(this)).length)return console.log(countryInfo[l].name,"没有玩家"),!1;var t=parseInt($("td:first a",$(this)).attr("href").match(/([0-9]+)$/)[1]),e=parseInt($("td:last a",$(this)).attr("href").match(/([0-9]+)$/)[1]);a.push({citizenId:t,locationId:e,countryId:l,a:n,b:i,profile:$("td:first a",$(this)),avatar:$("td:first img",$(this)).attr("class","smallAvatar").attr("style","").attr("align","absmiddle")}),0==--s&&(r.onlineCitizens=a,console.log("相关国家的在线玩家扫描完毕"),o())})},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}}):0==--s&&(r.onlineCitizens=a,console.log("相关国家的在线玩家扫描完毕"),o())}),$.ajax({url:"battleUnitsStats.html?id="+battleId,success:function(t){var e=$("div.small-5:eq(-2) a",t),i=e.length;if(0===i)console.log("防御方没有军团"),r.defenderMus=[],o();else{var a=[];e.each(function(){var t=parseInt($(this).attr("href").match(/([0-9]+)$/)[1]);a.push(t),getMuMemberInfo(t,function(){0==--i&&(r.defenderMus=a,console.log("防御方军团玩家扫描完毕"),o())})})}var s=$("div.small-5:last a",t),n=s.length;if(0===n)console.log("进攻方没有军团"),r.attackerMus=[],o();else{var l=[];s.each(function(){var t=parseInt($(this).attr("href").match(/([0-9]+)$/)[1]);l.push(t),getMuMemberInfo(t,function(){0==--n&&(r.attackerMus=l,console.log("进攻方军团玩家扫描完毕"),o())})})}},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}}),$("#eh2CheckCoalition").is(":checked")?function(){defenderId?defenderId===allies[0]?r.defenderAllies=allies:$.ajax({url:"countryPoliticalStatistics.html?countryId="+defenderId,success:function(t){console.log(countryInfo[defenderId].name,"盟友及联盟抓取成功");var e=[defenderId],i=$("div.xflagsMedium",$("table.dataTable:last",t));i.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),console.log("防守方盟友："+t),e.push(countryInfo[t].id)});var a,s=$("h2",t);if("Coalition"!=(a=s.length>4?s[2]:s[1]).innerText.split(" ")[0])console.log("防守方没有联盟");else{console.log("防守方属于联盟 "+a.innerText.split(" ")[1]);var n=$(a,t).nextAll("div.xflagsSmall");n.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),countryInfo[defenderId].flagName!=t&&(console.log("防守方联盟成员国："+t),e.push(countryInfo[t].id))})}var l=$.unique(e.sort());r.defenderAllies=l,o()},error:function(t,e){console.log(countryInfo[defenderId].name,"盟友及联盟抓取错误 (",e,")，重新抓取"),$.ajax(this)}}):r.defenderAllies=[];attackerId?attackerId===allies[0]?r.attackerAllies=allies:$.ajax({url:"countryPoliticalStatistics.html?countryId="+attackerId,success:function(t){console.log(countryInfo[attackerId].name,"盟友及联盟抓取成功");var e=[attackerId],i=$("div.xflagsMedium",$("table.dataTable:last",t));i.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),console.log("进攻方盟友："+t),e.push(countryInfo[t].id)});var a,s=$("h2",t);if("Coalition"!=(a=s.length>4?s[2]:s[1]).innerText.split(" ")[0])console.log("进攻方没有联盟");else{console.log("进攻方属于联盟 "+a.innerText.split(" ")[1]);var n=$(a,t).nextAll("div.xflagsSmall");n.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),countryInfo[attackerId].flagName!=t&&(console.log("进攻方联盟成员国："+t),e.push(countryInfo[t].id))})}var l=$.unique(e.sort());r.attackerAllies=l,o()},error:function(t,e){console.log(countryInfo[attackerId].name,"盟友及联盟抓取错误 (",e,")，重新抓取"),$.ajax(this)}}):r.attackerAllies=[]}():function(){defenderId?defenderId===allies[0]?r.defenderAllies=allies:$.ajax({url:"countryPoliticalStatistics.html?countryId="+defenderId,success:function(t){console.log(countryInfo[defenderId].name,"盟友抓取成功");var e=[defenderId],i=$("div.xflagsMedium",$("table.dataTable:last",t));i.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),console.log("防守方盟友："+t),e.push(countryInfo[t].id)}),r.defenderAllies=e,o()},error:function(t,e){console.log(countryInfo[defenderId].name,"盟友抓取错误 (",e,")，重新抓取"),$.ajax(this)}}):r.defenderAllies=[];attackerId?attackerId===allies[0]?r.attackerAllies=allies:$.ajax({url:"countryPoliticalStatistics.html?countryId="+attackerId,success:function(t){console.log(countryInfo[attackerId].name,"盟友抓取成功");var e=[attackerId],i=$("div.xflagsMedium",$("table.dataTable:last",t));i.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1),console.log("进攻方盟友："+t),e.push(countryInfo[t].id)}),r.attackerAllies=e,o()},error:function(t,e){console.log(countryInfo[attackerId].name,"盟友抓取错误 (",e,")，重新抓取"),$.ajax(this)}}):r.attackerAllies=[]}()}),i.click(function(){e.attr("disabled",!0),i.attr("disabled",!0),a.parent().attr("class","foundation-style column small-5"),n.parent().attr("class","foundation-style column small-5"),s.parent().attr("style","width:100%;").insertAfter(n.parent()),s.attr("style","width:50%; margin:0 auto; text-align:left;");var r="rgb(139, 139, 139);; rgb(177, 11, 11);; rgb(242, 160, 27);; rgb(177, 182, 6);; rgb(33, 157, 33);; rgb(169, 34, 156);; rgb(0, 211, 211);".split("; "),o="帽 镜 甲 裤 鞋 符 武 副".split(" "),l="头盔, 眼镜, 盔甲, 作战裤, 作战靴, 幸运符, 武器配件, 副手".split(", "),h=$("div[id^='citizen']",t),d=h.length;h.each(function(){var t=$(this),i=parseInt(t.attr("id").match(/([0-9]+)$/)[1]);fetchAndUpdateOneCitizenPage(i,!1,function(){if(0===citizenPage[i].equipments.length)return t.remove(),!0;var a=[];$.each(citizenPage[i].equipments,function(t,e){e=parseInt(e[1]),a.push($("<span>",{style:"color:"+r[e],text:o[t],title:"Q"+e+" "+l[t]}))}),t.prepend(a);var s=[];$.each(citizenPage[i].buffIcons,function(t,e){s.push($("<img>",{src:e,style:"width:18px; vertical-align:middle;"}))}),$.each(citizenPage[i].debuffIcons,function(t,e){s.push($("<img>",{src:e,style:"width:18px; vertical-align:middle;"}))}),t.append(s),0==--d&&(e.attr("disabled",!1),localStorage.setItem("citizenPage",JSON.stringify(citizenPage)))})})})}function enhanceBattleStatistics(){var t=$("div > a.fbShare2").closest("div.columns").empty();console.log(t);var e=$("<button>",{class:"foundation-style button",text:"显示所有局"}).appendTo(t),i=$("#battleProgress:first");e.click(function(){for(var e=t.closest("div.fightContainer "),a=$('a[href^="battle.html"]').attr("href"),s=$('img[src$="blue_ball.png"]').length+$('img[src$="red_ball.png"]').length;s>0;--s){var n=$("<div>",{class:"foundation-radius fightContainer oldRound",id:"ehRound"+s,roundId:s}).insertAfter(e).hide();$("<div>",{class:"foundation-style small-2 columns topDefenders",id:"defenderBH"}).appendTo(n);var r=$("<div>",{class:"foundation-style small-6 columns",id:"middle"}).appendTo(n);i.clone().appendTo(r),$("<div>",{class:"foundation-radius fightContainer foundation-base-font",id:"scores"}).appendTo(r),$("<div>",{class:"foundation-style small-2 columns topAttackers",id:"attackerBH"}).appendTo(n)}$("div.oldRound").each(function(){var t=$(this),e=$("#middle",t),i=$("#scores",e),s=t.attr("roundId");$.ajax({url:a+"&round="+s,success:function(e){$("#topDefender1",e).children().appendTo($("#defenderBH",t)),$("#topAttacker1",e).children().appendTo($("#attackerBH",t));var n=$("#leftStat",e).text().match(/^([\d\.]+)/)[1];$("#battleProgress",t).attr("aria-valuenow",n),$("#battleProgress > div.ui-progressbar-value",t).attr("style","width: "+n+"%");var r=$("#battleProgressStats",e).insertAfter($("#battleProgress",t)),o=$("<div>").appendTo(r),l=parseInt($("#defenderScore",e).text().replace(/,/g,"").replace(/\xA0/g,""))-parseInt($("#attackerScore",e).text().replace(/,/g,"").replace(/\xA0/g,""));0===l?o.text(""):l>0?o.text(">> "+l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>"):o.text("<< "+(-l).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<"),$("#defenderScore",e).closest("div").appendTo(i),$("<a>",{class:"foundation-style small-2 columns",href:a+"&round="+s,text:"Round "+s}).appendTo(i),$("#attackerScore",e).closest("div").appendTo(i),t.show()},error:function(t,e){console.log("第",s,"局伤害抓取错误 (",e,")，重新抓取"),$.ajax(this)}})})}),calBattleConsumption()}function calBattleConsumption(){var t=[],e=[],a=[],s=[],n=[],r=[],o=[],l=[],h=[],d=[],c=[],p=[],u=[],g=[],f=[];function m(i){var n=t.indexOf(i);return n<0?(t.push(i),e.push(countryInfo[i].name),a[t.length-1]=new Array,s[t.length-1]=new Array,t.length-1):n}function b(t){var e=o.indexOf(t);return e<0?(o.push(t),d[o.length-1]=new Array,c[o.length-1]=new Array,$.ajax({url:"apiMilitaryUnitById.html?id="+t,async:!1,success:function(t){var e=JSON.parse(t);l.push(e.name),h.push(e.countryId)},error:function(e,i){console.log("获取军团API错误 (",i,")"),l.push("未知军团（"+t+"）"),h.push(-1)}}),o.length-1):e}function x(t,e){return(Array(e).join(0)+t).slice(-e)}function v(t,e){var i,a,s,n,r=[];$(".CBCCountry").each(function(o,l){""==(a=$(this).children("td:eq("+t+")").text())&&(a="0"),""==(i=$(this).children("td:eq("+e+")").text())&&(i="0"),s=parseInt(i)+5*parseInt(a),n=x(s,6),r.push(n+" "+$(this).attr("id"))}),r.sort(),$.each(r,function(t,e){var i=e.split(" ").pop();$("#CBCCountryResult #"+i).insertAfter($("#CBCCountryResult tr:first"))})}function y(t,e){var i,a,s,n,r=[];$(".CBCMu").each(function(o,l){""==(a=$(this).children("td:eq("+t+")").text())&&(a="0"),""==(i=$(this).children("td:eq("+e+")").text())&&(i="0"),s=parseInt(i)+5*parseInt(a),n=x(s,6),r.push(n+" "+$(this).attr("id"))}),r.sort(),$.each(r,function(t,e){var i=e.split(" ").pop();$("#CBCMuResult #"+i).insertAfter($("#CBCMuResult tr:first"))})}function k(t){if("ie"==((o=window.navigator.userAgent).indexOf("MSIE")>=0?"ie":o.indexOf("Firefox")>=0?"Firefox":o.indexOf("Chrome")>=0?"Chrome":o.indexOf("Opera")>=0?"Opera":o.indexOf("Safari")>=0?"Safari":void 0)){var e=document.getElementById(t),i=new ActiveXObject("Excel.Application"),a=i.Workbooks.Add(),s=a.Worksheets(1),n=document.body.createTextRange();n.moveToElementText(e),n.select(),n.execCommand("Copy"),s.Paste(),i.Visible=!0;try{var r=i.Application.GetSaveAsFilename("Excel.xls","Excel Spreadsheets (*.xls), *.xls")}catch(t){print("Nested catch caught "+t)}finally{a.SaveAs(r),a.Close(savechanges=!1),i.Quit(),i=null,window.setInterval("Cleanup();",1)}}else S(t);var o}!function(){var x=$("div.foundation-radius.fightContainer.foundation-base-font :last"),S=x.clone().insertAfter(x);S.empty();var w=$("<button>",{class:"foundation-style button",text:"统计战场消耗"}).appendTo(S),_=$("<input>",{type:"checkbox",id:"calMuConsumptionCheckbox"}).appendTo(S);$("<label>",{class:"checkboxlabel",for:"calMuConsumptionCheckbox",text:"同时统计军团消耗（需要耐心等待）"}).appendTo(S),$("<input>",{type:"checkbox",id:"showRoundsDetailCheckbox"}).appendTo(S),$("<label>",{class:"checkboxlabel",for:"showRoundsDetailCheckbox",text:"显示每回合的消耗数量"}).appendTo(S);w.click(function(){w.attr("disabled",!0);var x=_.is(":checked"),T=$('a[href^="battle.html"]').attr("href").split("?id=")[1],I=$('img[src$="blue_ball.png"]').length+$('img[src$="red_ball.png"]').length;if(I<=0)w.text("第一回合还没结束呢！");else{var C=I;w.text("剩余"+C+"个"),function x(S,w,_,T,I,C){$.ajax({url:"apiFights.html?battleId="+_+"&roundId="+T,success:function(D){if(1==C?function(t,e){var o,l,h=JSON.parse(t);for(i=0;i<h.length;++i)o=m(h[i].citizenship),l=void 0!==h[i].militaryUnit?b(h[i].militaryUnit):-1,1==h[i].weapon?(h[i].citizenId==userId&&(void 0===g[e]?g[e]=1+4*h[i].berserk:g[e]+=1+4*h[i].berserk),void 0===a[o][e]?a[o][e]=1+4*h[i].berserk:a[o][e]+=1+4*h[i].berserk,void 0===n[o]?n[o]=1+4*h[i].berserk:n[o]+=1+4*h[i].berserk,void 0!==h[i].militaryUnit&&(void 0===d[l][e]?d[l][e]=1+4*h[i].berserk:d[l][e]+=1+4*h[i].berserk,void 0===p[l]?p[l]=1+4*h[i].berserk:p[l]+=1+4*h[i].berserk)):5==h[i].weapon&&(h[i].citizenId==userId&&(void 0===f[e]?f[e]=1+4*h[i].berserk:f[e]+=1+4*h[i].berserk),void 0===s[o][e]?s[o][e]=1+4*h[i].berserk:s[o][e]+=1+4*h[i].berserk,void 0===r[o]?r[o]=1+4*h[i].berserk:r[o]+=1+4*h[i].berserk,void 0!==h[i].militaryUnit&&(void 0===c[l][e]?c[l][e]=1+4*h[i].berserk:c[l][e]+=1+4*h[i].berserk,void 0===u[l]?u[l]=1+4*h[i].berserk:u[l]+=1+4*h[i].berserk))}(D,T):function(t,e){var o,l=JSON.parse(t);for(i=0;i<l.length;++i)o=m(l[i].citizenship),1==l[i].weapon?(l[i].citizenId==userId&&(void 0===g[e]?g[e]=1+4*l[i].berserk:g[e]+=1+4*l[i].berserk),void 0===a[o][e]?a[o][e]=1+4*l[i].berserk:a[o][e]+=1+4*l[i].berserk,void 0===n[o]?n[o]=1+4*l[i].berserk:n[o]+=1+4*l[i].berserk):5==l[i].weapon&&(l[i].citizenId==userId&&(void 0===f[e]?f[e]=1+4*l[i].berserk:f[e]+=1+4*l[i].berserk),void 0===s[o][e]?s[o][e]=1+4*l[i].berserk:s[o][e]+=1+4*l[i].berserk,void 0===r[o]?r[o]=1+4*l[i].berserk:r[o]+=1+4*l[i].berserk)}(D,T),S.text("剩余"+(I-T)+"个"),I==T){S.text("加载完成，共"+I+"回合"),function(i,o){$("<p>国家消耗统计</p>").appendTo(o);var l,h,d,c,p=$("<table>",{id:"CBCCountryResult",style:"width:100%;"}).appendTo(o),u=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(p),g=$("#showRoundsDetailCheckbox").is(":checked");if(!0===g){$("<td>",{text:"回合"}).appendTo(u);for(l=1;l<=i;++l)$("<td>",{text:l}).appendTo(u);$("<td>",{text:"总计(Q1)"}).appendTo(u),$("<td>",{text:"总计(Q5)"}).appendTo(u)}else{$("<td>",{text:"国家"}).appendTo(u);$("<td>",{text:"总计(Q1)"}).appendTo(u),$("<td>",{text:"总计(Q5)"}).appendTo(u)}for(l=0;l<t.length;++l)if(void 0!==n[l]||void 0!==r[l]){if(d=$("<tr>",{id:"CBCCountry-"+l,class:"CBCCountry",style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(p),c=$("<td>",{text:e[l]}).appendTo(d),$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[t[l]].flagName,style:"vertical-align:middle;"}).prependTo(c),!0===g)for(h=1;h<=i;++h)void 0===a[l][h]?void 0===s[l][h]?$("<td>",{text:""}).appendTo(d):$("<td>",{text:s[l][h]+" Q5"}).appendTo(d):void 0===s[l][h]?$("<td>",{text:a[l][h]+" Q1"}).appendTo(d):$("<td>",{text:a[l][h]+" Q1  "+s[l][h]+" Q5"}).appendTo(d);$("<td>",{text:n[l]}).appendTo(d),$("<td>",{text:r[l]}).appendTo(d)}!0===g?v(i+2,i+1):v(2,1);var f,m,b,x=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(p);if($("<td>",{text:"总消耗"}).appendTo(x),!0===g)for(var y=1;y<=i;++y){f=0,m=0;for(var k=0;k<t.length;++k)void 0!==a[k][y]&&(f+=a[k][y]),void 0!==s[k][y]&&(m+=s[k][y]);0==f?0==m?$("<td>",{text:""}).appendTo(x):$("<td>",{text:m+" Q5"}).appendTo(x):0==m?$("<td>",{text:f+" Q1"}).appendTo(x):$("<td>",{text:f+" Q1  "+m+" Q5"}).appendTo(x)}var S=0,w=0;for(b=0;b<n.length;b++)void 0!==n[b]&&(S+=n[b]);for(b=0;b<r.length;b++)void 0!==r[b]&&(w+=r[b]);$("<td>",{text:S}).appendTo(x),$("<td>",{text:w}).appendTo(x)}(I,w);var M=$('<button type="button">导出</button>').appendTo(w);if(M.click(function(){k("CBCCountryResult")}),1==C){!function(t,e){$("<p>军团消耗统计</p>").appendTo(e);var i,a,s,n,r=$("<table>",{id:"CBCMuResult",style:"width:100%;"}).appendTo(e),g=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(r),f=$("#showRoundsDetailCheckbox").is(":checked");if(!0===f){$("<td>",{text:"回合"}).appendTo(g);for(i=1;i<=t;++i)$("<td>",{text:i}).appendTo(g);$("<td>",{text:"总计(Q1)"}).appendTo(g),$("<td>",{text:"总计(Q5)"}).appendTo(g)}else{$("<td>",{text:"军团"}).appendTo(g);$("<td>",{text:"总计(Q1)"}).appendTo(g),$("<td>",{text:"总计(Q5)"}).appendTo(g)}for(i=0;i<o.length;++i)if(void 0!==p[i]||void 0!==u[i]){if(s=$("<tr>",{id:"CBCMu-"+i,class:"CBCMu",style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(r),n=$("<td></td>").appendTo(s),$("<a>",{href:"militaryUnit.html?id="+o[i],text:l[i]}).appendTo(n),-1==h[i]?$("<div>",{class:"xflagsSmall xflagsSmall-Adminland",style:"vertical-align:middle;"}).prependTo(n):$("<div>",{class:"xflagsSmall xflagsSmall-"+countryInfo[h[i]].flagName,style:"vertical-align:middle;"}).prependTo(n),!0===f)for(a=1;a<=t;++a)void 0===d[i][a]?void 0===c[i][a]?$("<td>",{text:""}).appendTo(s):$("<td>",{text:c[i][a]+" Q5"}).appendTo(s):void 0===c[i][a]?$("<td>",{text:d[i][a]+" Q1"}).appendTo(s):$("<td>",{text:d[i][a]+" Q1  "+c[i][a]+" Q5"}).appendTo(s);$("<td>",{text:p[i]}).appendTo(s),$("<td>",{text:u[i]}).appendTo(s)}!0===f?y(t+2,t+1):y(2,1);var m,b,x,v=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(r);if($("<td>",{text:"总消耗"}).appendTo(v),!0===f)for(var k=1;k<=t;++k){m=0,b=0;for(var S=0;S<o.length;++S)void 0!==d[S][k]&&(m+=d[S][k]),void 0!==c[S][k]&&(b+=c[S][k]);0==m?0==b?$("<td>",{text:""}).appendTo(v):$("<td>",{text:b+" Q5"}).appendTo(v):0==b?$("<td>",{text:m+" Q1"}).appendTo(v):$("<td>",{text:m+" Q1  "+b+" Q5"}).appendTo(v)}var w=0,_=0;for(x=0;x<p.length;x++)void 0!==p[x]&&(w+=p[x]);for(x=0;x<u.length;x++)void 0!==u[x]&&(_+=u[x]);$("<td>",{text:w}).appendTo(v),$("<td>",{text:_}).appendTo(v)}(I,w);var q=$('<button type="button">导出</button>').appendTo(w);q.click(function(){k("CBCMuResult")})}!function(t,e){$("<p>个人消耗统计</p>").appendTo(e);var i,a=$("<table>",{id:"CBCPersonalResult",style:"width:100%;"}).appendTo(e),s=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(a);$("<td>",{text:"回合"}).appendTo(s);for(i=1;i<=t;++i)$("<td>",{text:i}).appendTo(s);$("<td>",{text:"总计(Q1)"}).appendTo(s),$("<td>",{text:"总计(Q5)"}).appendTo(s);var n,r=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(a);$("<td>",{text:citizenInfo[userId].login}).appendTo(r);for(i=1;i<=t;++i)void 0===g[i]?void 0===f[i]?$("<td>",{text:""}).appendTo(r):$("<td>",{text:f[i]+" Q5"}).appendTo(r):void 0===f[i]?$("<td>",{text:g[i]+" Q1"}).appendTo(r):$("<td>",{text:g[i]+" Q1  "+f[i]+" Q5"}).appendTo(r);var o=0,l=0;for(n=0;n<g.length;n++)void 0!==g[n]&&(o+=g[n]);for(n=0;n<f.length;n++)void 0!==f[n]&&(l+=f[n]);$("<td>",{text:o}).appendTo(r),$("<td>",{text:l}).appendTo(r)}(I,w);var j=$('<button type="button">复制个人消耗记录</button>').appendTo(w);j.click(function(){for(var t,e=$("#CBCPersonalResult tr:eq(1) td:eq(0)").text()+"的战场消耗：\r\n",i=location.origin+"/battle.html?id="+GetQueryString("id")+"&round=",a=1;a<=I;a++)""!=(t=$("#CBCPersonalResult tr:eq(1) td:eq("+a+")").text())&&(e=e+i+$("#CBCPersonalResult tr:eq(0) td:eq("+a+")").text()+"    "+t+"\r\n");e+="------------------------------------------------------------\r\n总计： ",""!=(t=$("#CBCPersonalResult tr:eq(1) td:eq("+(I+1)+")").text())&&(e=e+t+" Q1  "),"0"!=(t=$("#CBCPersonalResult tr:eq(1) td:eq("+(I+2)+")").text())&&(e=e+t+" Q5"),GM_setClipboard(e)})}T+1<=I&&x(S,w,_,T+1,I,C)},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})}(w,S,T,1,I,x)}})}();var S=function(t,e){t.nodeType||(t=document.getElementById(t));var i,a,s={worksheet:e||"Worksheet",table:t.innerHTML};window.location.href="data:application/vnd.ms-excel;base64,"+(a=s,i='<html><head><meta charset="UTF-8"></head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(t,e){return a[e]}),window.btoa(unescape(encodeURIComponent(i))))}}function enhanceCitizensOnline(){1!==$("td",$("table.dataTable tr:gt(0)")).length&&(function(){if($("#pagination-digg").length>0){var t=$("<button>",{text:"加载其他页的在线玩家",class:"foundation-style button",title:"如果需要加载所有在线玩家，请尽快点击该按钮，否则可能会出现重复玩家或丢失玩家"}).appendTo($(".dataTable tr:first td:first")),e=$("table.dataTable:last");t.click(function(){t.attr("disabled",!0);var i,a=$("li.next"),s=parseInt($("li.active")[0].innerHTML),n=(i=a.length>0?parseInt(a.prev().children().attr("href").split("page=")[1]):s)-1;t.text("剩余"+n+"个");for(var r=1;r<=i;r++)if(r!=s){var o=document.URL;o=o.indexOf("page")>0?o.substring(0,o.indexOf("page"))+"page="+r:o.indexOf("?")>0?o+"&page="+r:o+"?page="+r,$.ajax({url:o,success:function(a){if(2!==$(".time",a).length)return console.log(citizenId,"抓取错误，重新抓取"),void $.ajax(this);if(1===$("td",$(".dataTable tr:gt(0)",a)).length)return!1;var s=$("tr :gt(0)",$(".dataTable",a));s.appendTo(e),t.text("剩余"+--n+"个"),n<=0&&t.text("加载完成，共"+i+"页")},error:function(t,e){console.log("抓取错误 (",e,")，重新抓取"),$.ajax(this)}})}})}}(),function(){var t=$(".dataTable :first").parent(),e=$("<div class='foundation-style columns'></div>");t.before(e);$("<b>",{text:"默认使用武器：",title:"不开坦克buff的情况下该服务器大多数玩家使用的武器"}).appendTo(e);var i=$("<select>",{id:"DefaultWeapon",style:"padding:3px; margin:3px;"}).appendTo(e);$("<option>",{value:1,text:"Q1"}).appendTo(i),$("<option>",{value:5,text:"Q5"}).appendTo(i);var a=localStorage.getItem("CitizensOnlineDefaultWeapon");null===a?(localStorage.setItem("CitizensOnlineDefaultWeapon",1),i.val(1)):i.val(a);i.change(function(){localStorage.setItem("CitizensOnlineDefaultWeapon",i.val())});var s=$("<input>",{type:"checkbox",id:"DefaultMuBonus"}).appendTo(e),n=($("<label>",{class:"checkboxlabel",for:"DefaultMuBonus",text:"军令加成",title:"默认精英军团（20%加成）"}).appendTo(e),localStorage.getItem("CitizensOnlineDefaultMuBonus"));null===n?(localStorage.setItem("CitizensOnlineDefaultMuBonus",!0),s.attr("checked",!0)):s.attr("checked","true"==n);s.click(function(){s.is(":checked")?localStorage.setItem("CitizensOnlineDefaultMuBonus",!0):localStorage.setItem("CitizensOnlineDefaultMuBonus",!1)});$("<span>",{text:"    更多伤害："}).appendTo(e);for(var r=$("<select>",{id:"MoreDamage",style:"padding:3px; margin:3px;"}).appendTo(e),o=0;o<=40;o++)$("<option>",{value:10*o,text:(10*o).toString()+"%"}).appendTo(r);var l=localStorage.getItem("CitizensOnlineMoreDamage");null===l?(localStorage.setItem("CitizensOnlineMoreDamage",0),r.val(0)):r.val(l);r.change(function(){localStorage.setItem("CitizensOnlineMoreDamage",r.val())});$("<span>",{text:"更多暴击："}).appendTo(e);for(var h=$("<select>",{id:"MoreCritical",style:"padding:3px; margin:3px;"}).appendTo(e),o=0;o<=20;o++)$("<option>",{value:10*o,text:(10*o).toString()+"%"}).appendTo(h);var d=localStorage.getItem("CitizensOnlineMoreCritical");null===d?(localStorage.setItem("CitizensOnlineMoreCritical",0),h.val(0)):h.val(d);h.change(function(){localStorage.setItem("CitizensOnlineMoreCritical",h.val())});var c=$("<input type='button' class='foundation-style button' value='获取玩家状态'></input> ");e.append(c),c.click(function(){var t,e;c.attr("disabled",!0),$("table.dataTable tr:eq(0)").append($("<td exid='info'>详细信息</td>")),$("table.dataTable tr:gt(0)").append($('<td exid="info"><span id="buffs">BUFF：</span><br><span id="estBerserkAvg" title="伤害不含建筑加成，默认有本地加成，无被包围加成">连击平均伤害：加载中……</span><br><span id="score1" title="与无装备状态相比">总伤害：加载中……</span><br><span id="score2" title="与无装备状态相比，且不考虑闪避属性(avoid)">爆发力：加载中……</span></td>')),t=$("table.dataTable:last tr:gt(0)"),e=t.length,t.each(function(){var t=parseInt($("td:first a",$(this)).attr("href").match(/([0-9]+)$/)[1]),i=$(this);fetchAndUpdateOneCitizenPage(t,!1,function(){if(0===citizenPage[t].equipments.length)return $("td[exid='info']",i).html("组织号"),!0;var a,s,n=[];$.each(citizenPage[t].buffIcons,function(t,e){n.push($("<img>",{src:e,style:"width:20px; height:20px; vertical-align:middle;"}))}),$.each(citizenPage[t].debuffIcons,function(t,e){n.push($("<img>",{src:e,style:"width:20px; height:20px; vertical-align:middle;"}))}),n.length>0?$("#buffs",i).append(n):$("#buffs",i).append("无");var r,o=0,l=0,h=0,d=0,c=1,p=$("#DefaultWeapon").val();c=0==p?.5:1+.2*p,r=$("#DefaultMuBonus").is(":checked")?1.2:1;for(var u=1+.01*$("#MoreDamage").val(),g=1+.01*$("#MoreCritical").val(),f=citizenPage[t].buffIcons,m=0;m<citizenPage[t].debuffIcons.length;m++)f.push(citizenPage[t].debuffIcons[m]);for(var b=0;b<f.length;b++){var x=f[b].match(/(steroids|tank|spa|vacations|bunker|resistance|painDealer1h|painDealer10h|painDealer25h)\_(positive|negative)/gi);if(null===x)break;switch(x[0]){case"painDealer10h_positive":case"painDealer1h_positive":case"painDealer25h_positive":o=1;break;case"steroids_positive":l=1;break;case"steroids_negative":l=-1;break;case"tank_positive":h=1,c=2;break;case"tank_negative":h=-1,c=.5;break;case"bunker_positive":case"resistance_positive":d=1;break;case"bunker_negative":case"resistance_negative":d=1}}var v,y=citizenPage[t].lowHit,k=citizenPage[t].highHit,S=citizenPage[t].critical/100,w=citizenPage[t].miss/100,_=citizenPage[t].avoid/100,T=c;v=S,1==o&&(v*=2),(v*=g)>.8&&(v=.8),1==l?T*=1.2:-1==l&&(T*=.8),1==h&&(T*=1.2),1==d?T*=1.25:-1==d&&(T*=.8),T*=r,T*=1.2,T*=u;var I=Math.round(y*T*5),C=Math.round(k*T*5),D=(I+C)*(1+v)/10;$("#estBerserkAvg",i).html("连击平均伤害："+function(t){var e=(t+="").split(".");return e[0].replace(/(\d{1,3})(?=(\d{3})+$)/g,"$1,")+(2==e.length?"."+e[1]:"")}(Math.round(5*D)));for(var M=citizenPage[t].strength,q=citizenPage[t].totalDamage,j=[{damageRequired:0,name:"Rookie",damageModifier:1},{damageRequired:250,name:"Private",damageModifier:1.1},{damageRequired:1e3,name:"Private First Class",damageModifier:1.2},{damageRequired:3e3,name:"Corporal",damageModifier:1.3},{damageRequired:5e3,name:"Sergeant",damageModifier:1.4},{damageRequired:1e4,name:"Staff Sergeant",damageModifier:1.5},{damageRequired:3e4,name:"Sergeant First Class",damageModifier:1.6},{damageRequired:6e4,name:"Master Sergeant",damageModifier:1.65},{damageRequired:1e5,name:"First Sergeant",damageModifier:1.7},{damageRequired:25e4,name:"Sergeant Major",damageModifier:1.75},{damageRequired:5e5,name:"Command Sergeant Major",damageModifier:1.8},{damageRequired:75e4,name:"Sergeant Major of the Army",damageModifier:1.85},{damageRequired:1e6,name:"Second Lieutenant",damageModifier:1.9},{damageRequired:15e5,name:"First Lieutenant",damageModifier:1.93},{damageRequired:25e5,name:"Captain",damageModifier:1.96},{damageRequired:5e6,name:"Major",damageModifier:2},{damageRequired:1e7,name:"Lieutenant Colonel",damageModifier:2.03},{damageRequired:17e6,name:"Colonel",damageModifier:2.06},{damageRequired:25e6,name:"Brigadier General",damageModifier:2.1},{damageRequired:35e6,name:"Major General",damageModifier:2.13},{damageRequired:45e6,name:"Lieutenant General",damageModifier:2.16},{damageRequired:6e7,name:"General",damageModifier:2.19},{damageRequired:8e7,name:"General of the Army",damageModifier:2.21},{damageRequired:1e8,name:"Marshall",damageModifier:2.24},{damageRequired:125e6,name:"Field Marshall",damageModifier:2.27},{damageRequired:175e6,name:"Supreme Marshall",damageModifier:2.3},{damageRequired:25e7,name:"Generalissimus",damageModifier:2.33},{damageRequired:4e8,name:"Supreme Generalissimuss",damageModifier:2.36},{damageRequired:6e8,name:"Imperial Generalissimus",damageModifier:2.4},{damageRequired:8e8,name:"Legendary Generalissimuss",damageModifier:2.42},{damageRequired:1e9,name:"Imperator",damageModifier:2.44},{damageRequired:15e8,name:"Imperator Caesar",damageModifier:2.46},{damageRequired:25e8,name:"Deus Dimidiam",damageModifier:2.48},{damageRequired:5e9,name:"Deus",damageModifier:2.5},{damageRequired:75e8,name:"Summi Deus",damageModifier:2.52},{damageRequired:1e10,name:"Deus Imperialis",damageModifier:2.54},{damageRequired:15e9,name:"Deus Fabuloso",damageModifier:2.56},{damageRequired:2e10,name:"Deus Ultimum",damageModifier:2.58}],m=0;m<j.length;++m)if(j[m].damageRequired>q){q=j[m-1].damageModifier;break}j[j.length-1].damageRequired<=q&&(q=j[j.length-1].damageModifier),a=.95*(s=(s=(y+k)/2*(1+v)*(1-w)/(M*q*1.125*.875))<1?1:s)/(1-_),$("#score1",i).text("总伤害：+"+(100*(a-1)).toFixed(2)+"%"),$("#score2",i).text("爆发力：+"+(100*(s-1)).toFixed(2)+"%"),0==--e&&localStorage.setItem("citizenPage",JSON.stringify(citizenPage))})})})}(),function(){var t,e;sortIndex=-1;var i=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(1)")),a=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(2)")),s=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(3)")),n=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(4)"));function r(i,a,s){var n=new Array;i.each(function(){var t=$(this).find("td");n.push(a+".separator"+$(t[s]).html()+".separator"+$(this).html()),$(this).html("")});var r=n.length;if(s==sortIndex)n.reverse();else for(var o=0;o<r;o++){a=n[o].split(".separator")[0];for(var l=o+1;l<r;l++)if(t=n[o].split(".separator")[1],e=n[l].split(".separator")[1],"number"==a){if(t=""==t?0:parseInt(t),e=""==e?0:parseInt(e),t<e){var h=n[l];n[l]=n[o],n[o]=h}}else if("formatNumber"==a){if(t=""==t?0:parseInt(t.replace(/,/g,"").replace(/\xA0/g,"")),e=""==e?0:parseInt(e.replace(/,/g,"").replace(/\xA0/g,"")),t<e){var h=n[l];n[l]=n[o],n[o]=h}}else if("region"==a&&(t=""==t?0:parseInt(t.match(/id=([0-9]+)/)[1]),e=""==e?0:parseInt(e.match(/id=([0-9]+)/)[1]),t<e)){var h=n[l];n[l]=n[o],n[o]=h}}for(var d=$("table.dataTable:last").children(),o=0;o<r;o++)$("tr:eq("+(o+1)+")",d).html(n[o].split(".separator")[2]);sortIndex=s}i.click(function(){r($("table.dataTable:last tr:gt(0)"),"number",1)}),a.click(function(){r($("table.dataTable:last tr:gt(0)"),"formatNumber",2)}),s.click(function(){r($("table.dataTable:last tr:gt(0)"),"formatNumber",3)}),n.click(function(){r($("table.dataTable:last tr:gt(0)"),"region",4)})}(),function(){var t=$("table.dataTable:last"),e=$("<div></div>");e.insertBefore(t);var i=$("<table align='right'></table>");e.append(i);var a=$("<tr align='right'></tr>");i.append(a);var s=$("<input type='button' id='btnFilter' value='筛选玩家'></input> ");a.append(s);var n=$("<input type='button' id='btnCloseFilter' value='关闭筛选'></input> ");n.hide(),a.append(n);var r=$("<input type='button' id='btnDeleteCheckedCitizen' value='隐藏选中玩家'></input> ");r.attr("disabled",!0),a.append(r);var o=$("<input type='button' id='btnDeleteUncheckedCitizen' value='保留选中玩家'></input> ");o.attr("disabled",!0),a.append(o),s.click(function(){s.hide(),n.show();var e=$("<td exid='filter'><input type='checkbox'></input></td>");$("tr:eq(0)",t).append($("<td exid='filter'><input id='filterSelectAll' type='checkbox'></input>全选</td>")),$("tr:gt(0)",t).append(e),r.attr("disabled",!1),o.attr("disabled",!1),$("#filterSelectAll").click(function(){$("tr:gt(0)",t).each(function(t,e){$("input:checkbox",e).attr("checked",$("#filterSelectAll").is(":checked"))})})}),n.click(function(){s.show(),n.hide(),$("td[exid='filter']",t).remove(),r.attr("disabled",!0),o.attr("disabled",!0)}),r.click(function(){$("tr:gt(0)",t).each(function(t,e){var i=$("input:checkbox",e);!0===i.is(":checked")&&e.remove()})}),o.click(function(){$("tr:gt(0)",t).each(function(t,e){var i=$("input:checkbox",e);!1===i.is(":checked")&&e.remove()})})}())}!function(t){function e(e){t.jqplot.ElemContainer.call(this),this.name=e,this._series=[],this.show=!1,this.tickRenderer=t.jqplot.AxisTickRenderer,this.tickOptions={},this.labelRenderer=t.jqplot.AxisLabelRenderer,this.labelOptions={},this.label=null,this.showLabel=!0,this.min=null,this.max=null,this.autoscale=!1,this.pad=1.2,this.padMax=null,this.padMin=null,this.ticks=[],this.numberTicks,this.tickInterval,this.renderer=t.jqplot.LinearAxisRenderer,this.rendererOptions={},this.showTicks=!0,this.showTickMarks=!0,this.showMinorTicks=!0,this.drawMajorGridlines=!0,this.drawMinorGridlines=!1,this.drawMajorTickMarks=!0,this.drawMinorTickMarks=!0,this.useSeriesColor=!1,this.borderWidth=null,this.borderColor=null,this.scaleToHiddenSeries=!1,this._dataBounds={min:null,max:null},this._intervalStats=[],this._offsets={min:null,max:null},this._ticks=[],this._label=null,this.syncTicks=null,this.tickSpacing=75,this._min=null,this._max=null,this._tickInterval=null,this._numberTicks=null,this.__ticks=null,this._options={}}function i(e){t.jqplot.ElemContainer.call(this),this.show=!1,this.location="ne",this.labels=[],this.showLabels=!0,this.showSwatches=!0,this.placement="insideGrid",this.xoffset=0,this.yoffset=0,this.border,this.background,this.textColor,this.fontFamily,this.fontSize,this.rowSpacing="0.5em",this.renderer=t.jqplot.TableLegendRenderer,this.rendererOptions={},this.preDraw=!1,this.marginTop=null,this.marginRight=null,this.marginBottom=null,this.marginLeft=null,this.escapeHtml=!1,this._series=[],t.extend(!0,this,e)}function a(e){t.jqplot.ElemContainer.call(this),this.text=e,this.show=!0,this.fontFamily,this.fontSize,this.textAlign,this.textColor,this.renderer=t.jqplot.DivTitleRenderer,this.rendererOptions={},this.escapeHtml=!1}function s(e){e=e||{},t.jqplot.ElemContainer.call(this),this.show=!0,this.xaxis="xaxis",this._xaxis,this.yaxis="yaxis",this._yaxis,this.gridBorderWidth=2,this.renderer=t.jqplot.LineRenderer,this.rendererOptions={},this.data=[],this.gridData=[],this.label="",this.showLabel=!0,this.color,this.negativeColor,this.lineWidth=2.5,this.lineJoin="round",this.lineCap="round",this.linePattern="solid",this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1.25,this.shadowDepth=3,this.shadowAlpha="0.1",this.breakOnNull=!1,this.markerRenderer=t.jqplot.MarkerRenderer,this.markerOptions={},this.showLine=!0,this.showMarker=!0,this.index,this.fill=!1,this.fillColor,this.fillAlpha,this.fillAndStroke=!1,this.disableStack=!1,this._stack=!1,this.neighborThreshold=4,this.fillToZero=!1,this.fillToValue=0,this.fillAxis="y",this.useNegativeColors=!0,this._stackData=[],this._plotData=[],this._plotValues={x:[],y:[]},this._intervals={x:{},y:{}},this._prevPlotData=[],this._prevGridData=[],this._stackAxis="y",this._primaryAxis="_xaxis",this.canvas=new t.jqplot.GenericCanvas,this.shadowCanvas=new t.jqplot.GenericCanvas,this.plugins={},this._sumy=0,this._sumx=0,this._type="",this.step=!1}function n(){t.jqplot.ElemContainer.call(this),this.drawGridlines=!0,this.gridLineColor="#cccccc",this.gridLineWidth=1,this.background="#fffdf6",this.borderColor="#999999",this.borderWidth=2,this.drawBorder=!0,this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1.5,this.shadowWidth=3,this.shadowDepth=3,this.shadowColor=null,this.shadowAlpha="0.07",this._left,this._top,this._right,this._bottom,this._width,this._height,this._axes=[],this.renderer=t.jqplot.CanvasGridRenderer,this.rendererOptions={},this._offsets={top:null,bottom:null,left:null,right:null}}function r(t,e){return(3.4182054+e)*Math.pow(t,-.3534992)}function o(t){return(Math.exp(2*t)-1)/(Math.exp(2*t)+1)}function l(t){function e(t,e){return t-e==0?Math.pow(10,10):t-e}var i,a=this.renderer.smooth,s=this.canvas.getWidth(),n=this._xaxis.series_p2u,o=this._yaxis.series_p2u,l=t.length/s,h=[],d=[];i=isNaN(parseFloat(a))?r(l,.5):parseFloat(a);for(var c=[],p=[],u=0,g=t.length;g>u;u++)c.push(t[u][1]),p.push(t[u][0]);for(var f,m,b,x,v=t.length-1,y=1,k=t.length;k>y;y++){for(var $=[],S=[],w=0;2>w;w++){0==(u=y-1+w)||u==v?$[w]=Math.pow(10,10):c[u+1]-c[u]==0||c[u]-c[u-1]==0?$[w]=0:(p[u+1]-p[u])/(c[u+1]-c[u])+(p[u]-p[u-1])/(c[u]-c[u-1])==0?$[w]=0:(c[u+1]-c[u])*(c[u]-c[u-1])<0?$[w]=0:$[w]=2/(e(p[u+1],p[u])/(c[u+1]-c[u])+e(p[u],p[u-1])/(c[u]-c[u-1]))}1==y?$[0]=1.5*(c[1]-c[0])/e(p[1],p[0])-$[1]/2:y==v&&($[1]=1.5*(c[v]-c[v-1])/e(p[v],p[v-1])-$[0]/2),S[0]=-2*($[1]+2*$[0])/e(p[y],p[y-1])+6*(c[y]-c[y-1])/Math.pow(e(p[y],p[y-1]),2),S[1]=2*(2*$[1]+$[0])/e(p[y],p[y-1])-6*(c[y]-c[y-1])/Math.pow(e(p[y],p[y-1]),2),x=1/6*(S[1]-S[0])/e(p[y],p[y-1]),b=.5*(p[y]*S[0]-p[y-1]*S[1])/e(p[y],p[y-1]),m=(c[y]-c[y-1]-b*(Math.pow(p[y],2)-Math.pow(p[y-1],2))-x*(Math.pow(p[y],3)-Math.pow(p[y-1],3)))/e(p[y],p[y-1]),f=c[y-1]-m*p[y-1]-b*Math.pow(p[y-1],2)-x*Math.pow(p[y-1],3);var _,T,I=(p[y]-p[y-1])/i;for(w=0,g=i;g>w;w++)_=[],T=p[y-1]+w*I,_.push(T),_.push(f+m*T+b*Math.pow(T,2)+x*Math.pow(T,3)),h.push(_),d.push([n(_[0]),o(_[1])])}return h.push(t[u]),d.push([n(t[u][0]),o(t[u][1])]),[h,d]}function h(t){var e,i,a,s,n,l,h,d,c,p,u,g,f,m,b,x,v,y,k,$=this.renderer.smooth,S=this.renderer.tension,w=this.canvas.getWidth(),_=this._xaxis.series_p2u,T=this._yaxis.series_p2u,I=null,C=null,D=null,M=null,q=null,j=null,A=t.length/w,F=[],R=[];k=isNaN(parseFloat($))?r(A,.5):parseFloat($),isNaN(parseFloat(S))||(S=parseFloat(S));for(var P=0,O=t.length-1;O>P;P++)for(null===S?(M=Math.abs((t[P+1][1]-t[P][1])/(t[P+1][0]-t[P][0])),m=.3,b=.6,x=(b-m)/2,v=2.5,y=-1.4,j=M/v+y,C=x*o(j)-x*o(y)+m,P>0&&(q=Math.abs((t[P][1]-t[P-1][1])/(t[P][0]-t[P-1][0]))),j=q/v+y,D=x*o(j)-x*o(y)+m,I=(C+D)/2):I=S,e=0;k>e;e++)i=e/k,a=(1+2*i)*Math.pow(1-i,2),s=i*Math.pow(1-i,2),n=Math.pow(i,2)*(3-2*i),l=Math.pow(i,2)*(i-1),t[P-1]?(h=I*(t[P+1][0]-t[P-1][0]),d=I*(t[P+1][1]-t[P-1][1])):(h=I*(t[P+1][0]-t[P][0]),d=I*(t[P+1][1]-t[P][1])),t[P+2]?(c=I*(t[P+2][0]-t[P][0]),p=I*(t[P+2][1]-t[P][1])):(c=I*(t[P+1][0]-t[P][0]),p=I*(t[P+1][1]-t[P][1])),u=a*t[P][0]+n*t[P+1][0]+s*h+l*c,g=a*t[P][1]+n*t[P+1][1]+s*d+l*p,f=[u,g],F.push(f),R.push([_(u),T(g)]);return F.push(t[O]),R.push([_(t[O][0]),T(t[O][1])]),[F,R]}function d(e,i,a){for(var s=0;s<this.series.length;s++)this.series[s].renderer.constructor==t.jqplot.LineRenderer&&this.series[s].highlightMouseOver&&(this.series[s].highlightMouseDown=!1)}function c(){this.plugins.lineRenderer&&this.plugins.lineRenderer.highlightCanvas&&(this.plugins.lineRenderer.highlightCanvas.resetCanvas(),this.plugins.lineRenderer.highlightCanvas=null),this.plugins.lineRenderer.highlightedSeriesIndex=null,this.plugins.lineRenderer.highlightCanvas=new t.jqplot.GenericCanvas,this.eventCanvas._elem.before(this.plugins.lineRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-lineRenderer-highlight-canvas",this._plotDimensions,this)),this.plugins.lineRenderer.highlightCanvas.setContext(),this.eventCanvas._elem.bind("mouseleave",{plot:this},function(t){u(t.data.plot)})}function p(t,e,i,a){var s=t.series[e],n=t.plugins.lineRenderer.highlightCanvas;n._ctx.clearRect(0,0,n._ctx.canvas.width,n._ctx.canvas.height),s._highlightedPoint=i,t.plugins.lineRenderer.highlightedSeriesIndex=e;var r={fillStyle:s.highlightColor};"line"===s.type&&s.renderer.bands.show&&(r.fill=!0,r.closePath=!0),s.renderer.shapeRenderer.draw(n._ctx,a,r),n=null}function u(t){var e=t.plugins.lineRenderer.highlightCanvas;e._ctx.clearRect(0,0,e._ctx.canvas.width,e._ctx.canvas.height);for(var i=0;i<t.series.length;i++)t.series[i]._highlightedPoint=null;t.plugins.lineRenderer.highlightedSeriesIndex=null,t.target.trigger("jqplotDataUnhighlight"),e=null}function g(t,e,i,a,s){if(a){var n=[a.seriesIndex,a.pointIndex,a.data],r=jQuery.Event("jqplotDataMouseOver");if(r.pageX=t.pageX,r.pageY=t.pageY,s.target.trigger(r,n),s.series[n[0]].highlightMouseOver&&n[0]!=s.plugins.lineRenderer.highlightedSeriesIndex){var o=jQuery.Event("jqplotDataHighlight");o.which=t.which,o.pageX=t.pageX,o.pageY=t.pageY,s.target.trigger(o,n),p(s,a.seriesIndex,a.pointIndex,a.points)}}else null==a&&u(s)}function f(t,e,i,a,s){if(a){var n=[a.seriesIndex,a.pointIndex,a.data];if(s.series[n[0]].highlightMouseDown&&n[0]!=s.plugins.lineRenderer.highlightedSeriesIndex){var r=jQuery.Event("jqplotDataHighlight");r.which=t.which,r.pageX=t.pageX,r.pageY=t.pageY,s.target.trigger(r,n),p(s,a.seriesIndex,a.pointIndex,a.points)}}else null==a&&u(s)}function m(t,e,i,a,s){var n=s.plugins.lineRenderer.highlightedSeriesIndex;null!=n&&s.series[n].highlightMouseDown&&u(s)}function b(t,e,i,a,s){if(a){var n=[a.seriesIndex,a.pointIndex,a.data],r=jQuery.Event("jqplotDataClick");r.which=t.which,r.pageX=t.pageX,r.pageY=t.pageY,s.target.trigger(r,n)}}function x(t,e,i,a,s){if(a){var n=[a.seriesIndex,a.pointIndex,a.data],r=s.plugins.lineRenderer.highlightedSeriesIndex;null!=r&&s.series[r].highlightMouseDown&&u(s);var o=jQuery.Event("jqplotDataRightClick");o.which=t.which,o.pageX=t.pageX,o.pageY=t.pageY,s.target.trigger(o,n)}}function v(t){var e;if((t=Math.abs(t))>=10)e="%d";else if(t>1)e=t===parseInt(t,10)?"%d":"%.1f";else{e="%."+-Math.floor(Math.log(t)/Math.LN10)+"f"}return e}function y(t,e){var i=t/((e=e||7)-1),a=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/a;return 1>a?s>5?10*a:s>2?5*a:s>1?2*a:a:s>5?10*a:s>4?5*a:s>3?4*a:s>2?3*a:s>1?2*a:a}function k(t,e){e=e||1;var i=Math.floor(Math.log(t)/Math.LN10),a=Math.pow(10,i),s=t/a;return(.38>=(s/=e)?.1:1.6>=s?.2:4>=s?.5:8>=s?1:16>=s?2:5)*a}function $(t,e){return t-e}function S(t){if(null==t||"object"!=typeof t)return t;var e=new t.constructor;for(var i in t)e[i]=S(t[i]);return e}function w(t,e){if(null!=e&&"object"==typeof e)for(var i in e)"highlightColors"==i&&(t[i]=S(e[i])),null!=e[i]&&"object"==typeof e[i]?(t.hasOwnProperty(i)||(t[i]={}),w(t[i],e[i])):t[i]=e[i]}function _(t,e){if(e.indexOf)return e.indexOf(t);for(var i=0,a=e.length;a>i;i++)if(e[i]===t)return i;return-1}function T(t){return null===t?"[object Null]":Object.prototype.toString.call(t)}var I;t.fn.emptyForce=function(){for(var e,i=0;null!=(e=t(this)[i]);i++){if(1===e.nodeType&&t.cleanData(e.getElementsByTagName("*")),t.jqplot.use_excanvas)e.outerHTML="";else for(;e.firstChild;)e.removeChild(e.firstChild);e=null}return t(this)},t.fn.removeChildForce=function(t){for(;t.firstChild;)this.removeChildForce(t.firstChild),t.removeChild(t.firstChild)},t.fn.jqplot=function(){for(var e=[],i=[],a=0,s=arguments.length;s>a;a++)t.isArray(arguments[a])?e.push(arguments[a]):t.isPlainObject(arguments[a])&&i.push(arguments[a]);return this.each(function(a){var s,n,r,o,l=t(this),h=e.length,d=i.length;r=h>a?e[a]:h?e[h-1]:null,o=d>a?i[a]:d?i[d-1]:null,(s=l.attr("id"))===I&&(s="jqplot_target_"+t.jqplot.targetCounter++,l.attr("id",s)),n=t.jqplot(s,r,o),l.data("jqplot",n)})},t.jqplot=function(r,o,l){var h=null,d=null;3===arguments.length?(h=o,d=l):2===arguments.length&&(t.isArray(o)?h=o:t.isPlainObject(o)&&(d=o)),null===h&&null!==d&&d.data&&(h=d.data);var c=new function r(){function o(t){for(var e,i=0;i<t.length;i++)for(var a,s=[t[i].data,t[i]._stackData,t[i]._plotData,t[i]._prevPlotData],n=0;4>n;n++)if(a=!0,e=s[n],"x"==t[i]._stackAxis){for(var r=0;r<e.length;r++)if("number"!=typeof e[r][1]){a=!1;break}a&&e.sort(function(t,e){return t[1]-e[1]})}else{for(r=0;r<e.length;r++)if("number"!=typeof e[r][0]){a=!1;break}a&&e.sort(function(t,e){return t[0]-e[0]})}}function l(t){var e,i,a=t.data.plot,s=a.eventCanvas._elem.offset(),n={x:t.pageX-s.left,y:t.pageY-s.top},r={xaxis:null,yaxis:null,x2axis:null,y2axis:null,y3axis:null,y4axis:null,y5axis:null,y6axis:null,y7axis:null,y8axis:null,y9axis:null,yMidAxis:null},o=["xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"],l=a.axes;for(e=11;e>0;e--)i=o[e-1],l[i].show&&(r[i]=l[i].series_p2u(n[i.charAt(0)]));return{offsets:s,gridPos:n,dataPos:r}}function h(e,i){function a(t,e,i){var a=(e[1]-i[1])/(e[0]-i[0]),s=e[1]-a*e[0],n=t+e[1];return[(n-s)/a,n]}var s,n,r,o,l,h,d,c,p,u,g,f,m,b,x,v,y,k,$=i.series;for(n=i.seriesStack.length-1;n>=0;n--)switch(s=i.seriesStack[n],r=$[s],v=r._highlightThreshold,r.renderer.constructor){case t.jqplot.BarRenderer:for(l=e.x,h=e.y,w=0;w<r._barPoints.length;w++)if(x=r._barPoints[w],b=r.gridData[w],l>x[0][0]&&l<x[2][0]&&(h>x[2][1]&&h<x[0][1]||h<x[2][1]&&h>x[0][1]))return{seriesIndex:r.index,pointIndex:w,gridData:b,data:r.data[w],points:r._barPoints[w]};break;case t.jqplot.PyramidRenderer:for(l=e.x,h=e.y,w=0;w<r._barPoints.length;w++)if(x=r._barPoints[w],b=r.gridData[w],l>x[0][0]+v[0][0]&&l<x[2][0]+v[2][0]&&h>x[2][1]&&h<x[0][1])return{seriesIndex:r.index,pointIndex:w,gridData:b,data:r.data[w],points:r._barPoints[w]};break;case t.jqplot.DonutRenderer:if(p=r.startAngle/180*Math.PI,l=e.x-r._center[0],h=e.y-r._center[1],o=Math.sqrt(Math.pow(l,2)+Math.pow(h,2)),l>0&&-h>=0?d=2*Math.PI-Math.atan(-h/l):l>0&&0>-h?d=-Math.atan(-h/l):0>l?d=Math.PI-Math.atan(-h/l):0==l&&-h>0?d=3*Math.PI/2:0==l&&0>-h?d=Math.PI/2:0==l&&0==h&&(d=0),p&&(0>(d-=p)?d+=2*Math.PI:d>2*Math.PI&&(d-=2*Math.PI)),c=r.sliceMargin/180*Math.PI,o<r._radius&&o>r._innerRadius)for(w=0;w<r.gridData.length;w++)if(u=w>0?r.gridData[w-1][1]+c:c,g=r.gridData[w][1],d>u&&g>d)return{seriesIndex:r.index,pointIndex:w,gridData:[e.x,e.y],data:r.data[w]};break;case t.jqplot.PieRenderer:if(p=r.startAngle/180*Math.PI,l=e.x-r._center[0],h=e.y-r._center[1],o=Math.sqrt(Math.pow(l,2)+Math.pow(h,2)),l>0&&-h>=0?d=2*Math.PI-Math.atan(-h/l):l>0&&0>-h?d=-Math.atan(-h/l):0>l?d=Math.PI-Math.atan(-h/l):0==l&&-h>0?d=3*Math.PI/2:0==l&&0>-h?d=Math.PI/2:0==l&&0==h&&(d=0),p&&(0>(d-=p)?d+=2*Math.PI:d>2*Math.PI&&(d-=2*Math.PI)),c=r.sliceMargin/180*Math.PI,o<r._radius)for(w=0;w<r.gridData.length;w++)if(u=w>0?r.gridData[w-1][1]+c:c,g=r.gridData[w][1],d>u&&g>d)return{seriesIndex:r.index,pointIndex:w,gridData:[e.x,e.y],data:r.data[w]};break;case t.jqplot.BubbleRenderer:l=e.x,h=e.y;var S=null;if(r.show){for(var w=0;w<r.gridData.length;w++)b=r.gridData[w],m=Math.sqrt((l-b[0])*(l-b[0])+(h-b[1])*(h-b[1])),m<=b[2]&&(f>=m||null==f)&&(f=m,S={seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]});if(null!=S)return S}break;case t.jqplot.FunnelRenderer:l=e.x,h=e.y;var _,T,I,C=r._vertices,D=C[0],M=C[C.length-1];for(_=a(h,D[0],M[3]),T=a(h,D[1],M[2]),w=0;w<C.length;w++)if(I=C[w],h>=I[0][1]&&h<=I[3][1]&&l>=_[0]&&l<=T[0])return{seriesIndex:r.index,pointIndex:w,gridData:null,data:r.data[w]};break;case t.jqplot.LineRenderer:if(l=e.x,h=e.y,o=r.renderer,r.show){if(!(!(r.fill||r.renderer.bands.show&&r.renderer.bands.fill)||i.plugins.highlighter&&i.plugins.highlighter.show)){var q=!1;if(l>r._boundingBox[0][0]&&l<r._boundingBox[1][0]&&h>r._boundingBox[1][1]&&h<r._boundingBox[0][1])for(var j=r._areaPoints.length,A=(w=j-1,0);j>A;A++){var F=[r._areaPoints[A][0],r._areaPoints[A][1]],R=[r._areaPoints[w][0],r._areaPoints[w][1]];(F[1]<h&&R[1]>=h||R[1]<h&&F[1]>=h)&&F[0]+(h-F[1])/(R[1]-F[1])*(R[0]-F[0])<l&&(q=!q),w=A}if(q)return{seriesIndex:s,pointIndex:null,gridData:r.gridData,data:r.data,points:r._areaPoints};break}for(y=(k=r.markerRenderer.size/2+r.neighborThreshold)>0?k:0,w=0;w<r.gridData.length;w++)if(b=r.gridData[w],o.constructor==t.jqplot.OHLCRenderer){if(o.candleStick){var P=r._yaxis.series_u2p;if(l>=b[0]-o._bodyWidth/2&&l<=b[0]+o._bodyWidth/2&&h>=P(r.data[w][2])&&h<=P(r.data[w][3]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(o.hlc){if(P=r._yaxis.series_u2p,l>=b[0]-o._tickLength&&l<=b[0]+o._tickLength&&h>=P(r.data[w][1])&&h<=P(r.data[w][2]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(P=r._yaxis.series_u2p,l>=b[0]-o._tickLength&&l<=b[0]+o._tickLength&&h>=P(r.data[w][2])&&h<=P(r.data[w][3]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(null!=b[0]&&null!=b[1]&&(m=Math.sqrt((l-b[0])*(l-b[0])+(h-b[1])*(h-b[1])),y>=m&&(f>=m||null==f)))return f=m,{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}break;default:if(l=e.x,h=e.y,o=r.renderer,r.show)for(y=(k=r.markerRenderer.size/2+r.neighborThreshold)>0?k:0,w=0;w<r.gridData.length;w++)if(b=r.gridData[w],o.constructor==t.jqplot.OHLCRenderer){if(o.candleStick){if(P=r._yaxis.series_u2p,l>=b[0]-o._bodyWidth/2&&l<=b[0]+o._bodyWidth/2&&h>=P(r.data[w][2])&&h<=P(r.data[w][3]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(o.hlc){if(P=r._yaxis.series_u2p,l>=b[0]-o._tickLength&&l<=b[0]+o._tickLength&&h>=P(r.data[w][1])&&h<=P(r.data[w][2]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(P=r._yaxis.series_u2p,l>=b[0]-o._tickLength&&l<=b[0]+o._tickLength&&h>=P(r.data[w][2])&&h<=P(r.data[w][3]))return{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}else if(m=Math.sqrt((l-b[0])*(l-b[0])+(h-b[1])*(h-b[1])),y>=m&&(f>=m||null==f))return f=m,{seriesIndex:s,pointIndex:w,gridData:b,data:r.data[w]}}return null}var d,c;this.animate=!1,this.animateReplot=!1,this.axes={xaxis:new e("xaxis"),yaxis:new e("yaxis"),x2axis:new e("x2axis"),y2axis:new e("y2axis"),y3axis:new e("y3axis"),y4axis:new e("y4axis"),y5axis:new e("y5axis"),y6axis:new e("y6axis"),y7axis:new e("y7axis"),y8axis:new e("y8axis"),y9axis:new e("y9axis"),yMidAxis:new e("yMidAxis")},this.baseCanvas=new t.jqplot.GenericCanvas,this.captureRightClick=!1,this.data=[],this.dataRenderer,this.dataRendererOptions,this.defaults={axesDefaults:{},axes:{xaxis:{},yaxis:{},x2axis:{},y2axis:{},y3axis:{},y4axis:{},y5axis:{},y6axis:{},y7axis:{},y8axis:{},y9axis:{},yMidAxis:{}},seriesDefaults:{},series:[]},this.defaultAxisStart=1,this.drawIfHidden=!1,this.eventCanvas=new t.jqplot.GenericCanvas,this.fillBetween={series1:null,series2:null,color:null,baseSeries:0,fill:!0},this.fontFamily,this.fontSize,this.grid=new n,this.legend=new i,this.noDataIndicator={show:!1,indicator:"Loading Data...",axes:{xaxis:{min:0,max:10,tickInterval:2,show:!0},yaxis:{min:0,max:12,tickInterval:3,show:!0}}},this.negativeSeriesColors=t.jqplot.config.defaultNegativeColors,this.options={},this.previousSeriesStack=[],this.plugins={},this.series=[],this.seriesStack=[],this.seriesColors=t.jqplot.config.defaultColors,this.sortData=!0,this.stackSeries=!1,this.syncXTicks=!0,this.syncYTicks=!0,this.target=null,this.targetId=null,this.textColor,this.title=new a,this._drawCount=0,this._sumy=0,this._sumx=0,this._stackData=[],this._plotData=[],this._width=null,this._height=null,this._plotDimensions={height:null,width:null},this._gridPadding={top:null,right:null,bottom:null,left:null},this._defaultGridPadding={top:10,right:10,bottom:23,left:10},this._addDomReference=t.jqplot.config.addDomReference,this.preInitHooks=new t.jqplot.HooksManager,this.postInitHooks=new t.jqplot.HooksManager,this.preParseOptionsHooks=new t.jqplot.HooksManager,this.postParseOptionsHooks=new t.jqplot.HooksManager,this.preDrawHooks=new t.jqplot.HooksManager,this.postDrawHooks=new t.jqplot.HooksManager,this.preDrawSeriesHooks=new t.jqplot.HooksManager,this.postDrawSeriesHooks=new t.jqplot.HooksManager,this.preDrawLegendHooks=new t.jqplot.HooksManager,this.addLegendRowHooks=new t.jqplot.HooksManager,this.preSeriesInitHooks=new t.jqplot.HooksManager,this.postSeriesInitHooks=new t.jqplot.HooksManager,this.preParseSeriesOptionsHooks=new t.jqplot.HooksManager,this.postParseSeriesOptionsHooks=new t.jqplot.HooksManager,this.eventListenerHooks=new t.jqplot.EventListenerManager,this.preDrawSeriesShadowHooks=new t.jqplot.HooksManager,this.postDrawSeriesShadowHooks=new t.jqplot.HooksManager,this.colorGenerator=new t.jqplot.ColorGenerator,this.negativeColorGenerator=new t.jqplot.ColorGenerator,this.canvasManager=new t.jqplot.CanvasManager,this.themeEngine=new t.jqplot.ThemeEngine,this.init=function(i,a,s){s=s||{};for(var n=0;n<t.jqplot.preInitHooks.length;n++)t.jqplot.preInitHooks[n].call(this,i,a,s);for(n=0;n<this.preInitHooks.hooks.length;n++)this.preInitHooks.hooks[n].call(this,i,a,s);if(this.targetId="#"+i,this.target=t("#"+i),this._addDomReference&&this.target.data("jqplot",this),this.target.removeClass("jqplot-error"),!this.target.get(0))throw new Error("No plot target specified");var r,l,h,d;"static"==this.target.css("position")&&this.target.css("position","relative"),this.target.hasClass("jqplot-target")||this.target.addClass("jqplot-target"),this.target.height()?this._height=r=this.target.height():(r=s&&s.height?parseInt(s.height,10):this.target.attr("data-height")?parseInt(this.target.attr("data-height"),10):parseInt(t.jqplot.config.defaultHeight,10),this._height=r,this.target.css("height",r+"px")),this.target.width()?this._width=l=this.target.width():(l=s&&s.width?parseInt(s.width,10):this.target.attr("data-width")?parseInt(this.target.attr("data-width"),10):parseInt(t.jqplot.config.defaultWidth,10),this._width=l,this.target.css("width",l+"px")),n=0;for(var c=C.length;c>n;n++)this.axes[C[n]]=new e(C[n]);if(this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions,this._height<=0||this._width<=0||!this._height||!this._width)throw new Error("Canvas dimension not set");if(s.dataRenderer&&t.isFunction(s.dataRenderer)&&(s.dataRendererOptions&&(this.dataRendererOptions=s.dataRendererOptions),this.dataRenderer=s.dataRenderer,a=this.dataRenderer(a,this,this.dataRendererOptions)),s.noDataIndicator&&t.isPlainObject(s.noDataIndicator)&&t.extend(!0,this.noDataIndicator,s.noDataIndicator),null==a||0==t.isArray(a)||0==a.length||0==t.isArray(a[0])||0==a[0].length){if(0==this.noDataIndicator.show)throw new Error("No data specified");for(var p in this.noDataIndicator.axes)for(var u in this.noDataIndicator.axes[p])this.axes[p][u]=this.noDataIndicator.axes[p][u];this.postDrawHooks.add(function(){var e=this.eventCanvas.getHeight(),i=this.eventCanvas.getWidth(),a=t('<div class="jqplot-noData-container" style="position:absolute;"></div>');this.target.append(a),a.height(e),a.width(i),a.css("top",this.eventCanvas._offsets.top),a.css("left",this.eventCanvas._offsets.left);var s=t('<div class="jqplot-noData-contents" style="text-align:center; position:relative; margin-left:auto; margin-right:auto;"></div>');a.append(s),s.html(this.noDataIndicator.indicator);var n=s.height(),r=s.width();s.height(n),s.width(r),s.css("top",(e-n)/2+"px")})}for(this.data=t.extend(!0,[],a),this.parseOptions(s),this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this.title.init(),this.legend.init(),this._sumy=0,this._sumx=0,this.computePlotData(),n=0;n<this.series.length;n++){this.seriesStack.push(n),this.previousSeriesStack.push(n),this.series[n].shadowCanvas._plotDimensions=this._plotDimensions,this.series[n].canvas._plotDimensions=this._plotDimensions;for(var g=0;g<t.jqplot.preSeriesInitHooks.length;g++)t.jqplot.preSeriesInitHooks[g].call(this.series[n],i,this.data,this.options.seriesDefaults,this.options.series[n],this);for(g=0;g<this.preSeriesInitHooks.hooks.length;g++)this.preSeriesInitHooks.hooks[g].call(this.series[n],i,this.data,this.options.seriesDefaults,this.options.series[n],this);for(this.series[n]._plotDimensions=this._plotDimensions,this.series[n].init(n,this.grid.borderWidth,this),g=0;g<t.jqplot.postSeriesInitHooks.length;g++)t.jqplot.postSeriesInitHooks[g].call(this.series[n],i,this.data,this.options.seriesDefaults,this.options.series[n],this);for(g=0;g<this.postSeriesInitHooks.hooks.length;g++)this.postSeriesInitHooks.hooks[g].call(this.series[n],i,this.data,this.options.seriesDefaults,this.options.series[n],this);this._sumy+=this.series[n]._sumy,this._sumx+=this.series[n]._sumx}for(n=0,c=C.length;c>n;n++)h=C[n],d=this.axes[h],d._plotDimensions=this._plotDimensions,d.init(),null==this.axes[h].borderColor&&("x"!==h.charAt(0)&&!0===d.useSeriesColor&&d.show?d.borderColor=d._series[0].color:d.borderColor=this.grid.borderColor);for(this.sortData&&o(this.series),this.grid.init(),this.grid._axes=this.axes,this.legend._series=this.series,n=0;n<t.jqplot.postInitHooks.length;n++)t.jqplot.postInitHooks[n].call(this,i,this.data,s);for(n=0;n<this.postInitHooks.hooks.length;n++)this.postInitHooks.hooks[n].call(this,i,this.data,s)},this.resetAxesScale=function(e,i){var a=i||{},s=e||this.axes;if(!0===s&&(s=this.axes),t.isArray(s))for(var n=0;n<s.length;n++)this.axes[s[n]].resetScale(a[s[n]]);else if("object"==typeof s)for(var r in s)this.axes[r].resetScale(a[r])},this.reInitialize=function(i,a){for(var s=t.extend(!0,{},this.options,a),n=this.targetId.substr(1),r=null==i?this.data:i,l=0;l<t.jqplot.preInitHooks.length;l++)t.jqplot.preInitHooks[l].call(this,n,r,s);for(l=0;l<this.preInitHooks.hooks.length;l++)this.preInitHooks.hooks[l].call(this,n,r,s);if(this._height=this.target.height(),this._width=this.target.width(),this._height<=0||this._width<=0||!this._height||!this._width)throw new Error("Target dimension not set");this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions,l=0;for(var h,d,c,p=C.length;p>l;l++){h=C[l];for(var u=0,g=(d=(c=this.axes[h])._ticks).length;g>u;u++){var f=d[u]._elem;f&&(t.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==I&&window.G_vmlCanvasManager.uninitElement(f.get(0)),f.emptyForce(),f=null,d._elem=null)}d=null,delete c.ticks,delete c._ticks,this.axes[h]=new e(h),this.axes[h]._plotWidth=this._width,this.axes[h]._plotHeight=this._height}for(i&&(s.dataRenderer&&t.isFunction(s.dataRenderer)&&(s.dataRendererOptions&&(this.dataRendererOptions=s.dataRendererOptions),this.dataRenderer=s.dataRenderer,i=this.dataRenderer(i,this,this.dataRendererOptions)),this.data=t.extend(!0,[],i)),a&&this.parseOptions(s),this.title._plotWidth=this._width,this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this.title.init(),this.legend.init(),this._sumy=0,this._sumx=0,this.seriesStack=[],this.previousSeriesStack=[],this.computePlotData(),l=0,p=this.series.length;p>l;l++){for(this.seriesStack.push(l),this.previousSeriesStack.push(l),this.series[l].shadowCanvas._plotDimensions=this._plotDimensions,this.series[l].canvas._plotDimensions=this._plotDimensions,u=0;u<t.jqplot.preSeriesInitHooks.length;u++)t.jqplot.preSeriesInitHooks[u].call(this.series[l],n,this.data,this.options.seriesDefaults,this.options.series[l],this);for(u=0;u<this.preSeriesInitHooks.hooks.length;u++)this.preSeriesInitHooks.hooks[u].call(this.series[l],n,this.data,this.options.seriesDefaults,this.options.series[l],this);for(this.series[l]._plotDimensions=this._plotDimensions,this.series[l].init(l,this.grid.borderWidth,this),u=0;u<t.jqplot.postSeriesInitHooks.length;u++)t.jqplot.postSeriesInitHooks[u].call(this.series[l],n,this.data,this.options.seriesDefaults,this.options.series[l],this);for(u=0;u<this.postSeriesInitHooks.hooks.length;u++)this.postSeriesInitHooks.hooks[u].call(this.series[l],n,this.data,this.options.seriesDefaults,this.options.series[l],this);this._sumy+=this.series[l]._sumy,this._sumx+=this.series[l]._sumx}for(l=0,p=C.length;p>l;l++)h=C[l],c=this.axes[h],c._plotDimensions=this._plotDimensions,c.init(),null==c.borderColor&&("x"!==h.charAt(0)&&!0===c.useSeriesColor&&c.show?c.borderColor=c._series[0].color:c.borderColor=this.grid.borderColor);for(this.sortData&&o(this.series),this.grid.init(),this.grid._axes=this.axes,this.legend._series=this.series,l=0,p=t.jqplot.postInitHooks.length;p>l;l++)t.jqplot.postInitHooks[l].call(this,n,this.data,s);for(l=0,p=this.postInitHooks.hooks.length;p>l;l++)this.postInitHooks.hooks[l].call(this,n,this.data,s)},this.quickInit=function(){if(this._height=this.target.height(),this._width=this.target.width(),this._height<=0||this._width<=0||!this._height||!this._width)throw new Error("Target dimension not set");this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions;for(var e in this.axes)this.axes[e]._plotWidth=this._width,this.axes[e]._plotHeight=this._height;this.title._plotWidth=this._width,this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this._sumy=0,this._sumx=0,this.computePlotData();for(var i=0;i<this.series.length;i++)"line"===this.series[i]._type&&this.series[i].renderer.bands.show&&this.series[i].renderer.initBands.call(this.series[i],this.series[i].renderer.options,this),this.series[i]._plotDimensions=this._plotDimensions,this.series[i].canvas._plotDimensions=this._plotDimensions,this._sumy+=this.series[i]._sumy,this._sumx+=this.series[i]._sumx;for(var a,s=0;12>s;s++){a=C[s];var n=this.axes[a]._ticks;for(i=0;i<n.length;i++){var r=n[i]._elem;r&&(t.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==I&&window.G_vmlCanvasManager.uninitElement(r.get(0)),r.emptyForce(),r=null,n._elem=null)}n=null,this.axes[a]._plotDimensions=this._plotDimensions,this.axes[a]._ticks=[]}this.sortData&&o(this.series),this.grid._axes=this.axes,this.legend._series=this.series},this.computePlotData=function(){var e,i,a;for(this._plotData=[],this._stackData=[],i=0,a=this.series.length;a>i;i++){e=this.series[i],this._plotData.push([]),this._stackData.push([]);var s=e.data;this._plotData[i]=t.extend(!0,[],s),this._stackData[i]=t.extend(!0,[],s),e._plotData=this._plotData[i],e._stackData=this._stackData[i];var n={x:[],y:[]};if(this.stackSeries&&!e.disableStack){e._stack=!0;for(var r="x"===e._stackAxis?0:1,o=0,l=s.length;l>o;o++){var h=s[o][r];if(null==h&&(h=0),this._plotData[i][o][r]=h,this._stackData[i][o][r]=h,i>0)for(var d=i;d--;){var c=this._plotData[d][o][r];if(h*c>=0){this._plotData[i][o][r]+=c,this._stackData[i][o][r]+=c;break}}}}else{for(var p=0;p<e.data.length;p++)n.x.push(e.data[p][0]),n.y.push(e.data[p][1]);this._stackData.push(e.data),this.series[i]._stackData=e.data,this._plotData.push(e.data),e._plotData=e.data,e._plotValues=n}for(i>0&&(e._prevPlotData=this.series[i-1]._plotData),e._sumy=0,e._sumx=0,p=e.data.length-1;p>-1;p--)e._sumy+=e.data[p][1],e._sumx+=e.data[p][0]}},this.populatePlotData=function(e,i){this._plotData=[],this._stackData=[],e._stackData=[],e._plotData=[];var a={x:[],y:[]};if(this.stackSeries&&!e.disableStack){e._stack=!0;for(var s,n,r,o,l="x"===e._stackAxis?0:1,h=t.extend(!0,[],e.data),d=t.extend(!0,[],e.data),c=0;i>c;c++)for(var p=this.series[c].data,u=0;u<p.length;u++)r=p[u],s=null!=r[0]?r[0]:0,n=null!=r[1]?r[1]:0,h[u][0]+=s,h[u][1]+=n,o=l?n:s,e.data[u][l]*o>=0&&(d[u][l]+=o);for(var g=0;g<d.length;g++)a.x.push(d[g][0]),a.y.push(d[g][1]);this._plotData.push(d),this._stackData.push(h),e._stackData=h,e._plotData=d,e._plotValues=a}else{for(g=0;g<e.data.length;g++)a.x.push(e.data[g][0]),a.y.push(e.data[g][1]);this._stackData.push(e.data),this.series[i]._stackData=e.data,this._plotData.push(e.data),e._plotData=e.data,e._plotValues=a}for(i>0&&(e._prevPlotData=this.series[i-1]._plotData),e._sumy=0,e._sumx=0,g=e.data.length-1;g>-1;g--)e._sumy+=e.data[g][1],e._sumx+=e.data[g][0]},this.getNextSeriesColor=(d=0,c=this.seriesColors,function(){return d<c.length?c[d++]:(d=0,c[d++])}),this.parseOptions=function(e){for(var i=0;i<this.preParseOptionsHooks.hooks.length;i++)this.preParseOptionsHooks.hooks[i].call(this,e);for(i=0;i<t.jqplot.preParseOptionsHooks.length;i++)t.jqplot.preParseOptionsHooks[i].call(this,e);this.options=t.extend(!0,{},this.defaults,e);var a=this.options;if(this.animate=a.animate,this.animateReplot=a.animateReplot,this.stackSeries=a.stackSeries,t.isPlainObject(a.fillBetween))for(var n,r=["series1","series2","color","baseSeries","fill"],o=(i=0,r.length);o>i;i++)n=r[i],null!=a.fillBetween[n]&&(this.fillBetween[n]=a.fillBetween[n]);for(a.seriesColors&&(this.seriesColors=a.seriesColors),a.negativeSeriesColors&&(this.negativeSeriesColors=a.negativeSeriesColors),a.captureRightClick&&(this.captureRightClick=a.captureRightClick),this.defaultAxisStart=e&&null!=e.defaultAxisStart?e.defaultAxisStart:this.defaultAxisStart,this.colorGenerator.setColors(this.seriesColors),this.negativeColorGenerator.setColors(this.negativeSeriesColors),t.extend(!0,this._gridPadding,a.gridPadding),this.sortData=null!=a.sortData?a.sortData:this.sortData,i=0;12>i;i++){var l=C[i];(u=this.axes[l])._options=t.extend(!0,{},a.axesDefaults,a.axes[l]),t.extend(!0,u,a.axesDefaults,a.axes[l]),u._plotWidth=this._width,u._plotHeight=this._height}var h=function(e,i,a){var s,n,r=[];if(i=i||"vertical",t.isArray(e[0]))t.extend(!0,r,e);else for(s=0,n=e.length;n>s;s++)"vertical"==i?r.push([a+s,e[s]]):r.push([e[s],a+s]);return r};for(this.series=[],i=0;i<this.data.length;i++){for(var d=t.extend(!0,{index:i},{seriesColors:this.seriesColors,negativeSeriesColors:this.negativeSeriesColors},this.options.seriesDefaults,this.options.series[i],{rendererOptions:{animation:{show:this.animate}}}),c=(r=new s(d),0);c<t.jqplot.preParseSeriesOptionsHooks.length;c++)t.jqplot.preParseSeriesOptionsHooks[c].call(r,this.options.seriesDefaults,this.options.series[i]);for(c=0;c<this.preParseSeriesOptionsHooks.hooks.length;c++)this.preParseSeriesOptionsHooks.hooks[c].call(r,this.options.seriesDefaults,this.options.series[i]);t.extend(!0,r,d);var p="vertical";switch(r.renderer===t.jqplot.BarRenderer&&r.rendererOptions&&"horizontal"==r.rendererOptions.barDirection&&(p="horizontal",r._stackAxis="x",r._primaryAxis="_yaxis"),r.data=h(this.data[i],p,this.defaultAxisStart),r.xaxis){case"xaxis":r._xaxis=this.axes.xaxis;break;case"x2axis":r._xaxis=this.axes.x2axis}for(r._yaxis=this.axes[r.yaxis],r._xaxis._series.push(r),r._yaxis._series.push(r),r.show?(r._xaxis.show=!0,r._yaxis.show=!0):(r._xaxis.scaleToHiddenSeries&&(r._xaxis.show=!0),r._yaxis.scaleToHiddenSeries&&(r._yaxis.show=!0)),r.label||(r.label="Series "+(i+1).toString()),this.series.push(r),c=0;c<t.jqplot.postParseSeriesOptionsHooks.length;c++)t.jqplot.postParseSeriesOptionsHooks[c].call(this.series[i],this.options.seriesDefaults,this.options.series[i]);for(c=0;c<this.postParseSeriesOptionsHooks.hooks.length;c++)this.postParseSeriesOptionsHooks.hooks[c].call(this.series[i],this.options.seriesDefaults,this.options.series[i])}for(t.extend(!0,this.grid,this.options.grid),i=0,o=C.length;o>i;i++){var u;l=C[i],null==(u=this.axes[l]).borderWidth&&(u.borderWidth=this.grid.borderWidth)}for("string"==typeof this.options.title?this.title.text=this.options.title:"object"==typeof this.options.title&&t.extend(!0,this.title,this.options.title),this.title._plotWidth=this._width,this.legend.setOptions(this.options.legend),i=0;i<t.jqplot.postParseOptionsHooks.length;i++)t.jqplot.postParseOptionsHooks[i].call(this,e);for(i=0;i<this.postParseOptionsHooks.hooks.length;i++)this.postParseOptionsHooks.hooks[i].call(this,e)},this.destroy=function(){this.canvasManager.freeAllCanvases(),this.eventCanvas&&this.eventCanvas._elem&&this.eventCanvas._elem.unbind(),this.target.empty(),this.target[0].innerHTML=""},this.replot=function(e){var i=e||{},a=i.data||null,s=!1!==i.clear,n=i.resetAxes||!1;delete i.data,delete i.clear,delete i.resetAxes,this.target.trigger("jqplotPreReplot"),s&&this.destroy(),a||!t.isEmptyObject(i)?this.reInitialize(a,i):this.quickInit(),n&&this.resetAxesScale(n,i.axes),this.draw(),this.target.trigger("jqplotPostReplot")},this.redraw=function(t){t=null==t||t,this.target.trigger("jqplotPreRedraw"),t&&(this.canvasManager.freeAllCanvases(),this.eventCanvas._elem.unbind(),this.target.empty());for(var e in this.axes)this.axes[e]._ticks=[];this.computePlotData(),this._sumy=0,this._sumx=0;for(var i=0,a=this.series.length;a>i;i++)this._sumy+=this.series[i]._sumy,this._sumx+=this.series[i]._sumx;this.draw(),this.target.trigger("jqplotPostRedraw")},this.draw=function(){if(this.drawIfHidden||this.target.is(":visible")){var e;for(this.target.trigger("jqplotPreDraw"),v=0,y=t.jqplot.preDrawHooks.length;y>v;v++)t.jqplot.preDrawHooks[v].call(this);for(v=0,y=this.preDrawHooks.hooks.length;y>v;v++)this.preDrawHooks.hooks[v].apply(this,this.preDrawSeriesHooks.args[v]);this.target.append(this.baseCanvas.createElement({left:0,right:0,top:0,bottom:0},"jqplot-base-canvas",null,this)),this.baseCanvas.setContext(),this.target.append(this.title.draw()),this.title.pack({top:0,left:0});var i=this.legend.draw({},this),a={top:0,left:0,bottom:0,right:0};if("outsideGrid"==this.legend.placement){switch(this.target.append(i),this.legend.location){case"n":a.top+=this.legend.getHeight();break;case"s":a.bottom+=this.legend.getHeight();break;case"ne":case"e":case"se":a.right+=this.legend.getWidth();break;case"nw":case"w":case"sw":a.left+=this.legend.getWidth();break;default:a.right+=this.legend.getWidth()}i=i.detach()}var s,n=this.axes;for(v=0;12>v;v++)s=C[v],this.target.append(n[s].draw(this.baseCanvas._ctx,this)),n[s].set();n.yaxis.show&&(a.left+=n.yaxis.getWidth());var r=["y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis"],o=[0,0,0,0,0,0,0,0],l=0;for(g=0;8>g;g++)n[r[g]].show&&(l+=n[r[g]].getWidth(),o[g]=l);if(a.right+=l,n.x2axis.show&&(a.top+=n.x2axis.getHeight()),this.title.show&&(a.top+=this.title.getHeight()),n.xaxis.show&&(a.bottom+=n.xaxis.getHeight()),this.options.gridDimensions&&t.isPlainObject(this.options.gridDimensions)){var h=parseInt(this.options.gridDimensions.width,10)||0,d=parseInt(this.options.gridDimensions.height,10)||0,c=(this._width-a.left-a.right-h)/2,p=(this._height-a.top-a.bottom-d)/2;p>=0&&c>=0&&(a.top+=p,a.bottom+=p,a.left+=c,a.right+=c)}var u=["top","bottom","left","right"];for(var g in u)null==this._gridPadding[u[g]]&&a[u[g]]>0?this._gridPadding[u[g]]=a[u[g]]:null==this._gridPadding[u[g]]&&(this._gridPadding[u[g]]=this._defaultGridPadding[u[g]]);var f=this._gridPadding;for("outsideGrid"===this.legend.placement&&(f={top:this.title.getHeight(),left:0,right:0,bottom:0},"s"===this.legend.location&&(f.left=this._gridPadding.left,f.right=this._gridPadding.right)),n.xaxis.pack({position:"absolute",bottom:this._gridPadding.bottom-n.xaxis.getHeight(),left:0,width:this._width},{min:this._gridPadding.left,max:this._width-this._gridPadding.right}),n.yaxis.pack({position:"absolute",top:0,left:this._gridPadding.left-n.yaxis.getWidth(),height:this._height},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top}),n.x2axis.pack({position:"absolute",top:this._gridPadding.top-n.x2axis.getHeight(),left:0,width:this._width},{min:this._gridPadding.left,max:this._width-this._gridPadding.right}),v=8;v>0;v--)n[r[v-1]].pack({position:"absolute",top:0,right:this._gridPadding.right-o[v-1]},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top});var m=(this._width-this._gridPadding.left-this._gridPadding.right)/2+this._gridPadding.left-n.yMidAxis.getWidth()/2;n.yMidAxis.pack({position:"absolute",top:0,left:m,zIndex:9,textAlign:"center"},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top}),this.target.append(this.grid.createElement(this._gridPadding,this)),this.grid.draw();var b=this.series,x=b.length;for(v=0,y=x;y>v;v++)e=this.seriesStack[v],this.target.append(b[e].shadowCanvas.createElement(this._gridPadding,"jqplot-series-shadowCanvas",null,this)),b[e].shadowCanvas.setContext(),b[e].shadowCanvas._elem.data("seriesIndex",e);for(v=0,y=x;y>v;v++)e=this.seriesStack[v],this.target.append(b[e].canvas.createElement(this._gridPadding,"jqplot-series-canvas",null,this)),b[e].canvas.setContext(),b[e].canvas._elem.data("seriesIndex",e);this.target.append(this.eventCanvas.createElement(this._gridPadding,"jqplot-event-canvas",null,this)),this.eventCanvas.setContext(),this.eventCanvas._ctx.fillStyle="rgba(0,0,0,0)",this.eventCanvas._ctx.fillRect(0,0,this.eventCanvas._ctx.canvas.width,this.eventCanvas._ctx.canvas.height),this.bindCustomEvents(),this.legend.preDraw?(this.eventCanvas._elem.before(i),this.legend.pack(f),this.legend._elem?this.drawSeries({legendInfo:{location:this.legend.location,placement:this.legend.placement,width:this.legend.getWidth(),height:this.legend.getHeight(),xoffset:this.legend.xoffset,yoffset:this.legend.yoffset}}):this.drawSeries()):(this.drawSeries(),x&&t(b[x-1].canvas._elem).after(i),this.legend.pack(f));for(var v=0,y=t.jqplot.eventListenerHooks.length;y>v;v++)this.eventCanvas._elem.bind(t.jqplot.eventListenerHooks[v][0],{plot:this},t.jqplot.eventListenerHooks[v][1]);for(v=0,y=this.eventListenerHooks.hooks.length;y>v;v++)this.eventCanvas._elem.bind(this.eventListenerHooks.hooks[v][0],{plot:this},this.eventListenerHooks.hooks[v][1]);var k,$,S,w,_=this.fillBetween;if("number"==typeof _.series1)_.fill&&_.series1!==_.series2&&_.series1<x&&_.series2<x&&"line"===b[_.series1]._type&&"line"===b[_.series2]._type&&this.doFillBetweenLines();else if(null!=_.series1&&null!=_.series2){var T=!1;if(_.series1.length===_.series2.length)for(var I=0,D=0,M=0;M<_.series1.length;M++){if(!((I=_.series1[M])!==(D=_.series2[M])&&x>I&&x>D&&"line"===b[I]._type&&"line"===b[D]._type)){T=!1;break}T=!0}_.fill&&T&&this.doFillBetweenLines()}for(v=0,y=t.jqplot.postDrawHooks.length;y>v;v++)t.jqplot.postDrawHooks[v].call(this);for(v=0,y=this.postDrawHooks.hooks.length;y>v;v++)this.postDrawHooks.hooks[v].apply(this,this.postDrawHooks.args[v]);for(this.target.is(":visible")&&(this._drawCount+=1),v=0,y=x;y>v;v++)k=b[v],$=k.renderer,S=".jqplot-point-label.jqplot-series-"+v,$.animation&&$.animation._supported&&$.animation.show&&(this._drawCount<2||this.animateReplot)&&(w=this.target.find(S),w.stop(!0,!0).hide(),k.canvas._elem.stop(!0,!0).hide(),k.shadowCanvas._elem.stop(!0,!0).hide(),k.canvas._elem.jqplotEffect("blind",{mode:"show",direction:$.animation.direction},$.animation.speed),k.shadowCanvas._elem.jqplotEffect("blind",{mode:"show",direction:$.animation.direction},$.animation.speed),w.fadeIn(.8*$.animation.speed));w=null,this.target.trigger("jqplotPostDraw",[this])}},r.prototype.doFillBetweenLines=function(){function t(t,s){var n=i[t],r=i[s];if(r.renderer.smooth)var o=r.renderer._smoothedData.slice(0).reverse();else o=r.gridData.slice(0).reverse();if(n.renderer.smooth)var l=n.renderer._smoothedData.concat(o);else l=n.gridData.concat(o);var h=null!==e.color?e.color:i[a].fillColor,d=null!==e.baseSeries?e.baseSeries:t,c={fillStyle:h,fill:!0,closePath:!0};i[d].renderer.shapeRenderer.draw(n.shadowCanvas._ctx,l,c)}var e=this.fillBetween,i=this.series,a=e.series1,s=e.series2,n=0,r=0;if("number"==typeof a&&"number"==typeof s)n=s>a?a:s,r=s>a?s:a,t(n,r);else for(var o=0;o<a.length;o++)n=a[o]<s[o]?a[o]:s[o],r=s[o]>a[o]?s[o]:a[o],t(n,r)},this.bindCustomEvents=function(){this.eventCanvas._elem.bind("click",{plot:this},this.onClick),this.eventCanvas._elem.bind("dblclick",{plot:this},this.onDblClick),this.eventCanvas._elem.bind("mousedown",{plot:this},this.onMouseDown),this.eventCanvas._elem.bind("mousemove",{plot:this},this.onMouseMove),this.eventCanvas._elem.bind("mouseenter",{plot:this},this.onMouseEnter),this.eventCanvas._elem.bind("mouseleave",{plot:this},this.onMouseLeave),this.captureRightClick?(this.eventCanvas._elem.bind("mouseup",{plot:this},this.onRightClick),this.eventCanvas._elem.get(0).oncontextmenu=function(){return!1}):this.eventCanvas._elem.bind("mouseup",{plot:this},this.onMouseUp)},this.onClick=function(e){var i=l(e),a=e.data.plot,s=h(i.gridPos,a),n=t.Event("jqplotClick");n.pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a])},this.onDblClick=function(e){var i=l(e),a=e.data.plot,s=h(i.gridPos,a),n=t.Event("jqplotDblClick");n.pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a])},this.onMouseDown=function(e){var i=l(e),a=e.data.plot,s=h(i.gridPos,a),n=t.Event("jqplotMouseDown");n.pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a])},this.onMouseUp=function(e){var i=l(e),a=t.Event("jqplotMouseUp");a.pageX=e.pageX,a.pageY=e.pageY,t(this).trigger(a,[i.gridPos,i.dataPos,null,e.data.plot])},this.onRightClick=function(e){var i=l(e),a=e.data.plot,s=h(i.gridPos,a);if(a.captureRightClick)if(3==e.which)(n=t.Event("jqplotRightClick")).pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a]);else{var n;(n=t.Event("jqplotMouseUp")).pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a])}},this.onMouseMove=function(e){var i=l(e),a=e.data.plot,s=h(i.gridPos,a),n=t.Event("jqplotMouseMove");n.pageX=e.pageX,n.pageY=e.pageY,t(this).trigger(n,[i.gridPos,i.dataPos,s,a])},this.onMouseEnter=function(e){var i=l(e),a=e.data.plot,s=t.Event("jqplotMouseEnter");s.pageX=e.pageX,s.pageY=e.pageY,s.relatedTarget=e.relatedTarget,t(this).trigger(s,[i.gridPos,i.dataPos,null,a])},this.onMouseLeave=function(e){var i=l(e),a=e.data.plot,s=t.Event("jqplotMouseLeave");s.pageX=e.pageX,s.pageY=e.pageY,s.relatedTarget=e.relatedTarget,t(this).trigger(s,[i.gridPos,i.dataPos,null,a])},this.drawSeries=function(e,i){var a,s,n;if(i="number"==typeof e&&null==i?e:i,e="object"==typeof e?e:{},i!=I)s=this.series[i],n=s.shadowCanvas._ctx,n.clearRect(0,0,n.canvas.width,n.canvas.height),s.drawShadow(n,e,this),n=s.canvas._ctx,n.clearRect(0,0,n.canvas.width,n.canvas.height),s.draw(n,e,this),s.renderer.constructor==t.jqplot.BezierCurveRenderer&&i<this.series.length-1&&this.drawSeries(i+1);else for(a=0;a<this.series.length;a++)s=this.series[a],n=s.shadowCanvas._ctx,n.clearRect(0,0,n.canvas.width,n.canvas.height),s.drawShadow(n,e,this),n=s.canvas._ctx,n.clearRect(0,0,n.canvas.width,n.canvas.height),s.draw(n,e,this);e=i=a=s=n=null},this.moveSeriesToFront=function(e){e=parseInt(e,10);var i=t.inArray(e,this.seriesStack);if(-1!=i){if(i==this.seriesStack.length-1)return void(this.previousSeriesStack=this.seriesStack.slice(0));var a=this.seriesStack[this.seriesStack.length-1],s=this.series[e].canvas._elem.detach(),n=this.series[e].shadowCanvas._elem.detach();this.series[a].shadowCanvas._elem.after(n),this.series[a].canvas._elem.after(s),this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack.splice(i,1),this.seriesStack.push(e)}},this.moveSeriesToBack=function(e){e=parseInt(e,10);var i=t.inArray(e,this.seriesStack);if(0!=i&&-1!=i){var a=this.seriesStack[0],s=this.series[e].canvas._elem.detach(),n=this.series[e].shadowCanvas._elem.detach();this.series[a].shadowCanvas._elem.before(n),this.series[a].canvas._elem.before(s),this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack.splice(i,1),this.seriesStack.unshift(e)}},this.restorePreviousSeriesOrder=function(){var t,e,i,a,s,n;if(this.seriesStack!=this.previousSeriesStack){for(t=1;t<this.previousSeriesStack.length;t++)s=this.previousSeriesStack[t],n=this.previousSeriesStack[t-1],e=this.series[s].canvas._elem.detach(),i=this.series[s].shadowCanvas._elem.detach(),this.series[n].shadowCanvas._elem.after(i),this.series[n].canvas._elem.after(e);a=this.seriesStack.slice(0),this.seriesStack=this.previousSeriesStack.slice(0),this.previousSeriesStack=a}},this.restoreOriginalSeriesOrder=function(){var t,e,i,a=[];for(t=0;t<this.series.length;t++)a.push(t);if(this.seriesStack!=a)for(this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack=a,t=1;t<this.seriesStack.length;t++)e=this.series[t].canvas._elem.detach(),i=this.series[t].shadowCanvas._elem.detach(),this.series[t-1].shadowCanvas._elem.after(i),this.series[t-1].canvas._elem.after(e)},this.activateTheme=function(t){this.themeEngine.activate(this,t)}};if(t("#"+r).removeClass("jqplot-error"),!t.jqplot.config.catchErrors)return c.init(r,h,d),c.draw(),c.themeEngine.init.call(c),c;try{return c.init(r,h,d),c.draw(),c.themeEngine.init.call(c),c}catch(e){var p=t.jqplot.config.errorMessage||e.message;t("#"+r).append('<div class="jqplot-error-message">'+p+"</div>"),t("#"+r).addClass("jqplot-error"),document.getElementById(r).style.background=t.jqplot.config.errorBackground,document.getElementById(r).style.border=t.jqplot.config.errorBorder,document.getElementById(r).style.fontFamily=t.jqplot.config.errorFontFamily,document.getElementById(r).style.fontSize=t.jqplot.config.errorFontSize,document.getElementById(r).style.fontStyle=t.jqplot.config.errorFontStyle,document.getElementById(r).style.fontWeight=t.jqplot.config.errorFontWeight}},t.jqplot.version="1.0.9",t.jqplot.revision="d96a669",t.jqplot.targetCounter=1,t.jqplot.CanvasManager=function(){void 0===t.jqplot.CanvasManager.canvases&&(t.jqplot.CanvasManager.canvases=[],t.jqplot.CanvasManager.free=[]);var e=[];this.getCanvas=function(){var i,a=!0;if(!t.jqplot.use_excanvas)for(var s=0,n=t.jqplot.CanvasManager.canvases.length;n>s;s++)if(!0===t.jqplot.CanvasManager.free[s]){a=!1,i=t.jqplot.CanvasManager.canvases[s],t.jqplot.CanvasManager.free[s]=!1,e.push(s);break}return a&&(i=document.createElement("canvas"),e.push(t.jqplot.CanvasManager.canvases.length),t.jqplot.CanvasManager.canvases.push(i),t.jqplot.CanvasManager.free.push(!1)),i},this.initCanvas=function(e){if(t.jqplot.use_excanvas)return window.G_vmlCanvasManager.initElement(e);var i=e.getContext("2d"),a=1;window.devicePixelRatio>1&&(i.webkitBackingStorePixelRatio===I||i.webkitBackingStorePixelRatio<2)&&(a=window.devicePixelRatio);var s=e.width,n=e.height;return e.width=a*e.width,e.height=a*e.height,e.style.width=s+"px",e.style.height=n+"px",i.save(),i.scale(a,a),e},this.freeAllCanvases=function(){for(var t=0,i=e.length;i>t;t++)this.freeCanvas(e[t]);e=[]},this.freeCanvas=function(e){if(t.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==I)window.G_vmlCanvasManager.uninitElement(t.jqplot.CanvasManager.canvases[e]),t.jqplot.CanvasManager.canvases[e]=null;else{var i=t.jqplot.CanvasManager.canvases[e];i.getContext("2d").clearRect(0,0,i.width,i.height),t(i).unbind().removeAttr("class").removeAttr("style"),t(i).css({left:"",top:"",position:""}),i.width=0,i.height=0,t.jqplot.CanvasManager.free[e]=!0}}},t.jqplot.log=function(){window.console&&window.console.log.apply(window.console,arguments)},t.jqplot.config={addDomReference:!1,enablePlugins:!1,defaultHeight:300,defaultWidth:400,UTCAdjust:!1,timezoneOffset:new Date(6e4*(new Date).getTimezoneOffset()),errorMessage:"",errorBackground:"",errorBorder:"",errorFontFamily:"",errorFontSize:"",errorFontStyle:"",errorFontWeight:"",catchErrors:!1,defaultTickFormatString:"%.1f",defaultColors:["#4bb2c5","#EAA228","#c5b47f","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7"],defaultNegativeColors:["#498991","#C08840","#9F9274","#546D61","#646C4A","#6F6621","#6E3F5F","#4F64B0","#A89050","#C45923","#187399","#945381","#959E5C","#C7AF7B","#478396","#907294"],dashLength:4,gapLength:4,dotGapLength:2.5,srcLocation:"jqplot/src/",pluginLocation:"jqplot/src/plugins/"},t.jqplot.arrayMax=function(t){return Math.max.apply(Math,t)},t.jqplot.arrayMin=function(t){return Math.min.apply(Math,t)},t.jqplot.enablePlugins=t.jqplot.config.enablePlugins,t.jqplot.support_canvas=function(){return void 0===t.jqplot.support_canvas.result&&(t.jqplot.support_canvas.result=!!document.createElement("canvas").getContext),t.jqplot.support_canvas.result},t.jqplot.support_canvas_text=function(){return void 0===t.jqplot.support_canvas_text.result&&(window.G_vmlCanvasManager!==I&&window.G_vmlCanvasManager._version>887?t.jqplot.support_canvas_text.result=!0:t.jqplot.support_canvas_text.result=!(!document.createElement("canvas").getContext||"function"!=typeof document.createElement("canvas").getContext("2d").fillText)),t.jqplot.support_canvas_text.result},t.jqplot.use_excanvas=!(t.support.boxModel&&t.support.objectAll&&$support.leadingWhitespace||t.jqplot.support_canvas()),t.jqplot.preInitHooks=[],t.jqplot.postInitHooks=[],t.jqplot.preParseOptionsHooks=[],t.jqplot.postParseOptionsHooks=[],t.jqplot.preDrawHooks=[],t.jqplot.postDrawHooks=[],t.jqplot.preDrawSeriesHooks=[],t.jqplot.postDrawSeriesHooks=[],t.jqplot.preDrawLegendHooks=[],t.jqplot.addLegendRowHooks=[],t.jqplot.preSeriesInitHooks=[],t.jqplot.postSeriesInitHooks=[],t.jqplot.preParseSeriesOptionsHooks=[],t.jqplot.postParseSeriesOptionsHooks=[],t.jqplot.eventListenerHooks=[],t.jqplot.preDrawSeriesShadowHooks=[],t.jqplot.postDrawSeriesShadowHooks=[],t.jqplot.ElemContainer=function(){this._elem,this._plotWidth,this._plotHeight,this._plotDimensions={height:null,width:null}},t.jqplot.ElemContainer.prototype.createElement=function(e,i,a,s,n){this._offsets=i;var r=a||"jqplot",o=document.createElement(e);return this._elem=t(o),this._elem.addClass(r),this._elem.css(s),this._elem.attr(n),o=null,this._elem},t.jqplot.ElemContainer.prototype.getWidth=function(){return this._elem?this._elem.outerWidth(!0):null},t.jqplot.ElemContainer.prototype.getHeight=function(){return this._elem?this._elem.outerHeight(!0):null},t.jqplot.ElemContainer.prototype.getPosition=function(){return this._elem?this._elem.position():{top:null,left:null,bottom:null,right:null}},t.jqplot.ElemContainer.prototype.getTop=function(){return this.getPosition().top},t.jqplot.ElemContainer.prototype.getLeft=function(){return this.getPosition().left},t.jqplot.ElemContainer.prototype.getBottom=function(){return this._elem.css("bottom")},t.jqplot.ElemContainer.prototype.getRight=function(){return this._elem.css("right")},e.prototype=new t.jqplot.ElemContainer,e.prototype.constructor=e,e.prototype.init=function(){t.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.tickOptions.axis=this.name,null==this.tickOptions.showMark&&(this.tickOptions.showMark=this.showTicks),null==this.tickOptions.showMark&&(this.tickOptions.showMark=this.showTickMarks),null==this.tickOptions.showLabel&&(this.tickOptions.showLabel=this.showTicks),null==this.label||""==this.label?this.showLabel=!1:this.labelOptions.label=this.label,0==this.showLabel&&(this.labelOptions.show=!1),0==this.pad&&(this.pad=1),0==this.padMax&&(this.padMax=1),0==this.padMin&&(this.padMin=1),null==this.padMax&&(this.padMax=(this.pad-1)/2+1),null==this.padMin&&(this.padMin=(this.pad-1)/2+1),this.pad=this.padMax+this.padMin-1,(null!=this.min||null!=this.max)&&(this.autoscale=!1),null==this.syncTicks&&this.name.indexOf("y")>-1?this.syncTicks=!0:null==this.syncTicks&&(this.syncTicks=!1),this.renderer.init.call(this,this.rendererOptions)},e.prototype.draw=function(t,e){return this.__ticks&&(this.__ticks=null),this.renderer.draw.call(this,t,e)},e.prototype.set=function(){this.renderer.set.call(this)},e.prototype.pack=function(t,e){this.show&&this.renderer.pack.call(this,t,e),null==this._min&&(this._min=this.min,this._max=this.max,this._tickInterval=this.tickInterval,this._numberTicks=this.numberTicks,this.__ticks=this._ticks)},e.prototype.reset=function(){this.renderer.reset.call(this)},e.prototype.resetScale=function(e){t.extend(!0,this,{min:null,max:null,numberTicks:null,tickInterval:null,_ticks:[],ticks:[]},e),this.resetDataBounds()},e.prototype.resetDataBounds=function(){var e=this._dataBounds;e.min=null,e.max=null;for(var i,a,s=!!this.show,n=0;n<this._series.length;n++)if(i=this._series[n],i.show||this.scaleToHiddenSeries){a=i._plotData,"line"===i._type&&i.renderer.bands.show&&"x"!==this.name.charAt(0)&&(a=[[0,i.renderer.bands._min],[1,i.renderer.bands._max]]);var r=1,o=1;null!=i._type&&"ohlc"==i._type&&(r=3,o=2);for(var l=0,h=a.length;h>l;l++)"xaxis"==this.name||"x2axis"==this.name?((null!=a[l][0]&&a[l][0]<e.min||null==e.min)&&(e.min=a[l][0]),(null!=a[l][0]&&a[l][0]>e.max||null==e.max)&&(e.max=a[l][0])):((null!=a[l][r]&&a[l][r]<e.min||null==e.min)&&(e.min=a[l][r]),(null!=a[l][o]&&a[l][o]>e.max||null==e.max)&&(e.max=a[l][o]));s&&i.renderer.constructor!==t.jqplot.BarRenderer?s=!1:s&&this._options.hasOwnProperty("forceTickAt0")&&0==this._options.forceTickAt0?s=!1:s&&i.renderer.constructor===t.jqplot.BarRenderer&&("vertical"==i.barDirection&&"xaxis"!=this.name&&"x2axis"!=this.name?(null!=this._options.pad||null!=this._options.padMin)&&(s=!1):"horizontal"!=i.barDirection||"xaxis"!=this.name&&"x2axis"!=this.name||(null!=this._options.pad||null!=this._options.padMin)&&(s=!1))}s&&this.renderer.constructor===t.jqplot.LinearAxisRenderer&&e.min>=0&&(this.padMin=1,this.forceTickAt0=!0)},i.prototype=new t.jqplot.ElemContainer,i.prototype.constructor=i,i.prototype.setOptions=function(e){if(t.extend(!0,this,e),"inside"==this.placement&&(this.placement="insideGrid"),this.xoffset>0){if("insideGrid"==this.placement)switch(this.location){case"nw":case"w":case"sw":null==this.marginLeft&&(this.marginLeft=this.xoffset+"px"),this.marginRight="0px";break;case"ne":case"e":case"se":default:null==this.marginRight&&(this.marginRight=this.xoffset+"px"),this.marginLeft="0px"}else if("outside"==this.placement)switch(this.location){case"nw":case"w":case"sw":null==this.marginRight&&(this.marginRight=this.xoffset+"px"),this.marginLeft="0px";break;case"ne":case"e":case"se":default:null==this.marginLeft&&(this.marginLeft=this.xoffset+"px"),this.marginRight="0px"}this.xoffset=0}if(this.yoffset>0){if("outside"==this.placement)switch(this.location){case"sw":case"s":case"se":null==this.marginTop&&(this.marginTop=this.yoffset+"px"),this.marginBottom="0px";break;case"ne":case"n":case"nw":default:null==this.marginBottom&&(this.marginBottom=this.yoffset+"px"),this.marginTop="0px"}else if("insideGrid"==this.placement)switch(this.location){case"sw":case"s":case"se":null==this.marginBottom&&(this.marginBottom=this.yoffset+"px"),this.marginTop="0px";break;case"ne":case"n":case"nw":default:null==this.marginTop&&(this.marginTop=this.yoffset+"px"),this.marginBottom="0px"}this.yoffset=0}},i.prototype.init=function(){t.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},i.prototype.draw=function(e,i){for(var a=0;a<t.jqplot.preDrawLegendHooks.length;a++)t.jqplot.preDrawLegendHooks[a].call(this,e);return this.renderer.draw.call(this,e,i)},i.prototype.pack=function(t){this.renderer.pack.call(this,t)},a.prototype=new t.jqplot.ElemContainer,a.prototype.constructor=a,a.prototype.init=function(){t.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},a.prototype.draw=function(t){return this.renderer.draw.call(this,t)},a.prototype.pack=function(){this.renderer.pack.call(this)},s.prototype=new t.jqplot.ElemContainer,s.prototype.constructor=s,s.prototype.init=function(e,i,a){this.index=e,this.gridBorderWidth=i;var s,n,r=this.data,o=[];for(s=0,n=r.length;n>s;s++)if(this.breakOnNull)o.push(r[s]);else{if(null==r[s]||null==r[s][0]||null==r[s][1])continue;o.push(r[s])}if(this.data=o,this.color||(this.color=a.colorGenerator.get(this.index)),this.negativeColor||(this.negativeColor=a.negativeColorGenerator.get(this.index)),this.fillColor||(this.fillColor=this.color),this.fillAlpha){var l=t.jqplot.normalize2rgb(this.fillColor);l=t.jqplot.getColorComponents(l);this.fillColor="rgba("+l[0]+","+l[1]+","+l[2]+","+this.fillAlpha+")"}t.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions,a),this.markerRenderer=new this.markerRenderer,this.markerOptions.color||(this.markerOptions.color=this.color),null==this.markerOptions.show&&(this.markerOptions.show=this.showMarker),this.showMarker=this.markerOptions.show,this.markerRenderer.init(this.markerOptions)},s.prototype.draw=function(e,i,a){var s,n,r,o=i==I?{}:i;for(e=e==I?this.canvas._ctx:e,s=0;s<t.jqplot.preDrawSeriesHooks.length;s++)t.jqplot.preDrawSeriesHooks[s].call(this,e,o);for(this.show&&(this.renderer.setGridData.call(this,a),o.preventJqPlotSeriesDrawTrigger||t(e.canvas).trigger("jqplotSeriesDraw",[this.data,this.gridData]),n=[],n=o.data?o.data:this._stack?this._plotData:this.data,r=o.gridData||this.renderer.makeGridData.call(this,n,a),"line"===this._type&&this.renderer.smooth&&this.renderer._smoothedData.length&&(r=this.renderer._smoothedData),this.renderer.draw.call(this,e,r,o,a)),s=0;s<t.jqplot.postDrawSeriesHooks.length;s++)t.jqplot.postDrawSeriesHooks[s].call(this,e,o,a);e=i=a=s=n=r=null},s.prototype.drawShadow=function(e,i,a){var s,n,r,o=i==I?{}:i;for(e=e==I?this.shadowCanvas._ctx:e,s=0;s<t.jqplot.preDrawSeriesShadowHooks.length;s++)t.jqplot.preDrawSeriesShadowHooks[s].call(this,e,o);for(this.shadow&&(this.renderer.setGridData.call(this,a),n=[],n=o.data?o.data:this._stack?this._plotData:this.data,r=o.gridData||this.renderer.makeGridData.call(this,n,a),this.renderer.drawShadow.call(this,e,r,o,a)),s=0;s<t.jqplot.postDrawSeriesShadowHooks.length;s++)t.jqplot.postDrawSeriesShadowHooks[s].call(this,e,o);e=i=a=s=n=r=null},s.prototype.toggleDisplay=function(t,e){var i,a;i=t.data.series?t.data.series:this,t.data.speed&&(a=t.data.speed),a?i.canvas._elem.is(":hidden")||!i.show?(i.show=!0,i.canvas._elem.removeClass("jqplot-series-hidden"),i.shadowCanvas._elem&&i.shadowCanvas._elem.fadeIn(a),i.canvas._elem.fadeIn(a,e),i.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+i.index).fadeIn(a)):(i.show=!1,i.canvas._elem.addClass("jqplot-series-hidden"),i.shadowCanvas._elem&&i.shadowCanvas._elem.fadeOut(a),i.canvas._elem.fadeOut(a,e),i.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+i.index).fadeOut(a)):i.canvas._elem.is(":hidden")||!i.show?(i.show=!0,i.canvas._elem.removeClass("jqplot-series-hidden"),i.shadowCanvas._elem&&i.shadowCanvas._elem.show(),i.canvas._elem.show(0,e),i.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+i.index).show()):(i.show=!1,i.canvas._elem.addClass("jqplot-series-hidden"),i.shadowCanvas._elem&&i.shadowCanvas._elem.hide(),i.canvas._elem.hide(0,e),i.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+i.index).hide())},n.prototype=new t.jqplot.ElemContainer,n.prototype.constructor=n,n.prototype.init=function(){t.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},n.prototype.createElement=function(t,e){return this._offsets=t,this.renderer.createElement.call(this,e)},n.prototype.draw=function(){this.renderer.draw.call(this)},t.jqplot.GenericCanvas=function(){t.jqplot.ElemContainer.call(this),this._ctx},t.jqplot.GenericCanvas.prototype=new t.jqplot.ElemContainer,t.jqplot.GenericCanvas.prototype.constructor=t.jqplot.GenericCanvas,t.jqplot.GenericCanvas.prototype.createElement=function(e,i,a,s){this._offsets=e;var n,r="jqplot";return i!=I&&(r=i),n=s.canvasManager.getCanvas(),null!=a&&(this._plotDimensions=a),n.width=this._plotDimensions.width-this._offsets.left-this._offsets.right,n.height=this._plotDimensions.height-this._offsets.top-this._offsets.bottom,this._elem=t(n),this._elem.css({position:"absolute",left:this._offsets.left,top:this._offsets.top}),this._elem.addClass(r),n=s.canvasManager.initCanvas(n),n=null,this._elem},t.jqplot.GenericCanvas.prototype.setContext=function(){return this._ctx=this._elem.get(0).getContext("2d"),this._ctx},t.jqplot.GenericCanvas.prototype.resetCanvas=function(){this._elem&&(t.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==I&&window.G_vmlCanvasManager.uninitElement(this._elem.get(0)),this._elem.emptyForce()),this._ctx=null},t.jqplot.HooksManager=function(){this.hooks=[],this.args=[]},t.jqplot.HooksManager.prototype.addOnce=function(t,e){e=e||[];for(var i=!1,a=0,s=this.hooks.length;s>a;a++)this.hooks[a]==t&&(i=!0);i||(this.hooks.push(t),this.args.push(e))},t.jqplot.HooksManager.prototype.add=function(t,e){e=e||[],this.hooks.push(t),this.args.push(e)},t.jqplot.EventListenerManager=function(){this.hooks=[]},t.jqplot.EventListenerManager.prototype.addOnce=function(t,e){for(var i,a=!1,s=0,n=this.hooks.length;n>s;s++)i=this.hooks[s],i[0]==t&&i[1]==e&&(a=!0);a||this.hooks.push([t,e])},t.jqplot.EventListenerManager.prototype.add=function(t,e){this.hooks.push([t,e])};var C=["yMidAxis","xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis"];t.jqplot.computeHighlightColors=function(e){var i;if(t.isArray(e)){i=[];for(var a=0;a<e.length;a++){for(var s=(o=[(r=t.jqplot.getColorComponents(e[a]))[0],r[1],r[2]])[0]+o[1]+o[2],n=0;3>n;n++)o[n]=s>660?.85*o[n]:.73*o[n]+90,o[n]=parseInt(o[n],10),o[n]>255||o[n];o[3]=.3+.35*r[3],i.push("rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")")}}else{var r,o;for(s=(o=[(r=t.jqplot.getColorComponents(e))[0],r[1],r[2]])[0]+o[1]+o[2],n=0;3>n;n++)o[n]=s>660?.85*o[n]:.73*o[n]+90,o[n]=parseInt(o[n],10),o[n]>255||o[n];o[3]=.3+.35*r[3],i="rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")"}return i},t.jqplot.ColorGenerator=function(e){e=e||t.jqplot.config.defaultColors;var i=0;this.next=function(){return i<e.length?e[i++]:(i=0,e[i++])},this.previous=function(){return i>0?e[i--]:(i=e.length-1,e[i])},this.get=function(t){var i=t-e.length*Math.floor(t/e.length);return e[i]},this.setColors=function(t){e=t},this.reset=function(){i=0},this.getIndex=function(){return i},this.setIndex=function(t){i=t}},t.jqplot.hex2rgb=function(t,e){var i;return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),i="rgba("+parseInt(t.slice(0,2),16)+", "+parseInt(t.slice(2,4),16)+", "+parseInt(t.slice(4,6),16),e&&(i+=", "+e),i+")"},t.jqplot.rgb2hex=function(t){for(var e=t.match(/rgba?\( *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *(?:, *[0-9.]*)?\)/),i="#",a=1;4>a;a++){var s;-1!=e[a].search(/%/)?1==(s=parseInt(255*e[a]/100,10).toString(16)).length&&(s="0"+s):1==(s=parseInt(e[a],10).toString(16)).length&&(s="0"+s),i+=s}return i},t.jqplot.normalize2rgb=function(e,i){if(-1!=e.search(/^ *rgba?\(/))return e;if(-1!=e.search(/^ *#?[0-9a-fA-F]?[0-9a-fA-F]/))return t.jqplot.hex2rgb(e,i);throw new Error("Invalid color spec")},t.jqplot.getColorComponents=function(e){e=t.jqplot.colorKeywordMap[e]||e;for(var i=t.jqplot.normalize2rgb(e).match(/rgba?\( *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *,? *([0-9.]* *)?\)/),a=[],s=1;4>s;s++)-1!=i[s].search(/%/)?a[s-1]=parseInt(255*i[s]/100,10):a[s-1]=parseInt(i[s],10);return a[3]=parseFloat(i[4])?parseFloat(i[4]):1,a},t.jqplot.colorKeywordMap={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb( 0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb( 0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb( 0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb( 95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb( 0, 255, 255)",darkblue:"rgb( 0, 0, 139)",darkcyan:"rgb( 0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb( 0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb( 85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb( 72, 61, 139)",darkslategray:"rgb( 47, 79, 79)",darkslategrey:"rgb( 47, 79, 79)",darkturquoise:"rgb( 0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb( 0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb( 30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb( 34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",grey:"rgb(128, 128, 128)",green:"rgb( 0, 128, 0)",greenyellow:"rgb(173, 255, 47)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb( 75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb( 32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb( 0, 255, 0)",limegreen:"rgb( 50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb( 0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb( 60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb( 0, 250, 154)",mediumturquoise:"rgb( 72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb( 25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb( 0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb( 65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb( 46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb( 0, 255, 127)",steelblue:"rgb( 70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb( 0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",turquoise:"rgb( 64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)"},t.jqplot.AxisLabelRenderer=function(e){t.jqplot.ElemContainer.call(this),this.axis,this.show=!0,this.label="",this.fontFamily=null,this.fontSize=null,this.textColor=null,this._elem,this.escapeHTML=!1,t.extend(!0,this,e)},t.jqplot.AxisLabelRenderer.prototype=new t.jqplot.ElemContainer,t.jqplot.AxisLabelRenderer.prototype.constructor=t.jqplot.AxisLabelRenderer,t.jqplot.AxisLabelRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.AxisLabelRenderer.prototype.draw=function(e,i){return this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=t('<div style="position:absolute;" class="jqplot-'+this.axis+'-label"></div>'),Number(this.label)&&this._elem.css("white-space","nowrap"),this.escapeHTML?this._elem.text(this.label):this._elem.html(this.label),this.fontFamily&&this._elem.css("font-family",this.fontFamily),this.fontSize&&this._elem.css("font-size",this.fontSize),this.textColor&&this._elem.css("color",this.textColor),this._elem},t.jqplot.AxisLabelRenderer.prototype.pack=function(){},t.jqplot.AxisTickRenderer=function(e){t.jqplot.ElemContainer.call(this),this.mark="outside",this.axis,this.showMark=!0,this.showGridline=!0,this.isMinorTick=!1,this.size=4,this.markSize=6,this.show=!0,this.showLabel=!0,this.label=null,this.value=null,this._styles={},this.formatter=t.jqplot.DefaultTickFormatter,this.prefix="",this.suffix="",this.formatString="",this.fontFamily,this.fontSize,this.textColor,this.escapeHTML=!1,this._elem,this._breakTick=!1,t.extend(!0,this,e)},t.jqplot.AxisTickRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.AxisTickRenderer.prototype=new t.jqplot.ElemContainer,t.jqplot.AxisTickRenderer.prototype.constructor=t.jqplot.AxisTickRenderer,t.jqplot.AxisTickRenderer.prototype.setTick=function(t,e,i){return this.value=t,this.axis=e,i&&(this.isMinorTick=!0),this},t.jqplot.AxisTickRenderer.prototype.draw=function(){null===this.label&&(this.label=this.prefix+this.formatter(this.formatString,this.value)+this.suffix);var e={position:"absolute"};Number(this.label)&&(e.whitSpace="nowrap"),this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=t(document.createElement("div")),this._elem.addClass("jqplot-"+this.axis+"-tick"),this.escapeHTML?this._elem.text(this.label):this._elem.html(this.label),this._elem.css(e);for(var i in this._styles)this._elem.css(i,this._styles[i]);return this.fontFamily&&this._elem.css("font-family",this.fontFamily),this.fontSize&&this._elem.css("font-size",this.fontSize),this.textColor&&this._elem.css("color",this.textColor),this._breakTick&&this._elem.addClass("jqplot-breakTick"),this._elem},t.jqplot.DefaultTickFormatter=function(e,i){return"number"==typeof i?(e||(e=t.jqplot.config.defaultTickFormatString),t.jqplot.sprintf(e,i)):String(i)},t.jqplot.PercentTickFormatter=function(e,i){return"number"==typeof i?(i*=100,e||(e=t.jqplot.config.defaultTickFormatString),t.jqplot.sprintf(e,i)):String(i)},t.jqplot.AxisTickRenderer.prototype.pack=function(){},t.jqplot.CanvasGridRenderer=function(){this.shadowRenderer=new t.jqplot.ShadowRenderer},t.jqplot.CanvasGridRenderer.prototype.init=function(e){this._ctx,t.extend(!0,this,e);var i={lineJoin:"miter",lineCap:"round",fill:!1,isarc:!1,angle:this.shadowAngle,offset:this.shadowOffset,alpha:this.shadowAlpha,depth:this.shadowDepth,lineWidth:this.shadowWidth,closePath:!1,strokeStyle:this.shadowColor};this.renderer.shadowRenderer.init(i)},t.jqplot.CanvasGridRenderer.prototype.createElement=function(e){var i;this._elem&&(t.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==I&&(i=this._elem.get(0),window.G_vmlCanvasManager.uninitElement(i),i=null),this._elem.emptyForce(),this._elem=null),i=e.canvasManager.getCanvas();var a=this._plotDimensions.width,s=this._plotDimensions.height;return i.width=a,i.height=s,this._elem=t(i),this._elem.addClass("jqplot-grid-canvas"),this._elem.css({position:"absolute",left:0,top:0}),i=e.canvasManager.initCanvas(i),this._top=this._offsets.top,this._bottom=s-this._offsets.bottom,this._left=this._offsets.left,this._right=a-this._offsets.right,this._width=this._right-this._left,this._height=this._bottom-this._top,i=null,this._elem},t.jqplot.CanvasGridRenderer.prototype.draw=function(){function e(e,a,s,n,r){i.save(),(null==(r=r||{}).lineWidth||0!=r.lineWidth)&&(t.extend(!0,i,r),i.beginPath(),i.moveTo(e,a),i.lineTo(s,n),i.stroke(),i.restore())}this._ctx=this._elem.get(0).getContext("2d");var i=this._ctx,a=this._axes;i.save(),i.clearRect(0,0,this._plotDimensions.width,this._plotDimensions.height),i.fillStyle=this.backgroundColor||this.background,i.fillRect(this._left,this._top,this._width,this._height),i.save(),i.lineJoin="miter",i.lineCap="butt",i.lineWidth=this.gridLineWidth,i.strokeStyle=this.gridLineColor;for(var s,n,r,o,l=["xaxis","yaxis","x2axis","y2axis"],h=4;h>0;h--){var d=l[h-1],c=(m=(f=a[d])._ticks).length;if(f.show){if(f.drawBaseline){var p={};switch(null!==f.baselineWidth&&(p.lineWidth=f.baselineWidth),null!==f.baselineColor&&(p.strokeStyle=f.baselineColor),d){case"xaxis":e(this._left,this._bottom,this._right,this._bottom,p);break;case"yaxis":e(this._left,this._bottom,this._left,this._top,p);break;case"x2axis":e(this._left,this._bottom,this._right,this._bottom,p);break;case"y2axis":e(this._right,this._bottom,this._right,this._top,p)}}for(var u=c;u>0;u--){if((k=m[u-1]).show){var g=Math.round(f.u2p(k.value))+.5;switch(d){case"xaxis":if(k.showGridline&&this.drawGridlines&&(!k.isMinorTick&&f.drawMajorGridlines||k.isMinorTick&&f.drawMinorGridlines)&&e(g,this._top,g,this._bottom),k.showMark&&k.mark&&(!k.isMinorTick&&f.drawMajorTickMarks||k.isMinorTick&&f.drawMinorTickMarks)){r=k.markSize,o=k.mark;g=Math.round(f.u2p(k.value))+.5;switch(o){case"outside":s=this._bottom,n=this._bottom+r;break;case"inside":s=this._bottom-r,n=this._bottom;break;case"cross":s=this._bottom-r,n=this._bottom+r;break;default:s=this._bottom,n=this._bottom+r}this.shadow&&this.renderer.shadowRenderer.draw(i,[[g,s],[g,n]],{lineCap:"butt",lineWidth:this.gridLineWidth,offset:.75*this.gridLineWidth,depth:2,fill:!1,closePath:!1}),e(g,s,g,n)}break;case"yaxis":if(k.showGridline&&this.drawGridlines&&(!k.isMinorTick&&f.drawMajorGridlines||k.isMinorTick&&f.drawMinorGridlines)&&e(this._right,g,this._left,g),k.showMark&&k.mark&&(!k.isMinorTick&&f.drawMajorTickMarks||k.isMinorTick&&f.drawMinorTickMarks)){r=k.markSize,o=k.mark;g=Math.round(f.u2p(k.value))+.5;switch(o){case"outside":s=this._left-r,n=this._left;break;case"inside":s=this._left,n=this._left+r;break;case"cross":s=this._left-r,n=this._left+r;break;default:s=this._left-r,n=this._left}this.shadow&&this.renderer.shadowRenderer.draw(i,[[s,g],[n,g]],{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:.75*this.gridLineWidth,fill:!1,closePath:!1}),e(s,g,n,g,{strokeStyle:f.borderColor})}break;case"x2axis":if(k.showGridline&&this.drawGridlines&&(!k.isMinorTick&&f.drawMajorGridlines||k.isMinorTick&&f.drawMinorGridlines)&&e(g,this._bottom,g,this._top),k.showMark&&k.mark&&(!k.isMinorTick&&f.drawMajorTickMarks||k.isMinorTick&&f.drawMinorTickMarks)){r=k.markSize,o=k.mark;g=Math.round(f.u2p(k.value))+.5;switch(o){case"outside":s=this._top-r,n=this._top;break;case"inside":s=this._top,n=this._top+r;break;case"cross":s=this._top-r,n=this._top+r;break;default:s=this._top-r,n=this._top}this.shadow&&this.renderer.shadowRenderer.draw(i,[[g,s],[g,n]],{lineCap:"butt",lineWidth:this.gridLineWidth,offset:.75*this.gridLineWidth,depth:2,fill:!1,closePath:!1}),e(g,s,g,n)}break;case"y2axis":if(k.showGridline&&this.drawGridlines&&(!k.isMinorTick&&f.drawMajorGridlines||k.isMinorTick&&f.drawMinorGridlines)&&e(this._left,g,this._right,g),k.showMark&&k.mark&&(!k.isMinorTick&&f.drawMajorTickMarks||k.isMinorTick&&f.drawMinorTickMarks)){r=k.markSize,o=k.mark;g=Math.round(f.u2p(k.value))+.5;switch(o){case"outside":s=this._right,n=this._right+r;break;case"inside":s=this._right-r,n=this._right;break;case"cross":s=this._right-r,n=this._right+r;break;default:s=this._right,n=this._right+r}this.shadow&&this.renderer.shadowRenderer.draw(i,[[s,g],[n,g]],{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:.75*this.gridLineWidth,fill:!1,closePath:!1}),e(s,g,n,g,{strokeStyle:f.borderColor})}}}}k=null}f=null,m=null}l=["y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"];for(h=7;h>0;h--){var f,m=(f=a[l[h-1]])._ticks;if(f.show){var b=m[f.numberTicks-1],x=m[0],v=f.getLeft(),y=[[v,b.getTop()+b.getHeight()/2],[v,x.getTop()+x.getHeight()/2+1]];this.shadow&&this.renderer.shadowRenderer.draw(i,y,{lineCap:"butt",fill:!1,closePath:!1}),e(y[0][0],y[0][1],y[1][0],y[1][1],{lineCap:"butt",strokeStyle:f.borderColor,lineWidth:f.borderWidth});for(u=m.length;u>0;u--){var k;r=(k=m[u-1]).markSize,o=k.mark;g=Math.round(f.u2p(k.value))+.5;if(k.showMark&&k.mark){switch(o){case"outside":s=v,n=v+r;break;case"inside":s=v-r,n=v;break;case"cross":s=v-r,n=v+r;break;default:s=v,n=v+r}y=[[s,g],[n,g]],this.shadow&&this.renderer.shadowRenderer.draw(i,y,{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:.75*this.gridLineWidth,fill:!1,closePath:!1}),e(s,g,n,g,{strokeStyle:f.borderColor})}k=null}x=null}f=null,m=null}if(i.restore(),this.shadow){y=[[this._left,this._bottom],[this._right,this._bottom],[this._right,this._top]];this.renderer.shadowRenderer.draw(i,y)}0!=this.borderWidth&&this.drawBorder&&(e(this._left,this._top,this._right,this._top,{lineCap:"round",strokeStyle:a.x2axis.borderColor,lineWidth:a.x2axis.borderWidth}),e(this._right,this._top,this._right,this._bottom,{lineCap:"round",strokeStyle:a.y2axis.borderColor,lineWidth:a.y2axis.borderWidth}),e(this._right,this._bottom,this._left,this._bottom,{lineCap:"round",strokeStyle:a.xaxis.borderColor,lineWidth:a.xaxis.borderWidth}),e(this._left,this._bottom,this._left,this._top,{lineCap:"round",strokeStyle:a.yaxis.borderColor,lineWidth:a.yaxis.borderWidth})),i.restore(),i=null,a=null},t.jqplot.DivTitleRenderer=function(){},t.jqplot.DivTitleRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.DivTitleRenderer.prototype.draw=function(){this._elem&&(this._elem.emptyForce(),this._elem=null);var e=(this.renderer,document.createElement("div"));if(this._elem=t(e),this._elem.addClass("jqplot-title"),this.text){if(this.text){var i;this.color?i=this.color:this.textColor&&(i=this.textColor);var a={position:"absolute",top:"0px",left:"0px"};this._plotWidth&&(a.width=this._plotWidth+"px"),this.fontSize&&(a.fontSize=this.fontSize),"string"==typeof this.textAlign?a.textAlign=this.textAlign:a.textAlign="center",i&&(a.color=i),this.paddingBottom&&(a.paddingBottom=this.paddingBottom),this.fontFamily&&(a.fontFamily=this.fontFamily),this._elem.css(a),this.escapeHtml?this._elem.text(this.text):this._elem.html(this.text)}}else this.show=!1,this._elem.height(0),this._elem.width(0);return e=null,this._elem},t.jqplot.DivTitleRenderer.prototype.pack=function(){};t.jqplot.LinePattern=function(e,i){var a={dotted:[.1,t.jqplot.config.dotGapLength],dashed:[t.jqplot.config.dashLength,t.jqplot.config.gapLength],solid:null};if("string"==typeof i)if("."===i[0]||"-"===i[0]){var s=i;i=[];for(var n=0,r=s.length;r>n;n++){if("."===s[n])i.push(.1);else{if("-"!==s[n])continue;i.push(t.jqplot.config.dashLength)}i.push(t.jqplot.config.gapLength)}}else i=a[i];if(!i||!i.length)return e;var o=0,l=i[0],h=0,d=0,c=0,p=0,u=function(t,a){var s=e.lineWidth,n=t-h,r=a-d,c=Math.sqrt(n*n+r*r);if(c>0&&s>0)for(n/=c,r/=c;;){var p=s*l;if(!(c>p)){h=t,d=a,0==(1&o)?e.lineTo(h,d):e.moveTo(h,d),l-=c/s;break}h+=p*n,d+=p*r,0==(1&o)?e.lineTo(h,d):e.moveTo(h,d),c-=p,++o>=i.length&&(o=0),l=i[o]}};return{moveTo:function(t,i){e.moveTo(t,i),h=t,d=i,c=t,p=i},lineTo:u,beginPath:function(){e.beginPath()},closePath:function(){u(c,p)}}},t.jqplot.LineRenderer=function(){this.shapeRenderer=new t.jqplot.ShapeRenderer,this.shadowRenderer=new t.jqplot.ShadowRenderer},t.jqplot.LineRenderer.prototype.init=function(e,i){e=e||{},this._type="line",this.renderer.animation={show:!1,direction:"left",speed:2500,_supported:!0},this.renderer.smooth=!1,this.renderer.tension=null,this.renderer.constrainSmoothing=!0,this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[],this.renderer.bandData=[],this.renderer.bands={show:!1,hiData:[],lowData:[],color:this.color,showLines:!1,fill:!0,fillColor:null,_min:null,_max:null,interval:"3%"};var a={highlightMouseOver:e.highlightMouseOver,highlightMouseDown:e.highlightMouseDown,highlightColor:e.highlightColor};delete e.highlightMouseOver,delete e.highlightMouseDown,delete e.highlightColor,t.extend(!0,this.renderer,e),this.renderer.options=e,this.renderer.bandData.length>1&&(!e.bands||null==e.bands.show)?this.renderer.bands.show=!0:e.bands&&null==e.bands.show&&null!=e.bands.interval&&(this.renderer.bands.show=!0),this.fill&&(this.renderer.bands.show=!1),this.renderer.bands.show&&this.renderer.initBands.call(this,this.renderer.options,i),this._stack&&(this.renderer.smooth=!1);var s={lineJoin:this.lineJoin,lineCap:this.lineCap,fill:this.fill,isarc:!1,strokeStyle:this.color,fillStyle:this.fillColor,lineWidth:this.lineWidth,linePattern:this.linePattern,closePath:this.fill};this.renderer.shapeRenderer.init(s);var n=e.shadowOffset;null==n&&(n=this.lineWidth>2.5?1.25*(1+.6*(Math.atan(this.lineWidth/2.5)/.785398163-1)):1.25*Math.atan(this.lineWidth/2.5)/.785398163);var r={lineJoin:this.lineJoin,lineCap:this.lineCap,fill:this.fill,isarc:!1,angle:this.shadowAngle,offset:n,alpha:this.shadowAlpha,depth:this.shadowDepth,lineWidth:this.lineWidth,linePattern:this.linePattern,closePath:this.fill};if(this.renderer.shadowRenderer.init(r),this._areaPoints=[],this._boundingBox=[[],[]],!this.isTrendline&&this.fill||this.renderer.bands.show){if(this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColor=null,a.highlightMouseDown&&null==a.highlightMouseOver&&(a.highlightMouseOver=!1),t.extend(!0,this,{highlightMouseOver:a.highlightMouseOver,highlightMouseDown:a.highlightMouseDown,highlightColor:a.highlightColor}),!this.highlightColor){var o=this.renderer.bands.show?this.renderer.bands.fillColor:this.fillColor;this.highlightColor=t.jqplot.computeHighlightColors(o)}this.highlighter&&(this.highlighter.show=!1)}!this.isTrendline&&i&&(i.plugins.lineRenderer={},i.postInitHooks.addOnce(d),i.postDrawHooks.addOnce(c),i.eventListenerHooks.addOnce("jqplotMouseMove",g),i.eventListenerHooks.addOnce("jqplotMouseDown",f),i.eventListenerHooks.addOnce("jqplotMouseUp",m),i.eventListenerHooks.addOnce("jqplotClick",b),i.eventListenerHooks.addOnce("jqplotRightClick",x))},t.jqplot.LineRenderer.prototype.initBands=function(e,i){var a=e.bandData||[],s=this.renderer.bands;s.hiData=[],s.lowData=[];var n=this.data;if(s._max=null,s._min=null,2==a.length)if(t.isArray(a[0][0])){for(var r,o=0,l=0,h=0,d=a[0].length;d>h;h++)r=a[0][h],(null!=r[1]&&r[1]>s._max||null==s._max)&&(s._max=r[1]),(null!=r[1]&&r[1]<s._min||null==s._min)&&(s._min=r[1]);for(h=0,d=a[1].length;d>h;h++)r=a[1][h],(null!=r[1]&&r[1]>s._max||null==s._max)&&(s._max=r[1],l=1),(null!=r[1]&&r[1]<s._min||null==s._min)&&(s._min=r[1],o=1);l===o&&(s.show=!1),s.hiData=a[l],s.lowData=a[o]}else if(a[0].length===n.length&&a[1].length===n.length){var c=a[0][0]>a[1][0]?0:1,p=c?0:1;for(h=0,d=n.length;d>h;h++)s.hiData.push([n[h][0],a[c][h]]),s.lowData.push([n[h][0],a[p][h]])}else s.show=!1;else if(a.length>2&&!t.isArray(a[0][0]))for(c=a[0][0]>a[0][1]?0:1,p=c?0:1,h=0,d=a.length;d>h;h++)s.hiData.push([n[h][0],a[h][c]]),s.lowData.push([n[h][0],a[h][p]]);else{var u=s.interval,g=null,f=null,m=null,b=null;if(t.isArray(u)?(g=u[0],f=u[1]):g=u,isNaN(g)?"%"===g.charAt(g.length-1)&&(m="multiply",g=parseFloat(g)/100+1):(g=parseFloat(g),m="add"),null!==f&&isNaN(f)?"%"===f.charAt(f.length-1)&&(b="multiply",f=parseFloat(f)/100+1):null!==f&&(f=parseFloat(f),b="add"),null!==g){if(null===f&&(f=-g,"multiply"===(b=m)&&(f+=2)),f>g){var x=g;g=f,f=x,x=m,m=b,b=x}for(h=0,d=n.length;d>h;h++){switch(m){case"add":s.hiData.push([n[h][0],n[h][1]+g]);break;case"multiply":s.hiData.push([n[h][0],n[h][1]*g])}switch(b){case"add":s.lowData.push([n[h][0],n[h][1]+f]);break;case"multiply":s.lowData.push([n[h][0],n[h][1]*f])}}}else s.show=!1}var v=s.hiData,y=s.lowData;for(h=0,d=v.length;d>h;h++)(null!=v[h][1]&&v[h][1]>s._max||null==s._max)&&(s._max=v[h][1]);for(h=0,d=y.length;d>h;h++)(null!=y[h][1]&&y[h][1]<s._min||null==s._min)&&(s._min=y[h][1]);if(null===s.fillColor){var k=t.jqplot.getColorComponents(s.color);k[3]=.5*k[3],s.fillColor="rgba("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+")"}},t.jqplot.LineRenderer.prototype.setGridData=function(t){var e,i=this._xaxis.series_u2p,a=this._yaxis.series_u2p,s=this._plotData,n=this._prevPlotData;this.gridData=[],this._prevGridData=[],this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[];for(var r=this.renderer.bands,o=!1,d=0,c=s.length;c>d;d++)null!=s[d][0]&&null!=s[d][1]?this.gridData.push([i.call(this._xaxis,s[d][0]),a.call(this._yaxis,s[d][1])]):null==s[d][0]?(o=!0,this.gridData.push([null,a.call(this._yaxis,s[d][1])])):null==s[d][1]&&(o=!0,this.gridData.push([i.call(this._xaxis,s[d][0]),null])),null!=n[d]&&null!=n[d][0]&&null!=n[d][1]?this._prevGridData.push([i.call(this._xaxis,n[d][0]),a.call(this._yaxis,n[d][1])]):null!=n[d]&&null==n[d][0]?this._prevGridData.push([null,a.call(this._yaxis,n[d][1])]):null!=n[d]&&null!=n[d][0]&&null==n[d][1]&&this._prevGridData.push([i.call(this._xaxis,n[d][0]),null]);if(o&&(this.renderer.smooth=!1,"line"===this._type&&(r.show=!1)),"line"===this._type&&r.show){for(d=0,c=r.hiData.length;c>d;d++)this.renderer._hiBandGridData.push([i.call(this._xaxis,r.hiData[d][0]),a.call(this._yaxis,r.hiData[d][1])]);for(d=0,c=r.lowData.length;c>d;d++)this.renderer._lowBandGridData.push([i.call(this._xaxis,r.lowData[d][0]),a.call(this._yaxis,r.lowData[d][1])])}"line"===this._type&&this.renderer.smooth&&this.gridData.length>2&&(this.renderer.constrainSmoothing?(e=l.call(this,this.gridData),this.renderer._smoothedData=e[0],this.renderer._smoothedPlotData=e[1],r.show&&(e=l.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=e[0],e=l.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=e[0]),e=null):(e=h.call(this,this.gridData),this.renderer._smoothedData=e[0],this.renderer._smoothedPlotData=e[1],r.show&&(e=h.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=e[0],e=h.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=e[0]),e=null))},t.jqplot.LineRenderer.prototype.makeGridData=function(t,e){var i,a=this._xaxis.series_u2p,s=this._yaxis.series_u2p,n=[];this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[];for(var r=this.renderer.bands,o=!1,d=0;d<t.length;d++)null!=t[d][0]&&null!=t[d][1]?(this.step&&d>0&&n.push([a.call(this._xaxis,t[d][0]),s.call(this._yaxis,t[d-1][1])]),n.push([a.call(this._xaxis,t[d][0]),s.call(this._yaxis,t[d][1])])):null==t[d][0]?(o=!0,n.push([null,s.call(this._yaxis,t[d][1])])):null==t[d][1]&&(o=!0,n.push([a.call(this._xaxis,t[d][0]),null]));if(o&&(this.renderer.smooth=!1,"line"===this._type&&(r.show=!1)),"line"===this._type&&r.show){d=0;for(var c=r.hiData.length;c>d;d++)this.renderer._hiBandGridData.push([a.call(this._xaxis,r.hiData[d][0]),s.call(this._yaxis,r.hiData[d][1])]);for(d=0,c=r.lowData.length;c>d;d++)this.renderer._lowBandGridData.push([a.call(this._xaxis,r.lowData[d][0]),s.call(this._yaxis,r.lowData[d][1])])}"line"===this._type&&this.renderer.smooth&&n.length>2&&(this.renderer.constrainSmoothing?(i=l.call(this,n),this.renderer._smoothedData=i[0],this.renderer._smoothedPlotData=i[1],r.show&&(i=l.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=i[0],i=l.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=i[0]),i=null):(i=h.call(this,n),this.renderer._smoothedData=i[0],this.renderer._smoothedPlotData=i[1],r.show&&(i=h.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=i[0],i=h.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=i[0]),i=null));return n},t.jqplot.LineRenderer.prototype.draw=function(e,i,a,s){var n,r,o,l=t.extend(!0,{},a),h=l.shadow!=I?l.shadow:this.shadow,d=l.showLine!=I?l.showLine:this.showLine,c=l.fill!=I?l.fill:this.fill,p=l.fillAndStroke!=I?l.fillAndStroke:this.fillAndStroke;if(e.save(),i.length){if(d)if(c){if(this.fillToZero){var u=this.negativeColor;this.useNegativeColors||(u=l.fillStyle);var g=l.fillStyle;if(p)var f=i.slice(0);if(0!=this.index&&this._stack){for(var m=(k=this._prevGridData).length;m>0;m--)i.push(k[m-1]);h&&this.renderer.shadowRenderer.draw(e,i,l),this._areaPoints=i,this.renderer.shapeRenderer.draw(e,i,l)}else{var b=[],x=this.renderer.smooth?this.renderer._smoothedPlotData:this._plotData;this._areaPoints=[];var v=this._yaxis.series_u2p(this.fillToValue);if(this._xaxis.series_u2p(this.fillToValue),l.closePath=!0,"y"==this.fillAxis){b.push([i[0][0],v]),this._areaPoints.push([i[0][0],v]);for(m=0;m<i.length-1;m++)if(b.push(i[m]),this._areaPoints.push(i[m]),x[m][1]*x[m+1][1]<=0){x[m][1]<0?(!0,l.fillStyle=u):(!1,l.fillStyle=g);var y=i[m][0]+(i[m+1][0]-i[m][0])*(v-i[m][1])/(i[m+1][1]-i[m][1]);b.push([y,v]),this._areaPoints.push([y,v]),h&&this.renderer.shadowRenderer.draw(e,b,l),this.renderer.shapeRenderer.draw(e,b,l),b=[[y,v]]}x[i.length-1][1]<0?(!0,l.fillStyle=u):(!1,l.fillStyle=g),b.push(i[i.length-1]),this._areaPoints.push(i[i.length-1]),b.push([i[i.length-1][0],v]),this._areaPoints.push([i[i.length-1][0],v])}h&&this.renderer.shadowRenderer.draw(e,b,l),this.renderer.shapeRenderer.draw(e,b,l)}}else{if(p)f=i.slice(0);if(0!=this.index&&this._stack){var k=this._prevGridData;for(m=k.length;m>0;m--)i.push(k[m-1])}else{var $=e.canvas.height;i.unshift([i[0][0],$]);var S=i.length;i.push([i[S-1][0],$])}this._areaPoints=i,h&&this.renderer.shadowRenderer.draw(e,i,l),this.renderer.shapeRenderer.draw(e,i,l)}if(p){var w=t.extend(!0,{},l,{fill:!1,closePath:!1});if(this.renderer.shapeRenderer.draw(e,f,w),this.markerRenderer.show)for(this.renderer.smooth&&(f=this.gridData),m=0;m<f.length;m++)this.markerRenderer.draw(f[m][0],f[m][1],e,l.markerOptions)}}else{if(this.renderer.bands.show){var _,T=t.extend(!0,{},l);this.renderer.bands.showLines&&(_=this.renderer.smooth?this.renderer._hiBandSmoothedData:this.renderer._hiBandGridData,this.renderer.shapeRenderer.draw(e,_,l),_=this.renderer.smooth?this.renderer._lowBandSmoothedData:this.renderer._lowBandGridData,this.renderer.shapeRenderer.draw(e,_,T)),this.renderer.bands.fill&&(_=this.renderer.smooth?this.renderer._hiBandSmoothedData.concat(this.renderer._lowBandSmoothedData.reverse()):this.renderer._hiBandGridData.concat(this.renderer._lowBandGridData.reverse()),this._areaPoints=_,T.closePath=!0,T.fill=!0,T.fillStyle=this.renderer.bands.fillColor,this.renderer.shapeRenderer.draw(e,_,T))}h&&this.renderer.shadowRenderer.draw(e,i,l),this.renderer.shapeRenderer.draw(e,i,l)}var C=r=n=o=null;for(m=0;m<this._areaPoints.length;m++){var D=this._areaPoints[m];(C>D[0]||null==C)&&(C=D[0]),(o<D[1]||null==o)&&(o=D[1]),(r<D[0]||null==r)&&(r=D[0]),(n>D[1]||null==n)&&(n=D[1])}if("line"===this.type&&this.renderer.bands.show&&(o=this._yaxis.series_u2p(this.renderer.bands._min),n=this._yaxis.series_u2p(this.renderer.bands._max)),this._boundingBox=[[C,o],[r,n]],this.markerRenderer.show&&!c)for(this.renderer.smooth&&(i=this.gridData),m=0;m<i.length;m++)null!=i[m][0]&&null!=i[m][1]&&this.markerRenderer.draw(i[m][0],i[m][1],e,l.markerOptions)}e.restore()},t.jqplot.LineRenderer.prototype.drawShadow=function(t,e,i){},t.jqplot.LinearAxisRenderer=function(){},t.jqplot.LinearAxisRenderer.prototype.init=function(e){this.breakPoints=null,this.breakTickLabel="&asymp;",this.drawBaseline=!0,this.baselineWidth=null,this.baselineColor=null,this.forceTickAt0=!1,this.forceTickAt100=!1,this.tickInset=0,this.minorTicks=0,this.alignTicks=!1,this._autoFormatString="",this._overrideFormatString=!1,this._scalefact=1,t.extend(!0,this,e),this.breakPoints&&(t.isArray(this.breakPoints)?(this.breakPoints.length<2||this.breakPoints[1]<=this.breakPoints[0])&&(this.breakPoints=null):this.breakPoints=null),null!=this.numberTicks&&this.numberTicks<2&&(this.numberTicks=2),this.resetDataBounds()},t.jqplot.LinearAxisRenderer.prototype.draw=function(e,i){if(this.show){if(this.renderer.createTicks.call(this,i),this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=t(document.createElement("div")),this._elem.addClass("jqplot-axis jqplot-"+this.name),this._elem.css("position","absolute"),"xaxis"==this.name||"x2axis"==this.name?this._elem.width(this._plotDimensions.width):this._elem.height(this._plotDimensions.height),this.labelOptions.axis=this.name,this._label=new this.labelRenderer(this.labelOptions),this._label.show){var a=this._label.draw(e,i);a.appendTo(this._elem),a=null}for(var s,n=this._ticks,r=0;r<n.length;r++)s=n[r],s.show&&s.showLabel&&(!s.isMinorTick||this.showMinorTicks)&&this._elem.append(s.draw(e,i));s=null,n=null}return this._elem},t.jqplot.LinearAxisRenderer.prototype.reset=function(){this.min=this._options.min,this.max=this._options.max,this.tickInterval=this._options.tickInterval,this.numberTicks=this._options.numberTicks,this._autoFormatString="",this._overrideFormatString&&this.tickOptions&&this.tickOptions.formatString&&(this.tickOptions.formatString="")},t.jqplot.LinearAxisRenderer.prototype.set=function(){var e,i=0,a=0,s=0,n=null!=this._label&&this._label.show;if(this.show){for(var r,o=this._ticks,l=0;l<o.length;l++)r=o[l],r._breakTick||!r.show||!r.showLabel||r.isMinorTick&&!this.showMinorTicks||(e="xaxis"==this.name||"x2axis"==this.name?r._elem.outerHeight(!0):r._elem.outerWidth(!0),e>i&&(i=e));r=null,o=null,n&&(a=this._label._elem.outerWidth(!0),s=this._label._elem.outerHeight(!0)),"xaxis"==this.name?(i+=s,this._elem.css({height:i+"px",left:"0px",bottom:"0px"})):"x2axis"==this.name?(i+=s,this._elem.css({height:i+"px",left:"0px",top:"0px"})):"yaxis"==this.name?(i+=a,this._elem.css({width:i+"px",left:"0px",top:"0px"}),n&&this._label.constructor==t.jqplot.AxisLabelRenderer&&this._label._elem.css("width",a+"px")):(i+=a,this._elem.css({width:i+"px",right:"0px",top:"0px"}),n&&this._label.constructor==t.jqplot.AxisLabelRenderer&&this._label._elem.css("width",a+"px"))}},t.jqplot.LinearAxisRenderer.prototype.createTicks=function(e){this._ticks;var i,a,s,n=this.ticks,r=this.name,o=this._dataBounds,l="x"===this.name.charAt(0)?this._plotDimensions.width:this._plotDimensions.height,h=this.min,d=this.max,c=this.numberTicks,p=this.tickInterval;if(this._scalefact=(Math.max(l,31)-30)/300,n.length){for(M=0;M<n.length;M++){var u=n[M],g=new this.tickRenderer(this.tickOptions);t.isArray(u)?(g.value=u[0],this.breakPoints?u[0]==this.breakPoints[0]?(g.label=this.breakTickLabel,g._breakTick=!0,g.showGridline=!1,g.showMark=!1):u[0]>this.breakPoints[0]&&u[0]<=this.breakPoints[1]?(g.show=!1,g.showGridline=!1,g.label=u[1]):g.label=u[1]:g.label=u[1],g.setTick(u[0],this.name),this._ticks.push(g)):t.isPlainObject(u)?(t.extend(!0,g,u),g.axis=this.name,this._ticks.push(g)):(g.value=u,this.breakPoints&&(u==this.breakPoints[0]?(g.label=this.breakTickLabel,g._breakTick=!0,g.showGridline=!1,g.showMark=!1):u>this.breakPoints[0]&&u<=this.breakPoints[1]&&(g.show=!1,g.showGridline=!1)),g.setTick(u,this.name),this._ticks.push(g))}this.numberTicks=n.length,this.min=this._ticks[0].value,this.max=this._ticks[this.numberTicks-1].value,this.tickInterval=(this.max-this.min)/(this.numberTicks-1)}else{l="xaxis"==r||"x2axis"==r?this._plotDimensions.width:this._plotDimensions.height;var f=this.numberTicks;this.alignTicks&&("x2axis"===this.name&&e.axes.xaxis.show?f=e.axes.xaxis.numberTicks:"y"===this.name.charAt(0)&&"yaxis"!==this.name&&"yMidAxis"!==this.name&&e.axes.yaxis.show&&(f=e.axes.yaxis.numberTicks)),i=null!=this.min?this.min:o.min;var m,b,x=(a=null!=this.max?this.max:o.max)-i;if(null!=this.tickOptions&&this.tickOptions.formatString||(this._overrideFormatString=!0),null==this.min||null==this.max&&null==this.tickInterval&&!this.autoscale){this.forceTickAt0&&(i>0&&(i=0),0>a&&(a=0)),this.forceTickAt100&&(i>100&&(i=100),100>a&&(a=100));var v=!1,y=!1;null!=this.min?v=!0:null!=this.max&&(y=!0);var k=t.jqplot.LinearTickGenerator(i,a,this._scalefact,f,v,y),$=null!=this.min?i:i+x*(this.padMin-1),S=null!=this.max?a:a-x*(this.padMax-1);($>i||a>S)&&($=null!=this.min?i:i-x*(this.padMin-1),S=null!=this.max?a:a+x*(this.padMax-1),k=t.jqplot.LinearTickGenerator($,S,this._scalefact,f,v,y)),this.min=k[0],this.max=k[1],this.numberTicks=k[2],this._autoFormatString=k[3],this.tickInterval=k[4]}else{if(i==a){var w=.05;i>0&&(w=Math.max(Math.log(i)/Math.LN10,.05)),i-=w,a+=w}if(this.autoscale&&null==this.min&&null==this.max){for(var _,T,I,C=!1,D=!1,M=0;M<this._series.length;M++){var q=this._series[M],j="x"==q.fillAxis?q._xaxis.name:q._yaxis.name;if(this.name==j){for(var A=q._plotValues[q.fillAxis],F=A[0],R=A[0],P=1;P<A.length;P++)A[P]<F?F=A[P]:A[P]>R&&(R=A[P]);var O=(R-F)/R;q.renderer.constructor==t.jqplot.BarRenderer?F>=0&&(q.fillToZero||O>.1)?C=!0:(C=!1,D=!!(q.fill&&q.fillToZero&&0>F&&R>0)):q.fill?F>=0&&(q.fillToZero||O>.1)?C=!0:0>F&&R>0&&q.fillToZero?(C=!1,D=!0):(C=!1,D=!1):0>F&&(C=!1)}}if(C)this.numberTicks=2+Math.ceil((l-(this.tickSpacing-1))/this.tickSpacing),this.min=0,h=0,T=a/(this.numberTicks-1),B=Math.pow(10,Math.abs(Math.floor(Math.log(T)/Math.LN10))),T/B==parseInt(T/B,10)&&(T+=B),this.tickInterval=Math.ceil(T/B)*B,this.max=this.tickInterval*(this.numberTicks-1);else if(D){this.numberTicks=2+Math.ceil((l-(this.tickSpacing-1))/this.tickSpacing);var N=Math.ceil(Math.abs(i)/x*(this.numberTicks-1)),H=this.numberTicks-1-N;T=Math.max(Math.abs(i/N),Math.abs(a/H)),B=Math.pow(10,Math.abs(Math.floor(Math.log(T)/Math.LN10))),this.tickInterval=Math.ceil(T/B)*B,this.max=this.tickInterval*H,this.min=-this.tickInterval*N}else null==this.numberTicks&&(this.tickInterval?this.numberTicks=3+Math.ceil(x/this.tickInterval):this.numberTicks=2+Math.ceil((l-(this.tickSpacing-1))/this.tickSpacing)),null==this.tickInterval?(T=x/(this.numberTicks-1),B=1>T?Math.pow(10,Math.abs(Math.floor(Math.log(T)/Math.LN10))):1,this.tickInterval=Math.ceil(T*B*this.pad)/B):B=1/this.tickInterval,_=this.tickInterval*(this.numberTicks-1),I=(_-x)/2,null==this.min&&(this.min=Math.floor(B*(i-I))/B),null==this.max&&(this.max=this.min+_);if((L=t.jqplot.getSignificantFigures(this.tickInterval)).digitsLeft>=L.significantDigits)E="%d";else{var B=Math.max(0,5-L.digitsLeft);E="%."+(B=Math.min(B,L.digitsRight))+"f"}this._autoFormatString=E}else{var E,L;if(m=null!=this.min?this.min:i-x*(this.padMin-1),x=(b=null!=this.max?this.max:a+x*(this.padMax-1))-m,null==this.numberTicks&&(null!=this.tickInterval?this.numberTicks=Math.ceil((b-m)/this.tickInterval)+1:this.numberTicks=l>100?parseInt(3+(l-100)/75,10):2),null==this.tickInterval&&(this.tickInterval=x/(this.numberTicks-1)),null==this.max&&(b=m+this.tickInterval*(this.numberTicks-1)),null==this.min&&(m=b-this.tickInterval*(this.numberTicks-1)),(L=t.jqplot.getSignificantFigures(this.tickInterval)).digitsLeft>=L.significantDigits)E="%d";else{B=Math.max(0,5-L.digitsLeft);E="%."+(B=Math.min(B,L.digitsRight))+"f"}this._autoFormatString=E,this.min=m,this.max=b}if(this.renderer.constructor==t.jqplot.LinearAxisRenderer&&""==this._autoFormatString){x=this.max-this.min;var z,G=0;if(z=(z=new this.tickRenderer(this.tickOptions).formatString||t.jqplot.config.defaultTickFormatString).match(t.jqplot.sprintf.regex)[0]){if(z.search(/[fFeEgGpP]/)>-1){var W=z.match(/\%\.(\d{0,})?[eEfFgGpP]/);G=W?parseInt(W[1],10):6}else z.search(/[di]/)>-1&&(G=0);var Q=Math.pow(10,-G);if(this.tickInterval<Q&&null==c&&null==p)if(this.tickInterval=Q,null==d&&null==h){this.min=Math.floor(this._dataBounds.min/Q)*Q,this.min==this._dataBounds.min&&(this.min=this._dataBounds.min-this.tickInterval),this.max=Math.ceil(this._dataBounds.max/Q)*Q,this.max==this._dataBounds.max&&(this.max=this._dataBounds.max+this.tickInterval),U=(U=(this.max-this.min)/this.tickInterval).toFixed(11),U=Math.ceil(U),this.numberTicks=U+1}else if(null==d){U=(U=(this._dataBounds.max-this.min)/this.tickInterval).toFixed(11),this.numberTicks=Math.ceil(U)+2,this.max=this.min+this.tickInterval*(this.numberTicks-1)}else if(null==h){var U;U=(U=(this.max-this._dataBounds.min)/this.tickInterval).toFixed(11),this.numberTicks=Math.ceil(U)+2,this.min=this.max-this.tickInterval*(this.numberTicks-1)}else this.numberTicks=Math.ceil((d-h)/this.tickInterval)+1,this.min=Math.floor(h*Math.pow(10,G))/Math.pow(10,G),this.max=Math.ceil(d*Math.pow(10,G))/Math.pow(10,G),this.numberTicks=Math.ceil((this.max-this.min)/this.tickInterval)+1}}}this._overrideFormatString&&""!=this._autoFormatString&&(this.tickOptions=this.tickOptions||{},this.tickOptions.formatString=this._autoFormatString);var J;for(M=0;M<this.numberTicks;M++){if(s=this.min+M*this.tickInterval,(g=new this.tickRenderer(this.tickOptions)).setTick(s,this.name),this._ticks.push(g),M<this.numberTicks-1)for(P=0;P<this.minorTicks;P++)s+=this.tickInterval/(this.minorTicks+1),J=t.extend(!0,{},this.tickOptions,{name:this.name,value:s,label:"",isMinorTick:!0}),g=new this.tickRenderer(J),this._ticks.push(g);g=null}}this.tickInset&&(this.min=this.min-this.tickInset*this.tickInterval,this.max=this.max+this.tickInset*this.tickInterval)},t.jqplot.LinearAxisRenderer.prototype.resetTickValues=function(e){if(t.isArray(e)&&e.length==this._ticks.length){for(var i,a=0;a<e.length;a++)i=this._ticks[a],i.value=e[a],i.label=i.formatter(i.formatString,e[a]),i.label=i.prefix+i.label,i._elem.html(i.label);i=null,this.min=t.jqplot.arrayMin(e),this.max=t.jqplot.arrayMax(e),this.pack()}},t.jqplot.LinearAxisRenderer.prototype.pack=function(e,i){e=e||{},i=i||this._offsets;var a=this._ticks,s=this.max,n=this.min,r=i.max,o=i.min,l=null!=this._label&&this._label.show;for(var h in e)this._elem.css(h,e[h]);this._offsets=i;var d=r-o,c=s-n;if(this.breakPoints?(c=c-this.breakPoints[1]+this.breakPoints[0],this.p2u=function(t){return(t-o)*c/d+n},this.u2p=function(t){return t>this.breakPoints[0]&&t<this.breakPoints[1]&&(t=this.breakPoints[0]),t<=this.breakPoints[0]?(t-n)*d/c+o:(t-this.breakPoints[1]+this.breakPoints[0]-n)*d/c+o},"x"==this.name.charAt(0)?(this.series_u2p=function(t){return t>this.breakPoints[0]&&t<this.breakPoints[1]&&(t=this.breakPoints[0]),t<=this.breakPoints[0]?(t-n)*d/c:(t-this.breakPoints[1]+this.breakPoints[0]-n)*d/c},this.series_p2u=function(t){return t*c/d+n}):(this.series_u2p=function(t){return t>this.breakPoints[0]&&t<this.breakPoints[1]&&(t=this.breakPoints[0]),t>=this.breakPoints[1]?(t-s)*d/c:(t+this.breakPoints[1]-this.breakPoints[0]-s)*d/c},this.series_p2u=function(t){return t*c/d+s})):(this.p2u=function(t){return(t-o)*c/d+n},this.u2p=function(t){return(t-n)*d/c+o},"xaxis"==this.name||"x2axis"==this.name?(this.series_u2p=function(t){return(t-n)*d/c},this.series_p2u=function(t){return t*c/d+n}):(this.series_u2p=function(t){return(t-s)*d/c},this.series_p2u=function(t){return t*c/d+s})),this.show)if("xaxis"==this.name||"x2axis"==this.name){for(var p=0;p<a.length;p++){if((m=a[p]).show&&m.showLabel){if(m.constructor==t.jqplot.CanvasAxisTickRenderer&&m.angle){var u="xaxis"==this.name?1:-1;switch(m.labelPosition){case"auto":b=u*m.angle<0?-m.getWidth()+m._textRenderer.height*Math.sin(-m._textRenderer.angle)/2:-m._textRenderer.height*Math.sin(m._textRenderer.angle)/2;break;case"end":b=-m.getWidth()+m._textRenderer.height*Math.sin(-m._textRenderer.angle)/2;break;case"start":b=-m._textRenderer.height*Math.sin(m._textRenderer.angle)/2;break;case"middle":b=-m.getWidth()/2+m._textRenderer.height*Math.sin(-m._textRenderer.angle)/2;break;default:b=-m.getWidth()/2+m._textRenderer.height*Math.sin(-m._textRenderer.angle)/2}}else b=-m.getWidth()/2;var g=this.u2p(m.value)+b+"px";m._elem.css("left",g),m.pack()}}if(l){var f=this._label._elem.outerWidth(!0);this._label._elem.css("left",o+d/2-f/2+"px"),"xaxis"==this.name?this._label._elem.css("bottom","0px"):this._label._elem.css("top","0px"),this._label.pack()}}else{for(p=0;p<a.length;p++){var m;if((m=a[p]).show&&m.showLabel){var b;if(m.constructor==t.jqplot.CanvasAxisTickRenderer&&m.angle){u="yaxis"==this.name?1:-1;switch(m.labelPosition){case"auto":case"end":b=u*m.angle<0?-m._textRenderer.height*Math.cos(-m._textRenderer.angle)/2:-m.getHeight()+m._textRenderer.height*Math.cos(m._textRenderer.angle)/2;break;case"start":b=m.angle>0?-m._textRenderer.height*Math.cos(-m._textRenderer.angle)/2:-m.getHeight()+m._textRenderer.height*Math.cos(m._textRenderer.angle)/2;break;case"middle":b=-m.getHeight()/2;break;default:b=-m.getHeight()/2}}else b=-m.getHeight()/2;g=this.u2p(m.value)+b+"px";m._elem.css("top",g),m.pack()}}if(l){var x=this._label._elem.outerHeight(!0);this._label._elem.css("top",r-d/2-x/2+"px"),"yaxis"==this.name?this._label._elem.css("left","0px"):this._label._elem.css("right","0px"),this._label.pack()}}a=null},t.jqplot.LinearTickGenerator=function(e,i,a,s,n,r){if(n=null!==n&&n,r=null!==r&&!n&&r,e===i&&(i=i?0:1),a=a||1,e>i){var o=i;i=e,e=o}var l=[],h=k(i-e,a),d=t.jqplot.getSignificantFigures;if(null==s)if(n||r){if(n){l[0]=e,l[2]=Math.ceil((i-e)/h+1),l[1]=e+(l[2]-1)*h;var c=d(e).digitsRight,p=d(h).digitsRight;l[3]=p>c?v(h):"%."+c+"f",l[4]=h}else if(r){l[1]=i,l[2]=Math.ceil((i-e)/h+1),l[0]=i-(l[2]-1)*h;var u=d(i).digitsRight;p=d(h).digitsRight;l[3]=p>u?v(h):"%."+u+"f",l[4]=h}}else l[0]=Math.floor(e/h)*h,l[1]=Math.ceil(i/h)*h,l[2]=Math.round((l[1]-l[0])/h+1),l[3]=v(h),l[4]=h;else{var g=[];if(g[0]=Math.floor(e/h)*h,g[1]=Math.ceil(i/h)*h,g[2]=Math.round((g[1]-g[0])/h+1),g[3]=v(h),g[4]=h,g[2]===s)l=g;else{var f=y(g[1]-g[0],s);l[0]=g[0],l[2]=s,l[4]=f,l[3]=v(f),l[1]=l[0]+(l[2]-1)*l[4]}}return l},t.jqplot.LinearTickGenerator.bestLinearInterval=k,t.jqplot.LinearTickGenerator.bestInterval=y,t.jqplot.LinearTickGenerator.bestLinearComponents=function(t,e){var i,a=Math.floor(Math.log(t)/Math.LN10),s=Math.pow(10,a),n=t/s;return[(i=.38>=(n/=e)?.1:1.6>=n?.2:4>=n?.5:8>=n?1:16>=n?2:5)*s,i,s]},t.jqplot.LinearTickGenerator.bestConstrainedInterval=function(e,i,a){for(var s,n,r,o,l,h,d=Math.floor(a/2),c=Math.ceil(1.5*a),p=Number.MAX_VALUE,u=i-e,g=t.jqplot.getSignificantFigures,f=0,m=c-d+1;m>f;f++)l=d+f,s=u/(l-1),n=g(s),s=Math.abs(a-l)+n.digitsRight,p>s?(p=s,r=l,h=n.digitsRight):s===p&&n.digitsRight<h&&(r=l,h=n.digitsRight);return[e,i,r,0===(o=Math.max(h,Math.max(g(e).digitsRight,g(i).digitsRight)))?"%d":"%."+o+"f",s=u/(r-1)]},t.jqplot.MarkerRenderer=function(e){this.show=!0,this.style="filledCircle",this.lineWidth=2,this.size=9,this.color="#666666",this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1,this.shadowDepth=3,this.shadowAlpha="0.07",this.shadowRenderer=new t.jqplot.ShadowRenderer,this.shapeRenderer=new t.jqplot.ShapeRenderer,t.extend(!0,this,e)},t.jqplot.MarkerRenderer.prototype.init=function(e){t.extend(!0,this,e);var i={angle:this.shadowAngle,offset:this.shadowOffset,alpha:this.shadowAlpha,lineWidth:this.lineWidth,depth:this.shadowDepth,closePath:!0};-1!=this.style.indexOf("filled")&&(i.fill=!0),-1!=this.style.indexOf("ircle")&&(i.isarc=!0,i.closePath=!1),this.shadowRenderer.init(i);var a={fill:!1,isarc:!1,strokeStyle:this.color,fillStyle:this.color,lineWidth:this.lineWidth,closePath:!0};-1!=this.style.indexOf("filled")&&(a.fill=!0),-1!=this.style.indexOf("ircle")&&(a.isarc=!0,a.closePath=!1),this.shapeRenderer.init(a)},t.jqplot.MarkerRenderer.prototype.drawDiamond=function(t,e,i,a,s){var n=this.size/2/1.2,r=this.size/2*1.2,o=[[t-n,e],[t,e+r],[t+n,e],[t,e-r]];this.shadow&&this.shadowRenderer.draw(i,o),this.shapeRenderer.draw(i,o,s)},t.jqplot.MarkerRenderer.prototype.drawPlus=function(e,i,a,s,n){var r=this.size/2*1,o=this.size/2*1,l=[[e,i-o],[e,i+o]],h=[[e+r,i],[e-r,i]],d=t.extend(!0,{},this.options,{closePath:!1});this.shadow&&(this.shadowRenderer.draw(a,l,{closePath:!1}),this.shadowRenderer.draw(a,h,{closePath:!1})),this.shapeRenderer.draw(a,l,d),this.shapeRenderer.draw(a,h,d)},t.jqplot.MarkerRenderer.prototype.drawX=function(e,i,a,s,n){var r=this.size/2*1,o=this.size/2*1,l=t.extend(!0,{},this.options,{closePath:!1}),h=[[e-r,i-o],[e+r,i+o]],d=[[e-r,i+o],[e+r,i-o]];this.shadow&&(this.shadowRenderer.draw(a,h,{closePath:!1}),this.shadowRenderer.draw(a,d,{closePath:!1})),this.shapeRenderer.draw(a,h,l),this.shapeRenderer.draw(a,d,l)},t.jqplot.MarkerRenderer.prototype.drawDash=function(t,e,i,a,s){var n=this.size/2*1,r=(this.size,[[t-n,e],[t+n,e]]);this.shadow&&this.shadowRenderer.draw(i,r),this.shapeRenderer.draw(i,r,s)},t.jqplot.MarkerRenderer.prototype.drawLine=function(t,e,i,a,s){var n=[t,e];this.shadow&&this.shadowRenderer.draw(i,n),this.shapeRenderer.draw(i,n,s)},t.jqplot.MarkerRenderer.prototype.drawSquare=function(t,e,i,a,s){var n=this.size/2/1,r=this.size/2*1,o=[[t-n,e-r],[t-n,e+r],[t+n,e+r],[t+n,e-r]];this.shadow&&this.shadowRenderer.draw(i,o),this.shapeRenderer.draw(i,o,s)},t.jqplot.MarkerRenderer.prototype.drawCircle=function(t,e,i,a,s){var n=[t,e,this.size/2,0,2*Math.PI,!0];this.shadow&&this.shadowRenderer.draw(i,n),this.shapeRenderer.draw(i,n,s)},t.jqplot.MarkerRenderer.prototype.draw=function(t,e,i,a){if(null==(a=a||{}).show||0!=a.show)switch(a.color&&!a.fillStyle&&(a.fillStyle=a.color),a.color&&!a.strokeStyle&&(a.strokeStyle=a.color),this.style){case"diamond":this.drawDiamond(t,e,i,!1,a);break;case"filledDiamond":this.drawDiamond(t,e,i,!0,a);break;case"circle":this.drawCircle(t,e,i,!1,a);break;case"filledCircle":this.drawCircle(t,e,i,!0,a);break;case"square":this.drawSquare(t,e,i,!1,a);break;case"filledSquare":this.drawSquare(t,e,i,!0,a);break;case"x":this.drawX(t,e,i,!0,a);break;case"plus":this.drawPlus(t,e,i,!0,a);break;case"dash":this.drawDash(t,e,i,!0,a);break;case"line":this.drawLine(t,e,i,!1,a);break;default:this.drawDiamond(t,e,i,!1,a)}},t.jqplot.ShadowRenderer=function(e){this.angle=45,this.offset=1,this.alpha=.07,this.lineWidth=1.5,this.lineJoin="miter",this.lineCap="round",this.closePath=!1,this.fill=!1,this.depth=3,this.strokeStyle="rgba(0,0,0,0.1)",this.isarc=!1,t.extend(!0,this,e)},t.jqplot.ShadowRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.ShadowRenderer.prototype.draw=function(e,i,a){e.save();var s=null!=a?a:{},n=null!=s.fill?s.fill:this.fill,r=null!=s.fillRect?s.fillRect:this.fillRect,o=null!=s.closePath?s.closePath:this.closePath,l=null!=s.offset?s.offset:this.offset,h=null!=s.alpha?s.alpha:this.alpha,d=null!=s.depth?s.depth:this.depth,c=null!=s.isarc?s.isarc:this.isarc,p=null!=s.linePattern?s.linePattern:this.linePattern;e.lineWidth=null!=s.lineWidth?s.lineWidth:this.lineWidth,e.lineJoin=null!=s.lineJoin?s.lineJoin:this.lineJoin,e.lineCap=null!=s.lineCap?s.lineCap:this.lineCap,e.strokeStyle=s.strokeStyle||this.strokeStyle||"rgba(0,0,0,"+h+")",e.fillStyle=s.fillStyle||this.fillStyle||"rgba(0,0,0,"+h+")";for(var u=0;d>u;u++){var g=t.jqplot.LinePattern(e,p);if(e.translate(Math.cos(this.angle*Math.PI/180)*l,Math.sin(this.angle*Math.PI/180)*l),g.beginPath(),c)e.arc(i[0],i[1],i[2],i[3],i[4],!0);else if(r)r&&e.fillRect(i[0],i[1],i[2],i[3]);else if(i&&i.length)for(var f=!0,m=0;m<i.length;m++)null!=i[m][0]&&null!=i[m][1]?f?(g.moveTo(i[m][0],i[m][1]),f=!1):g.lineTo(i[m][0],i[m][1]):f=!0;o&&g.closePath(),n?e.fill():e.stroke()}e.restore()},t.jqplot.ShapeRenderer=function(e){this.lineWidth=1.5,this.linePattern="solid",this.lineJoin="miter",this.lineCap="round",this.closePath=!1,this.fill=!1,this.isarc=!1,this.fillRect=!1,this.strokeRect=!1,this.clearRect=!1,this.strokeStyle="#999999",this.fillStyle="#999999",t.extend(!0,this,e)},t.jqplot.ShapeRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.ShapeRenderer.prototype.draw=function(e,i,a){e.save();var s=null!=a?a:{},n=null!=s.fill?s.fill:this.fill,r=null!=s.closePath?s.closePath:this.closePath,o=null!=s.fillRect?s.fillRect:this.fillRect,l=null!=s.strokeRect?s.strokeRect:this.strokeRect,h=null!=s.clearRect?s.clearRect:this.clearRect,d=null!=s.isarc?s.isarc:this.isarc,c=null!=s.linePattern?s.linePattern:this.linePattern,p=t.jqplot.LinePattern(e,c);if(e.lineWidth=s.lineWidth||this.lineWidth,e.lineJoin=s.lineJoin||this.lineJoin,e.lineCap=s.lineCap||this.lineCap,e.strokeStyle=s.strokeStyle||s.color||this.strokeStyle,e.fillStyle=s.fillStyle||this.fillStyle,e.beginPath(),d)return e.arc(i[0],i[1],i[2],i[3],i[4],!0),r&&e.closePath(),n?e.fill():e.stroke(),void e.restore();if(h)return e.clearRect(i[0],i[1],i[2],i[3]),void e.restore();if(o||l){if(o&&e.fillRect(i[0],i[1],i[2],i[3]),l)return e.strokeRect(i[0],i[1],i[2],i[3]),void e.restore()}else if(i&&i.length){for(var u=!0,g=0;g<i.length;g++)null!=i[g][0]&&null!=i[g][1]?u?(p.moveTo(i[g][0],i[g][1]),u=!1):p.lineTo(i[g][0],i[g][1]):u=!0;r&&p.closePath(),n?e.fill():e.stroke()}e.restore()},t.jqplot.TableLegendRenderer=function(){},t.jqplot.TableLegendRenderer.prototype.init=function(e){t.extend(!0,this,e)},t.jqplot.TableLegendRenderer.prototype.addrow=function(e,i,a,s){var n,r,o,l,h,d=a?this.rowSpacing+"px":"0px";o=document.createElement("tr"),(n=t(o)).addClass("jqplot-table-legend"),o=null,s?n.prependTo(this._elem):n.appendTo(this._elem),this.showSwatches&&((r=t(document.createElement("td"))).addClass("jqplot-table-legend jqplot-table-legend-swatch"),r.css({textAlign:"center",paddingTop:d}),(l=t(document.createElement("div"))).addClass("jqplot-table-legend-swatch-outline"),(h=t(document.createElement("div"))).addClass("jqplot-table-legend-swatch"),h.css({backgroundColor:i,borderColor:i}),n.append(r.append(l.append(h)))),this.showLabels&&((r=t(document.createElement("td"))).addClass("jqplot-table-legend jqplot-table-legend-label"),r.css("paddingTop",d),n.append(r),this.escapeHtml?r.text(e):r.html(e)),r=null,l=null,h=null,n=null,o=null},t.jqplot.TableLegendRenderer.prototype.draw=function(){if(this._elem&&(this._elem.emptyForce(),this._elem=null),this.show){var e=this._series,i=document.createElement("table");this._elem=t(i),this._elem.addClass("jqplot-table-legend");var a={position:"absolute"};this.background&&(a.background=this.background),this.border&&(a.border=this.border),this.fontSize&&(a.fontSize=this.fontSize),this.fontFamily&&(a.fontFamily=this.fontFamily),this.textColor&&(a.textColor=this.textColor),null!=this.marginTop&&(a.marginTop=this.marginTop),null!=this.marginBottom&&(a.marginBottom=this.marginBottom),null!=this.marginLeft&&(a.marginLeft=this.marginLeft),null!=this.marginRight&&(a.marginRight=this.marginRight);for(var s,n=!1,r=!1,o=0;o<e.length;o++)if(s=e[o],(s._stack||s.renderer.constructor==t.jqplot.BezierCurveRenderer)&&(r=!0),s.show&&s.showLabel){var l=this.labels[o]||s.label.toString();if(l){var h=s.color;r&&o<e.length-1?n=!0:r&&o==e.length-1&&(n=!1),this.renderer.addrow.call(this,l,h,n,r),n=!0}for(var d=0;d<t.jqplot.addLegendRowHooks.length;d++){var c=t.jqplot.addLegendRowHooks[d].call(this,s);c&&(this.renderer.addrow.call(this,c.label,c.color,n),n=!0)}l=null}}return this._elem},t.jqplot.TableLegendRenderer.prototype.pack=function(t){if(this.show)if("insideGrid"==this.placement)switch(this.location){case"nw":var e=t.left,i=t.top;this._elem.css("left",e),this._elem.css("top",i);break;case"n":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2,i=t.top;this._elem.css("left",e),this._elem.css("top",i);break;case"ne":e=t.right,i=t.top;this._elem.css({right:e,top:i});break;case"e":e=t.right,i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({right:e,top:i});break;case"se":e=t.right,i=t.bottom;this._elem.css({right:e,bottom:i});break;case"s":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2,i=t.bottom;this._elem.css({left:e,bottom:i});break;case"sw":e=t.left,i=t.bottom;this._elem.css({left:e,bottom:i});break;case"w":e=t.left,i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({left:e,top:i});break;default:e=t.right,i=t.bottom;this._elem.css({right:e,bottom:i})}else if("outside"==this.placement)switch(this.location){case"nw":e=this._plotDimensions.width-t.left,i=t.top;this._elem.css("right",e),this._elem.css("top",i);break;case"n":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2,i=this._plotDimensions.height-t.top;this._elem.css("left",e),this._elem.css("bottom",i);break;case"ne":e=this._plotDimensions.width-t.right,i=t.top;this._elem.css({left:e,top:i});break;case"e":e=this._plotDimensions.width-t.right,i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({left:e,top:i});break;case"se":e=this._plotDimensions.width-t.right,i=t.bottom;this._elem.css({left:e,bottom:i});break;case"s":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2,i=this._plotDimensions.height-t.bottom;this._elem.css({left:e,top:i});break;case"sw":e=this._plotDimensions.width-t.left,i=t.bottom;this._elem.css({right:e,bottom:i});break;case"w":e=this._plotDimensions.width-t.left,i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({right:e,top:i});break;default:e=t.right,i=t.bottom;this._elem.css({right:e,bottom:i})}else switch(this.location){case"nw":this._elem.css({left:0,top:t.top});break;case"n":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2;this._elem.css({left:e,top:t.top});break;case"ne":this._elem.css({right:0,top:t.top});break;case"e":i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({right:t.right,top:i});break;case"se":this._elem.css({right:t.right,bottom:t.bottom});break;case"s":e=(t.left+(this._plotDimensions.width-t.right))/2-this.getWidth()/2;this._elem.css({left:e,bottom:t.bottom});break;case"sw":this._elem.css({left:t.left,bottom:t.bottom});break;case"w":i=(t.top+(this._plotDimensions.height-t.bottom))/2-this.getHeight()/2;this._elem.css({left:t.left,top:i});break;default:this._elem.css({right:t.right,bottom:t.bottom})}},t.jqplot.ThemeEngine=function(){this.themes={},this.activeTheme=null},t.jqplot.ThemeEngine.prototype.init=function(){var e,i,a,s,n,r,o=new t.jqplot.Theme({_name:"Default"});for(e in o.target)o.target[e]="textColor"==e?this.target.css("color"):this.target.css(e);if(this.title.show&&this.title._elem)for(e in o.title)o.title[e]="textColor"==e?this.title._elem.css("color"):this.title._elem.css(e);for(e in o.grid)o.grid[e]=this.grid[e];if(null==o.grid.backgroundColor&&null!=this.grid.background&&(o.grid.backgroundColor=this.grid.background),this.legend.show&&this.legend._elem)for(e in o.legend)o.legend[e]="textColor"==e?this.legend._elem.css("color"):this.legend._elem.css(e);for(i=0;i<this.series.length;i++){(s=this.series[i]).renderer.constructor==t.jqplot.LineRenderer?o.series.push(new j):s.renderer.constructor==t.jqplot.BarRenderer?o.series.push(new F):s.renderer.constructor==t.jqplot.PieRenderer?o.series.push(new R):s.renderer.constructor==t.jqplot.DonutRenderer?o.series.push(new P):s.renderer.constructor==t.jqplot.FunnelRenderer?o.series.push(new O):s.renderer.constructor==t.jqplot.MeterGaugeRenderer?o.series.push(new N):o.series.push({});for(e in o.series[i])o.series[i][e]=s[e]}for(e in this.axes){if(r=this.axes[e],(n=o.axes[e]=new D).borderColor=r.borderColor,n.borderWidth=r.borderWidth,r._ticks&&r._ticks[0])for(a in n.ticks)r._ticks[0].hasOwnProperty(a)?n.ticks[a]=r._ticks[0][a]:r._ticks[0]._elem&&(n.ticks[a]=r._ticks[0]._elem.css(a));if(r._label&&r._label.show)for(a in n.label)r._label[a]?n.label[a]=r._label[a]:r._label._elem&&(n.label[a]="textColor"==a?r._label._elem.css("color"):r._label._elem.css(a))}this.themeEngine._add(o),this.themeEngine.activeTheme=this.themeEngine.themes[o._name]},t.jqplot.ThemeEngine.prototype.get=function(t){return t?this.themes[t]:this.activeTheme},t.jqplot.ThemeEngine.prototype.getThemeNames=function(){var t=[];for(var e in this.themes)t.push(e);return t.sort($)},t.jqplot.ThemeEngine.prototype.getThemes=function(){var t=[],e=[];for(var i in this.themes)t.push(i);t.sort($);for(var a=0;a<t.length;a++)e.push(this.themes[t[a]]);return e},t.jqplot.ThemeEngine.prototype.activate=function(e,i){var a=!1;if(!i&&this.activeTheme&&this.activeTheme._name&&(i=this.activeTheme._name),!this.themes.hasOwnProperty(i))throw new Error("No theme of that name");var s=this.themes[i];this.activeTheme=s;var n,r,o=["xaxis","x2axis","yaxis","y2axis"];for(r=0;r<o.length;r++){var l=o[r];null!=s.axesStyles.borderColor&&(e.axes[l].borderColor=s.axesStyles.borderColor),null!=s.axesStyles.borderWidth&&(e.axes[l].borderWidth=s.axesStyles.borderWidth)}for(var h in e.axes){var d=e.axes[h];if(d.show){var c=s.axes[h]||{},p=s.axesStyles,u=t.jqplot.extend(!0,{},c,p);if(n=null!=s.axesStyles.borderColor?s.axesStyles.borderColor:u.borderColor,null!=u.borderColor&&(d.borderColor=u.borderColor,a=!0),n=null!=s.axesStyles.borderWidth?s.axesStyles.borderWidth:u.borderWidth,null!=u.borderWidth&&(d.borderWidth=u.borderWidth,a=!0),d._ticks&&d._ticks[0])for(var g in u.ticks)n=u.ticks[g],null!=n&&(d.tickOptions[g]=n,d._ticks=[],a=!0);if(d._label&&d._label.show)for(var g in u.label)n=u.label[g],null!=n&&(d.labelOptions[g]=n,a=!0)}}for(var f in s.grid)null!=s.grid[f]&&(e.grid[f]=s.grid[f]);if(a||e.grid.draw(),e.legend.show)for(f in s.legend)null!=s.legend[f]&&(e.legend[f]=s.legend[f]);if(e.title.show)for(f in s.title)null!=s.title[f]&&(e.title[f]=s.title[f]);for(r=0;r<s.series.length;r++){var m={};for(f in s.series[r])n=null!=s.seriesStyles[f]?s.seriesStyles[f]:s.series[r][f],null!=n&&(m[f]=n,"color"==f?(e.series[r].renderer.shapeRenderer.fillStyle=n,e.series[r].renderer.shapeRenderer.strokeStyle=n,e.series[r][f]=n):"lineWidth"==f||"linePattern"==f?(e.series[r].renderer.shapeRenderer[f]=n,e.series[r][f]=n):"markerOptions"==f?(w(e.series[r].markerOptions,n),w(e.series[r].markerRenderer,n)):e.series[r][f]=n,a=!0)}a&&(e.target.empty(),e.draw());for(f in s.target)null!=s.target[f]&&e.target.css(f,s.target[f])},t.jqplot.ThemeEngine.prototype._add=function(t,e){if(e&&(t._name=e),t._name||(t._name=Date.parse(new Date)),this.themes.hasOwnProperty(t._name))throw new Error("jqplot.ThemeEngine Error: Theme already in use");this.themes[t._name]=t},t.jqplot.ThemeEngine.prototype.remove=function(t){return"Default"!=t&&delete this.themes[t]},t.jqplot.ThemeEngine.prototype.newTheme=function(e,i){"object"==typeof e&&(i=i||e,e=null),e=i&&i._name?i._name:e||Date.parse(new Date);var a=this.copy(this.themes.Default._name,e);return t.jqplot.extend(a,i),a},t.jqplot.clone=S,t.jqplot.merge=w,t.jqplot.extend=function(){var e,i=arguments[0]||{},a=1,s=arguments.length,n=!1;for("boolean"==typeof i&&(n=i,i=arguments[1]||{},a=2),"object"!=typeof i&&"[object Function]"===!toString.call(i)&&(i={});s>a;a++)if(null!=(e=arguments[a]))for(var r in e){var o=i[r],l=e[r];i!==l&&(n&&l&&"object"==typeof l&&!l.nodeType?i[r]=t.jqplot.extend(n,o||(null!=l.length?[]:{}),l):l!==I&&(i[r]=l))}return i},t.jqplot.ThemeEngine.prototype.rename=function(t,e){if("Default"==t||"Default"==e)throw new Error("jqplot.ThemeEngine Error: Cannot rename from/to Default");if(this.themes.hasOwnProperty(e))throw new Error("jqplot.ThemeEngine Error: New name already in use.");if(this.themes.hasOwnProperty(t)){var i=this.copy(t,e);return this.remove(t),i}throw new Error("jqplot.ThemeEngine Error: Old name or new name invalid")},t.jqplot.ThemeEngine.prototype.copy=function(e,i,a){if("Default"==i)throw new Error("jqplot.ThemeEngine Error: Cannot copy over Default theme");if(!this.themes.hasOwnProperty(e)){var s="jqplot.ThemeEngine Error: Source name invalid";throw new Error(s)}if(this.themes.hasOwnProperty(i)){s="jqplot.ThemeEngine Error: Target name invalid";throw new Error(s)}var n=S(this.themes[e]);return n._name=i,t.jqplot.extend(!0,n,a),this._add(n),n},t.jqplot.Theme=function(e,i){"object"==typeof e&&(i=i||e,e=null),e=e||Date.parse(new Date),this._name=e,this.target={backgroundColor:null},this.legend={textColor:null,fontFamily:null,fontSize:null,border:null,background:null},this.title={textColor:null,fontFamily:null,fontSize:null,textAlign:null},this.seriesStyles={},this.series=[],this.grid={drawGridlines:null,gridLineColor:null,gridLineWidth:null,backgroundColor:null,borderColor:null,borderWidth:null,shadow:null},this.axesStyles={label:{},ticks:{}},this.axes={},"string"==typeof i?this._name=i:"object"==typeof i&&t.jqplot.extend(!0,this,i)};var D=function(){this.borderColor=null,this.borderWidth=null,this.ticks=new M,this.label=new q},M=function(){this.show=null,this.showGridline=null,this.showLabel=null,this.showMark=null,this.size=null,this.textColor=null,this.whiteSpace=null,this.fontSize=null,this.fontFamily=null},q=function(){this.textColor=null,this.whiteSpace=null,this.fontSize=null,this.fontFamily=null,this.fontWeight=null},j=function(){this.color=null,this.lineWidth=null,this.linePattern=null,this.shadow=null,this.fillColor=null,this.showMarker=null,this.markerOptions=new A},A=function(){this.show=null,this.style=null,this.lineWidth=null,this.size=null,this.color=null,this.shadow=null},F=function(){this.color=null,this.seriesColors=null,this.lineWidth=null,this.shadow=null,this.barPadding=null,this.barMargin=null,this.barWidth=null,this.highlightColors=null},R=function(){this.seriesColors=null,this.padding=null,this.sliceMargin=null,this.fill=null,this.shadow=null,this.startAngle=null,this.lineWidth=null,this.highlightColors=null},P=function(){this.seriesColors=null,this.padding=null,this.sliceMargin=null,this.fill=null,this.shadow=null,this.startAngle=null,this.lineWidth=null,this.innerDiameter=null,this.thickness=null,this.ringMargin=null,this.highlightColors=null},O=function(){this.color=null,this.lineWidth=null,this.shadow=null,this.padding=null,this.sectionMargin=null,this.seriesColors=null,this.highlightColors=null},N=function(){this.padding=null,this.backgroundColor=null,this.ringColor=null,this.tickColor=null,this.ringWidth=null,this.intervalColors=null,this.intervalInnerRadius=null,this.intervalOuterRadius=null,this.hubRadius=null,this.needleThickness=null,this.needlePad=null};t.fn.jqplotChildText=function(){return t(this).contents().filter(function(){return 3==this.nodeType}).text()},t.fn.jqplotGetComputedFontStyle=function(){for(var t=window.getComputedStyle?window.getComputedStyle(this[0],""):this[0].currentStyle,e=t["font-style"]?["font-style","font-weight","font-size","font-family"]:["fontStyle","fontWeight","fontSize","fontFamily"],i=[],a=0;a<e.length;++a){var s=String(t[e[a]]);s&&"normal"!=s&&i.push(s)}return i.join(" ")},t.fn.jqplotToImageCanvas=function(e){function i(e,i,a,s,n,r){for(var o=(b=e,x=void 0,x=parseInt(t(b).css("line-height"),10),isNaN(x)&&(x=1.2*parseInt(t(b).css("font-size"),10)),x),l=t(e).innerWidth(),h=(t(e).innerHeight(),a.split(/\s+/)),d=h.length,c="",p=[],u=n,g=s,f=0;d>f;f++)c+=h[f],i.measureText(c).width>l&&c.length>h[f].length&&(p.push(f),c="",f--);var b,x;if(0===p.length)"center"===t(e).css("textAlign")&&(g=s+(r-i.measureText(c).width)/2-m),i.fillText(a,g,n);else{c=h.slice(0,p[0]).join(" "),"center"===t(e).css("textAlign")&&(g=s+(r-i.measureText(c).width)/2-m),i.fillText(c,g,u),u+=o;f=1;for(var v=p.length;v>f;f++)c=h.slice(p[f-1],p[f]).join(" "),"center"===t(e).css("textAlign")&&(g=s+(r-i.measureText(c).width)/2-m),i.fillText(c,g,u),u+=o;c=h.slice(p[f-1],h.length).join(" "),"center"===t(e).css("textAlign")&&(g=s+(r-i.measureText(c).width)/2-m),i.fillText(c,g,u)}}var a=null==(e=e||{}).x_offset?0:e.x_offset,s=null==e.y_offset?0:e.y_offset,n=null==e.backgroundColor?"rgb(255,255,255)":e.backgroundColor;if(0==t(this).width()||0==t(this).height())return null;if(t.jqplot.use_excanvas)return null;for(var r,o,l,h,d=document.createElement("canvas"),c=t(this).outerHeight(!0),p=t(this).outerWidth(!0),u=t(this).offset(),g=u.left,f=u.top,m=0,b=0,x=["jqplot-table-legend","jqplot-xaxis-tick","jqplot-x2axis-tick","jqplot-yaxis-tick","jqplot-y2axis-tick","jqplot-y3axis-tick","jqplot-y4axis-tick","jqplot-y5axis-tick","jqplot-y6axis-tick","jqplot-y7axis-tick","jqplot-y8axis-tick","jqplot-y9axis-tick","jqplot-xaxis-label","jqplot-x2axis-label","jqplot-yaxis-label","jqplot-y2axis-label","jqplot-y3axis-label","jqplot-y4axis-label","jqplot-y5axis-label","jqplot-y6axis-label","jqplot-y7axis-label","jqplot-y8axis-label","jqplot-y9axis-label"],v=0;v<x.length;v++)t(this).find("."+x[v]).each(function(){r=t(this).offset().top-f,o=t(this).offset().left-g,h=o+t(this).outerWidth(!0)+m,l=r+t(this).outerHeight(!0)+b,-m>o&&(p=p-m-o,m=-o),-b>r&&(c=c-b-r,b=-r),h>p&&(p=h),l>c&&(c=l)});d.width=p+Number(a),d.height=c+Number(s);var y=d.getContext("2d");return y.save(),y.fillStyle=n,y.fillRect(0,0,d.width,d.height),y.restore(),y.translate(m,b),y.textAlign="left",y.textBaseline="top",t(this).children().each(function(){!function e(a,s,n){var r=a.tagName.toLowerCase(),o=t(a).position(),l=window.getComputedStyle?window.getComputedStyle(a,""):a.currentStyle,h=s+o.left+parseInt(l.marginLeft,10)+parseInt(l.borderLeftWidth,10)+parseInt(l.paddingLeft,10),c=n+o.top+parseInt(l.marginTop,10)+parseInt(l.borderTopWidth,10)+parseInt(l.paddingTop,10),p=d.width;if("div"!=r&&"span"!=r||t(a).hasClass("jqplot-highlighter-tooltip"))"table"===r&&t(a).hasClass("jqplot-table-legend")?(y.strokeStyle=t(a).css("border-top-color"),y.fillStyle=t(a).css("background-color"),y.fillRect(h,c,t(a).innerWidth(),t(a).innerHeight()),parseInt(t(a).css("border-top-width"),10)>0&&y.strokeRect(h,c,t(a).innerWidth(),t(a).innerHeight()),t(a).find("div.jqplot-table-legend-swatch-outline").each(function(){var e=t(this);y.strokeStyle=e.css("border-top-color");var i=h+e.position().left,a=c+e.position().top;y.strokeRect(i,a,e.innerWidth(),e.innerHeight()),i+=parseInt(e.css("padding-left"),10),a+=parseInt(e.css("padding-top"),10);var s=e.innerHeight()-2*parseInt(e.css("padding-top"),10),n=e.innerWidth()-2*parseInt(e.css("padding-left"),10),r=e.children("div.jqplot-table-legend-swatch");y.fillStyle=r.css("background-color"),y.fillRect(i,a,n,s)}),t(a).find("td.jqplot-table-legend-label").each(function(){var e=t(this),a=h+e.position().left,s=c+e.position().top+parseInt(e.css("padding-top"),10);y.font=e.jqplotGetComputedFontStyle(),y.fillStyle=e.css("color"),i(e,y,e.text(),a,s,p)})):"canvas"==r&&y.drawImage(a,h,c);else{t(a).children().each(function(){e(this,h,c)});var u=t(a).jqplotChildText();u&&(y.font=t(a).jqplotGetComputedFontStyle(),y.fillStyle=t(a).css("color"),i(a,y,u,h,c,p))}}(this,a,s)}),d},t.fn.jqplotToImageStr=function(e){var i=t(this).jqplotToImageCanvas(e);return i?i.toDataURL("image/png"):null},t.fn.jqplotToImageElem=function(e){var i=document.createElement("img"),a=t(this).jqplotToImageStr(e);return i.src=a,i},t.fn.jqplotToImageElemStr=function(e){return"<img src="+t(this).jqplotToImageStr(e)+" />"},t.fn.jqplotSaveImage=function(){var e=t(this).jqplotToImageStr({});e&&(window.location.href=e.replace("image/png","image/octet-stream"))},t.fn.jqplotViewImage=function(){var e=t(this).jqplotToImageElemStr({});if(t(this).jqplotToImageStr({}),e){var i=window.open("");i.document.open("image/png"),i.document.write(e),i.document.close(),i=null}};var H=function(){switch(this.syntax=H.config.syntax,this._type="jsDate",this.proxy=new Date,this.options={},this.locale=H.regional.getLocale(),this.formatString="",this.defaultCentury=H.config.defaultCentury,arguments.length){case 0:break;case 1:if("[object Object]"==T(arguments[0])&&"jsDate"!=arguments[0]._type){var t=this.options=arguments[0];this.syntax=t.syntax||this.syntax,this.defaultCentury=t.defaultCentury||this.defaultCentury,this.proxy=H.createDate(t.date)}else this.proxy=H.createDate(arguments[0]);break;default:for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i]);this.proxy=new Date,this.proxy.setFullYear.apply(this.proxy,e.slice(0,3)),e.slice(3).length&&this.proxy.setHours.apply(this.proxy,e.slice(3))}};H.config={defaultLocale:"en",syntax:"perl",defaultCentury:1900},H.prototype.add=function(t,e){var i=E[e]||E.day;return"number"==typeof i?this.proxy.setTime(this.proxy.getTime()+i*t):i.add(this,t),this},H.prototype.clone=function(){return new H(this.proxy.getTime())},H.prototype.getUtcOffset=function(){return 6e4*this.proxy.getTimezoneOffset()},H.prototype.diff=function(t,e,i){if(null===(t=new H(t)))return null;var a=E[e]||E.day;if("number"==typeof a)var s=(this.proxy.getTime()-t.proxy.getTime())/a;else s=a.diff(this.proxy,t.proxy);return i?s:Math[s>0?"floor":"ceil"](s)},H.prototype.getAbbrDayName=function(){return H.regional[this.locale].dayNamesShort[this.proxy.getDay()]},H.prototype.getAbbrMonthName=function(){return H.regional[this.locale].monthNamesShort[this.proxy.getMonth()]},H.prototype.getAMPM=function(){return this.proxy.getHours()>=12?"PM":"AM"},H.prototype.getAmPm=function(){return this.proxy.getHours()>=12?"pm":"am"},H.prototype.getCentury=function(){return parseInt(this.proxy.getFullYear()/100,10)},H.prototype.getDate=function(){return this.proxy.getDate()},H.prototype.getDay=function(){return this.proxy.getDay()},H.prototype.getDayOfWeek=function(){var t=this.proxy.getDay();return 0===t?7:t},H.prototype.getDayOfYear=function(){var t=this.proxy,e=t-new Date(t.getFullYear()+"/1/1 GMT");return e+=6e4*t.getTimezoneOffset(),t=null,parseInt(e/6e4/60/24,10)+1},H.prototype.getDayName=function(){return H.regional[this.locale].dayNames[this.proxy.getDay()]},H.prototype.getFullWeekOfYear=function(){var t=this.proxy,e=this.getDayOfYear(),i=6-t.getDay();return parseInt((e+i)/7,10)},H.prototype.getFullYear=function(){return this.proxy.getFullYear()},H.prototype.getGmtOffset=function(){var t=this.proxy.getTimezoneOffset()/60,e=0>t?"+":"-";return t=Math.abs(t),e+B(Math.floor(t),2)+":"+B(t%1*60,2)},H.prototype.getHours=function(){return this.proxy.getHours()},H.prototype.getHours12=function(){var t=this.proxy.getHours();return t>12?t-12:0==t?12:t},H.prototype.getIsoWeek=function(){var t=this.proxy,e=this.getWeekOfYear(),i=new Date(t.getFullYear()+"/1/1").getDay(),a=e+(i>4||1>=i?0:1);return 53==a&&new Date(t.getFullYear()+"/12/31").getDay()<4?a=1:0===a&&(a=(t=new H(new Date(t.getFullYear()-1+"/12/31"))).getIsoWeek()),t=null,a},H.prototype.getMilliseconds=function(){return this.proxy.getMilliseconds()},H.prototype.getMinutes=function(){return this.proxy.getMinutes()},H.prototype.getMonth=function(){return this.proxy.getMonth()},H.prototype.getMonthName=function(){return H.regional[this.locale].monthNames[this.proxy.getMonth()]},H.prototype.getMonthNumber=function(){return this.proxy.getMonth()+1},H.prototype.getSeconds=function(){return this.proxy.getSeconds()},H.prototype.getShortYear=function(){return this.proxy.getYear()%100},H.prototype.getTime=function(){return this.proxy.getTime()},H.prototype.getTimezoneAbbr=function(){return this.proxy.toString().replace(/^.*\(([^)]+)\)$/,"$1")},H.prototype.getTimezoneName=function(){var t=/(?:\((.+)\)$| ([A-Z]{3}) )/.exec(this.toString());return t[1]||t[2]||"GMT"+this.getGmtOffset()},H.prototype.getTimezoneOffset=function(){return this.proxy.getTimezoneOffset()},H.prototype.getWeekOfYear=function(){var t=this.getDayOfYear(),e=7-this.getDayOfWeek();return parseInt((t+e)/7,10)},H.prototype.getUnix=function(){return Math.round(this.proxy.getTime()/1e3,0)},H.prototype.getYear=function(){return this.proxy.getYear()},H.prototype.next=function(t){return t=t||"day",this.clone().add(1,t)},H.prototype.set=function(){switch(arguments.length){case 0:this.proxy=new Date;break;case 1:if("[object Object]"==T(arguments[0])&&"jsDate"!=arguments[0]._type){var t=this.options=arguments[0];this.syntax=t.syntax||this.syntax,this.defaultCentury=t.defaultCentury||this.defaultCentury,this.proxy=H.createDate(t.date)}else this.proxy=H.createDate(arguments[0]);break;default:for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i]);this.proxy=new Date,this.proxy.setFullYear.apply(this.proxy,e.slice(0,3)),e.slice(3).length&&this.proxy.setHours.apply(this.proxy,e.slice(3))}return this},H.prototype.setDate=function(t){return this.proxy.setDate(t),this},H.prototype.setFullYear=function(){return this.proxy.setFullYear.apply(this.proxy,arguments),this},H.prototype.setHours=function(){return this.proxy.setHours.apply(this.proxy,arguments),this},H.prototype.setMilliseconds=function(t){return this.proxy.setMilliseconds(t),this},H.prototype.setMinutes=function(){return this.proxy.setMinutes.apply(this.proxy,arguments),this},H.prototype.setMonth=function(){return this.proxy.setMonth.apply(this.proxy,arguments),this},H.prototype.setSeconds=function(){return this.proxy.setSeconds.apply(this.proxy,arguments),this},H.prototype.setTime=function(t){return this.proxy.setTime(t),this},H.prototype.setYear=function(){return this.proxy.setYear.apply(this.proxy,arguments),this},H.prototype.strftime=function(t){return t=t||this.formatString||H.regional[this.locale].formatString,H.strftime(this,t,this.syntax)},H.prototype.toString=function(){return this.proxy.toString()},H.prototype.toYmdInt=function(){return 1e4*this.proxy.getFullYear()+100*this.getMonthNumber()+this.proxy.getDate()},H.regional={en:{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],formatString:"%Y-%m-%d %H:%M:%S"},fr:{monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],formatString:"%Y-%m-%d %H:%M:%S"},de:{monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],formatString:"%Y-%m-%d %H:%M:%S"},es:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S&aacute;bado"],dayNamesShort:["Dom","Lun","Mar","Mi&eacute;","Juv","Vie","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},ru:{monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],formatString:"%Y-%m-%d %H:%M:%S"},ar:{monthNames:["كانون الثاني","شباط","آذار","نيسان","آذار","حزيران","تموز","آب","أيلول","تشرين الأول","تشرين الثاني","كانون الأول"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"],dayNamesShort:["سبت","أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة"],formatString:"%Y-%m-%d %H:%M:%S"},pt:{monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S&aacute;bado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},"pt-BR":{monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S&aacute;bado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},pl:{monthNames:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],monthNamesShort:["Sty","Lut","Mar","Kwi","Maj","Cze","Lip","Sie","Wrz","Paź","Lis","Gru"],dayNames:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],dayNamesShort:["Ni","Pn","Wt","Śr","Cz","Pt","Sb"],formatString:"%Y-%m-%d %H:%M:%S"},nl:{monthNames:["Januari","Februari","Maart","April","Mei","Juni","July","Augustus","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:",".Zaterdag,dayNamesShort:["Zo","Ma","Di","Wo","Do","Vr","Za"],formatString:"%Y-%m-%d %H:%M:%S"},sv:{monthNames:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],monthNamesShort:["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],dayNames:["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],dayNamesShort:["sön","mån","tis","ons","tor","fre","lör"],formatString:"%Y-%m-%d %H:%M:%S"},it:{monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedi","Martedi","Mercoledi","Giovedi","Venerdi","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],formatString:"%d-%m-%Y %H:%M:%S"}},H.regional["en-US"]=H.regional["en-GB"]=H.regional.en,H.regional.getLocale=function(){var t=H.config.defaultLocale;return document&&document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang&&(t=document.getElementsByTagName("html")[0].lang,H.regional.hasOwnProperty(t)||(t=H.config.defaultLocale)),t};var B=function(t,e){var i=e-(t=String(t)).length;return String(Math.pow(10,i)).slice(1).concat(t)},E={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:{add:function(t,e){E.year.add(t,Math[e>0?"floor":"ceil"](e/12));var i=t.getMonth()+e%12;12==i?(i=0,t.setYear(t.getFullYear()+1)):-1==i&&(i=11,t.setYear(t.getFullYear()-1)),t.setMonth(i)},diff:function(t,e){var i=t.getFullYear()-e.getFullYear();return t.getMonth()-e.getMonth()+12*i+(t.getDate()-e.getDate())/30}},year:{add:function(t,e){t.setYear(t.getFullYear()+Math[e>0?"floor":"ceil"](e))},diff:function(t,e){return E.month.diff(t,e)/12}}};for(var L in E)"s"!=L.substring(L.length-1)&&(E[L+"s"]=E[L]);var z=function(t,e,i){if(H.formats[i].shortcuts[e])return H.strftime(t,H.formats[i].shortcuts[e],i);var a=(H.formats[i].codes[e]||"").split("."),s=t["get"+a[0]]?t["get"+a[0]]():"";return a[1]&&(s=B(s,a[1])),s};H.strftime=function(t,e,i,a){var s="perl",n=H.regional.getLocale();i&&H.formats.hasOwnProperty(i)?s=i:i&&H.regional.hasOwnProperty(i)&&(n=i),a&&H.formats.hasOwnProperty(a)?s=a:a&&H.regional.hasOwnProperty(a)&&(n=a),("[object Object]"!=T(t)||"jsDate"!=t._type)&&((t=new H(t)).locale=n),e||(e=t.formatString||H.regional[n].formatString);for(var r,o=e||"%Y-%m-%d",l="";o.length>0;)(r=o.match(H.formats[s].codes.matcher))?(l+=o.slice(0,r.index),l+=(r[1]||"")+z(t,r[2],s),o=o.slice(r.index+r[0].length)):(l+=o,o="");return l},H.formats={ISO:"%Y-%m-%dT%H:%M:%S.%N%G",SQL:"%Y-%m-%d %H:%M:%S"},H.formats.perl={codes:{matcher:/()%(#?(%|[a-z]))/i,Y:"FullYear",y:"ShortYear.2",m:"MonthNumber.2","#m":"MonthNumber",B:"MonthName",b:"AbbrMonthName",d:"Date.2","#d":"Date",e:"Date",A:"DayName",a:"AbbrDayName",w:"Day",H:"Hours.2","#H":"Hours",I:"Hours12.2","#I":"Hours12",p:"AMPM",M:"Minutes.2","#M":"Minutes",S:"Seconds.2","#S":"Seconds",s:"Unix",N:"Milliseconds.3","#N":"Milliseconds",O:"TimezoneOffset",Z:"TimezoneName",G:"GmtOffset"},shortcuts:{F:"%Y-%m-%d",T:"%H:%M:%S",X:"%H:%M:%S",x:"%m/%d/%y",D:"%m/%d/%y","#c":"%a %b %e %H:%M:%S %Y",v:"%e-%b-%Y",R:"%H:%M",r:"%I:%M:%S %p",t:"\t",n:"\n","%":"%"}},H.formats.php={codes:{matcher:/()%((%|[a-z]))/i,a:"AbbrDayName",A:"DayName",d:"Date.2",e:"Date",j:"DayOfYear.3",u:"DayOfWeek",w:"Day",U:"FullWeekOfYear.2",V:"IsoWeek.2",W:"WeekOfYear.2",b:"AbbrMonthName",B:"MonthName",m:"MonthNumber.2",h:"AbbrMonthName",C:"Century.2",y:"ShortYear.2",Y:"FullYear",H:"Hours.2",I:"Hours12.2",l:"Hours12",p:"AMPM",P:"AmPm",M:"Minutes.2",S:"Seconds.2",s:"Unix",O:"TimezoneOffset",z:"GmtOffset",Z:"TimezoneAbbr"},shortcuts:{D:"%m/%d/%y",F:"%Y-%m-%d",T:"%H:%M:%S",X:"%H:%M:%S",x:"%m/%d/%y",R:"%H:%M",r:"%I:%M:%S %p",t:"\t",n:"\n","%":"%"}},H.createDate=function(t){function e(t,e){var i,a,s,n,r=parseFloat(e[1]),o=parseFloat(e[2]),l=parseFloat(e[3]),h=H.config.defaultCentury;return r>31?(a=l,s=o,i=h+r):(a=o,s=r,i=h+l),n=s+"/"+a+"/"+i,t.replace(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})/,n)}if(null==t)return new Date;if(t instanceof Date)return t;if("number"==typeof t)return new Date(t);var i,a=String(t).replace(/^\s*(.+)\s*$/g,"$1");if((i=(a=(a=a.replace(/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,4})/,"$1/$2/$3")).replace(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{4})/i,"$1 $2 $3")).match(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{2})\D*/i))&&i.length>3){var s=parseFloat(i[3]),n=H.config.defaultCentury+s;n=String(n),a=a.replace(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{2})\D*/i,i[1]+" "+i[2]+" "+n)}(i=a.match(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})[^0-9]/))&&i.length>3&&(a=e(a,i)),(i=a.match(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})$/))&&i.length>3&&(a=e(a,i));for(var r,o,l,h=0,d=H.matchers.length,c=a;d>h;){if(o=Date.parse(c),!isNaN(o))return new Date(o);if("function"==typeof(r=H.matchers[h])){if((l=r.call(H,c))instanceof Date)return l}else c=a.replace(r[0],r[1]);h++}return NaN},H.daysInMonth=function(t,e){return 2==e?29==new Date(t,1,29).getDate()?29:28:[I,31,I,31,30,31,30,31,31,30,31,30,31][e]},H.matchers=[[/(3[01]|[0-2]\d)\s*\.\s*(1[0-2]|0\d)\s*\.\s*([1-9]\d{3})/,"$2/$1/$3"],[/([1-9]\d{3})\s*-\s*(1[0-2]|0\d)\s*-\s*(3[01]|[0-2]\d)/,"$2/$3/$1"],function(t){var e=t.match(/^(?:(.+)\s+)?([012]?\d)(?:\s*\:\s*(\d\d))?(?:\s*\:\s*(\d\d(\.\d*)?))?\s*(am|pm)?\s*$/i);if(e){if(e[1]){var i=this.createDate(e[1]);if(isNaN(i))return}else{(i=new Date).setMilliseconds(0)}var a=parseFloat(e[2]);return e[6]&&(a="am"==e[6].toLowerCase()?12==a?0:a:12==a?12:a+12),i.setHours(a,parseInt(e[3]||0,10),parseInt(e[4]||0,10),1e3*(parseFloat(e[5]||0)||0)),i}return t},function(t){var e=t.match(/^(?:(.+))[T|\s+]([012]\d)(?:\:(\d\d))(?:\:(\d\d))(?:\.\d+)([\+\-]\d\d\:\d\d)$/i);if(e){if(e[1]){var i=this.createDate(e[1]);if(isNaN(i))return}else{(i=new Date).setMilliseconds(0)}var a=parseFloat(e[2]);return i.setHours(a,parseInt(e[3],10),parseInt(e[4],10),1e3*parseFloat(e[5])),i}return t},function(t){var e=t.match(/^([0-3]?\d)\s*[-\/.\s]{1}\s*([a-zA-Z]{3,9})\s*[-\/.\s]{1}\s*([0-3]?\d)$/);if(e){var i,a,s,n=new Date,r=H.config.defaultCentury,o=parseFloat(e[1]),l=parseFloat(e[3]);return o>31?(a=l,i=r+o):(a=o,i=r+l),-1==(s=_(e[2],H.regional[H.regional.getLocale()].monthNamesShort))&&(s=_(e[2],H.regional[H.regional.getLocale()].monthNames)),n.setFullYear(i,s,a),n.setHours(0,0,0,0),n}return t}],t.jsDate=H,t.jqplot.sprintf=function(){function e(t,e,i,a){var s=t.length>=e?"":Array(1+e-t.length>>>0).join(i);return a?t+s:s+t}function i(e){for(var i=new String(e),a=10;a>0&&i!=(i=i.replace(/^(\d+)(\d{3})/,"$1"+t.jqplot.sprintf.thousandsSeparator+"$2"));a--);return i}function a(t,i,a,s,n,r){var o=s-t.length;if(o>0){var l=" ";r&&(l="&nbsp;"),t=a||!n?e(t,s,l,a):t.slice(0,i.length)+e("",o,"0",!0)+t.slice(i.length)}return t}function s(t,i,s,n,r,o,l,h){var d=t>>>0;return a(t=(s=s&&d&&{2:"0b",8:"0",16:"0x"}[i]||"")+e(d.toString(i),o||0,"0",!1),s,n,r,l,h)}function n(t,e,i,s,n,r){return null!=s&&(t=t.slice(0,s)),a(t,"",e,i,n,r)}var r=arguments,o=0;return r[o++].replace(t.jqplot.sprintf.regex,function(l,h,d,c,p,u,g){if("%%"==l)return"%";for(var f=!1,m="",b=!1,x=!1,v=!1,y=!1,k=0;d&&k<d.length;k++)switch(d.charAt(k)){case" ":m=" ";break;case"+":m="+";break;case"-":f=!0;break;case"0":b=!0;break;case"#":x=!0;break;case"&":v=!0;break;case"'":y=!0}if(0>(c=c?"*"==c?+r[o++]:"*"==c.charAt(0)?+r[c.slice(1,-1)]:+c:0)&&(c=-c,f=!0),!isFinite(c))throw new Error("$.jqplot.sprintf: (minimum-)width must be finite");u=u?"*"==u?+r[o++]:"*"==u.charAt(0)?+r[u.slice(1,-1)]:+u:"fFeE".indexOf(g)>-1?6:"d"==g?0:void 0;var $=h?r[h.slice(0,-1)]:r[o++];switch(g){case"s":return null==$?"":n(String($),f,c,u,b,v);case"c":return n(String.fromCharCode(+$),f,c,u,b,v);case"b":return s($,2,x,f,c,u,b,v);case"o":return s($,8,x,f,c,u,b,v);case"x":return s($,16,x,f,c,u,b,v);case"X":return s($,16,x,f,c,u,b,v).toUpperCase();case"u":return s($,10,x,f,c,u,b,v);case"i":var S=parseInt(+$,10);return isNaN(S)?"":a($=(w=0>S?"-":m)+e(y?i(String(Math.abs(S))):String(Math.abs(S)),u,"0",!1),w,f,c,b,v);case"d":S=Math.round(+$);return isNaN(S)?"":a($=(w=0>S?"-":m)+e(y?i(String(Math.abs(S))):String(Math.abs(S)),u,"0",!1),w,f,c,b,v);case"e":case"E":case"f":case"F":case"g":case"G":S=+$;if(isNaN(S))return"";var w=0>S?"-":m,_=["toExponential","toFixed","toPrecision"]["efg".indexOf(g.toLowerCase())],T=["toString","toUpperCase"]["eEfFgG".indexOf(g)%2];return(I=Math.abs(S)[_](u).toString().split("."))[0]=y?i(I[0]):I[0],a($=w+I.join(t.jqplot.sprintf.decimalMark),w,f,c,b,v)[T]();case"p":case"P":S=+$;if(isNaN(S))return"";w=0>S?"-":m;var I,C=-1!=(I=String(Number(Math.abs(S)).toExponential()).split(/e|E/))[0].indexOf(".")?I[0].length-1:String(S).length,D=I[1]<0?-I[1]-1:0;if(Math.abs(S)<1)$=u>=C+D?w+Math.abs(S).toPrecision(C):u-1>=C?w+Math.abs(S).toExponential(C-1):w+Math.abs(S).toExponential(u-1);else{var M=u>=C?C:u;$=w+Math.abs(S).toPrecision(M)}T=["toString","toUpperCase"]["pP".indexOf(g)%2];return a($,w,f,c,b,v)[T]();case"n":return"";default:return l}})},t.jqplot.sprintf.thousandsSeparator=",",t.jqplot.sprintf.decimalMark=".",t.jqplot.sprintf.regex=/%%|%(\d+\$)?([-+#0&\' ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([nAscboxXuidfegpEGP])/g,t.jqplot.getSignificantFigures=function(t){var e=String(Number(Math.abs(t)).toExponential()).split(/e|E/),i=-1!=e[0].indexOf(".")?e[0].length-1:e[0].length,a=e[1]<0?-e[1]-1:0,s=parseInt(e[1],10),n=s+1>0?s+1:0;return{significantDigits:i,digitsLeft:n,digitsRight:n>=i?0:i-s-1,zeros:a,exponent:s}},t.jqplot.getPrecision=function(e){return t.jqplot.getSignificantFigures(e).digitsRight};var G=!1!==t.uiBackCompat;t.jqplot.effects={effect:{}};var W="jqplot.storage.";t.extend(t.jqplot.effects,{version:"1.9pre",save:function(t,e){for(var i=0;i<e.length;i++)null!==e[i]&&t.data(W+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i=0;i<e.length;i++)null!==e[i]&&t.css(e[i],t.data(W+e[i]))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},a=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),s={width:e.width(),height:e.height()},n=document.activeElement;return e.wrap(a),(e[0]===n||t.contains(e[0],n))&&t(n).focus(),a=e.parent(),"static"===e.css("position")?(a.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,a){i[a]=e.css(a),isNaN(parseInt(i[a],10))&&(i[a]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(s),a.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e}}),t.fn.extend({jqplotEffect:function(e,i,a,s){function n(e){function i(){t.isFunction(s)&&s.call(a[0]),t.isFunction(e)&&e()}var a=t(this),s=r.complete,n=r.mode;(a.is(":hidden")?"hide"===n:"show"===n)?i():h.call(a[0],r,i)}var r=function(e,i,a,s){return t.isPlainObject(e)?e:(e={effect:e},i===I&&(i={}),t.isFunction(i)&&(s=i,a=null,i={}),("number"===t.type(i)||t.fx.speeds[i])&&(s=a,a=i,i={}),t.isFunction(a)&&(s=a,a=null),i&&t.extend(e,i),a=a||i.duration,e.duration=t.fx.off?0:"number"==typeof a?a:a in t.fx.speeds?t.fx.speeds[a]:t.fx.speeds._default,e.complete=s||i.complete,e)}.apply(this,arguments),o=r.mode,l=r.queue,h=t.jqplot.effects.effect[r.effect],d=!h&&G&&t.jqplot.effects[r.effect];return t.fx.off||!h&&!d?o?this[o](r.duration,r.complete):this.each(function(){r.complete&&r.complete.call(this)}):h?!1===l?this.each(n):this.queue(l||"fx",n):d.call(this,{options:r,duration:r.duration,callback:r.complete,mode:r.mode})}});var Q=/up|down|vertical/,U=/up|left|vertical|horizontal/;t.jqplot.effects.effect.blind=function(e,i){var a,s,n,r=t(this),o=["position","top","bottom","left","right","height","width"],l=t.jqplot.effects.setMode(r,e.mode||"hide"),h=e.direction||"up",d=Q.test(h),c=d?"height":"width",p=d?"top":"left",u=U.test(h),g={},f="show"===l;r.parent().is(".ui-effects-wrapper")?t.jqplot.effects.save(r.parent(),o):t.jqplot.effects.save(r,o),r.show(),n=parseInt(r.css("top"),10),a=t.jqplot.effects.createWrapper(r).css({overflow:"hidden"}),s=d?a[c]()+n:a[c](),g[c]=f?String(s):"0",u||(r.css(d?"bottom":"right",0).css(d?"top":"left","").css({position:"absolute"}),g[p]=f?"0":String(s)),f&&(a.css(c,0),u||a.css(p,s)),a.animate(g,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===l&&r.hide(),t.jqplot.effects.restore(r,o),t.jqplot.effects.removeWrapper(r),i()}})}}(jQuery);