// ==UserScript==
// @name         e-sim助手
// @namespace    esim
// @version      2.5.7.6-release
// @description  e-sim增强功能，本版本为功能测试版，使用中可能会出现问题，如果影响正常使用可以换回之前版本。
// @author       E-sim插件开发组
// @match        http://*.e-sim.org/*
// @match        https://*.e-sim.org/*
// @require      http://cdn.e-sim.org/js/jquery-1.8.3.min.js
// @grant        GM_setClipboard
// @grant        GM_addStyle
// @grant        unsafewindow
// ==/UserScript==

// 前排提醒：如果你发现网页显示有问题，请先自行尝试 Ctrl+F5 刷新，如果问题依旧再来向开发组求助
// 前排提醒：如果战场输出或补充体力时出现404错误，请删除cookies并重新登录（chrome可以进入 chrome://settings/siteData 搜索服务器名，点▶进去，除了本地存储和数据库存储外全删）
// 前排提醒：如果你需要在游戏内截图并分享给国外玩家，请先关闭esim插件再截图

// 招人：E-sim插件开发组长期招收程序设计、编写、测试、优化、女装人员，要求：是活人就行
// 插件开发群：462288323 ，各位大佬进来拿插件也行呀

// ChangeLog
// 2.5.7.5：修正已知bug：初次使用插件加载国家失败、战场页原打枪按钮未绑定插件功能；预置最近输出；
// 2.5.7版本：发送战况到discord；简单的自动攻击；战斗显示网络错误信息；战场页终止请求；战斗方国旗修正；特殊道具页快捷菜单；在线玩家页增强功能；装备属性刷新和升级提示；请求超时设定；一些细节改进；
// 2.5.6版本：删除语音闹钟功能；修正国旗问题（请不要再使用其他修正国旗错位插件）；预约战场；快捷站点；个人消耗统计；记录玩家暴击和免体buff；修正战场飞行结果判断问题；一些优化和改进；
// 2.5.5版本：紧凑式战场界面；战场列表筛选、复制战场信息、显示T5时间；分解确认；观战列表点击国家可以查看在线玩家；在线玩家详细信息；存储战场飞行设置；替换会员原观战框；
// 2.5.4版本：添加显示全部战场功能；添加战场消耗统计功能；战场飞行可以在原网页刷新攻击框；攻击返回404时切换协议；战场飞行显示机票数量；应对profile界面更改；一些优化和改进；更新jqplot
// 2.5.3版本：插件内所有后生成的国旗均使用新国旗样式；更改本地加成地区判断；添加对联盟成员国的显示；添加桌面通知战场提醒；给闹钟加音效（大文件会有延迟）；上调“直接使用医疗包”按钮位置；修正Kekistan的国家缩写；战场界面功能框下移；会员上移观战框；修正一些小问题；稍微更改界面；
// 2.5.2版本：修正非起义战的防守方本地加成地区；添加国旗选择列的清空和锁定功能；添加战场中无需确认使用医疗包的功能；战场页面修改网页标题
// 2.5.1版本：修正从2.4.8版本以来因页面样式更新导致的各种功能失效的问题；添加显示货币市场玩家国籍的功能；在战场推测观战玩家中添加根据联盟分类玩家的功能；添加隐藏首页左上角提醒框的功能
//------------2.4.8及之前版本开发者：c*******, z*****，之后版本均由E-sim插件开发组维护------------

var ajaxs=[];var oldAjaxOrigin=unsafeWindow.$.ajax;var oldAjaxScript=$.ajax;unsafeWindow.$.ajax=function(){var b=Array.prototype.slice.call(arguments);var c=oldAjaxOrigin.apply(this,b);ajaxs.push(c);return c};$.ajax=function(){var b=Array.prototype.slice.call(arguments);var c=oldAjaxScript.apply(this,b);ajaxs.push(c);return c};function abortAll(){$.each(ajaxs,function(b,c){c.abort()});ajaxs=[]}
/*! jquery.livequery - v1.3.6 - 2013-08-26
 * Copyright (c)
 *  (c) 2010, Brandon Aaron (http://brandonaaron.net)
 *  (c) 2012 - 2013, Alexander Zaytsev (http://hazzik.ru/en)
 * Dual licensed under the MIT (MIT_LICENSE.txt)
 * and GPL Version 2 (GPL_LICENSE.txt) licenses.
 */
!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?b(require("jquery")):b(jQuery)}(function(f,e){function h(l,k,n,m){return !(l.selector!=k.selector||l.context!=k.context||n&&n.$lqguid!=k.fn.$lqguid||m&&m.$lqguid!=k.fn2.$lqguid)}f.extend(f.fn,{livequery:function(c,l){var k,d=this;return f.each(g.queries,function(b,m){return h(d,m,c,l)?(k=m)&&!1:void 0}),k=k||new g(d.selector,d.context,c,l),k.stopped=!1,k.run(),d},expire:function(c,k){var d=this;return f.each(g.queries,function(b,l){h(d,l,c,k)&&!d.stopped&&g.stop(l.id)}),d}});var g=f.livequery=function(d,n,m,l){var k=this;return k.selector=d,k.context=n,k.fn=m,k.fn2=l,k.elements=f([]),k.stopped=!1,k.id=g.queries.push(k)-1,m.$lqguid=m.$lqguid||g.guid++,l&&(l.$lqguid=l.$lqguid||g.guid++),k};g.prototype={stop:function(){var c=this;c.stopped||(c.fn2&&c.elements.each(c.fn2),c.elements=f([]),c.stopped=!0)},run:function(){var k=this;if(!k.stopped){var o=k.elements,n=f(k.selector,k.context),m=n.not(o),l=o.not(n);k.elements=n,m.each(k.fn),k.fn2&&l.each(k.fn2)}}},f.extend(g,{guid:0,queries:[],queue:[],running:!1,timeout:null,registered:[],checkQueue:function(){if(g.running&&g.queue.length){for(var b=g.queue.length;b--;){g.queries[g.queue.shift()].run()}}},pause:function(){g.running=!1},play:function(){g.running=!0,g.run()},registerPlugin:function(){f.each(arguments,function(d,l){if(f.fn[l]&&!(f.inArray(l,g.registered)>0)){var k=f.fn[l];f.fn[l]=function(){var b=k.apply(this,arguments);return g.run(),b},g.registered.push(l)}})},run:function(b){b!==e?f.inArray(b,g.queue)<0&&g.queue.push(b):f.each(g.queries,function(c){f.inArray(c,g.queue)<0&&g.queue.push(c)}),g.timeout&&clearTimeout(g.timeout),g.timeout=setTimeout(g.checkQueue,20)},stop:function(b){b!==e?g.queries[b].stop():f.each(g.queries,g.prototype.stop)}}),g.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html","prop","removeProp"),f(function(){g.play()})});main();function main(){if(location.pathname=="/maintenance.html"){setTimeout(function(){location.pathname="/index.html"},10000);return}if($(".time").length!==2){console.log("未登录，e-sim助手停止运行");return}if($(".time:first").text().match(/-/g).length!=2){console.log("官方脚本还未执行，e-sim助手等待0.5秒");setTimeout(main,500);return}if($("#ehIcon2").length>0){console.log("已运行e-sim助手");return}fetchMap();enhanceCountrySelect();addIcon();fetchMe();enhanceQuickButton();enhanceCurrency();quickSite();fixFlagInline();if(document.URL.search("html")!=-1){var b=document.URL.match("/([a-zA-Z0-9]+).html")[1];document.title="e-Sim - "+location.host.split(".")[0]+" - "+b;switch(b){case"index":hideFrontPagePushQuestion();break;case"profile":var c=parseInt(document.URL.match("/profile.html[?]id=([0-9]+)")[1]);updateOneCitizenPage(c,$("body"));enhanceProfile(c);break;case"citizensOnline":enhanceCitizensOnline();break;case"militaryUnitCompanies":case"companies":enhanceMilitaryUnitCompanies();break;case"myMilitaryUnit":case"militaryUnit":enhanceMyMilitaryUnit();break;case"statistics":enhanceStatistics();break;case"storage":enhanceStorage();break;case"monetaryMarket":updateCurrencyRatio($("body"));ShowPlayerCitizenship();break;case"battle":enhanceBattle();break;case"battles":preEnhanceBattleList();break;case"battleStatistics":enhanceBattleStatistics();break;case"showEquipment":equipmentUpgradeHelper();break;case"companyAllWorkers":returnToCompanyPage();break;default:console.log(b);break}}else{hideFrontPagePushQuestion()}}function hideFrontPagePushQuestion(){var b=$("#frontPagePushQuestion");if(b.length>0){b.hide()}}function fixFlagInline(){GM_addStyle(".xflagsSmall{display:inline-block;vertical-align:bottom;margin:1px!important;padding:0!important;} .xflagsMedium{display:inline-block;} .xflagsBig{display:inline-block;} ")}function getCountryFormXflagsClass(d){try{var b=d.split(" ")[1];return b.substring(b.indexOf("-")+1)}catch(c){return"未知"}}function getEpoch(){return parseInt($("#time2").text())}function getEpochFromString(g,b){var e=b.split(":");var c=g.split("-");var f=new Date(c[2],parseInt(c[1])-1,c[0],e[0],e[1],e[2],0);return Date.parse(f)}function isEpochOutdated(c,d){var b=getEpoch();if(b-c<d*1000){return false}return true}function isObjectOutdated(b,c){if(b&&"date" in b){return isEpochOutdated(b.date,c)}return true}function isLocalStorageOutdated(b,d){var c=JSON.parse(localStorage.getItem(b));return isObjectOutdated(c,d)}function setUpdatedDate(b){b.date=getEpoch()}function epochToTime(f){var g=parseInt(f/(24*3600*1000));f-=g*24*3600*1000;var e=parseInt(f/(3600*1000));f-=e*3600*1000;var b=parseInt(f/(60*1000));var c="";if(g>0){c+=g+"d"}if(e>0){c+=e+"h"}if(b>0){c+=b+"m"}return c?c:"0m"}function epochToTime2(f){var g=parseInt(f/(24*3600*1000));f-=g*24*3600*1000;var e=parseInt(f/(3600*1000));f-=e*3600*1000;var b=parseInt(f/(60*1000));var c="";if(g>0){c=g+"d"}else{if(e>0){c=e+"h"}else{if(b>0){c=b+"m"}else{c="0m"}}}return c}function addCheckBoxSettingFrame(k,h,d,e,c){var g=$("<input>",{type:"checkbox",id:h});var f=$("<label>",{"class":"checkboxlabel","for":h,text:d});var b=localStorage.getItem(e);if(b===null){localStorage.setItem(e,c);g.attr("checked",c=="true")}else{g.attr("checked",b=="true")}k.append(g,f);g.click(function(){if(g.is(":checked")){localStorage.setItem(e,true)}else{localStorage.setItem(e,false)}})}function addSelectSettingFrame(g,m,h,b,c,k){var e=$("<p>",{style:"padding:3px; margin:3px",text:m});var f=$("<select>",{style:"padding:3px; margin:3px",id:c}).appendTo(e);for(var d=0;d<h.length;d++){$("<option>",{value:h[d],text:b[d]}).appendTo(f)}var l=localStorage.getItem(c);if(l===null){localStorage.setItem(c,k);f.val(k)}else{f.val(l)}g.append(e);f.change(function(){localStorage.setItem(c,f.val())})}function addTextboxSettingFrame(f,e,d,c){var g=$("<input>",{type:"text",id:d,style:"vertical-align:5px;width:"+e+"px;"}).appendTo(f);var b=localStorage.getItem(d);if(b===null){localStorage.setItem(d,c);g.val(c)}else{g.val(b)}f.append(g);g.focus(function(){g.css("background-color","#FFFFFF")});g.blur(function(){if(g.val()===""){g.val(c)}g.css("background-color","#79FF79");localStorage.setItem(d,g.val())})}function addIcon(){config={};allies=JSON.parse(localStorage.getItem("allies"));enemies=JSON.parse(localStorage.getItem("enemies"));if(allies===null||enemies===null){allies=[];enemies=[]}coalitionMembers=JSON.parse(localStorage.getItem("coalitionMembers"));if(coalitionMembers===null){coalitionMembers=[]}currencyRatio=JSON.parse(localStorage.getItem("currencyRatio"));currencyRatio=currencyRatio===null?{}:currencyRatio;topCountryIds=JSON.parse(localStorage.getItem("topCountryIds"));topCountryIds=topCountryIds===null?[]:topCountryIds;var n=$("<li>",{id:"ehIcon2"}).insertBefore($("#userAvatar"));var y=$("<a>",{"data-dropdown":"contentDropEh",style:"padding:0 5px;",href:"#"}).appendTo(n);var z=$("<img>",{align:"absmiddle","class":"smallAvatar",style:"height:36px; width:36px;",src:"https://suna.e-sim.org:3000/avatars/140351_small"}).appendTo(y);var m=$("#contentDrop").clone().attr("id","contentDropEh").empty().insertBefore($("#contentDrop"));$("<b>",{text:"e-sim助手 版本 "+GM_info.script.version+" "}).appendTo(m);$("<div>",{style:"text-align:left;line-height:30px;",text:"使用此脚本造成的一切后果（包括但不限于封号、经济损失）与作者无关"}).appendTo(m);var u=$("<table>",{id:"Eh2Config",style:"width:100%;"}).appendTo(m);var d=$("<tr>",{style:"line-height:30px;"}).appendTo(u);var h;var p=[["fetchCurrency","统计汇率 ","统计汇率和常用物资的价格",["currencyRatio","topCountryIds"],"扫描大国"],["fetchCitizen","统计玩家 ","估算玩家buff时间等",["citizenInfo","citizenPage","muInfo"],"扫描本页"]];for(var s=0;s<p.length;++s){h=$("<td>",{style:"text-align:left; background-color:SlateGray;"}).appendTo(d);var l=$("<label>",{"class":"checkboxlabel","for":p[s][0]+"Checkbox",text:p[s][1]}).appendTo(h);var o=$("<input>",{id:p[s][0]+"Checkbox",type:"checkbox",style:"vertical-align:5px;",text:" "}).prependTo(l);var c=$("<button>",{id:p[s][0]+"ClearButton","class":"foundation-style",style:"padding:5px; margin:5px",target:p[s][3].join(" "),text:"清除"}).appendTo(h);var w=$("<button>",{id:p[s][0]+"Scan","class":"foundation-style",style:"padding:5px; margin:5px",text:p[s][4]}).appendTo(h);o.click(function(){var b=$(this).attr("id")+"Disabled";if($(this).is(":checked")){localStorage.removeItem(b)}else{localStorage.setItem(b,"1")}});if(localStorage.getItem(p[s][0]+"CheckboxDisabled")){config[p[s][0]+"Disabled"]=true;o.attr("checked",false)}else{config[p[s][0]+"Disabled"]=false;o.attr("checked",true)}c.click(function(){var b=$(this).attr("target").split(" ");for(var A=0;A<b.length;++A){console.log("清除",b[A]);localStorage.removeItem(b[A])}})}if(config.fetchCitizenDisabled){$("#fetchCitizenScan").hide()}else{$("#fetchCitizenScan").click(function(){$(this).attr("disabled",true);var b=[];$("a[href*='profile.html'").each(function(){var B=parseInt($(this).attr("href").match(/profile\.html[?]id=([0-9]+)/)[1]);if($.inArray(B,b)===-1){b.push(B)}});var A=b.length;$(this).text("剩余"+A+"个");$.each(b,function(B,C){$.ajax({url:"profile.html?id="+C,success:function(D){if($(".time",D).length!==2){console.log(C,"抓取错误，重新抓取");$.ajax(this);return}updateOneCitizenPage(C,D);$("#fetchCitizenScan").text("剩余"+(--A)+"个");if(A==0){$("#fetchCitizenScan").text("扫描完成")}},error:function(D,E){console.log("抓取错误 (",E,")，重新抓取");$.ajax(this)},})})})}u=$("<table>",{style:"width:100%; text-align:left;"}).insertBefore($("#Eh2Config"));d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>",{id:"Eh2Homeland",text:"祖国: "}).appendTo(d);var q=$("<select>",{style:"padding:3px; margin:3px",id:"Eh2HomelandSelect"}).appendTo(h);for(var s=0;s<countryIds.length;++s){$("<option>",{value:countryIds[s],text:countryInfo[countryIds[s]].name}).appendTo(q)}var f=$("option",q).sort(function(B,A){return $(B).text().localeCompare($(A).text())});q.html(f);q.change(r);var v=$("<button>",{id:"refreshAlliesAndEnemies","class":"foundation-style",style:"padding:5px; margin:5px",text:"更新盟国和敌国"}).appendTo(h);v.click(r);d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>",{text:"盟国: "}).appendTo(d);var x=$("<b>",{id:"Eh2Allies",text:"更新中..."}).appendTo(h);d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>",{text:"敌国: "}).appendTo(d);x=$("<b>",{id:"Eh2Enemies",text:"更新中..."}).appendTo(h);d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>",{text:"联盟成员国: "}).appendTo(d);x=$("<b>",{id:"Eh2CoalitionMembers",text:"更新中..."}).appendTo(h);if(allies.length===0){q[0].selectedIndex=0;r()}else{q.val(allies[0]);e()}function r(){var b=parseInt(q.val());q.attr("disabled",true);v.attr("disabled",true);$("~ div.xflagsSmall",q).remove();$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[b].flagName,style:"vertical-align:middle;",value:b,title:countryInfo[b].name}).insertAfter(q);console.log("正在更新"+countryInfo[b].name+"的盟国和敌国信息");allies=[b,];enemies=[];coalitionMembers=[];$("#Eh2Allies").html("更新中...");$("#Eh2Enemies").html("更新中...");$("#Eh2CoalitionMembers").html("更新中...");$.ajax({url:"countryPoliticalStatistics.html?countryId="+b,success:function(F){var E=$("div.xflagsMedium",$("table.dataTable:last",F));E.each(function(){var H=$(this);var G=H.attr("class").split(" ").pop();G=G.substring(G.indexOf("-")+1);allies.push(countryInfo[G].id)});var C=$("div.xflagsMedium",$("table.dataTable:eq(-2)",F));C.each(function(){var H=$(this);var G=getCountryFormXflagsClass(H.attr("class"));if(countryInfo[G].id!==b){enemies.push(countryInfo[G].id)}});var B=$("h2",F);var D;if(B.length>4){D=B[2]}else{D=B[1]}if(D.innerText.split(" ")[0]=="Coalition"){var A=$(D,F).nextAll("div.xflagsSmall");A.each(function(){var G=$(this).attr("class").split(" ").pop();G=G.substring(G.indexOf("-")+1);coalitionMembers.push(countryInfo[G].id)})}localStorage.setItem("allies",JSON.stringify(allies));localStorage.setItem("enemies",JSON.stringify(enemies));localStorage.setItem("coalitionMembers",JSON.stringify(coalitionMembers));e();q.attr("disabled",false);v.attr("disabled",false)},error:function(A,B){console.log("抓取错误 (",B,")，重新抓取");$.ajax(this)},})}function e(){$("~ div.xflagsSmall",q).remove();$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[allies[0]].flagName,style:"vertical-align:middle;",value:allies[0],title:countryInfo[allies[0]].name}).insertAfter(q);$("#Eh2Allies").text("");$("#Eh2Enemies").text("");$("#Eh2CoalitionMembers").text("");for(var b=1;b<allies.length;++b){countryId=allies[b];$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2Allies"))}for(var b=0;b<enemies.length;++b){countryId=enemies[b];$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2Enemies"))}for(var b=0;b<coalitionMembers.length;++b){countryId=coalitionMembers[b];$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[countryId].flagName,style:"vertical-align:middle;",title:countryInfo[countryId].name}).appendTo($("#Eh2CoalitionMembers"))}}if(config.fetchCurrencyDisabled){$("#fetchCurrencyScan").hide()}else{var u=$("<table>",{id:"Eh2CurrencyRatios",style:"width:100%;"}).appendTo(m);if(topCountryIds.length===0){console.log("查看人口和生产力前5的国家");$.ajax({url:"countryStatistics.html?statisticType=PRODUCTIVITY",success:function(b){$("div.xflagsMedium:lt(5)",b).each(function(){var A=$(this).attr("class").split(" ").pop();A=A.substring(A.indexOf("-")+1);topCountryIds.push(A)});if(topCountryIds.length===10){g()}},error:function(b,A){console.log("抓取错误 (",A,")，重新抓取");$.ajax(this)},});$.ajax({url:"countryStatistics.html?statisticType=CITIZENS",success:function(b){$("div.xflagsMedium:lt(5)",b).each(function(){var A=$(this).attr("class").split(" ").pop();A=A.substring(A.indexOf("-")+1);topCountryIds.push(A)});if(topCountryIds.length===10){g()}},error:function(b,A){console.log(name,"抓取错误 (",A,")，重新抓取");$.ajax(this)},})}else{g()}}function g(){if(config.fetchCurrencyDisabled){return}var L=[parseInt($("#Eh2HomelandSelect").val())];for(var C=0;C<topCountryIds.length;++C){if(topCountryIds[C]&&countryInfo[topCountryIds[C]]){var A=countryInfo[topCountryIds[C]].id;if($.inArray(A,L)===-1){L.push(A)}}}topCountryIds=L;localStorage.setItem("topCountryIds",JSON.stringify(topCountryIds));u=$("#Eh2CurrencyRatios");u.empty();var G=$("<tr>",{style:"line-height:30px;"}).appendTo(u);var b=$("<td>",{style:"background-color:DarkSlateGray;",text:"货币"}).appendTo(G);var B=$("<tr>",{style:"line-height:30px;"}).appendTo(u);var K=$("<td>",{style:"background-color:DarkSlateGray;",html:"买 1<div class='xflagsSmall xflagsSmall-Gold' style='vertical-align:middle;' />"}).appendTo(B);var F=$("<tr>",{style:"line-height:30px;"}).appendTo(u);var E=$("<td>",{style:"background-color:DarkSlateGray;",html:"卖 1<div class='xflagsSmall xflagsSmall-Gold' style='vertical-align:middle;' />"}).appendTo(F);for(var C=0;C<topCountryIds.length;++C){var I=topCountryIds[C];var J=b.clone().text("").insertAfter(b);$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[I].flagName,style:"vertical-align:middle;"}).appendTo(J);J=K.clone().text("").insertAfter(K);var H=$("<a>",{href:"monetaryMarket.html?buyerCurrencyId=0&sellerCurrencyId="+I,text:"???"}).appendTo(J);if(currencyRatio[I]!==undefined&&currencyRatio[I].sell!==undefined){H.html(""+parseFloat(currencyRatio[I].sell.ratio).toFixed(2)).after($("<div>",{style:"font-size:10px;",text:epochToTime2(getEpoch()-currencyRatio[I].sell.date)}))}J=E.clone().text("").insertAfter(E);H=$("<a>",{href:"monetaryMarket.html?buyerCurrencyId="+I+"&sellerCurrencyId=0",text:"???"}).appendTo(J);if(currencyRatio[I]!==undefined&&currencyRatio[I].buy!==undefined){H.html(""+parseFloat(currencyRatio[I].buy.ratio).toFixed(2)).after($("<div>",{style:"font-size:10px;",text:epochToTime2(getEpoch()-currencyRatio[I].buy.date)}))}}var D=$("#fetchCurrencyScan");D.click(function(){var M=$("a",$("#Eh2CurrencyRatios")).length;$(this).attr("disabled",true).text("剩余"+M+"个");$("a",$("#Eh2CurrencyRatios")).each(function(){$.ajax({url:$(this).attr("href"),success:function(N){if($(".time",N).length!==2){console.log("汇率抓取错误，重新抓取");$.ajax(this);return}updateCurrencyRatio(N);D.text("剩余"+(--M)+"个");if(M===0){$("#fetchCurrencyScan").text("扫描完成");g()}},error:function(N,O){console.log("抓取错误 (",O,")，重新抓取");$.ajax(this)},})})})}u=$("<table>",{style:"width:100%; text-align:left;"}).insertBefore($("#Eh2Config"));d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>",{id:"FavoriteCountriesConfig"}).appendTo(d);var k=$("<button>",{id:"clearFavoriteCountries","class":"foundation-style",style:"padding:5px; margin:5px",text:"清空国旗选择列"}).appendTo(h);k.click(function(){$(this).attr("disabled",true);localStorage.removeItem("favoriteCountries")});addCheckBoxSettingFrame(h,"lockFavoriteCountries","锁定国旗选择列","lockFavoriteCountries",false);d=$("<tr>",{style:"background-color:DarkSlateGray;line-height:30px;"}).appendTo(u);h=$("<td>").appendTo(d);var t=$("<button>",{id:"btnBattleSettings","class":"foundation-style",style:"padding:5px; margin:5px",text:"战场设置"}).appendTo(h);t.click(function(){t.attr({disabled:true});createSettingWindow()});varEnableBattleAjaxTimeout=localStorage.getItem("enableBattleAjaxTimeout");if(varEnableBattleAjaxTimeout!="true"){varEnableBattleAjaxTimeout=false}else{varEnableBattleAjaxTimeout=true}varBattleAjaxTimeout=parseInt(localStorage.getItem("battleAjaxTimeout"));if(varBattleAjaxTimeout<0){varBattleAjaxTimeout=5}return}function ShowPlayerCitizenship(){var d=$("table.dataTable:first");var b=$("<div class='testDivblue'></div>");d.before(b);var e=$("<table></table>");b.append(e);var c=$("<input type='button' id='gcbtn' value='检查卖家国籍'></input> ");e.append(c);e.append("检查需要等待一段时间");$("#gcbtn").click(function(){b.remove();var f=$("a.profileLink");for(var g=1;g<f.length;g++){ShowPlayerCitizenshipAjax(f[g])}})}function ShowPlayerCitizenshipAjax(c){var b=$(c).attr("href").split("=")[1];$.ajax({url:"apiCitizenById.html?id="+b,success:function(e){var f=JSON.parse(e);console.log("用户",b,"API抓取成功");var d=f.citizenshipId;$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[d].flagName,style:"vertical-align:middle;"}).insertBefore(c)},error:function(d,e){console.log("用户",b,"API抓取错误 (",e,")，重新抓取");$.ajax(this)},})}function GetQueryString(b){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)");var d=window.location.search.substr(1).match(c);if(d!=null){return unescape(d[2])}return null}function enhanceStorage(){var b=GetQueryString("storageType");if(b=="EQUIPMENT"){preEnhanceEquipment()}else{if(b=="SPECIAL_ITEM"||b=="SPECIAL_ITEMS"){updateBuffTime();enhanceSpecialItem()}}}function preEnhanceEquipment(){var c=$("#mergeItem");var e=$("<input type='button' style='display:inline-block;' id='eeqbtn' value='自定义拍卖'></input> ");e.prependTo(c);$("#eeqbtn").click(function(){enhanceEquipment();$("#eeqbtn").attr({disabled:true});$("#eeqbtn").remove()});var d=$("<div>",{id:"confirmSplitTable",style:"display:inline-block;"});e.after(d);var b=$("<input>",{type:"checkbox",id:"confirmSplitCheckbox"}).appendTo(d);var f=$("<label>",{"class":"checkboxlabel","for":"confirmSplitCheckbox",text:"分解前确认"}).appendTo(d);var g=localStorage.getItem("confirmSplit");if(g!==null){b.attr("checked",g=="true");if(g==="true"){$(".foundation-style.button.splitItemsButton").parent().attr("onSubmit","return confirm('确定要分解吗？')")}}b.click(function(){if(b.is(":checked")){localStorage.setItem("confirmSplit",true)}else{localStorage.setItem("confirmSplit",false)}location=location})}function enhanceStatistics(){var b=GetQueryString("selectedSite");if(b=="MILITARY_UNIT"){enhanceMilitaryUnitStatistics()}}function fetchMap(){countryIds=JSON.parse(localStorage.getItem("countryIds"));countryInfo=JSON.parse(localStorage.getItem("countryInfo"));regionInfo=JSON.parse(localStorage.getItem("regionInfo"));muInfo=JSON.parse(localStorage.getItem("muInfo"))||{};var h=[["apiCountries.html",3600*24],["apiRegions.html",3600*24],["apiMap.html",600]];var c=h.length;for(var g=0;g<h.length;++g){var f=h[g][0];var k=h[g][1];var e=localStorage.getItem(f+".date");if(isEpochOutdated(e,k)){d(f)}else{c--}}function d(l){$.ajax({url:l,success:function(m){localStorage.setItem(l,m);localStorage.setItem(l+".date",getEpoch());console.log(l,"抓取成功");if(--c===0){b()}},error:function(m,n){console.log(l,"抓取错误 (",n,")，重新抓取",l);$.ajax(this)},})}function b(){countryInfo={};countryIds=[];var p=JSON.parse(localStorage.getItem("apiCountries.html"));for(var o=0;o<p.length;++o){var n=p[o];n.flagName=n.name.replace(/ /g,"-");countryIds.push(n.id);countryInfo[n.id]=n;countryInfo[n.name]=n;countryInfo[n.shortName]=n;countryInfo[n.flagName]=n;countryInfo[n.currencyName]=n}regionInfo=[];var m=JSON.parse(localStorage.getItem("apiMap.html"));var l=JSON.parse(localStorage.getItem("apiRegions.html"));for(o=0;o<m.length;++o){regionInfo[m[o].regionId]=m[o]}for(o=0;o<l.length;++o){var s=l[o].id;for(var r in l[o]){regionInfo[s][r]=l[o][r]}}var q={};for(var o=0;o<regionInfo.length;++o){var n=regionInfo[o];if(n){q[n.id]=n;q[n.name]=n}}localStorage.setItem("countryIds",JSON.stringify(countryIds));localStorage.setItem("countryInfo",JSON.stringify(countryInfo));localStorage.setItem("regionInfo",JSON.stringify(q));localStorage.setItem("maxRegionCount",regionInfo.length);console.log("国家和地图信息已更新")}}function fetchMe(){var b=$("a[href^='profile.html']",$("#userAvatar")).attr("href");userId=parseInt(b.replace("profile.html?id=",""));citizenInfo=JSON.parse(localStorage.getItem("citizenInfo"));if(citizenInfo===null){citizenInfo={}}citizenPage=JSON.parse(localStorage.getItem("citizenPage"));if(citizenPage===null){citizenPage={}}fetchAndUpdateOneCitizenInfo(userId);fetchAndUpdateOneCitizenPage(userId)}function UpdateOneCitizenInfo(c,b){if(config.fetchCitizenDisabled&&c.id!==userId){return}if(b===undefined){b=true}console.log("玩家",c.id,"(",c.login,") API已更新");setUpdatedDate(c);citizenInfo[c.id]=c;if(b){localStorage.setItem("citizenInfo",JSON.stringify(citizenInfo))}}function fetchAndUpdateOneCitizenInfo(d,c){if(config.fetchCitizenDisabled&&d!==userId){return}var b=citizenInfo[d];if(b!==undefined&&!isObjectOutdated(b,600)){return}$.ajax({url:"apiCitizenById.html?id="+d,success:function(e){var f=JSON.parse(e);UpdateOneCitizenInfo(f,c)},error:function(e,f){console.log("用户",d,"API抓取错误 (",f,")，重新抓取");$.ajax(this)},})}function updateOneCitizenPage(e,h,d){if(config.fetchCitizenDisabled&&e!==userId){return}if($("#indexShortcut",h).length===0){return}if(d===undefined){d=true}console.log("玩家",e,"(",$(".big-login",h).text(),")页面已更新");page=citizenPage[e];if(page===undefined){page={}}page.avatar=$(".bigAvatar",h).attr("src").trim();page.premium=$("img[src$='star_32.png']",h).length==1;page.buffIcons=[];$("img[src$='_positive.png']",h).each(function(){if($(this).attr("class")!="smallhelp"){return true}if(page.buffIcons.indexOf(this)==-1){page.buffIcons.push($(this).attr("src"))}});page.debuffIcons=[];$("img[src$='_negative.png']",h).each(function(){if($(this).attr("class")!="smallhelp"){return true}if(page.debuffIcons.indexOf(this)==-1){page.debuffIcons.push($(this).attr("src"))}});var c=getEpoch();var l=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"];var k=[24,24,24,24,1,10,25,24,24,24];for(var g=0;g<l.length;++g){$.each(page.buffIcons,function(){if(this.indexOf(l[g])>0){b(l[g],c-k[g]*3600*1000,c)}});$.each(page.debuffIcons,function(){if(this.indexOf(l[g])>0){if(page.premium){b(l[g],c-k[g]*2*3600*1000,c-k[g]*3600*1000)}else{b(l[g],c-k[g]*3*3600*1000,c-k[g]*3600*1000)}}});if(page[l[g]]===undefined){page[l[g]]=[c,c+1000*24*3600*1000]}}function b(p,r,n){if(page[p]===undefined){page[p]=[r,n]}else{var q=page[p][0]>r?page[p][0]:r;var o=page[p][1]<n?page[p][1]:n;if(q>o){page[p]=[r,n]}else{page[p]=[q,o]}}}var f=[];$(".equipmentBack",h).each(function(){if($(this).attr("class").indexOf("rewardEQ")<0){f.push($(this).attr("class").split(" ").pop())}});page.equipments=f;var m=$("div.rank :eq(0)",h).parent().children("div.profile-row:eq(7)").children("span.data");if(m.length!=0){page.lowHit=parseInt($("div#hitHelp",h).text().split("/")[0].replace(",",""));page.highHit=parseInt($("div#hitHelp",h).text().split("/")[1].replace(",",""));page.critical=parseFloat($("#criticalHelp",h).text().trim().split(" ")[0]);page.miss=parseFloat($("#missHelp",h).text().trim().split(" ")[0]);page.avoid=parseFloat($("#avoidHelp",h).text().trim().split(" ")[0]);page.power=parseInt((page.lowHit+page.highHit)/2*(1-page.miss/100)*(1+page.critical/100)/(1-page.avoid/100)*37*5*1.2*1.2*1.2);page.strength=parseInt($("div.rank :eq(0)",h).parent().children("div.profile-row:eq(4)").children("span.data").text());page.totalDamage=parseInt($("div.rank :eq(0)",h).parent().children("div.profile-row:eq(2)").children("span.data").text().replace(/,/g,""))}setUpdatedDate(page);citizenPage[e]=page;if(d){localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}}function fetchAndUpdateOneCitizenPage(d,b,e){if(config.fetchCitizenDisabled&&d!==userId){return}var c=citizenPage[d];if(c!==undefined&&!isObjectOutdated(c,600)){if(typeof(e)==="function"){e()}return}$.ajax({url:"profile.html?id="+d,success:function(f){updateOneCitizenPage(d,f,b);if(typeof(e)==="function"){e()}},error:function(h,k){var f=(d%10)*0.5+1;var g=this;console.log("用户",d,"页面抓取错误 (",k,")，",f,"秒后重新抓取");setTimeout(function(){$.ajax(g)},f*1000)},})}function getMuMemberInfo(c,d){if(!muInfo[c]){muInfo[c]={}}var b=muInfo[c];if(isObjectOutdated(b.member,48*3600)){$.ajax({url:"apiMilitaryUnitMembers.html?id="+c,success:function(g){var f=JSON.parse(g);for(var e=0;e<f.length;++e){UpdateOneCitizenInfo(f[e],false)}b.member={};setUpdatedDate(b.member);localStorage.setItem("citizenInfo",JSON.stringify(citizenInfo));localStorage.setItem("muInfo",JSON.stringify(muInfo));if(typeof(d)==="function"){d()}},error:function(g,h){var e=(c%10)*0.5+1;var f=this;console.log("军团",c,"的成员API抓取错误 (",h,")，",e,"秒后重新抓取");setTimeout(function(){$.ajax(f)},e*1000)}})}else{console.log("军团",c,"的成员API无需抓取");if(typeof(d)==="function"){d()}}}function enhanceProfile(e){if(config.fetchCitizenDisabled&&e!==userId){return}var b=getEpoch();$("img[src$='_positive.png']").after("<br>");$("img[src$='_negative.png']").after("<br>");var k=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"];var h=[24,24,24,24,1,10,25,24,24,24];for(var g=0;g<k.length;++g){var f=$("img[src$='"+k[g]+"_positive.png']:first")[0];var c=$("img[src$='"+k[g]+"_negative.png']:first")[0];var m=citizenPage[e][k[g]];if(f){if($(f).attr("class")=="smallhelp"){var d=m[0]+h[g]*3600*1000-b;var l=m[1]+h[g]*3600*1000-b;if((l-d)<60*1000){$("<b>",{text:epochToTime(d)}).insertAfter(f)}else{$("<b>",{text:epochToTime(d)+" - "+epochToTime(l)}).insertAfter(f)}}}if(c){if($(c).attr("class")=="smallhelp"){var d=m[0]+h[g]*2*3600*1000-b;var l=m[1]+h[g]*2*3600*1000-b;if(!citizenPage[e].premium){d+=h[g]*3600*1000;l+=h[g]*3600*1000}if((l-d)<60*1000){$("<b>",{text:epochToTime(l)}).insertAfter(c)}else{$("<b>",{text:epochToTime(d)+" - "+epochToTime(l)}).insertAfter(c)}}}}}function updateBuffTime(){var f=$(".time:first").text().trim().split(", ");var c=getEpochFromString(f[1],f[0]);var e=["steroids","tank","bunker","resistance","painDealer1h","painDealer10h","painDealer25h","camouflage_third_class","camouflage_second_class","camouflage_first_class"];var d=[24,24,24,24,1,10,25,24,24,24];var b=$("#userAvatar span.premiumStar").length===1;$(".specialItemInventory").each(function(){var o=$(this);var h=$("strong",o);if(h.length===0){return}f=h.text().split(" ");var g=getEpochFromString(f[0],f[1]);var m=epochToTime(g-c);h.append(" ("+m+")");var l=$("img:first",o).attr("src");for(var k=0;k<e.length;++k){if(l.indexOf(e[k])>=0){if(k<4){var n=getEpoch()+g-c-48*3600*1000;if(!b){n-=24*3600*1000}}else{var n=getEpoch()+g-c-d[k]*3600*1000}citizenPage[userId][e[k]]=[n,n+1];localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}}})}function enhanceSpecialItem(){var b=$("<table id='quickBuffTable' UpdateCount='0'></table>").prependTo($("#storageConteiner"));var c=$("<tr>").appendTo(b);var e=$("<tr>").appendTo(b);var g=$("<tr>").appendTo(b);d($(".specialItemInventory").parent(),c,e,g);function d(l,k,n,o){var m=["medkit_big","vacations_big","spa_big","steroids_big","tank_big","painDealer1h_big","painDealer10h_big","painDealer25h_big","resistance_big","bunker_big"];var h=["#EAC100","#00BB00","#00BB00","#FF5809","#FF5809","#9F4D95","#9F4D95","#9F4D95","#7373B9","#7373B9"];$.each(m,function(u,A){var C=$("img[src$='"+A+".png']",l).parent();if(C.length<=0){return true}var v=$(".smallhelp",C);if(v.length===0){return true}var r=$('<td bgcolor="'+h[u]+'"></td>').appendTo(k);v.clone().appendTo(r);var w=$("span",C).text();if(w!=""){$("<br><b>"+w+"</b>").appendTo(r)}else{$("<br><br>").appendTo(r)}var y=$('<td bgcolor="'+h[u]+'"></td>').appendTo(n);var q=$('<td bgcolor="'+h[u]+'"></td>').appendTo(o);var s=$(".siForms",C);var p=$("form",s);if(p.length<1){return true}else{if(p.length==1){var B=$("select",p);if(B.length<1){var x=$('input[name="item"]',p).attr("value");var t=$("<input type='button' class='foundation-style button' value='使用'></input>").appendTo(y);t.click(function(){var D=parseInt(b.attr("UpdateCount"))+1;b.attr("UpdateCount",D);t.attr({disabled:true});$.ajax({type:"POST",url:"storage.html",data:"item="+x+"&storageType=SPECIAL_ITEM&action=USE",success:function(E){f(E,D);console.log("使用"+x+"：成功响应")},error:function(E,F){t.val("使用失败");console.log("使用"+x+"时发生错误")}})})}else{var x=$('input[name="itemType"]',p).attr("value");var z=$("<input type='button' class='foundation-style button' value='购买'></input>").appendTo(q);z.click(function(){var D=parseInt(b.attr("UpdateCount"))+1;b.attr("UpdateCount",D);z.attr({disabled:true});$.ajax({type:"POST",url:"storage.html",data:"itemType="+x+"&storageType=SPECIAL_ITEM&action=BUY&quantity=1",success:function(E){f(E,D);console.log("购买"+x+"：成功响应")},error:function(E,F){z.val("购买失败");console.log("购买"+x+"时发生错误")}})})}}else{var x=$('input[name="itemType"]',p).attr("value");var t=$("<input type='button' class='foundation-style button' value='使用'></input>").appendTo(y);t.click(function(){var D=parseInt(b.attr("UpdateCount"))+1;b.attr("UpdateCount",D);t.attr({disabled:true});$.ajax({type:"POST",url:"storage.html",data:"item="+x+"&storageType=SPECIAL_ITEM&action=USE",success:function(E){f(E,D);console.log("使用"+x+"：成功响应")},error:function(E,F){t.val("使用失败");console.log("使用"+x+"时发生错误")}})});var z=$("<input type='button' class='foundation-style button' value='购买'></input>").appendTo(q);z.click(function(){var D=parseInt(b.attr("UpdateCount"))+1;b.attr("UpdateCount",D);z.attr({disabled:true});$.ajax({type:"POST",url:"storage.html",data:"itemType="+x+"&storageType=SPECIAL_ITEM&action=BUY&quantity=1",success:function(E){f(E,D);console.log("购买"+x+"：成功响应")},error:function(E,F){z.val("购买失败");console.log("购买"+x+"时发生错误")}})})}}})}function f(l,k){var h=b.attr("UpdateCount");if(k>=h){$("td",b).remove();d($(".specialItemInventory",l).parent(),c,e,g)}}}function createSettingWindow(){var e=$("<div>",{"class":"battleSettingsDiv",style:"overflow:auto; width:450px; height:auto; display:block; position:fixed; top:50%; left:50%; margin-left: -225px; margin-top: -150px; padding-bottom: 20px; text-align:center;background-color:lightgray;"}).appendTo($("body"));var b=$('<br>战场设置<br><table class="battleSettingsTable" style="text-align:left"></table><button class="battleSettingsCancel">关闭</button><br>').appendTo(e);var c=$(".battleSettingsTable");var d=$("<tr>").appendTo(c);var f=$("<td>").appendTo(d);addCheckBoxSettingFrame(f,"battleEnhanceDivPlacement","战场界面功能框下移","battleEnhanceDivPlacement",false);$("<p>",{text:"观战玩家变动不会改变按钮位置。"}).appendTo(f);d=$("<tr>").appendTo(c);f=$("<td>").appendTo(d);addCheckBoxSettingFrame(f,"battleBorderless","战场页面缩小框体间距","battleBorderless",false);$("<p>",{text:"能看到下面的玩家输出排行和实时输出伤害。"}).appendTo(f);d=$("<tr>").appendTo(c);f=$("<td>").appendTo(d);addCheckBoxSettingFrame(f,"addEmptyRecentRecord","预置最近输出栏位","addEmptyRecentRecord",false);$("<p>",{text:"当最近输出不足5个时补充至5个栏位，以便第一时间能看到输出状况。"}).appendTo(f);d=$("<tr>").appendTo(c);f=$("<td>").appendTo(d);addCheckBoxSettingFrame(f,"enableBattleAjaxTimeout","设定请求超时时间：","enableBattleAjaxTimeout",false);addTextboxSettingFrame(f,60,"battleAjaxTimeout","5");$("<span>",{text:" 秒"}).appendTo(f);$("<p>",{text:"缓解因网络环境差，同时进行的请求数量多，导致后续请求被堵塞。"}).appendTo(f);d=$("<tr>").appendTo(c);f=$("<td>").appendTo(d);addCheckBoxSettingFrame(f,"EnableAutoFight","启用自动打枪功能","EnableAutoFight",false);$("<p>",{text:"珍惜账号，慎用自动。"}).appendTo(f);$(".battleSettingsCancel").click(function(){$("#btnBattleSettings").attr({disabled:false});e.remove()})}function quickSite(){var h=$('<li class="has-dropdown">').appendTo($("ul.foundation-left"));var b=$('<a id="quickSite" href="#"><i class="icon-pin"></i>快捷站点</a>').appendTo(h);var f=$('<ul class="dropdown">').appendTo(h);var e=$('<li><a href="#" class="quickSiteSettings">快捷站点设置</a></li>').appendTo(f);$(".quickSiteSettings").click(function(){g()});var d=JSON.parse(localStorage.getItem("quickSite"));if(d!=null){for(var c=0;c<d.length;c++){$('<li><a href="'+d[c].url+'" target="_blank">'+d[c].name+"</a></li>").appendTo(f)}}function g(){var o=$("<div>",{"class":"quickSiteDiv",style:"overflow:auto; width:450px; height:300px; display:block; position:absolute; top:50%; left:50%; margin-left: -225px; margin-top: -150px; padding-bottom: 20px; text-align:center;background-color:lightgray;"}).appendTo($("body"));var l=$('<br>注意: 留空“名称”一栏则表示删除该行，修改后请保存，刷新后生效<br>站外链接请以http或https开头<br>举例：名称：EC在线玩家 链接：citizensOnline.html?countryId=28<br>举例：名称：Esim贴吧 链接：https://tieba.baidu.com/f?kw=esim<table style="text-align:center; margin:auto"><tbody><tr class="EHQS"><td>名称</td><td>链接</td></tr></tbody></table><button class="quickSiteAdd">增加站点</button><button class="quickSiteComplete">保存</button><button class="quickSiteCancel">取消</button><br>').appendTo(o);var k=$(".EHQS").parent();$(".quickSiteAdd").click(function(){var p=$('<tr><td><input class="EHQSSites" type="text" style="width:100px;"></td><td><input class="EHQSSites" type="text" style="width:300px;"></td></tr>').appendTo(k)});var n=JSON.parse(localStorage.getItem("quickSite"));if(n!=null){for(var m=0;m<n.length;m++){$('<tr><td><input class="EHQSSites" type="text" style="width:100px;" value="'+n[m].name+'"></td><td><input class="EHQSSites" type="text" style="width:300px;" value="'+n[m].url+'"></td></tr>').appendTo(k)}}$(".quickSiteComplete").click(function(){var q=[];var p=$("tr:gt(0)",$(".EHQS").parent());p.each(function(){var s=$(this);var r=$("td:eq(0)",s).find("input")[0].value;if(r!=""){q.push({name:r,url:$("td:eq(1)",s).find("input")[0].value})}});localStorage.setItem("quickSite",JSON.stringify(q));o.remove()});$(".quickSiteCancel").click(function(){o.remove()})}}function enhanceCountrySelect(){$("select").each(function(){var k=$(this);var n=$("option",k);if(n.length<countryIds.length-3){return}var c=false;var d=false;var b=true;for(var e=0;e<n.length;++e){var l=parseInt(n.eq(e).val());if(l===0){c=true;continue}else{if(l===-1){d=true;continue}else{if(l<-1){return}else{if($.inArray(l,countryIds)===-1){return}else{if(n.eq(e).text().indexOf(countryInfo[l].currencyName)===-1){b=false}}}}}}var g=$("~ input[type='submit']",k);k.after("<br />");var h=JSON.parse(localStorage.getItem("favoriteCountries"));if(h===null){h=[28]}$.each(h,function(p,q){if(!countryInfo[q]){return}var o=$("<div>",{"class":(b?"xflagsSmall xflagsSmall-":"xflagsMedium xflagsMedium-")+countryInfo[q].flagName,style:"vertical-align:middle;",value:q,title:countryInfo[q].name}).insertAfter(k);o.click(function(){k.val($(this).val());if(g.length===1){g.click()}})});if(!b&&((c&&!d)||(!c&&d))){var f=$("<div>",{"class":" xflagsMedium xflagsMedium-Adminland",style:"vertical-align:middle;",title:"全世界"}).insertAfter(k);f.click(function(){k.val(c?0:-1);if(g.length===1){g.click()}})}if(c&&b){var f=$("<div>",{"class":"xflagsSmall xflagsSmall-Gold",style:"vertical-align:middle;"}).insertAfter(k);f.click(function(){k.val(0);if(g.length===1){g.click()}})}if(g.length===1){g.click(function(){m(parseInt(k.val()))})}else{k.change(function(){m(parseInt(k.val()))})}function m(o){var q=localStorage.getItem("lockFavoriteCountries");if(q==null||q!="true"){if(o>0){var p=$.inArray(o,h);if(p>-1){h.splice(p,1)}h.push(o)}localStorage.setItem("favoriteCountries",JSON.stringify(h.slice(-9)))}}})}function enhanceQuickButton(){var c=$("#editCitizenId").parent();var d=JSON.parse(localStorage.getItem("citizenNumber"));if(d===null||isObjectOutdated(d,24*3600)){$.ajax({url:"militaryUnitStorage.html",success:function(f){d=b(f);console.log("团员编号为",d);e(d)},error:function(f,g){console.log("抓取团员编号时发生错误 (",g,")，重新尝试");$.ajax(this)}})}else{e(d.cn)}function e(l){if(l==="disabled"){return}var f=0;var n=0;if($("#foodLimit").length==1){f=parseInt($("#foodLimit").text());n=parseInt($("#giftLimit").text())}else{f=parseInt($("#foodLimit2").text());n=parseInt($("#giftLimit2").text())}var g=[["bread","Food",5,"5-FOOD","Q5食物",Math.floor(Math.random()*4+2)*10],["gift","Gift",5,"5-GIFT","Q5礼物",Math.floor(Math.random()*4+2)*10],["tank","Weapon",5,"5-WEAPON","Q5武器",Math.floor(Math.random()*10+15)*10],["ticket ","Ticket",5,"5-TICKET","Q5机票",10],["bread","Food",3,"3-FOOD","Q3食物",10],["gift","Gift",3,"3-GIFT","Q3礼物",10],["tank","Weapon",1,"1-WEAPON","Q1武器",Math.floor(Math.random()*10+15)*10],["ticket ","Ticket",1,"1-TICKET","Q1机票",10]];var m=$('<ul id="storageTable" class="button foundation-center foundation-style-group"></ul>');c.parent().after(m);$.each(g,function(u,x){var w=$("<li></li>");var p=$("#storageTable").append(w);var r=x[5];var s=$("<button>",{id:"send"+x[3],style:"width:41px; margin:1px;","class":"button foundation-style smallhelp only-icon profileButton",title:"从军团仓库取"+r+"个"+x[4]}).appendTo(w);var v=$("<img>",{src:"//cdn.e-sim.org/img/productIcons/"+x[1]+".png",style:"width:28px; height:28px;"}).appendTo(s);var t=$("<span>",{text:"x"+r,style:"position: absolute; top: 26px; right: 1px;"}).appendTo(s);s.append($("<br />"));var o=$("<img>",{src:"//cdn.e-sim.org/img/productIcons/q"+x[2]+".png",style:"width:28px;"}).appendTo(s);s.click(function(){s.attr({disabled:true});var q={product:x[3],quantity:r,reason:" ",};q[l]=userId;$.ajax({url:"militaryUnitStorage.html",type:"POST",data:q,success:function(y){console.log("已从军团仓库取了"+r+"个"+x[4]);s.attr({disabled:false})},error:function(y,z){console.log("从军团仓库取"+r+"个"+x[4]+"时发生错误 (",z,")，重新尝试");$.ajax(this)}})})});var k=$("<input type='button' id='gsnbtn' value='获取仓库物资数目'></input> ");c.parent().after(k);k.click(function(){h(l);k.remove()});function h(o){$.ajax({url:"storage.html?storageType=PRODUCT",success:function(u){var q=$("div.storage",u);var y=[0,0,0,0,0,0];var A=[0,0,0,0,0,0];var x=[0,0,0,0,0,0];var s=[0,0,0,0,0,0];for(var v=0;v<q.length;v++){var z;var r;var p;z=parseInt("0"+q[v].children[0].innerText.trim());var t=$(q[v]).children()[1];p=$(t.children[0]).attr("src").split("/")[6];r=$(t.children[1]).attr("src");if(r!=null){r=r.split("/")[6];r=r.substring(1,2);if(p=="Food.png"){y[parseInt(r)]=z}else{if(p=="Gift.png"){A[parseInt(r)]=z}else{if(p=="Weapon.png"){x[parseInt(r)]=z}else{if(p=="Ticket.png"){s[parseInt(r)]=z}}}}}}var w=parseInt((f+n+40)*5*100/(100-citizenPage[userId].avoid));console.log(f,n,y,A,x,s,w);g=[["bread","Food",5,"5-FOOD","Q5食物",y[5]<f+25,f+30-y[5],30],["gift","Gift",5,"5-GIFT","Q5礼物",A[5]<n+15,n+20-A[5],20],["tank","Weapon",5,"5-WEAPON","Q5武器",x[5]<w,w-x[5]+30,250],["ticket ","Ticket",5,"5-TICKET","Q5机票",s[5]<6,10-s[5],10],["bread","Food",3,"3-FOOD","Q3食物",y[3]<10,10-y[3],10],["gift","Gift",3,"3-GIFT","Q3礼物",A[3]<10,10-A[3],10],["tank","Weapon",1,"1-WEAPON","Q1武器",x[1]<w,w-x[1]+30,250],["ticket ","Ticket",1,"1-TICKET","Q1机票",s[1]<6,10-s[1],10]];$("ul#storageTable").html("");$.each(g,function(H,K){var J=$("<li></li>");var D=$("#storageTable").append(J);var C=K[5]?"red;":"black;";var E=K[5]?K[6]:K[7];var F=$("<button>",{id:"send"+K[3],style:"width:41px; margin:1px; border-color:"+C,"class":"button foundation-style smallhelp only-icon profileButton",title:"从军团仓库取"+E+"个"+K[4]+(K[5]?", 补足2天的用量":"")}).appendTo(J);var I=$("<img>",{src:"//cdn.e-sim.org/img/productIcons/"+K[1]+".png",style:"width:28px; height:28px;"}).appendTo(F);var G=$("<span>",{text:"x"+E,style:"position: absolute; top: 26px; right: 1px;"}).appendTo(F);F.append($("<br />"));var B=$("<img>",{src:"//cdn.e-sim.org/img/productIcons/q"+K[2]+".png",style:"width:28px;"}).appendTo(F);F.click(function(){F.attr({disabled:true});var L={product:K[3],quantity:E,reason:" ",};L[o]=userId;$.ajax({url:"militaryUnitStorage.html",type:"POST",data:L,success:function(M){console.log("已从军团仓库取了"+E+"个"+K[4]);F.attr({disabled:false})},error:function(M,N){console.log("从军团仓库取"+E+"个"+K[4]+"时发生错误 (",N,")，重新尝试");$.ajax(this)}})})})},error:function(p,q){console.log("获取物资时发生错误 (",q,")，重新尝试");$.ajax(this)}})}}function b(h){var f=$("input[value='"+userId+"']",h);var g={};if(f.length===1){g.cn=f.attr("name")}else{g.cn="disabled"}setUpdatedDate(g);localStorage.setItem("citizenNumber",JSON.stringify(g));return g.cn}}function enhanceMilitaryUnitCompanies(){var e=$("table.dataTable:last").width("100%");e.parent().attr("style","width:98% !important;");var b=$("tr:gt(0)",e).sort(function(g,f){return $("td:eq(1)",g).html().localeCompare($("td:eq(1)",f).html())});$("tr:gt(0)",e).remove();var d=$("tr",e);d.after(b);$("td:first",d).append(" ("+b.length+")");var c=$("<button>",{"class":"foundation-style button",text:"查看全部"}).appendTo($("<td>").appendTo(d));c.click(function(){c.attr("disabled",true);setTimeout(function(){c.attr("disabled",false)},10000);$('button[id^="ehShow"]').click()});b.each(function(){var h=$(this);if(parseInt($("td:eq(3)",h).text())===0){h.append($("<td>"));return}var f=parseInt($('td:first a[href^="company.html?id="]',h).attr("href").match(/([0-9]+)$/)[1]);h.attr("id","ehRow"+f);var g=$("<button>",{"class":"foundation-style button",style:"padding:10px;",id:"ehShow"+f,text:"查看工作情况",target:f}).appendTo($("<td>").appendTo(h));g.click(function(){g.attr("disabled",true);var k=g.attr("target");$.ajax({url:"companyWorkResults.html?id="+k,success:function(o){g.remove();var m=$("table.dataTable:last",o);if($("tr",m).length===1){return}var l=$("<tr>").insertAfter($("#ehRow"+k));var n=$("<td colspan=5></td>").appendTo(l);m.appendTo(n)},error:function(l,m){console.log("工厂",k,"抓取错误 (",m,")");g.click()}})})})}function returnToCompanyPage(){var b=$("<button>",{id:"returnButton","class":"foundation-style",style:"padding:5px; margin:5px",text:"回到工厂页面"});b.click(function(){var c=GetQueryString("id");document.location=location.origin+"/company.html?id="+c});$(".darkTable").before(b)}function enhanceMyMilitaryUnit(){var b=$("#orderForm > select");if(b.length!=1){return}var e=[];for(var d=0;d<allies.length;++d){e.push("("+countryInfo[allies[d]].shortName)}var c=$("option",b).sort(function(g,f){return $(g).text().localeCompare($(f).text())});c.each(function(){var g=$(this);for(var f=0;f<e.length;++f){if(g.text().indexOf(e[f]+" ")!=-1){if(f==0){g.attr("style","background:pink;")}else{g.attr("style","background:lavender;")}}}});b.html(c)}function preEnhanceBattleList(){var t=$(".dataTable :first");var p=$("<div class='foundation-style'></div>");p.insertBefore(t);var o=$("<table align='right'></table>");p.append(o);var e=$("<tr align='right'></tr>");o.append(e);var m=$("<input type='button' class='foundation-style button' id='btnShowEndTime' value='显示T5时间'></input> ");e.append(m);var d=$("<input type='button' class='foundation-style button' id='btnCloseShowEndTime' value='关闭T5时间'></input> ");d.hide();e.append(d);var k=$("<input type='button' class='foundation-style button' id='btnShowBattleID' value='显示战场ID'></input> ");e.append(k);var u=$("<input type='button' class='foundation-style button' id='btnCloseShowBattleID' value='关闭战场ID'></input> ");u.hide();e.append(u);var b=$("<tr align='right'></tr>");o.append(b);var v=$("<input type='button' class='foundation-style button' id='btnDeleteTourment' value='隐藏Cup战场'></input> ");b.append(v);var r=$("<input type='button' class='foundation-style button' id='btnFilter' value='筛选战场'></input> ");b.append(r);var h=$("<input type='button' class='foundation-style button' id='btnCloseFilter' value='关闭筛选'></input> ");h.hide();b.append(h);var f=$("<input type='button' class='foundation-style button' id='btnDeleteCheckedBattle' value='隐藏选中战场'></input> ");f.attr("disabled",true);b.append(f);var n=$("<input type='button' class='foundation-style button' id='btnDeleteUncheckedBattle' value='保留选中战场'></input> ");n.attr("disabled",true);b.append(n);var q=$("<input type='button' class='foundation-style button' id='btnCopyCheckedBattleInfo' value='复制选中战场信息'></input> ");q.attr("disabled",true);b.append(q);f.click(function(){$("#battlesTable tr:gt(0)").each(function(w,y){var x=$("input:checkbox",y);if(x.is(":checked")===true){y.remove()}})});n.click(function(){$("#battlesTable tr:gt(0)").each(function(w,y){var x=$("input:checkbox",y);if(x.is(":checked")===false){y.remove()}})});v.click(function(){$("#battlesTable tr:gt(0)").each(function(w,z){var y=$("a[href*='battle.html']",z);if(y==null){return true}var x=y.text();if(x=="Cup tournament"){z.remove()}})});r.click(function(){r.hide();h.show();var w=$("<td exid='filter'><input type='checkbox'></input></td>");$("#battlesTable tr:eq(0)").append($("<td exid='filter'><input id='filterSelectAll' type='checkbox'></input>全选</td>"));$("#battlesTable tr:gt(0)").append(w);f.attr("disabled",false);n.attr("disabled",false);q.attr("disabled",false);$("#filterSelectAll").click(function(){$("#battlesTable tr:gt(0)").each(function(x,y){$("input:checkbox",y).attr("checked",$("#filterSelectAll").is(":checked"))})})});h.click(function(){r.show();h.hide();$("#battlesTable td[exid='filter']").remove();f.attr("disabled",true);n.attr("disabled",true);q.attr("disabled",true)});m.click(function(){m.hide();d.show();$("#battlesTable tr:eq(0)").append($("<td exid='endTime'>T5时间</td>"));$("#battlesTable tr:gt(0)").each(function(B,D){var F=$("a[href*='battle.html']",D);var H=F.text();var w=$("span.is-countdown",D);var G;if(w.length!==1){G=$("<td exid='endTime'>未知</td>")}else{var x=w.text().split(":");if(x.length<3){G=$("<td exid='endTime'>已过期</td>")}else{var y=new Date();var E=parseInt(x[0])*60*60*1000+parseInt(x[1])*60*1000+parseInt(x[2])*1000-5*60*1000;var z=new Date(y.getTime()+E);G=$("<td exid='endTime'></td>");G.text(z.toLocaleTimeString());var C=F.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1];var A=$("<input type='button' class='foundation-style button' id='btnAutoPopup-"+C+"' value='T5自动打开战场' title='首次使用可能会被浏览器拦截，加入白名单即可' endtime='"+Date.parse(z)+"'></input> ");G.append(A);A.click(function(){var K=$(this);var J=new Date();var I=new Date(parseInt(K.attr("endtime")));setTimeout(function(){window.open(F.attr("href"),"Battle"+C,"resizable,scrollbars,width=1200,height=600")},I-J);console.log("在"+(I-J)/1000+"秒后打开"+F.attr("href"));K.attr("disabled",true);K.val("预约成功");K.attr("title","请勿关闭或刷新该网页")})}}$(D).append(G)})});d.click(function(){m.show();d.hide();$("#battlesTable td[exid='endTime']").remove()});k.click(function(){k.hide();u.show();$("#battlesTable tr:eq(0)").append($("<td exid='battleID'>战场ID</td>"));$("#battlesTable tr:gt(0)").each(function(w,z){var y=$("a[href*='battle.html']",z);if(y==null){return true}var x=y.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1];$(z).append($("<td exid='battleID'>"+x+"</td>"))})});u.click(function(){k.show();u.hide();$("#battlesTable td[exid='battleID']").remove()});q.click(function(){var w="";$("#battlesTable tr:gt(0)").each(function(C,D){var A=$("input:checkbox",D);if(A.is(":checked")===true){var E=$("a[href*='battle.html']",D);var F=E.text();var x=$("span.is-countdown",D);if(x.length!==1){w=w+E[0].href+"  "+F+"\r\n"}else{var y=x.text().split(":");var z=new Date();var B=new Date(z.getTime()+parseInt(y[0])*60*60*1000+parseInt(y[1])*60*1000+parseInt(y[2])*1000-5*60*1000);w=w+E[0].href+"  "+F+" T5时间："+B.toLocaleTimeString()+"\r\n"}}});GM_setClipboard(w)});var g=$("<button>",{text:"按结束时间排序","class":"foundation-style button"}).appendTo($("#battlesTable tr:first td:first").empty());g.click(function(){g.attr("disabled",true);setTimeout(function(){g.attr("disabled",false)},1000);var w=[];$("#battlesTable tr:gt(0)").each(function(x,A){var z=$("a[href*='battle.html']",A);if(z==null){return true}var y=parseInt(z.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1]);$(this).attr("id","battle-"+y);var B=$("span.is-countdown",A);if(B.length!==1){return}w.push(B.text()+" "+$(this).attr("id"))});w.sort().reverse();$.each(w,function(y,z){var x=z.split(" ").pop();$("#battlesTable #"+x).insertAfter($("#battlesTable tr:first"))})});var l=$("#pagination-digg");if(l.length>0){var c=$("<button>",{text:"加载其他页的战场","class":"foundation-style button",title:"如果需要加载所有战场，请尽快点击该按钮，否则可能会出现重复战场而导致插件失效"}).appendTo($("#battlesTable tr:first td:first"));c.click(function(){c.attr("disabled",true);var w=$("li.next");var z=parseInt($("li.active")[0].innerHTML);var x;if(w.length>0){x=parseInt(w.prev().children().attr("href").split("page=")[1])}else{x=z}var y=x-1;c.text("剩余"+y+"个");for(var B=1;B<=x;B++){if(B==z){continue}var A=document.URL;if(A.indexOf("page")>0){A=A.substring(0,A.indexOf("page"))+"page="+B}else{if(A.indexOf("?")>0){A=A+"&page="+B}else{A=A+"?page="+B}}$.ajax({url:A,success:function(L){if($(".time",L).length!==2){console.log(citizenId,"抓取错误，重新抓取");$.ajax(this);return}var M=$("#battlesTable").children("tbody");var P=L.split('<table id="battlesTable"')[1];P=P.split("</table>")[0];var O=P.substring(P.indexOf("</tr>")+5);var R=O.split("<tr>");var D=[];var N=[];var E=[];var F=[];var C=[];for(var K=1;K<R.length;K++){var J=R[K].split('<script type="text/javascript">');if(J.length>1){D[K]=J[0];var H=J[1].split("<\/script>");D[K]=D[K]+H[1];D[K]=D[K].split("</tr>")[0];N[K]=H[0];C[K]=D[K].split("?id=")[1];C[K]=C[K].substring(0,C[K].indexOf('"'));$("<tr>",{id:"battle-"+C[K]}).appendTo(M);$("#battle-"+C[K]).html(D[K]);var G=N[K].split("+");var Q=[];for(var I=1;I<G.length;I++){Q[I]=G[I].substring(0,G[I].indexOf(")"))}E[K]=new Date();E[K].setHours(E[K].getHours()+parseInt(Q[1]));E[K].setMinutes(E[K].getMinutes()+parseInt(Q[2]));E[K].setSeconds(E[K].getSeconds()+parseInt(Q[3]));F[K]=$("<span>",{id:"fundraisingTimer"+C[K]}).appendTo($("a[href='battle.html?id="+C[K]+"']").parent());unsafeWindow.$("#fundraisingTimer"+C[K]).countdown({until:E[K],compact:true,format:"dHMS",expiryText:"这个回合已经结束"})}else{C[K]=R[K].split("?id=")[1];C[K]=C[K].substring(0,C[K].indexOf('"'));$("<tr>",{id:"battle-"+C[K]}).appendTo(M);D[K]=R[K].split("</tr>")[0];$("#battle-"+C[K]).html(D[K])}}c.text("剩余"+(--y)+"个");if(y<=0){c.text("加载完成，共"+x+"页")}},error:function(C,D){console.log("抓取错误 (",D,")，重新抓取");$.ajax(this)},})}});var s=$("<button>",{text:"加载详情","class":"foundation-style button",style:"padding:5px; margin:5px;",title:"加载刷新战场详情功能"}).appendTo($("#battlesTable tr:first td:last").empty());s.click(function(){s.attr("disabled",true);s.remove();enhanceBattleList()})}else{enhanceBattleList()}}function enhanceBattleList(){$("#battlesTable tr:gt(0)").each(function(n,d){if($("div.teamBlack",d).length>0){return}var t=$("span.is-countdown",d);if(t.length!==1){return}var p=$("a[href*='battle.html']",d);var k=parseInt(p.attr("href").match(/battle\.html[?]id=([0-9]+)/)[1]);$(this).attr("id","battle-"+k);var K=p.text();if($("~ b",p).length===1){K+="起义"}else{K+="进攻"}var C=getCountryFormXflagsClass($("div.xflagsMedium:first",d).attr("class")).replace(/-/g," ");var s=getCountryFormXflagsClass($("div.xflagsMedium:last",d).attr("class")).replace(/-/g," ");var A=$("div.ui-progressbar-value",d);var D=$("<div>",{id:"wall"+k,style:"text-align:center;"}).insertAfter($("div.ui-progressbar",d));if($("div.xflagsMedium",d).length<=0){var r=$("<div>",{id:"defenderBattleHero"+k,style:"text-align:center;"}).insertAfter($(".muAvatar:first",d).parent());var I=$("<div>",{id:"defenderScore"+k,style:"text-align:center;"}).insertAfter($(".muAvatar:first",d).parent());var F=$("<div>",{id:"attackerBattleHero"+k,style:"text-align:center;"}).insertAfter($(".muAvatar:last",d).parent());var v=$("<div>",{id:"attackerScore"+k,style:"text-align:center;"}).insertAfter($(".muAvatar:last",d).parent())}else{var r=$("<div>",{id:"defenderBattleHero"+k,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:first",d));var I=$("<div>",{id:"defenderScore"+k,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:first",d));var F=$("<div>",{id:"attackerBattleHero"+k,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:last",d));var v=$("<div>",{id:"attackerScore"+k,style:"text-align:center;"}).insertAfter($("div.xflagsMedium:last",d))}var J=$("<div>",{id:"showSpectators"+k,text:"Show spectators",style:"color:#3787ea; cursor:pointer;"}).appendTo($("td:first",d)).click(function(){x.children().show();J.hide();L.show()}).hide();var L=$("<div>",{id:"hideSpectators"+k,text:"Hide spectators",style:"color:#3787ea; cursor:pointer;"}).appendTo($("td:first",d)).click(function(){x.children().hide();J.show();L.hide()}).hide();var x=$("<div>",{id:"spectators"+k,"class":"battleDiv",style:"width:100%; text-align:center;"}).appendTo($("td:first",d));var o=$("<div>",{style:"width:33%; border:0; padding:0; margin:0; display:inline-block;",text:" defenders"}).appendTo(x);var c=$("<i>",{id:"totaldefenders"+k,text:"0"}).prependTo(o);var h=$("<div>",{id:"defendersMenu"+k}).appendTo(o);var B=$("<div>",{style:"width:34%; border:0; padding:0; margin:0; display:inline-block; text-align:center;",text:" spectators"}).appendTo(x);var f=$("<i>",{id:"totalspectators"+k,text:"0"}).prependTo(B);var g=$("<div>",{id:"spectatorsMenu"+k}).appendTo(B);var m=$("<div>",{style:"width:33%; border:0; padding:0; margin:0; display:inline-block; text-align:center;",text:" attackers"}).appendTo(x);var q=$("<i>",{id:"totalattackers"+k,text:"0"}).prependTo(m);var z=$("<div>",{id:"attackersMenu"+k}).appendTo(m);x.children().hide();var e=$("<div>",{id:"dsOrHospital"+k}).appendTo(t.parent().parent());var E=$("<img>",{src:$("#userAvatar img").attr("src")}).insertAfter(e).hide();var H=$("<div>",{id:"myDamage"+k}).insertAfter(E);var G=$("<button>",{id:"peek"+k,text:"刷新","class":"foundation-style button",style:"padding:6px; margin:3px;"}).appendTo($("td:eq(3)",d));var u=$("<button>",{id:"copy"+k,text:"复制","class":"foundation-style button",style:"padding:6px; margin:3px;",title:K+": "+p[0].href+"\n"}).appendTo($("td:eq(3)",d)).hide();var w=$("<div>").appendTo($("td:eq(3)",d));var l=$("<span>",{id:"lastPeek"+k}).appendTo(w);var y=$("<span>",{id:"2lastPeek"+k,text:"秒前更新"}).hide().appendTo(w);G.click(function(){G.attr("disabled",true);$.ajax({url:"battle.html?id="+k,success:function(N){if($(".time",N).length!==2){console.log(k,"抓取错误，重新抓取");$.ajax(this);return}I.text($("#defenderScore",N).text());v.text($("#attackerScore",N).text());var M=parseInt($("#defenderScore",N).text().replace(/,/g,"").replace(/\xA0/g,""))-parseInt($("#attackerScore",N).text().replace(/,/g,"").replace(/\xA0/g,""));if(M===0){D.text("");D.attr("title",I===0?"双方无伤害":"双方伤害相同")}else{if(M>0){D.text(">> "+M.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>");D.attr("title",C+" 领先 "+s+" "+(M/1000000).toFixed(2)+"M")}else{D.text("<< "+(-M).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<");D.attr("title",s+" 领先 "+C+" "+((-M)/1000000).toFixed(2)+"M")}}A.attr("style","width:"+$("#leftStat",N).text().replace(" ","")+"; margin:0;");r.html($("#topDefender1 > div",N).attr("style","width:100%;"));F.html($("#topAttacker1 > div",N).attr("style","width:100%;"));if(F.height()<r.height()){F.parent().height(r.parent().height())}if($("td:first > div:first",d).children().length==4){$("td:first > div:first >div:last",d).hide()}if($("div.product",N).length>0){e.empty().append($("div.product",N))}var O=$("#topPlayerHit",N).text();if(O!=="0"){E.show();H.text(O)}if($("#userAvatar span.premiumStar").length===1){c.text($("#totaldefenders",N).text());h.html($("#defendersMenu",N).html());f.text($("#totalspectators",N).text());g.html($("#spectatorsMenu",N).html());q.text($("#totalattackers",N).text());z.html($("#attackersMenu",N).html());if(!L.is(":visible")){J.show()}}l.text("0");y.show();G.attr("disabled",false);u.show()},error:function(M,N){console.log("战场",k,"抓取错误 (",N,")");$.ajax(this)}})});u.click(function(){GM_setClipboard(u.attr("title")+t.text()+", "+D.attr("title")+" ("+w.text()+")")})});setInterval(function(){$("span[id^='lastPeek']").each(function(){var c=parseInt($(this).text());if(!isNaN(c)){$(this).text(c+1)}})},1000);var b=$("<button>",{text:"刷新全部","class":"foundation-style button",style:"padding:5px; margin:5px;"}).appendTo($("#battlesTable tr:first td:eq(3)").empty());b.click(function(){b.attr("disabled",true);$("#battlesTable tr:gt(0) button[id^='peek']").click();setTimeout(function(){b.attr("disabled",false)},10000)})}function enhanceEquipment(){var o=20;var g=[0.1,1,5,12,35,100,400];var m=$(".time").first().text().split(" ")[0];var e=m.split(":")[0];var c=o>e?(o-e+24):(o-e+48);console.log("距离波兰时间",o,"点还有约",c,"小时");console.log("各等级装备的起价是 ",g);var p=$(".equipmentInStorage");for(i=0;i<p.length;++i){var f=$(".equipmentActions",p[i])[0];var n=$(f).children()[4];n=$(n).children()[0];var d=$(n).attr("title");if(d==null){var k=5}else{var k=parseInt($(n).attr("title").substring(1))-1}var b=$(f).children()[2];var h=$("input",$(b));var l=$(f).children();for(a=0;a<l.length;++a){if(l[a].outerHTML=="<hr>"){f.removeChild(l[a])}}for(j=0;j<h.length;++j){switch(h[j].name){case"price":h[j].setAttribute("value",g[k]);h[j].setAttribute("type","text");h[j].setAttribute("style","width:30px");h.eq(j).before("起价: ");h.eq(j).after("<div></div>");break;case"length":h[j].setAttribute("value",c);h[j].setAttribute("type","text");h[j].setAttribute("style","width:30px");h.eq(j).before("时间: ");h.eq(j).after("<i></i>");break;default:break}}}}function equipmentUpgradeHelper(){var R=[0.1,0.2,0.4,0.6,0.8,1.1];var af=[0.2,0.4,0.6,0.8,1.1,1.4];var av=[0.5,1,1.5,2,3,4];var u=[1,1.5,2,3,4,5.5];var w=[0,1.5,3,4.5,6,7.5];var J=[1.5,3,4.5,6,7.5,9];var aq=[0,1,2,3,4,6];var t=[1,2,3,4,6,8];var A=[0,1,2,3,4,6];var L=[1,2,3,4,6,8];var g=[0,1,2,3,4,6];var D=[1,2,3,4,6,8];var ag=[0,2,4,6,8,12];var h=[2,4,6,8,12,16];var N=[10,16,20,24,28,40];var ad=[16,20,24,28,40,60];var H=[20,40,50,60,70,90];var V=[40,50,60,70,90,130];var al=[3,4,5,6,7,8];var o=[4,5,6,7,8,10];var e=[2,2.5,3,3.5,4,4.5];var B=[2.5,3,3.5,4,4.5,5];var S=[1,1,1,1,1,1,1,0,0,0,0];var U=[1,1,1,1,1,1,1,0,0,0,0];var ah=[1,1,1,1,1,1,1,0,0,0,0];var W=[1,1,1,1,1,1,1,0,1,0,0];var Z=[1,1,1,1,1,1,1,0,1,0,0];var am=[1,1,1,1,1,1,1,0,0,0,0];var E=[1,1,1,1,1,1,1,0,0,0,0];var P=[1,1,0,0,1,0,0,1,1,0,0];var aa=[1,0,1,1,1,0,0,1,0,0,0];var ao=[1,0,1,1,1,0,0,0,0,0,0];var x=[1,0,1,1,1,0,0,1,0,0,0];var n=[1,0,1,1,1,0,0,0,0,0,0];var q=[1,0,1,1,1,0,0,0,0,0,0];var p=[1,1,1,1,1,0,0,0,0,0,0];var m=[1,1,1,1,1,0,0,0,0,0,0];var K=[1,1,0,0,1,0,0,1,1,0,0];var T=[0,1,1,0,0,1,1,0,0,0,1];var ae=[1,1,1,0,0,1,1,0,0,0,1];var ax=[0,1,1,0,0,1,1,0,0,0,1];var ai=[0,1,1,0,0,1,1,0,0,0,1];var aj=[0,1,1,0,0,1,1,0,0,0,1];var d=[0,1,1,1,0,1,1,0,0,0,1];var c=[0,1,1,1,0,1,1,0,0,0,1];var F=[1,1,0,0,1,0,0,1,1,0,0];var O=[1,1,1,1,1,0,0,0,1,1,0];var Y=[1,1,1,1,1,0,0,0,1,1,0];var z=[1,1,1,1,1,0,0,0,1,1,0];var r=[1,1,1,1,1,0,0,1,1,1,0];var s=[1,1,1,1,1,0,0,0,1,1,0];var ar=[1,1,1,1,1,1,1,0,1,1,0];var C=[1,1,1,1,1,1,1,0,1,1,0];var ac=[1,1,0,0,1,0,0,1,1,0,0];var k=[0,1,1,0,1,0,0,0,0,1,1];var y=[0,1,1,0,1,0,0,1,0,1,1];var f=[0,1,1,0,1,0,0,0,0,1,1];var au=[0,1,1,0,1,0,0,0,0,1,1];var aw=[0,1,1,0,1,0,0,0,0,1,1];var I=[0,1,1,0,1,0,0,1,0,1,1];var X=[0,1,1,0,1,0,0,1,0,1,1];var ak=[1,1,0,0,1,0,0,1,1,0,0];var G=["pirate","postapo","future","ee"];var v=["helmet","vision","armor","pants","shoes","weapon","offhand","charm"];var at=["Reduce miss chance","Increase critical chance","Increase maximum damage","Increase damage","Increase chance to avoid damage","Increase strength","Increase hit","Increase economy skill","Increase chance for free flight","Increase chance to use less weapons for Berserk","Increase chance to find a weapon"];ap();M();function ay(aA){var aD=aA.split(" by ");var aE=aD[0].trim();var aC=aD[1].trim();if(aC.substring(aC.length-1)=="%"){aC=aC.substring(0,aC.length-1).trim()}var aB=[0,0];for(var az=0;az<at.length;az++){if(aE==at[az]){aB[0]=az;break}}aB[1]=parseFloat(aC);return aB}function an(aB,aA){var az=[0,0];switch(aB){case 0:az[0]=w[aA];az[1]=J[aA];return az;case 1:az[0]=aq[aA];az[1]=t[aA];return az;case 2:az[0]=ag[aA];az[1]=h[aA];return az;case 3:az[0]=g[aA];az[1]=D[aA];return az;case 4:az[0]=A[aA];az[1]=L[aA];return az;case 5:az[0]=N[aA];az[1]=ad[aA];return az;case 6:az[0]=H[aA];az[1]=V[aA];return az;case 7:az[0]=R[aA];az[1]=af[aA];return az;case 8:az[0]=av[aA];az[1]=u[aA];return az;case 9:az[0]=al[aA];az[1]=o[aA];return az;case 10:az[0]=e[aA];az[1]=B[aA];return az;default:console.log("获取装备属性数值范围时parameter越界："+aB);az[0]=0;az[1]=0;return az}}function ap(){var aA=$(".equipmentBack",$(".testDivblue")).attr("class");aA=parseInt(aA.substring(aA.length-1))-1;var az=$("h4");az.each(function(){var aC=this.innerText;var aD=ay(aC);var aB=an(aD[0],aA);var aF=(aB[1]-aD[1])/3;var aE=(aB[1]-aB[0])*0.9+aB[0];if(aD[1]<aE){this.append("（强化+"+aF.toFixed(2)+"）")}else{this.append("（无法强化）")}})}function b(aA,az){if(aA==0){if(az==0){return S}if(az==1){return U}if(az==2){return ah}if(az==3){return W}if(az==4){return Z}if(az==5){return am}if(az==6){return E}if(az==7){return P}return[0,0,0,0,0,0,0,0,0,0,0]}if(aA==1){if(az==0){return aa}if(az==1){return ao}if(az==2){return x}if(az==3){return n}if(az==4){return q}if(az==5){return p}if(az==6){return m}if(az==7){return K}return[0,0,0,0,0,0,0,0,0,0,0]}if(aA==2){if(az==0){return T}if(az==1){return ae}if(az==2){return ax}if(az==3){return ai}if(az==4){return aj}if(az==5){return d}if(az==6){return c}if(az==7){return F}return[0,0,0,0,0,0,0,0,0,0,0]}if(aA==3){if(az==0){return O}if(az==1){return Y}if(az==2){return z}if(az==3){return r}if(az==4){return s}if(az==5){return ar}if(az==6){return C}if(az==7){return ac}return[0,0,0,0,0,0,0,0,0,0,0]}if(aA==4){if(az==0){return k}if(az==1){return y}if(az==2){return f}if(az==3){return au}if(az==4){return aw}if(az==5){return I}if(az==6){return X}if(az==7){return ak}return[0,0,0,0,0,0,0,0,0,0,0]}return[0,0,0,0,0,0,0,0,0,0,0]}function l(az){switch(az){case 0:return"miss";case 1:return"暴击";case 2:return"大伤";case 3:return"小伤";case 4:return"免体";case 5:return"力量";case 6:return"伤害点";case 7:return"经济技能";case 8:return"免费飞行";case 9:return"减少连击消耗";case 10:return"捡到手枪";default:return"[未知属性]"}}function Q(az){for(var aA=0;aA<G.length;aA++){if(az==G[aA]){return aA+1}}return -1}function ab(aA){for(var az=0;az<v.length;az++){if(aA==v[az]){return az}}return -1}function M(){var aA=$(".equipmentBack",$(".testDivblue")).children().attr("class");aA=aA.split(" ")[1];aA=aA.substring(0,aA.length-1);var aF=aA.split("_");var aG,aD;if(aF.length==1){aG=0;aD=ab(aF[0])}else{aG=Q(aF[0]);aD=ab(aF[1])}var aE=b(aG,aD);var az="可以刷出的属性：";for(var aC=0;aC<aE.length;aC++){if(aE[aC]>0){az=az+l(aC)+"、"}}var aB=$(".dashedLine :eq(1)");aB.before("<br />");aB.before(az)}}function enhanceMilitaryUnitStatistics(){var g=$(".statisticsTable");var b=$("tr",g);var f=b.eq(0);f.append('<td><button class="foundation-style" id="ehShowAll">查看所有</button></td>');$("#ehShowAll").click(function(){$(this).attr("disabled","disabled");setTimeout(function(){$("#ehShowAll").attr("disabled",false)},10000);$('[id^="ehShow_"]').click()});function e(m){var l=parseInt(m.replace(/,/g,"").replace(/\xA0/g,""));return l>1000000?((l/1000000).toFixed(1)+"M"):m}for(var d=1;d<b.length;++d){var h=b.eq(d);$("td:eq(5)",h).text(e($("td:eq(5)",h).text()));$("td:eq(6)",h).text(e($("td:eq(6)",h).text()));var k=$('a[href^="militaryUnit.html?id="]',h).attr("href").replace("militaryUnit.html?id=","");var c=$('<button style="padding:10px;" class="foundation-style" id="ehShow_'+k+'">查看军令</button>');h.append($("<td>").append(c));c.click(function(){$(this).attr("disabled","disabled");var l=$(this).attr("id").replace("ehShow_","");$.ajax({url:"militaryUnit.html?id="+l,timeout:9000,success:function(o){var u=$("#ehShow_"+l);var t=$('img[src="//cdn.e-sim.org//img/newOnline.png"]',o).prev();var q=t.prev();var v=q.prev();var n=$("td:eq(3)",u.parent().parent());n.append('<b title="统计在线的人数">('+t.length+"人在线)</b>");for(var p=0;p<t.length;++p){n.append($("<div>",{style:"text-align:left;"}).append(v.eq(p),q.eq(p),t.eq(p)))}if($("#pagination-digg",o).length>0){$.ajax({url:"militaryUnit.html?id="+l+"&page=2",success:function(B){var A=$('img[src="//cdn.e-sim.org//img/newOnline.png"]',B).prev();var z=A.prev();var w=z.prev();var x=parseInt(n.find("b:eq(1)").text().replace(/[^0-9]/g,""));x+=A.length;n.find("b:eq(1)").text("("+x.toString()+"人在线)");for(var y=0;y<A.length;++y){n.append($("<div>",{style:"text-align:left;"}).append(w.eq(y),z.eq(y),A.eq(y)))}},error:function(w,x){$.ajax(this)}})}var s=$('div.battleDiv a[href^="battle.html"]',o).parent();var m=$("div.xflagsMedium",$("div.battleDiv",o).parent().parent());if(m.length!=3){u.after("无军令");u.remove();return}if(m.eq(0).attr("class")===m.eq(2).attr("class")){m.eq(0).attr("style","vertical-align:middle;");var r=getCountryFormXflagsClass(m.eq(1).attr("class"));m.eq(1).attr("class","xflagsSmall xflagsSmall-"+r);m.eq(1).attr("style","vertical-align:middle;")}else{m.eq(1).attr("style","vertical-align:middle;");var r=getCountryFormXflagsClass(m.eq(0).attr("class"));m.eq(0).attr("class","xflagsSmall xflagsSmall-"+r);m.eq(0).attr("style","vertical-align:middle;")}u.after(s,m.eq(0),"vs",m.eq(1));u.remove()},error:function(m,n){console.log(url,"抓取错误 (",n,")");$("#ehShow_"+l).click()}})})}}function updateCurrencyRatio(g){if(config.fetchCurrencyDisabled){return}if($(".dataTable:first tr:eq(1) td",g).length===1){return}var c=getCountryFormXflagsClass($(".dataTable:first tr:eq(1) td:eq(1) div.xflagsSmall",g).attr("class"));var e=parseFloat($(".dataTable:first tr:eq(1) td:eq(2) b",g).text().replace(",","."));var d=getCountryFormXflagsClass($(".dataTable:first tr:eq(1) td:eq(2) div.xflagsSmall",g).attr("class"));if(d==="Gold"){var f=countryInfo[c].id;if(currencyRatio[f]===undefined){currencyRatio[f]={}}var b=currencyRatio[f];if(b.buy===undefined){b.buy={}}b.buy.ratio=1/e;setUpdatedDate(b.buy);localStorage.setItem("currencyRatio",JSON.stringify(currencyRatio))}else{var f=countryInfo[d].id;if(currencyRatio[f]===undefined){currencyRatio[f]={}}var b=currencyRatio[f];if(b.sell===undefined){b.sell={}}b.sell.ratio=e;setUpdatedDate(b.sell);localStorage.setItem("currencyRatio",JSON.stringify(currencyRatio))}}function enhanceCurrency(){$("div.xflagsSmall + b").each(function(){var k=$(this);if(isNaN(k.text())){return}var f=getCountryFormXflagsClass(k.prev().attr("class"));var l=countryInfo[f]&&countryInfo[f].id;if(!l||!currencyRatio[l]||!currencyRatio[l].sell||!currencyRatio[l].buy){return}var p=countryInfo[l]&&countryInfo[l].currencyName;if(k.parent().text().indexOf(k.text()+" "+p)===-1){return}var c=parseFloat(k.text());var m=(currencyRatio[l].sell.ratio);var d=c/m;var e=(currencyRatio[l].buy.ratio);var n=c/e;var o=Math.abs(d-n)<0.01;var h=((m+e)/2).toPrecision(4);var g=((d+n)/2).toPrecision(4);d=d.toPrecision(4);n=n.toPrecision(4);if(o){if(k.next().length===1){k.next().before("(",$("<b>",{text:g,title:""+h+" "+p+" = 1 Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}else{k.parent().append("(",$("<b>",{text:g,title:""+h+" "+p+" = 1 Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}}else{if(k.next().length===1){k.next().before("(",$("<b>",{text:n+" 或 "+d,title:"用 "+n+" Gold买 "+c+" "+p+"，或用 "+c+" "+p+"卖 "+d+" Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}else{k.parent().append("(",$("<b>",{text:n+" 或 "+d,title:"用 "+n+" Gold买 "+c+" "+p+"，或用 "+c+" "+p+"卖 "+d+" Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}}});$("td b").each(function(){var d=$(this).text().trim().split(" ");if(d.length!==2||isNaN(d[0])||!countryInfo[d[1]]){return}var h=parseFloat(d[0]);var o=d[1];var k=countryInfo[o]&&countryInfo[o].id;if(!k||!currencyRatio[k]||!currencyRatio[k].sell||!currencyRatio[k].buy){return}var b=parseFloat(d[1]);var l=(currencyRatio[k].sell.ratio);var c=b/l;var e=(currencyRatio[k].buy.ratio);var m=b/e;var n=Math.abs(c-m)<0.1;var g=((l+e)/2).toPrecision(4);var f=((c+m)/2).toPrecision(4);c=c.toPrecision(4);m=m.toPrecision(4);if(n){$(this).after(" (",$("<b>",{text:f,title:""+g+" "+o+" = 1 Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}else{$(this).after(" (",$("<b>",{text:m+" 或 "+c,title:"用 "+m+" Gold买 "+b+" "+o+"，或用 "+b+" "+o+"卖 "+c+" Gold"}),$("<div>",{"class":"xflagsSmall xflagsSmall-Gold"}),")")}})}function enhanceBattle(){clipWithFlag=false;$("#battleHeaderImage").attr("style","height:85px; background-color:#222");$("#battleHeaderImage img").remove();var b=$(".small-2").eq(1);b.attr("id","ehPanel");b.prev().attr("class",b.prev().attr("class").replace("small-4","small-2"));b.next().attr("class",b.next().attr("class").replace("small-4","small-2"));b.attr("class",b.attr("class").replace("small-2","small-3"));b.after($("<div>",{"class":b.attr("class"),id:"ehRefresh"}));b.empty();var o=[["调试","Debug","bug"],["飞行","Flight","airplane"],["统计","Statistics","stocks"],["特殊","Special","uniF00F"],["观战","Spectator","eye"],["详细","SpectatorDetail","users"],["闹钟","Alarm","uptime"],["高级","Advanced","uniF478"]];var n="padding:6px 2px 6px 2px;";var f=n+" color:orange;";for(var h=0;h<o.length;++h){var l=$('<button class="small button foundation-style" style="'+n+'" id="ehButton'+o[h][1]+'"> <i class="icon-'+o[h][2]+'"></i>'+o[h][0]+"</button> ");var c=$("<div>",{"class":"foundation-radius fightContainer foundation-base-font",style:"display:none;",id:"ehDiv"+o[h][1]});l.click(function(){if(this.getAttribute("style")==n){$("[id^=ehButton]").attr("style",n);$("[id^=ehDiv]").attr("style","display:none;");this.setAttribute("style",f);$("#"+this.getAttribute("id").replace("Button","Div")).attr("style","display:block;")}else{$("[id^=ehButton]").attr("style",n);$("[id^=ehDiv]").attr("style","display:none;")}});b.append(l);var p=localStorage.getItem("battleEnhanceDivPlacement");if(p==null||p!="true"){b.parent().after(c)}else{$("#battleSelectable:first").before(c)}}setupDebug();setupWall();setupRefresh();setupFlight();setupStatistics();setupSpecial();setupSpectator();setupAlarm();setupSpectatorDetail();setupFight();setupFightButton();markAlliance();fixFightFlag();setupAdvanced();addMedkitButton();var e=localStorage.getItem("battleBorderless");if(e==="true"){BorderlessBattlePage()}$("#recentDefenders").parent().parent().prependTo($("#recentDefenders").parent().parent().parent().parent());$("#minimalChatpanel").remove();var m=localStorage.getItem("addEmptyRecentRecord");if(m==="true"){var q=$("#recentDefenders");var d=$("#recentAttackers");for(var g=1;g<=5;g++){if($("#recentDefender"+g).length<=0){$('<span style="display:block" id="recentDefender'+g+'">插件预置栏位</span>').appendTo(q)}}for(var k=1;k<=5;k++){if($("#recentAttacker"+k).length<=0){$('<span style="display:block" id="recentAttacker'+k+'">插件预置栏位</span>').appendTo(d)}}}}function BorderlessBattlePage(){GM_addStyle("#newFightView .fightContainer { margin: 0em!important;padding: .3em!important;border-style:none;}");GM_addStyle("#newFightView .fightContainer .topPlayer { padding-top: 0px!important;}");GM_addStyle("#newFightView .fightContainer .topPlayer a img { margin: 0px auto!important;}");GM_addStyle("#newFightView .fightContainer .fightRounds { margin: 0em!important;}");GM_addStyle("#newFightView .fightContainer #roundCountdown { font-size: 2.4em!important;margin:0 0!important;}");GM_addStyle("#battleSelectable #selectable4, #battleSelectable #selectable5, #battleSelectable #selectable6 { height: 30px!important;}");GM_addStyle("#battleSelectable #selectable4 li, #battleSelectable #selectable5 li, #battleSelectable #selectable6 li { height: 30px!important;}");GM_addStyle(".laurelssprite { height: 90px!important;}");$("i.icon-bread.ui-selectee").remove();$("i.icon-gift-2.ui-selectee").remove();$("i.icon-uniF470.ui-selectee").remove();$("i.icon-tank.ui-selectee").remove();var c=$(".topPlayer").children();for(var b=0;b<c.length;++b){if(c[b].outerHTML=="<br>"){$(".topPlayer")[0].removeChild(c[b])}}$("#moreBattleStats").parent().remove()}function addMedkitButton(){var c=$("#medkitForm");if(c.length>0){var b=$("<button>",{id:"sendMedkitRequest","class":"button smallhelp foundation-style",text:"无需确认直接使用医疗包（当前页面不会刷新额度显示）"}).prependTo(c.parent());b.click(function(){b.attr({disabled:true});var d="item=MEDKIT&storageType=SPECIAL_ITEM&action=USE";$.ajax({type:"POST",url:"storage.html",data:d,success:function(){b.attr({disabled:false});console.log("使用医疗包：成功响应")},error:function(e,f){console.log("使用医疗包时发生错误")}})})}}function getEhTime(){if(isNaN(endEpoch)){endEpoch=(new Date().getTime())+getPageTime()*1000}var b=parseInt((endEpoch-new Date().getTime())/1000)-timeBias;return b<0?0:b}function getPageTime(){var b=$("#roundCountdown");hmsArray=b.text().split(/:| /);return parseInt(hmsArray[0])*3600+parseInt(hmsArray[1])*60+parseInt(hmsArray[2])}function getTimeString(c){var b=(parseInt(c/60))%60;var d=c%60;return"0"+parseInt(c/3600)+(b<10?":0":":")+b+(d<10?":0":":")+d}function setupDebug(){$("#ehDivDebug").append($("<div>",{style:"text-align:left;"}));var d=$('a[href^="region.html?id="][href!="region.html?id="]');userId=parseInt($("#userName").attr("href").replace("profile.html?id=",""));userName=$("#userName").text();userLocationId=parseInt(d.first().attr("href").replace("region.html?id=",""));userLocationName=d.first().text();userCitizenshipId=parseInt($('li > a[href^="battles.html?countryId="][href$="&sorting=BY_TOTAL_DAMAGE&_substidedOnly=on"]').attr("href").match(/.+?countryId=([0-9]+).+?/)[1]);battleId=parseInt($('a[href^="battleStatistics.html?id="]').attr("href").replace("battleStatistics.html?id=",""));battleName=$("#fightName a[class=fightFont]").text().trim();battleLocationId=parseInt(d.length==1?-1:d.last().attr("href").replace("region.html?id=",""));battleLocationName=battleLocationId==-1?"无":battleName;isResistance=($("#fightName div").length>0);roundId=parseInt($("span.fightFont").text().match("[0-9]+$")[0]);battleRoundId=parseInt($("#battleRoundId").val());if($(".xflagsBig").length>0){defenderName=$(".xflagsBig:first").attr("class").split(" ").pop();defenderName=defenderName.substring(defenderName.indexOf("-")+1);attackerName=$(".xflagsBig:last").attr("class").split(" ").pop();attackerName=attackerName.substring(attackerName.indexOf("-")+1)}else{if($(".flags-big").length>0){defenderName=$(".flags-big:first").attr("class").split(" ").pop();attackerName=$(".flags-big:last").attr("class").split(" ").pop()}else{if($(".muAvatar").length>0){defenderName=$(".alliesList.leftList.fightFont").text().trim();attackerName=$(".alliesList.rightList.fightFont").text().trim()}else{defenderName="未知";attackerName="未知"}}}defenderId=countryInfo[defenderName]&&countryInfo[defenderName].id;attackerId=countryInfo[attackerName]&&countryInfo[attackerName].id;defenderScore=$('img[src$="/img/blue_ball.png"]').length;attackerScore=$('img[src$="/img/red_ball.png"]').length;defenderDescription=battleName+", "+defenderName+"方";attackerDescription=battleName+", "+attackerName+"方";isActive=roundId>(defenderScore+attackerScore);isPremium=$("#totalspectators").length>0;log("玩家id=",userId,", 玩家名字=",userName,", 国籍=",userCitizenshipId,", 会员=",isPremium,", 当前位置=",userLocationName," (",userLocationId,")");log("战斗id=",battleId,", 战斗名字=",battleName,", 战斗地点=",battleLocationName," (",battleLocationId,")");log("起义战=",isResistance,", 局数=",roundId,", battleRoundId=",battleRoundId,", 战斗中=",isActive);log(defenderName," v.s. ",attackerName,", 比分",defenderScore,":",attackerScore);timeBias=0;endEpoch=(new Date().getTime())+7200*1000;if(clipWithFlag){defenderNameOrFlag="/"+defenderName.slice(0,5);attackerNameOrFlag="/"+attackerName.slice(0,5)}else{defenderNameOrFlag=defenderName;attackerNameOrFlag=attackerName}if(battleLocationId==-1){document.title=battleName}else{var b=countryInfo[defenderName].shortName;var c=countryInfo[attackerName].shortName;if(defenderName=="Kekistan"){b="KK"}if(attackerName=="Kekistan"){c="KK"}document.title=b+" vs "+c+" @"+battleName}}function log(){var b=$("#ehDivDebug > div");b.append($(".time").first().text().split(" ")[0].slice(0,-1),": ");for(var c=0;c<arguments.length;c++){b.append(arguments[c].toString()," ")}b.append("<br />")}function setupFightButton(){var k=$(".fightButton").length;var m,l,d,b,e,c,f;if(k===2){m=$("#fightButtonBerserk1").parent();f=$("#fightButtonBerserk1").attr("name");m.append("<br />");d=$("<a id='foodWithFight1' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' href='#' title='' value='Berserk' name='"+f+"'> Hit & food</a>");m.append(d);e=$("<a id='giftWithFight1' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' href='#' title='' value='Berserk' name='"+f+"'>Hit & gift</a>");m.append(e)}else{if(k===4){m=$("#fightButtonBerserk1").parent();f=$("#fightButtonBerserk1").attr("name");m.append("<br />");d=$("<a id='foodWithFight1' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+f+"'> Hit & food</a>");m.append(d);e=$("<a id='giftWithFight1' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+f+"'>Hit & gift</a>");m.append(e);l=$("#fightButtonBerserk2").parent();f=$("#fightButtonBerserk2").attr("name");l.append("<br />");b=$("<a id='foodWithFight2' class='button foundation-style smallhelp profileButton foodWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+f+"'> Hit & food</a>");l.append(b);c=$("<a id='giftWithFight2' class='button foundation-style smallhelp profileButton giftWithFight' style='font-size: 0.95em !important; padding: 0.5em !important;' title='' value='Berserk' name='"+f+"'>Hit & gift</a>");l.append(c);b.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)");c.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)")}}if(k!==0){d.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)");e.css("background-image","linear-gradient(to bottom, #c00 0px, #a00 100%)")}unsafeWindow.$(".fightButton").unbind("click");$(".fightButton").click(function(q){q.preventDefault();q.stopPropagation();var o=$(this)[0].name;var p=$(this).attr("value");sendFightRequest(o,p);return false});$(".foodWithFight").click(function(q){q.preventDefault();q.stopPropagation();if(parseFloat($("#actualHealth").html())<=51||(getPageTime()%5)==0){g()}var o=$(this)[0].name;var p=$(this).attr("value");sendFightRequest(o,p);return false});$(".giftWithFight").click(function(q){q.preventDefault();q.stopPropagation();if(parseFloat($("#actualHealth").html())<=51||(getPageTime()%5)==0){n()}var o=$(this)[0].name;var p=$(this).attr("value");sendFightRequest(o,p);return false});function g(){var p="quality="+$("#foodQuality").val();if(varEnableBattleAjaxTimeout==false){$.ajax({type:"POST",url:"eat.html",data:p,success:function(q){h(q)}})}else{var o=$.ajax({type:"POST",url:"eat.html",timeout:varBattleAjaxTimeout*1000,data:p,success:function(q){h(q)},error:function(q,s,r){if(s=="timeout"){o.abort()}}})}}function n(){var o="quality="+$("#giftQuality").val();if(varEnableBattleAjaxTimeout==false){$.ajax({type:"POST",url:"gift.html",data:o,success:function(q){h(q)}})}else{var p=$.ajax({type:"POST",url:"gift.html",timeout:varBattleAjaxTimeout*1000,data:o,success:function(q){h(q)},error:function(q,s,r){if(s=="timeout"){p.abort()}}})}}function h(p){var o=jQuery.parseJSON(p);$("#foodLimit").html(o.foodLimit);$("#giftLimit").html(o.giftLimit);$("#foodLimit2").html(o.foodLimit);$("#giftLimit2").html(o.giftLimit);$("#wellness").html(o.wellness);$("#healthBar").html(o.wellness);$("#healthProgress .ui-progressbar-value").animate({width:o.wellness+"%"},{queue:false});$("#actualHealth").html(o.wellness);$("#foodQ1").html("<b>Q1</b><br>"+o.q1FoodStorage);$("#foodQ2").html("<b>Q2</b><br>"+o.q2FoodStorage);$("#foodQ3").html("<b>Q3</b><br>"+o.q3FoodStorage);$("#foodQ4").html("<b>Q4</b><br>"+o.q4FoodStorage);$("#foodQ5").html("<b>Q5</b><br>"+o.q5FoodStorage);$("#giftQ1").html("<b>Q1</b><br>"+o.q1GiftStorage);$("#giftQ2").html("<b>Q2</b><br>"+o.q2GiftStorage);$("#giftQ3").html("<b>Q3</b><br>"+o.q3GiftStorage);$("#giftQ4").html("<b>Q4</b><br>"+o.q4GiftStorage);$("#giftQ5").html("<b>Q5</b><br>"+o.q5GiftStorage);$("#sfoodQ1").html("<b>Q1</b><br>"+o.q1FoodStorage);$("#sfoodQ2").html("<b>Q2</b><br>"+o.q2FoodStorage);$("#sfoodQ3").html("<b>Q3</b><br>"+o.q3FoodStorage);$("#sfoodQ4").html("<b>Q4</b><br>"+o.q4FoodStorage);$("#sfoodQ5").html("<b>Q5</b><br>"+o.q5FoodStorage);$("#sgiftQ1").html("<b>Q1</b><br>"+o.q1GiftStorage);$("#sgiftQ2").html("<b>Q2</b><br>"+o.q2GiftStorage);$("#sgiftQ3").html("<b>Q3</b><br>"+o.q3GiftStorage);$("#sgiftQ4").html("<b>Q4</b><br>"+o.q4GiftStorage);$("#sgiftQ5").html("<b>Q5</b><br>"+o.q5GiftStorage)}}function sendFightRequest(b,e){var c="weaponQuality="+$("#weaponQuality").attr("value")+"&battleRoundId="+$("#battleRoundId").val()+"&side="+b+"&value="+e;if(varEnableBattleAjaxTimeout==false){$.ajax({type:"POST",url:"fight.html",data:c,success:function(h){$("#fightResponse > div").replaceWith(h);showDamege($(h));var g=$("#healthUpdate",h).text();if(g!==""){var f=g.substr(0,g.length-3);if(f<100){$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right")}$("#healthProgress .ui-progressbar-value").animate({width:f+"%"},{queue:false});$("#healthProgress").attr("title",f+" / 100");$("#actualHealth").html(f)}},error:function(g,m,k){if(g.status=="404"){var l=window.location.protocol;var f=window.location.href;if(l=="http:"){f="https:"+f.substring(5);alert("404错误！点击“确认”立刻切换协议为：https！\r\n建议删除cookie以解决此问题。");location=f}else{if(l=="https:"){f="http:"+f.substring(6);alert("404错误！点击“确认”立刻切换协议为：http！\r\n建议删除cookie以解决此问题。");location=f}else{alert("404错误！请立刻切换协议！\r\n建议删除cookie以解决此问题。")}}}else{var h=$("#showMsg");h.text("错误："+g.status);h.show();h.fadeOut(2000)}}})}else{var d=$.ajax({type:"POST",url:"fight.html",timeout:varBattleAjaxTimeout*1000,data:c,success:function(h){$("#fightResponse > div").replaceWith(h);showDamege($(h));var g=$("#healthUpdate",h).text();if(g!==""){var f=g.substr(0,g.length-3);if(f<100){$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right")}$("#healthProgress .ui-progressbar-value").animate({width:f+"%"},{queue:false});$("#healthProgress").attr("title",f+" / 100");$("#actualHealth").html(f)}},error:function(g,m,k){if(g.status=="404"){var l=window.location.protocol;var f=window.location.href;if(l=="http:"){f="https:"+f.substring(5);alert("404错误！点击“确认”立刻切换协议为：https！\r\n建议删除cookie以解决此问题。");location=f}else{if(l=="https:"){f="http:"+f.substring(6);alert("404错误！点击“确认”立刻切换协议为：http！\r\n建议删除cookie以解决此问题。");location=f}else{alert("404错误！请立刻切换协议！\r\n建议删除cookie以解决此问题。")}}}else{if(m=="timeout"){d.abort();var h=$("#showMsg");h.text("请求超时");h.show();h.fadeOut(2000)}else{var h=$("#showMsg");h.text("错误："+g.status);h.show();h.fadeOut(2000)}}}})}}function showDamege(k){function c(v){v+="";var t=v.split(".");var u=/(\d{1,3})(?=(\d{3})+$)/g;return t[0].replace(u,"$1,")+(t.length==2?"."+t[1]:"")}var r=$("#showMsg");r.text("");r.show();var e=$("#DamageDone",k);if(e.length>0){var p=parseInt(e.text().replace(/,/g,"").replace(/\xA0/g,""));var s=$(".fightsprite",e.parent().parent());var l={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]};var m={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]};for(var h=0;h<s.length;++h){var q=s.eq(h).attr("class").split(" ").pop();if(q in m){var d=m[q];l[d[0]]=d[1]}}var f="";var g=l.xp;delete l.xp;for(h in l){f='<i style="color:'+l[h][0]+';" class="icon-'+h+'" title="'+l[h][1]+'"></i>'+f}f+='<b title="'+g+'次攻击">x'+g+"</b>";var b=$("#fightHistory");var o=$("div[class^=foundation-style]",b);if(o.length===6){$("#ehHistoryExpand").show()}o.slice(0,2).attr("style","opacity:0.6;");o.slice(2,4).attr("style","opacity:0.3;");if($("#ehHistoryExpand").is(":hidden")===false){o.slice(4,6).hide()}var n=($("#fightResult>div").attr("class").split(" ").pop().indexOf("critical")!==-1);if(n){b.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:f}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right critical",text:e.text()}))}else{b.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:f}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right",text:e.text()}))}$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+g);$("#ehTotalDamage").text(c(parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+p))}else{r.text($("#fightResponse").text().trim());r.fadeOut(2000)}}function setupFlight(){if(!isActive||battleLocationId==-1){$("#ehButtonFlight").attr("disabled",true);return}var t=$("#ehDivFlight");var n=$("<div>");var f=$("<td>",{id:"defenderRegions",style:"text-align:left; font-size:9px; width:280px"});var u=$("<td>",{id:"attackerRegions",style:"text-align:right; font-size:9px; width:280px"});var x=$("<td>",{style:"text-align:center; width:250px"});n.append(f,x,u);t.append(n);var k=$("<select>",{id:"ticketQuality",name:"ticketQuality",style:"padding:3px; margin:3px"});for(var s=1;s<=5;++s){k.append($('<option value="'+s+'">Q'+s+"</option>"))}var e=localStorage.getItem("ticketSelectQuality");if(e!==null){k.val(e)}k.change(function(){localStorage.setItem("ticketSelectQuality",k.val())});var o=$("<button>",{text:"飞行","class":"small button foundation-style",style:"padding:5px; margin:3px;"});var p=$("<input>",{type:"checkbox",id:"newFightFrameCheckbox"});var r=$("<label>",{"class":"checkboxlabel","for":"newFightFrameCheckbox",text:"刷新攻击框 ",title:"飞行后不刷新网页，只刷新攻击框"});var b=localStorage.getItem("newFightFrame");if(b==null){localStorage.setItem("newFightFrame","false")}else{p.attr("checked",b=="true")}p.click(function(){$("input[type='radio']:disabled",n).removeAttr("disabled");if(p.is(":checked")){localStorage.setItem("newFightFrame",true)}else{localStorage.setItem("newFightFrame",false)}});var g=$("<div>");x.append(k,o,g);var h=$("<b>",{text:"强制刷新",style:"text-align:right;color:#0066cc;text-decoration:underline;cursor:pointer"});h.click(function(){g.text("正在更新...");w(location)});x.append(p,r,h);var v=$("form[action='travel.html']");if(v.length>0){var c=v.children(".foundation-text-center").children("select#ticketQuality");var m;for(var s=1;s<=5;++s){var l=c.find("option[value="+s+"]");if(l.length<1){m=0}else{m=l.text().split("(")[1].split(")")[0];if(m.indexOf(",")>0){m=m.split(",")[0]}}if(m!==""){$("#ticketQuality option[value='"+s+"']").text("Q"+s+" ("+m+")")}else{$("#ticketQuality option[value='"+s+"']").text("Q"+s+" (0)")}}}else{$.ajax({url:"travel.html",success:function(A){console.log("获取机票数量成功");var B=$("select#ticketQuality",A);var d;for(var y=1;y<=5;++y){var z=B.find("option[value="+y+"]");if(z.length<1){d=0}else{d=z.text().split("(")[1].split(")")[0];if(d.indexOf(",")>0){d=d.split(",")[0]}}if(d!==""){$("#ticketQuality option[value='"+y+"']").text("Q"+y+" ("+d+")")}else{$("#ticketQuality option[value='"+y+"']").text("Q"+y+" (0)")}}},error:function(d,q){console.log("获取机票数量失败 (",q,")，重新抓取");$.ajax(this)},})}processRegions();if(b=="true"){$("input[type='radio']:disabled",n).removeAttr("disabled")}o.click(function(){var d=$("input[type='radio']:checked",n);if(d.length===0){g.text("请选择地区");return}var y=parseInt(k.val());var q=parseInt(d.attr("countryId"));var z=parseInt(d.val());g.text("使用Q"+y+"机票飞往 "+countryInfo[q].name+" 的 "+regionInfo[z].name);$.ajax({url:"travel.html",type:"POST",data:{countryId:q,regionId:z,ticketQuality:y},success:function(A){if($("#newFightFrameCheckbox").is(":checked")===true){var B=$("div.testDivred",A);if(B.length===1){g.text("飞行失败："+B.text().trim())}else{g.text("飞行成功！更新攻击框中……");w(location)}}else{var B=$("div.testDivred",A);if(B.length===1){g.text("飞行失败："+B.text().trim())}else{g.text("飞行成功！");if($("#fightButtonBerserk1").length===0){location=location}}}},error:function(A,B){console.log("飞行错误 (",B,")")},})});function w(d){$.ajax({url:d,success:function(A){var q=$("link[href='//cdn.e-sim.org//css/fight.css']",A).parent();if($("#fightLeft").length>0){$("#fightRight").empty();$("#fightRight").append(q.children());var D=$("[id^=fightButton]");var E=D.parent().parent();$("[id^=fightButton] > i",E).remove()}else{$("link[href='//cdn.e-sim.org//css/fight.css'] :first").parent().replaceWith(q);setupFight()}var y=parseFloat($("#actualHealth",A).html());$("#healthProgress .ui-progressbar-value").animate({width:y+"%"},{queue:false});$("#healthProgress").attr("title",y+" / 100");$("#actualHealth").html(y);setupFightButton();fixFightFlag();setupAdvancedFightChooseTable("advancedFightChooseTable");var z=$('a[href^="region.html?id="][href!="region.html?id="]');var F=z.first().parent();var B=$('a[href^="region.html?id="][href!="region.html?id="]',A);var C=B.first().parent();F.replaceWith(C);g.text("更新完毕！")}})}}function markAlliance(){if(!isActive){return}if(defenderId==allies[0]){$(".xflagsBig-"+defenderName).after('<div class="fightFont">祖国</div>')}else{if(allies.indexOf(defenderId)>0){$(".xflagsBig-"+defenderName).after('<div class="fightFont">盟国</div>')}else{if(enemies.indexOf(defenderId)!==-1){$(".xflagsBig-"+defenderName).after('<div class="fightFont">敌国</div>')}else{if(coalitionMembers.indexOf(defenderId)>0){$(".xflagsBig-"+defenderName).after('<div class="fightFont">联盟成员国</div>')}}}}if(attackerId==allies[0]){$(".xflagsBig-"+attackerName).after('<div class="fightFont">祖国</div>')}else{if(allies.indexOf(attackerId)>0){$(".xflagsBig-"+attackerName).after('<div class="fightFont">盟国</div>')}else{if(enemies.indexOf(attackerId)!==-1){$(".xflagsBig-"+attackerName).after('<div class="fightFont">敌国</div>')}else{if(coalitionMembers.indexOf(attackerId)>0){$(".xflagsBig-"+attackerName).after('<div class="fightFont">联盟成员国</div>')}}}}if(allies.indexOf(defenderId)!==-1&&allies.indexOf(attackerId)===-1){var b=defenderId==allies[0]?"祖国":"盟国";$(".flags-medium."+defenderName).after('<b style="color:lightgreen"><i class="icon-uniF479" />帮助'+b+"</b>");$(".flags-medium."+attackerName).after('<b style="color:pink"><i class="icon-uniF478" />打反'+b+"</b>")}else{if(allies.indexOf(defenderId)===-1&&allies.indexOf(attackerId)!==-1){var b=attackerId==allies[0]?"祖国":"盟国";$(".flags-medium."+attackerName).after('<b style="color:lightgreen"><i class="icon-uniF479" />帮助'+b+"</b>");$(".flags-medium."+defenderName).after('<b style="color:pink"><i class="icon-uniF478" />打反'+b+"</b>");$("#copySideAttacker").attr("checked",true)}else{if(enemies.indexOf(defenderId)!==-1&&enemies.indexOf(attackerId)===-1){$(".flags-medium."+attackerName).after('<b style="color:lightgreen"><i class="icon-uniF479" />攻击敌国</b>');$(".flags-medium."+defenderName).after('<b style="color:pink"><i class="icon-uniF478" />帮助敌国</b>');$("#copySideAttacker").attr("checked",true)}else{if(enemies.indexOf(defenderId)===-1&&enemies.indexOf(attackerId)!==-1){$(".flags-medium."+defenderName).after('<b style="color:lightgreen"><i class="icon-uniF479" />攻击敌国</b>');$(".flags-medium."+attackerName).after('<b style="color:pink"><i class="icon-uniF478" />帮助敌国</b>')}else{}}}}}function fixFightFlag(){$(".flags-medium."+defenderName).attr("class","xflagsMedium xflagsMedium-"+defenderName);$(".flags-medium."+attackerName).attr("class","xflagsMedium xflagsMedium-"+attackerName)}function processRegions(){function h(J,H){var r=[];for(var d=0;d<regionInfo[J].neighbours.length;++d){var I=regionInfo[J].neighbours[d];if(regionInfo[I].occupantId==H){r.push(I)}}return r}function g(H,J,K){var L=[];var Q=[H];var N=K;var O=false;N.push(H);while(Q.length>0){var d=Q.pop();L.push(d);if(regionInfo[d].homeCountry==J){O=true}var P=h(d,J);for(var M=0;M<P.length;++M){var I=P[M];if(N.indexOf(I)==-1){Q.push(I);N.push(I)}}}return[L,O]}function F(r,K,J){var d=regionInfo[K].name;var H=$("<input>",{type:"radio",name:"regionId",id:"rR"+r.selector.substring(1,2)+"-"+K,value:K,countryId:regionInfo[K].occupantId});var I='<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[K].occupantId].flagName+'" />';if(regionInfo[K].occupantId!=regionInfo[K].homeCountry){I+='(<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[K].homeCountry].flagName+'" />)'}I+='<label for="rR'+r.selector.substring(1,2)+"-"+K+'"> '+regionInfo[K].name+"</label>";if(regionInfo[K].battle){I+=' <i title="'+regionInfo[K].name+'正在被攻击" class="icon-cannon"></i> '}if(!J){I+=" (被包围)";d+="(被包围)"}if((userLocationId==K)&&H.attr("disabled","disabled")){I+=" (你在这里)"}r.append(H,I,"<br />");return d}function w(r,J){var d=regionInfo[J].name;var H=$("<input>",{type:"radio",name:"regionId",id:"rR"+r.selector.substring(1,2)+"-"+J,value:J,countryId:regionInfo[J].occupantId});var I='<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[J].occupantId].flagName+'" />';if(regionInfo[J].occupantId!=regionInfo[J].homeCountry){I+='(<p class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[J].homeCountry].flagName+'" />)'}I+='<label for="rR'+r.selector.substring(1,2)+"-"+J+'"> '+regionInfo[J].name+"</label>";if(regionInfo[J].battle){I+=' <i title="'+regionInfo[J].name+'正在被攻击" class="icon-cannon"></i> '}I+=" (断路)";d+="(断路)";if((userLocationId==J)&&H.attr("disabled","disabled")){I+=" (你在这里)"}r.append(H,I,"<br />");return d}defenderId=countryInfo[defenderName].id;attackerId=countryInfo[attackerName].id;var c=g(battleLocationId,defenderId,[]);var A=c[1];c=c[0];log("防守方被包围：",!A);isAttackerLinkage=false;isDefenderLinkage=false;var n=h(battleLocationId,defenderId);if(n.length===0){isDefenderLinkage=false;log(battleName,"不与防守方其它地区相连，所以",battleName,"不是守方连接地")}else{var G=g(n[0],defenderId,[battleLocationId]);var m=G[1];G=G[0];if(G.length==c.length-1){log(battleName,"丢掉后，防守方现在相连的地区仍相连，所以",battleName,"不是守方连接地")}else{if(!m){isDefenderLinkage=true;log(battleName,"丢掉后，防守方现在相连的地区被切断，且",regionInfo[n[0]].name,"不与本土相连，因此",battleName,"是守方连接地")}else{for(var z=1;z<n.length;++z){if(G.indexOf(n[z])!=-1){continue}var l=g(n[z],defenderId,[battleLocationId])[1];if(l){isDefenderLinkage=false;log(battleName,"丢掉后，防守方现在相连的地区被切断，但都与本土相连，因此",battleName,"不是守方连接地")}else{isDefenderLinkage=true;log(battleName,"丢掉后，防守方现在相连的地区被切断，且",regionInfo[n[z]].name,"不与本土相连，因此",battleName,"是守方连接地")}}}}}defenderLocationText=F($("#defenderRegions"),battleLocationId,A);attackerLocationText="";if(isResistance){attackerLocationText=F($("#attackerRegions"),battleLocationId,true)}var e=h(battleLocationId,defenderId);var k=[];var C=false;for(var B=0;B<e.length;++B){k=g(e[B],defenderId,[]);C=k[1];defenderLocationText+=(defenderLocationText!==""?" 或 ":"")+F($("#defenderRegions"),e[B],C)}var u=h(battleLocationId,attackerId);var x=[];var p=[];var s=false;var y=false;var q=null;for(var B=0;B<u.length;++B){var t=u[B];if(x.indexOf(t)!=-1){continue}y=B>0;p=g(u[B],attackerId,[]);s=p[1];if(!s){q=u[B]}p=p[0];for(var z=0;z<u.length;++z){if(p.indexOf(u[z])!=-1){if(!isResistance){attackerLocationText+=(attackerLocationText!==""?" 或 ":"")+F($("#attackerRegions"),u[z],s)}x.push(u[z])}}}if(u.length<=0){for(var t=1;t<parseInt(localStorage.getItem("maxRegionCount"));t++){if(regionInfo[t]!=undefined){if(regionInfo[t].occupantId==attackerId){w($("#attackerRegions"),t)}}}}if(!y){isAttackerLinkage=false;log(battleName,"攻克后，进攻方没连接新的地区，因此",battleName,"不是夺回连接地")}else{if(q===null){isAttackerLinkage=false;log(battleName,"攻克后，进攻方的两组地区连成一片，但它们已与本土相连，因此",battleName,"不是夺回连接地")}else{isAttackerLinkage=true;log(battleName,"攻克后，进攻方被包围的"+regionInfo[q].name+"将与另一地区相连，因此",battleName,"是夺回连接地")}}var b=' <div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+countryInfo[regionInfo[battleLocationId].homeCountry].flagName+'" />';var v=battleLocationName;if(regionInfo[battleLocationId].capital){b+='<img style="height:16px" src="https://cdn.e-sim.org/img/map/house.png"> ';v+=" (首都)"}if(regionInfo[battleLocationId].rawRichness==="HIGH"){var f=regionInfo[battleLocationId].raw.toLowerCase();f=f.charAt(0).toUpperCase()+f.slice(1);b+='<img style="height:16px" src="http://cdn.e-sim.org/img/productIcons/'+f+'.png"> ';v+=" ("+f+")"}if(isDefenderLinkage){b+=' (<div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+defenderName+'" />防守连接地) '}if(isAttackerLinkage){b+=' (<div style="vertical-align:middle;" class="xflagsSmall xflagsSmall-'+attackerName+'" />收复连接地) '}$("#fightName a[class=fightFont]").append(b);var o=(isResistance?4:0)+(isDefenderLinkage?2:0)+(isAttackerLinkage?1:0);var D=[defenderNameOrFlag+" 在 "+v+"防守"+attackerNameOrFlag,defenderNameOrFlag+" 防守 "+v+", 保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 在连接地 "+v+"防守"+attackerNameOrFlag,defenderNameOrFlag+" 防守连接地 "+v+", 并保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 镇压 "+attackerNameOrFlag+" 在 "+v+" 的起义",defenderNameOrFlag+" 镇压 "+v+" 的起义, 保持"+attackerNameOrFlag+"断路",defenderNameOrFlag+" 镇压 "+attackerNameOrFlag+" 在连接地 "+v+" 的起义",defenderNameOrFlag+" 镇压连接地 "+v+" 的起义, 并保持"+attackerNameOrFlag+"断路"];var E=[attackerNameOrFlag+" 进攻 "+defenderNameOrFlag+" 的 "+v,attackerNameOrFlag+" 进攻 "+defenderNameOrFlag+", 收复连接地 "+v,attackerNameOrFlag+" 进攻 "+v+", 使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 收复连接地 "+v+", 同时使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 在 "+v+" 起义反抗 "+defenderNameOrFlag,attackerNameOrFlag+" 在 "+v+" 起义反抗 "+defenderNameOrFlag+", 收复连接地",attackerNameOrFlag+" 在 "+v+" 发起起义, 使"+defenderNameOrFlag+"断路",attackerNameOrFlag+" 在 "+v+" 发起起义, 收复连接地并使"+defenderNameOrFlag+"断路"];defenderDescription=D[o];attackerDescription=E[o];log(defenderDescription);log(attackerDescription)}function setupWall(){$("#battleProgressStats").append('<div id="wallStat"></div>');function c(){var f=defenderHistoryClutch.length-1;if(f<=1){return}var k=f-1;while(k>0&&defenderHistoryClutch[k][0]>defenderHistoryClutch[f][0]-15){k--}if(k<f-1){}k++;var g=defenderHistoryClutch[f][0]-defenderHistoryClutch[k][0];var h=(defenderHistoryClutch[f][1]-defenderHistoryClutch[k][1])/g;var e=(attackerHistoryClutch[f][1]-attackerHistoryClutch[k][1])/g;$("#defenderFirepower").text((h*15/1000000).toFixed(1));$("#attackerFirepower").text((e*15/1000000).toFixed(1))}function b(){var f=getEhTime();$("#ehCountdown").text(getTimeString(f));var d=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,""));var e=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,""));var g=d-e;if(g===0){$("#wallStat").text("")}else{if(g>0){$("#wallStat").text(">> "+g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>")}else{$("#wallStat").text("<< "+(-g).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<")}}if($("#autoCopy").is(":checked")){setClipboard()}if(f>0&&f<clutchStandard){if(defenderHistoryClutch.length<=1){lastUpdatedSeconds=f;defenderHistoryClutch.push([-f,d]);attackerHistoryClutch.push([-f,e])}else{if(defenderHistoryClutch[defenderHistoryClutch.length-1][1]<d||attackerHistoryClutch[attackerHistoryClutch.length-1][1]<e){lastUpdatedSeconds=f;defenderHistoryClutch.push([-f,d]);attackerHistoryClutch.push([-f,e])}}$("#wallStat").append(' <b style="font-size:12px;">('+(lastUpdatedSeconds-f)+"秒前更新)</b>");if(lastUpdatedSeconds<=f){c();if($("#ehDivStatistics").attr("style").indexOf("display:block")!=-1){drawChartClutch()}}}}endEpoch=(new Date().getTime())+getPageTime()*1000;window.setInterval(b,1000)}function setupRefresh(){var q=$("#ehRefresh");var p=$("<div>");var f=$("<button>",{type:"button","class":"small button foundation-style",id:"manualRefresh",style:"padding:6px;",html:'<i class="icon-search"></i>刷新',title:"刷新双方的总伤害"});var e=$("<input>",{type:"checkbox","class":"foundation-style",id:"autoRefresh",text:"自动"});var r=$("<input>",{type:"radio",id:"copySideDefender",name:"copySide",value:"defender",checked:"checked"});var u=$("#fightName a[class=fightFont]").text().trim();if($(".fightFlagDefender").length>0){var s=$(".fightFlagDefender").attr("class").split(" ").pop();var h=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+s.substring(s.indexOf("-")+1)})}else{if($(".xflagsBig").length>0){var s=$(".xflagsBig:first").attr("class").split(" ").pop();var h=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+s.substring(s.indexOf("-")+1)})}else{if($(".flags-big").length>0){var h=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+$("div.fightFlag.flags-big").first().attr("class").split(" ")[2]})}else{var h=$("<span>",{style:"vertical-align:middle;","class":"icon-uniF472"})}}}p.append(f,e,"自动",r,h);var o=$("<div>");var g=$("<button>",{type:"button","class":"small button foundation-style",id:"manualCopy",style:"padding:6px;",html:'<i class="icon-comment2"></i>复制',title:"复制战场状态到剪贴板"});var k=$("<input>",{type:"checkbox","class":"foundation-style",id:"autoCopy",text:"自动"});var l=$("<input>",{type:"radio",id:"copySideAttacker",name:"copySide",value:"attacker"});if($(".fightFlagAttacker").length>0){var t=$(".fightFlagAttacker").attr("class").split(" ").pop();var n=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+t.substring(t.indexOf("-")+1)})}else{if($(".xflagsBig").length>0){var t=$(".xflagsBig:last").attr("class").split(" ").pop();var n=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+t.substring(t.indexOf("-")+1)})}else{if($(".flags-big").length>0){var n=$("<p>",{style:"vertical-align:middle;","class":"xflagsSmall xflagsSmall-"+$("div.fightFlag.flags-big").last().attr("class").split(" ")[2]})}else{var n=$("<span>",{style:"vertical-align:middle;","class":"icon-uniF473"})}}}o.append(g,k,"自动",l,n);q.append(p,o);$("#defenderScore").after('<div title="防守方即时输出，仅在自动刷新时显示">防守火力: <b id="defenderFirepower" style="color:lightblue">?</b> M/15秒</div>');$("#attackerScore").after('<div title="进攻方即时输出，仅在自动刷新时显示">进攻火力: <b id="attackerFirepower" style="color:pink">?</b> M/15秒</div>');$("#manualRefresh").click(sendUpdateRequest2);$("#manualCopy").click(setClipboard);var m=0;$("#autoRefresh").click(function(){if($(this).is(":checked")){if(getEhTime()>0){m=window.setInterval(sendUpdateRequest2,7000)}$("#manualRefresh").attr("disabled",true)}else{window.clearInterval(m);$("#manualRefresh").attr("disabled",false)}});$("#autoCopy").click(function(){if($(this).is(":checked")){$("#manualCopy").attr("disabled",true)}else{$("#manualCopy").attr("disabled",false)}});if(typeof(unsafeWindow.sendUpdateRequest)=="function"){var c=unsafeWindow.sendUpdateRequest.toString().replace(/dataString \+\= \'&at\=.+?;/,";").replace(/dataString \+\= \'&ci\=.+?;/,";").replace(/\s+/g,"");var b=1075;if(isPremium){b=1100}if(c.length===b){log("sendUpdateRequest已检查，无变化（字数："+b+"）")}else{alert("页面中的 sendUpdateRequest 函数有更新，请联系e-sim helper的开发者。刷新功能暂时禁用。\n");$("#autoRefresh").attr("disabled",true);$("#manualRefresh").attr("disabled",true);log("sendUpdateRequest已检查，有变化")}}else{log("sendUpdateRequest未检查")}if(!isActive){$("#autoRefresh").attr("disabled",true);$("#manualRefresh").attr("disabled",true);$("#autoCopy").attr("disabled",true);$("#manualCopy").attr("disabled",true);$("#copySideAttacker").attr("disabled",true);$("#copySideDefender").attr("disabled",true)}}function setClipboard(){function k(m,o){var n=m.toString()+":"+o.toString();if(m===o){return n}if(m>o){return n+(m===8?"获胜":"领先")}else{return n+(o===8?"失利":"落后")}}var l=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,""));var d=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,""));var g=((l-d)/1000000).toFixed(2);var e=getEhTime();var h="";if(e>=120||e%5===0){var f=document.URL.match(/.+?battle.html\?id=[0-9]+/).toString();if(f.indexOf("https")>=0){h+=f+"\n";h+=f.replace(/https/,"http")+"\n"}else{if(f.indexOf("http")>=0){h+=f.replace(/http/,"https")+"\n";h+=f+"\n"}else{h+=document.URL.match(/.+?battle.html\?id=[0-9]+/)+"\n"}}}if(e>=120){if($("#copySideDefender").is(":checked")){h+="第"+roundId+"局(总比分"+k(defenderScore,attackerScore)+"), t"+parseInt(e/60)+"墙高"+g.toString()+"M\n"+defenderDescription+(battleLocationId==-1?"":"\n加成地点"+defenderLocationText)}else{h+="第"+roundId+"局(总比分"+k(attackerScore,defenderScore)+"), t"+parseInt(e/60)+"墙高"+(-g).toString()+"M\n"+attackerDescription+(battleLocationId==-1?"":"\n加成地点"+attackerLocationText)}}else{if(e>0){h+=e.toString()+"秒, ";var b=parseFloat($("#defenderFirepower").text());var c=parseFloat($("#attackerFirepower").text());if($("#copySideDefender").is(":checked")){h+=g.toString()+"M ("+(lastUpdatedSeconds-e)+"秒前更新)";if(!isNaN(b)){h+=", "+defenderNameOrFlag+"火力 "+b+(b<c?"M < ":"M ≥ ")+c+"M"}}else{h+=(-g).toString()+"M ("+(lastUpdatedSeconds-e)+"秒前更新)";if(!isNaN(b)){h+=", "+attackerNameOrFlag+"火力 "+c+(c<b?"M < ":"M ≥ ")+b+"M"}}}else{h+=battleName+"第"+roundId+"局结束, ";if($("#copySideDefender").is(":checked")){if(l>=d){h+="防守方"+defenderNameOrFlag+"获胜("+g.toString()+"M), 总比分"+k(defenderScore+1,attackerScore)}else{h+="防守方"+defenderNameOrFlag+"失利("+g.toString()+"M), 总比分"+k(defenderScore,attackerScore+1)}}else{if(d>=l){h+="进攻方"+attackerNameOrFlag+"获胜("+(-g).toString()+"M), 总比分"+k(attackerScore+1,defenderScore)}else{h+="进攻方"+attackerNameOrFlag+"失利("+(-g).toString()+"M), 总比分"+k(attackerScore,defenderScore+1)}}}}GM_setClipboard(h)}function adjustTime(c){var b=getEhTime();var d=timeBias;if(c<b){timeBias+=(b-c)}else{if(timeBias>0&&b%6===0){timeBias--}}console.log("实际时间≤"+c+", 页面时间="+getPageTime()+", eh计时="+b+", 修正值="+d,"->",timeBias)}function sendUpdateRequest2(b){var c="id="+battleRoundId;c+="&at="+userId;c+="&ci="+userCitizenshipId;if(isPremium||b===true){log("以高级会员身份抓取数据");c+="&premium=1"}$.ajax({type:"GET",url:"battleScore.html",data:c,dataType:"json",success:function(e){historyLen=defenderHistoryClutch.length;if(historyLen>0){if(defenderHistoryClutch[historyLen-1][1]>parseInt(e.defenderScore.replace(/,/g,"").replace(/\xA0/g,""))||attackerHistoryClutch[historyLen-1][1]>parseInt(e.attackerScore.replace(/,/g,"").replace(/\xA0/g,""))){return}}e=cloneInto(e,unsafeWindow);unsafeWindow.updateStatus(e.attackerScore,e.defenderScore,e.remainingTimeInSeconds,e.percentAttackers);adjustTime(e.remainingTimeInSeconds);if(e.remainingTimeInSeconds<=clutchStandard){lastUpdatedSeconds=e.remainingTimeInSeconds<0?0:e.remainingTimeInSeconds;defenderHistoryClutch.push([-lastUpdatedSeconds,parseInt(e.defenderScore.replace(/,/g,"").replace(/\xA0/g,""))]);attackerHistoryClutch.push([-lastUpdatedSeconds,parseInt(e.attackerScore.replace(/,/g,"").replace(/\xA0/g,""))]);if(lastUpdatedSeconds>0&&$("#ehDivStatistics").attr("style").indexOf("display:block")!=-1){drawChartClutch()}}unsafeWindow.updateBattleHeros(e.topAttackers,e.topDefenders);unsafeWindow.updateTop10(e.top10Attackers,e.top10Defenders);if(!isPremium&&b===false){unsafeWindow.updateBattleMonitor(e)}else{$("#ehTotaldefenders").html(e.defendersOnline);$("#ehTotalattackers").html(e.attackersOnline);$("#ehTotalspectators").html(e.spectatorsOnline);$("#ehDefendersMenu").html(e.defendersByCountries);$("#ehAttackersMenu").html(e.attackersByCountries);$("#ehSpectatorsMenu").html(e.spectatorsByCountries);$(".countryNameTranslated").attr("onclick","window.open('citizensOnline.html?countryId=' + countryInfo[this.innerText].id);")}unsafeWindow.updatePlace(e.yourPlace);unsafeWindow.updateTotalDamage(e.totalPlayerDamage);for(var d=0;d<e.recentAttackers.length;d++){if(e.recentAttackers[d].id==unsafeWindow.latestAttackerId){e.recentAttackers=cloneInto(e.recentAttackers.slice(0,d),unsafeWindow);break}}for(d=0;d<e.recentDefenders.length;d++){if(e.recentDefenders[d].id==unsafeWindow.latestDefenderId){e.recentDefenders=cloneInto(e.recentDefenders.slice(0,d),unsafeWindow);break}}if(e.recentAttackers.length!==0){unsafeWindow.latestAttackerId=e.recentAttackers[0].id;unsafeWindow.attackerHits=e.recentAttackers}if(e.recentDefenders.length!==0){unsafeWindow.latestDefenderId=e.recentDefenders[0].id;unsafeWindow.defenderHits=e.recentDefenders}}})}function convertDateString(b){return b.slice(6,10)+"/"+b.slice(3,5)+"/"+b.slice(0,2)+b.slice(10,b.indexOf(":")+6)}function drawChartForFinishedBattle(B){var o=JSON.parse(B);var n=new Date(convertDateString(o[o.length-1].time));var f=new Date(convertDateString(o[0].time));$("<div>",{text:"服务器时间 "+n.toLocaleString()+" - "+f.toLocaleString()}).prependTo($("#ehBattleDescription"));n=n.getTime();var r=parseInt((f.getTime()-n)/(60*1000));if(r<10){n=f-600*1000;r=10}else{if(r<120){n=f-7200*1000;r=120}}var c={"true":[],"false":[]};for(var s=0;s<=r;++s){c["true"][s]=0;c["false"][s]=0}var v={"true":{},"false":{}};var A={"true":{},"false":{}};var w={"true":{},"false":{}};var h=0;for(s=0;s<o.length;++s){var u=o[s];h+=u.berserk?5:1;var m=parseInt((Date.parse(convertDateString(u.time))-n)/(60*1000));c[u.defenderSide][m]=c[u.defenderSide][m]+u.damage;var q=u.citizenship;v[u.defenderSide][q]=(v[u.defenderSide][q])?(v[u.defenderSide][q]+u.damage):u.damage;var g=u.citizenId;w[u.defenderSide][g]=(w[u.defenderSide][g])?(w[u.defenderSide][g]+u.damage):u.damage;var p=u.militaryUnit;if(p){A[u.defenderSide][p]=(A[u.defenderSide][p])?(A[u.defenderSide][p]+u.damage):u.damage}}$("<div>",{text:"本局掉落Q5装备"+(h/30000).toFixed(2)+"件，Q4装备"+(h/10000).toFixed(2)+"件"}).prependTo($("#ehBattleDescription"));var y=new Array(r+1);var z=new Array(r+1);y[0]=c["true"][0];z[0]=c["false"][0];for(s=1;s<=r;++s){y[s]=y[s-1]+c["true"][s];z[s]=z[s-1]+c["false"][s]}var x=Math.pow(10,Math.floor(Math.log10(Math.max(y[r],z[r]))));$.jqplot("ehChart120m",[y,z],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"时间 (分钟)",max:r,min:0,tickOptions:{formatString:"%d"}},yaxis:{min:0,tickInterval:x,pad:1.1,tickOptions:{formatString:"%'d"}}}});var k=180;c={"true":[],"false":[]};for(s=0;s<=k;++s){c["true"][s]=0;c["false"][s]=0}var w={"true":{},"false":{}};for(s=0;s<o.length;++s){var u=o[s];var m=parseInt((f-Date.parse(convertDateString(u.time)))/1000);m=m>=k?k:m;c[u.defenderSide][m]=c[u.defenderSide][m]+u.damage;if(m<k){var g=u.citizenId;if(w[u.defenderSide][g]){w[u.defenderSide][g].damage+=u.damage;w[u.defenderSide][g].hitNumber[u.weapon]+=u.berserk?5:1;w[u.defenderSide][g].first=m}else{w[u.defenderSide][g]={};w[u.defenderSide][g].citizenId=g;w[u.defenderSide][g].damage=u.damage;w[u.defenderSide][g].hitNumber=[0,0,0,0,0,0];w[u.defenderSide][g].hitNumber[u.weapon]=u.berserk?5:1;w[u.defenderSide][g].citizenship=u.citizenship;w[u.defenderSide][g].militaryUnit=u.militaryUnit;w[u.defenderSide][g].first=m;w[u.defenderSide][g].last=m}}}var b=c["true"][k];var e=c["false"][k];y=[[-k,b]];z=[[-k,e]];for(s=k-1;s>=0;--s){b+=c["true"][s];e+=c["false"][s];y.push([-s,b]);z.push([-s,e])}$.jqplot("ehChartClutch",[y,z],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"时间 (秒)",max:0,min:-k,tickOptions:{formatString:"%d"}},yaxis:{min:0,tickInterval:x,pad:1.1,tickOptions:{formatString:"%'d"}}}});l(w["true"],$("#ehTableClutchDefenders"));l(w["false"],$("#ehTableClutchAttackers"));function l(d,C){var t=Object.keys(d).map(function(G){return d[G]});t.sort(function(H,G){return G.damage-H.damage});var F=$("<div>",{style:"text-align: left; margin:1em 1.6em 1em 1em; font-size:.9em;"}).appendTo(C);var D=$("<table>",{style:"width:100%;"}).appendTo(F);var E=$("<tr>").appendTo(D).append($("<td>",{text:"玩家",style:"text-align:center;"}),$("<td>",{colspan:2,text:"时段",style:"text-align:center;"}),$("<td>",{text:"次数",style:"text-align:right;"}),$("<td>",{text:"Q5",style:"text-align:right;"}),$("<td>",{text:"伤害值",style:"text-align:right;"}));$.each(t,function(H,I){var G=$("<tr>").appendTo(D);var K=$("<td>").appendTo(G);$("<b>",{style:"float:left;padding: 0 .5em 0 0",text:H+1}).appendTo(K);$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[I.citizenship].flagName}).appendTo(K);if(citizenPage[I.citizenId]){$("<img>",{align:"absmiddle","class":"smallAvatar",src:citizenPage[I.citizenId].avatar.replace("normal","small")}).appendTo(K)}else{$("<img>",{align:"absmiddle","class":"smallAvatar",src:"//cdn.e-sim.org/img/blank-avatar.png"}).appendTo(K)}$("<a>",{"class":"profileLink",href:"profile.html?id="+I.citizenId,text:citizenInfo[I.citizenId]?citizenInfo[I.citizenId].login:"???"}).appendTo(K);$("<td>",{style:"text-align:right;",text:I.first+"~"}).appendTo(G);$("<td>",{style:"text-align:right;",text:I.last+"s"}).appendTo(G);var J=0;$.each(I.hitNumber,function(L,M){J+=M});$("<td>",{style:"text-align:right;",text:J}).appendTo(G);$("<td>",{style:"text-align:right;",text:I.hitNumber[5]}).appendTo(G);$("<td>",{style:"text-align:right;",text:I.damage.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}).appendTo(G)})}}function drawChartClutch(){if(getEhTime()>=clutchStandard){$("#ehChartClutch").text("压秒趋势图仅在战场结束前"+clutchStandard+"秒内显示");return}$("#ehChartClutch").text("");console.log(getEhTime(),"重绘压秒趋势图");if(chartClutch){chartClutch.destroy()}chartClutch=$.jqplot("ehChartClutch",[defenderHistoryClutch,attackerHistoryClutch],{series:[{color:"blue"},{color:"red"}],axes:{xaxis:{label:"倒计时",max:0,pad:1.1,tickOptions:{formatString:"%d"}},yaxis:{min:0,pad:1.1,tickOptions:{formatString:"%'d"}}}})}function setupStatistics(){if(!isActive){$("#ehButtonStatistics").click();$("#ehDivStatistics").append($("<div>",{id:"ehBattleDescription"}));$("#ehDivStatistics").append('<br /> <div style="font-size:24px;"> 全场趋势图 </div>');$("#ehDivStatistics").append($("<div>",{id:"ehChart120m",style:"height:300px;width:750px;"}));$("<table>",{id:"ehTable120m"}).hide().appendTo($("#ehDivStatistics"));$("#ehDivStatistics").append('<br /> <br /> <br /> <div style="font-size:24px;"> 压秒趋势图 </div>');$("#ehDivStatistics").append($("<div>",{id:"ehChartClutch",style:"height:300px;width:750px;"}));$("<div>",{id:"ehTableClutchDefenders","class":"foundation-style small-5 columns"}).appendTo($("#ehDivStatistics"));$("<div>",{id:"ehTableClutchAttackers","class":"foundation-style small-5 columns"}).appendTo($("#ehDivStatistics"));$.ajax({url:"apiFights.html?battleId="+battleId+"&roundId="+roundId,timeout:5000,success:drawChartForFinishedBattle,error:function(b,c){log("战斗记录抓取错误 (",c,")，重新抓取");$.ajax(this)},})}else{$("#ehDivStatistics").append('<br /> <div style="font-size:24px;"> 压秒趋势图 </div>');$("#ehDivStatistics").append($("<div>",{id:"ehChartClutch",style:"height:300px;width:750px;"}));defenderHistoryClutch=[[]];attackerHistoryClutch=[[]];chartClutch=null;clutchStandard=300;lastUpdatedSeconds=getEhTime();$("#ehButtonStatistics").click(drawChartClutch)}}function setupSpecial(){var m=$("#ehDivSpecial");var d=$("<table>",{style:"width:100%;line-height:1px;"}).appendTo(m);var k=$("<tr>").appendTo(d);var e=$("<td>").appendTo(k);var l=$("<p>",{"class":"AjaxStat",text:"准备中……"}).appendTo(e);function c(){var n=ajaxs.length;for(var o=0;o<n;o++){if((ajaxs[o].readyState==4)||(ajaxs[o].readyState==0)){ajaxs.splice(o,1);o=o-1;n=n-1}}n=ajaxs.length;if(n<=0){l.text("当前网页共有"+n+"个未完成请求，网络畅通。")}else{if(n<6){l.text("当前网页共有"+n+"个未完成请求，网络畅通。")}else{l.text("当前网页共有"+n+"个未完成请求，网络堵塞，后续请求无法立即响应。");if(($("#AutoAbortAllAjax").is(":checked"))&&(n>10)){abortAll()}}}}setInterval(c,3000);k=$("<tr>").appendTo(d);e=$("<td>").appendTo(k);var h=$("<button>",{text:"终止所有未完成请求","class":"small button foundation-style"}).appendTo(e);h.click(function(){abortAll()});addCheckBoxSettingFrame(e,"AutoAbortAllAjax","自动清理请求","AutoAbortAllAjax",false);$("<p>发送到Discord</p>").appendTo(m);d=$("<table>",{style:"width:100%;line-height:1px;"}).appendTo(m);k=$("<tr>").appendTo(d);e=$("<td>").appendTo(k);k=$("<tr>").appendTo(d);e=$("<td>").appendTo(k);$("<p>登录网页版discord，开启F12控制台的Network页，在discord频道里</p><p>发送一条信息，点击控制台Network里出现的messages，在右边往下</p><p>找到Request Headers的authorization：右边内容复制到这里</p>").appendTo(e);e=$("<td>").appendTo(k);$("<p>",{text:"右击discord频道，选择复制ID粘贴进来"}).appendTo(e);k=$("<tr>").appendTo(d);e=$("<td>").appendTo(k);$("<span>",{text:"authToken："}).appendTo(e);addTextboxSettingFrame(e,300,"discordAuthToken","");e=$("<td>").appendTo(k);$("<span>",{text:"channelID："}).appendTo(e);addTextboxSettingFrame(e,200,"discordChannelID","");k=$("<tr>").appendTo(d);e=$("<td>").appendTo(k);addCheckBoxSettingFrame(e,"diyMessageToDiscord","自定义发送消息","diyMessageToDiscord",false);addTextboxSettingFrame(e,200,"diyMessageToDiscordText","");e=$("<td>").appendTo(k);var b=$("<button>",{text:"发送到Discord",id:"sendToDiscordButton","class":"small button foundation-style"}).appendTo(e);b.click(function(){if($("#diyMessageToDiscord").is(":checked")){g($("#diyMessageToDiscordText").val(),localStorage.getItem("discordAuthToken"),localStorage.getItem("discordChannelID"))}else{g(f(),localStorage.getItem("discordAuthToken"),localStorage.getItem("discordChannelID"))}});addCheckBoxSettingFrame(e,"autoSendMessageToDiscord","T5自动发送(不用记得去掉)","autoSendMessageToDiscord",false);function f(){function r(u,w){var v=u.toString()+":"+w.toString();if(u===w){return v}if(u>w){return v+(u===8?"获胜":"领先")}else{return v+(w===8?"失利":"落后")}}var o=parseInt($("#defenderScore").text().replace(/,/g,"").replace(/\xA0/g,""));var p=parseInt($("#attackerScore").text().replace(/,/g,"").replace(/\xA0/g,""));var q=((o-p)/1000000).toFixed(2);var s=getEhTime();var n="";var t=document.URL.match(/.+?battle.html\?id=[0-9]+/).toString();if(t.indexOf("https")>=0){n+=t+"\n";n+=t.replace(/https/,"http")+"\n"}else{if(t.indexOf("http")>=0){n+=t.replace(/http/,"https")+"\n";n+=t+"\n"}else{n+=document.URL.match(/.+?battle.html\?id=[0-9]+/)+"\n"}}if(s>0){if($("#copySideDefender").is(":checked")){n+="第"+roundId+"局(总比分"+r(defenderScore,attackerScore)+"), t"+parseInt(s/60)+"墙高"+q.toString()+"M\n"+defenderDescription}else{n+="第"+roundId+"局(总比分"+r(attackerScore,defenderScore)+"), t"+parseInt(s/60)+"墙高"+(-q).toString()+"M\n"+attackerDescription}}else{n+=battleName+"第"+roundId+"局结束, ";if($("#copySideDefender").is(":checked")){if(o>=p){n+="防守方"+defenderNameOrFlag+"获胜("+q.toString()+"M), 总比分"+r(defenderScore+1,attackerScore)}else{n+="防守方"+defenderNameOrFlag+"失利("+q.toString()+"M), 总比分"+r(defenderScore,attackerScore+1)}}else{if(p>=o){n+="进攻方"+attackerNameOrFlag+"获胜("+(-q).toString()+"M), 总比分"+r(attackerScore+1,defenderScore)}else{n+="进攻方"+attackerNameOrFlag+"失利("+(-q).toString()+"M), 总比分"+r(attackerScore,defenderScore+1)}}}return n}function g(p,n,o){if((p!="")&&(n!="")&&(o!="")){$.ajax({type:"POST",url:"https://discordapp.com/api/channels/"+o+"/messages",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US","Content-Type":"application/json",Authorization:n},data:JSON.stringify({content:p})})}else{alert("发送失败：缺少参数")}}}var setupAdvancedIsAutoFighting=false;function setupAdvancedFightChooseTable(p){var r=$("."+p);if(r.length>0){r.remove()}var g="defender";var y="attacker";var k="side";var m="undefined";var v="Berserk";var x=$("<table>",{"class":p,style:"width:100%;line-height:1px;"});var c=$("<tr>",{style:"background-color:DarkSlateGray;",height:"30px"}).appendTo(x);var n=$("<td>").appendTo(c);$("<span>输出选择：</span>").appendTo(n);if($("#fightButton2").length>0){n=$("<td>").appendTo(c);$("<span>防守方：</span>").appendTo(n);var d=$("<input>",{type:"radio",id:"AFHitStyleLeftHit",name:"AFHitStyle","data-AFSide":g,"data-AFValue":m}).appendTo(n);var e=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleLeftHit",text:"打一下"}).appendTo(n);var w=$("<input>",{type:"radio",id:"AFHitStyleLeftBerserk",name:"AFHitStyle","data-AFSide":g,"data-AFValue":v}).appendTo(n);var l=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleLeftBerserk",text:"打五下"}).appendTo(n);n=$("<td>").appendTo(c);$("<span>进攻方：</span>").appendTo(n);var h=$("<input>",{type:"radio",id:"AFHitStyleRightHit",name:"AFHitStyle","data-AFSide":y,"data-AFValue":m}).appendTo(n);var u=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleRightHit",text:"打一下"}).appendTo(n);var o=$("<input>",{type:"radio",id:"AFHitStyleRightBerserk",name:"AFHitStyle","data-AFSide":y,"data-AFValue":v}).appendTo(n);var f=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleRightBerserk",text:"打五下"}).appendTo(n)}else{if($("#fightButton1").length>0){n=$("<td>").appendTo(c);var s=$("<input>",{type:"radio",id:"AFHitStyleHit",name:"AFHitStyle","data-AFSide":k,"data-AFValue":m}).appendTo(n);var b=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleHit",text:"打一下"}).appendTo(n);var t=$("<input>",{type:"radio",id:"AFHitStyleBerserk",name:"AFHitStyle",checked:"checked","data-AFSide":k,"data-AFValue":v}).appendTo(n);var q=$("<label>",{"class":"checkboxlabel","for":"AFHitStyleBerserk",text:"打五下"}).appendTo(n)}else{n=$("<td>").appendTo(c);$("<span>当前所在地无法输出</span>").appendTo(n)}}$(".setupAdvancedTable").after(x)}function setupAdvanced(){var n=$("#ehDivAdvanced");if(localStorage.getItem("EnableAutoFight")!=="true"){$("<p>",{"class":"advancedStat",text:"未启用自动打枪。"}).appendTo(n);return}var q=$("<p>",{"class":"advancedStat",text:"使用自动打枪有可能受到封号惩罚。使用前你必须清楚其原理作用和可能产生的后果。"}).appendTo(n);function m(z){q.text(z)}var f=false;var w;var o=0;var c=0;var u=0;var p;function x(){o=0;c=0;u=0}function g(C,z){var B=z-C;var A=Math.random()*B+C;A=parseInt(A,10);return A}var e=[];t();function t(){var D=$("<div>",{"class":"foundation-style small-10 columns foundation-text-center"}).appendTo(n);var A=$("<table>",{align:"right"}).appendTo(D);var I=$("<button>",{type:"button","class":"small button foundation-style",id:"AFManualStart",text:"开始自动打枪"}).appendTo(A);I.attr("disabled",true);var P=$("<button>",{type:"button","class":"small button foundation-style",id:"AFStopButton",text:"停止自动打枪"}).appendTo(A);P.attr("disabled",true);var M=$("<table>",{"class":"setupAdvancedTable",style:"width:100%;line-height:1px;height:200px;"}).appendTo(n);var L;var E;L=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(M);E=$("<td>",{width:"25%"}).appendTo(L);$("<span>补充额度顺序：</span>").appendTo(E);E=$("<td>",{width:"25%"}).appendTo(L);addSelectSettingFrame(E,"优先：",[0,1,2],["无","食物","礼物"],"AFRestoreHealth1",2);E=$("<td>",{width:"25%"}).appendTo(L);addSelectSettingFrame(E,"其次：",[0,1,2],["无","食物","礼物"],"AFRestoreHealth2",1);$("<td>",{width:"25%"}).appendTo(L);L=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(M);E=$("<td>").appendTo(L);addCheckBoxSettingFrame(E,"AFRestrictHitCount","限制攻击次数：","AFRestrictHitCount",false);$("<span>最多</span>").appendTo(E);addTextboxSettingFrame(E,60,"AFRestrictHitCountTextbox","15");$("<span>次攻击</span>").appendTo(E);E=$("<td>").appendTo(L);addCheckBoxSettingFrame(E,"AFRestrictDamage","限制伤害：","AFRestrictDamage",false);$("<span>总伤害超过</span>").appendTo(E);addTextboxSettingFrame(E,60,"AFRestrictDamageTextbox","1000000");$("<span>后停止</span>").appendTo(E);E=$("<td>").appendTo(L);addCheckBoxSettingFrame(E,"AFRestrictTime","限制时间：","AFRestrictTime",false);$("<span>自动打枪</span>").appendTo(E);addTextboxSettingFrame(E,60,"AFRestrictTimeTextbox","10");$("<span>秒后停止</span>").appendTo(E);E=$("<td>").appendTo(L);L=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(M);E=$("<td>").appendTo(L);var F=$("<input>",{type:"radio",id:"AFStartModeAuto",name:"AFSelectStartMode","data-startmode":"auto"}).appendTo(E);var C=$("<label>",{"class":"checkboxlabel","for":"AFStartModeAuto",text:"自动开始："}).appendTo(E);$("<span>在S</span>").appendTo(E);addTextboxSettingFrame(E,40,"AFStartModeAutoStartTextbox","15");$("<span>到S</span>").appendTo(E);addTextboxSettingFrame(E,40,"AFStartModeAutoEndTextbox","10");$("<span>之间任意时间</span>").appendTo(E);E=$("<td>").appendTo(L);var G=$("<input>",{type:"radio",id:"AFStartModeManual",name:"AFSelectStartMode","data-startmode":"manual"}).appendTo(E);var B=$("<label>",{"class":"checkboxlabel","for":"AFStartModeManual",text:"手动开始"}).appendTo(E);var K=localStorage.getItem("AFStartModeSettings");if(K===null){localStorage.setItem("AFStartModeSettings","1");G.attr("checked",true)}else{if(K=="0"){F.attr("checked",true)}else{G.attr("checked",true)}}F.change(function(){if(F.is(":checked")){localStorage.setItem("AFStartModeSettings","0")}else{localStorage.setItem("AFStartModeSettings","1")}});G.change(function(){if(G.is(":checked")){localStorage.setItem("AFStartModeSettings","1")}else{localStorage.setItem("AFStartModeSettings","0")}});E=$("<td>").appendTo(L);E=$("<td>").appendTo(L);L=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(M);E=$("<td>").appendTo(L);$("<span>每次攻击间隔（毫秒）：</span>").appendTo(E);E=$("<td>").appendTo(L);addTextboxSettingFrame(E,60,"AFIntervalStart","500");$("<span>到</span>").appendTo(E);addTextboxSettingFrame(E,60,"AFIntervalEnd","1500");E=$("<td>").appendTo(L);$("<span>未响应请求允许数量：</span>").appendTo(E);E=$("<td>").appendTo(L);addTextboxSettingFrame(E,60,"AFMaxNotRespondRequest","12");var N=$("<table>",{align:"right"}).appendTo(n);L=$("<tr>",{style:"background-color:DarkSlateGray;"}).appendTo(N);E=$("<td>").appendTo(L);$("<span>总伤害： </span>").appendTo(E);var O=$("<span>",{id:"AFNowTotalDamage"}).appendTo(E);E=$("<td>").appendTo(L);$("<span>攻击次数： </span>").appendTo(E);var H=$("<span>",{id:"AFNowHitCount"}).appendTo(E);$("<span> 次</span>").appendTo(E);E=$("<td>").appendTo(L);$("<span>攻击用时： </span>").appendTo(E);var z=$("<span>",{id:"AFNowSpendTime"}).appendTo(E);$("<span> 秒</span>").appendTo(E);E=$("<td>").appendTo(L);$("<span>未完成请求：</span>").appendTo(E);var J=$("<span>",{id:"AFAjaxCount"}).appendTo(E);$("<span> 次</span>").appendTo(E);setupAdvancedFightChooseTable("advancedFightChooseTable");I.attr("disabled",false);I.click(function(){var R=$("input[name='AFSelectStartMode']:checked");if(R.length<=0){m("未选择开始方式")}else{I.attr("disabled",true);P.attr("disabled",false);if(R.attr("data-startmode")=="auto"){var Q=g(parseInt($("#AFStartModeAutoStartTextbox").val()),parseInt($("#AFStartModeAutoEndTextbox").val()));if(getEhTime()<=Q){m("当前时间已经超过预定时间");I.attr("disabled",false);P.attr("disabled",true)}else{m("预订于剩余 "+Q+" 秒时开始自动攻击");w=setInterval(function(){if(getEhTime()<=Q){clearInterval(w);p=new Date();f=true;x();h(parseInt($("#AFIntervalStart").val()),parseInt($("#AFIntervalEnd").val()))}},1000)}}else{p=new Date();f=true;x();h(parseInt($("#AFIntervalStart").val()),parseInt($("#AFIntervalEnd").val()))}}});P.click(function(){I.attr("disabled",false);P.attr("disabled",true);var Q=$("input[name='AFSelectStartMode']:checked");if(Q.attr("data-startmode")=="auto"){if(w!=undefined){m("停止计时");clearInterval(w)}else{m("停止攻击");f=false}}else{m("停止攻击");f=false}})}function h(A,D){$("#AFNowTotalDamage").text(o);$("#AFNowHitCount").text(c);u=parseInt(new Date()-p)/1000;$("#AFNowSpendTime").text(u);var z=e.length;for(var C=0;C<z;C++){if((e[C].readyState==4)||(e[C].readyState==0)){e.splice(C,1);C=C-1;z=z-1}}$("#AFAjaxCount").text(e.length);if(z>parseInt($("#AFMaxNotRespondRequest").val())){abortAll();e=[]}if(f==true){if(getEhTime()<=0){m("回合结束，停止攻击");f=false;$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}if($("#AFRestrictHitCount").is(":checked")&&(c>=parseInt($("#AFRestrictHitCountTextbox").val()))){m("攻击次数超限，停止攻击");f=false;$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}if($("#AFRestrictDamage").is(":checked")&&(o>=parseInt($("#AFRestrictDamageTextbox").val()))){m("总伤害超限，停止攻击");f=false;$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}if($("#AFRestrictTime").is(":checked")&&(u>=parseInt($("#AFRestrictTimeTextbox").val()))){m("时间超限，停止攻击");f=false;$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}if(r()==false){f=false;$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}var B=g(A,D);m(B+"毫秒后输出");setTimeout(function(){h(A,D)},B)}else{$("#AFManualStart").attr("disabled",false);$("#AFStopButton").attr("disabled",true);return}}function v(G){function A(R){R+="";var P=R.split(".");var Q=/(\d{1,3})(?=(\d{3})+$)/g;return P[0].replace(Q,"$1,")+(P.length==2?"."+P[1]:"")}var N=$("#showMsg");N.text("");N.show();var C=$("#DamageDone",G);if(C.length>0){var L=parseInt(C.text().replace(/,/g,"").replace(/\xA0/g,""));o+=L;var O=$(".fightsprite",C.parent().parent());var H={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]};var I={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]};for(var F=0;F<O.length;++F){var M=O.eq(F).attr("class").split(" ").pop();if(M in I){var B=I[M];H[B[0]]=B[1]}}var D="";var E=H.xp;delete H.xp;for(F in H){D='<i style="color:'+H[F][0]+';" class="icon-'+F+'" title="'+H[F][1]+'"></i>'+D}D+='<b title="'+E+'次攻击">x'+E+"</b>";c+=E;var z=$("#fightHistory");var K=$("div[class^=foundation-style]",z);if(K.length===6){$("#ehHistoryExpand").show()}K.slice(0,2).attr("style","opacity:0.6;");K.slice(2,4).attr("style","opacity:0.3;");if($("#ehHistoryExpand").is(":hidden")===false){K.slice(4,6).hide()}var J=($("#fightResult>div").attr("class").split(" ").pop().indexOf("critical")!==-1);if(J){z.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:D}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right critical",text:C.text()}))}else{z.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:D}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right",text:C.text()}))}$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+E);$("#ehTotalDamage").text(A(parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+L))}else{N.text($("#fightResponse").text().trim());N.fadeOut(2000)}}function y(A){var z=jQuery.parseJSON(A);$("#foodLimit").html(z.foodLimit);$("#giftLimit").html(z.giftLimit);$("#foodLimit2").html(z.foodLimit);$("#giftLimit2").html(z.giftLimit);$("#wellness").html(z.wellness);$("#healthBar").html(z.wellness);$("#healthProgress .ui-progressbar-value").animate({width:z.wellness+"%"},{queue:false});$("#actualHealth").html(z.wellness);$("#foodQ1").html("<b>Q1</b><br>"+z.q1FoodStorage);$("#foodQ2").html("<b>Q2</b><br>"+z.q2FoodStorage);$("#foodQ3").html("<b>Q3</b><br>"+z.q3FoodStorage);$("#foodQ4").html("<b>Q4</b><br>"+z.q4FoodStorage);$("#foodQ5").html("<b>Q5</b><br>"+z.q5FoodStorage);$("#giftQ1").html("<b>Q1</b><br>"+z.q1GiftStorage);$("#giftQ2").html("<b>Q2</b><br>"+z.q2GiftStorage);$("#giftQ3").html("<b>Q3</b><br>"+z.q3GiftStorage);$("#giftQ4").html("<b>Q4</b><br>"+z.q4GiftStorage);$("#giftQ5").html("<b>Q5</b><br>"+z.q5GiftStorage);$("#sfoodQ1").html("<b>Q1</b><br>"+z.q1FoodStorage);$("#sfoodQ2").html("<b>Q2</b><br>"+z.q2FoodStorage);$("#sfoodQ3").html("<b>Q3</b><br>"+z.q3FoodStorage);$("#sfoodQ4").html("<b>Q4</b><br>"+z.q4FoodStorage);$("#sfoodQ5").html("<b>Q5</b><br>"+z.q5FoodStorage);$("#sgiftQ1").html("<b>Q1</b><br>"+z.q1GiftStorage);$("#sgiftQ2").html("<b>Q2</b><br>"+z.q2GiftStorage);$("#sgiftQ3").html("<b>Q3</b><br>"+z.q3GiftStorage);$("#sgiftQ4").html("<b>Q4</b><br>"+z.q4GiftStorage);$("#sgiftQ5").html("<b>Q5</b><br>"+z.q5GiftStorage)}function d(z,C){var A="weaponQuality="+$("#weaponQuality").attr("value")+"&battleRoundId="+$("#battleRoundId").val()+"&side="+z+"&value="+C;var B=$.ajax({type:"POST",url:"fight.html",data:A,success:function(F){$("#fightResponse > div").replaceWith(F);v($(F));var E=$("#healthUpdate",F).text();if(E!==""){var D=E.substr(0,E.length-3);if(D<100){$("#healthProgress div.ui-corner-right").removeClass("ui-corner-right")}$("#healthProgress .ui-progressbar-value").animate({width:D+"%"},{queue:false});$("#healthProgress").attr("title",D+" / 100");$("#actualHealth").html(D)}},error:function(D,G,F){var E=$("#showMsg");E.text("错误："+D.status);E.show();E.fadeOut(2000)}});e.push(B)}function b(){var z="quality="+$("#foodQuality").val();var A=$.ajax({type:"POST",url:"eat.html",data:z,success:function(B){y(B)}});e.push(A)}function k(){var z="quality="+$("#giftQuality").val();var A=$.ajax({type:"POST",url:"gift.html",data:z,success:function(B){y(B)}});e.push(A)}function l(F){if(F){var A=parseInt($("#foodLimit2").text());if(A>0){var C=parseInt($("#foodQuality").val());var E=parseInt($("span#sfoodQ"+C)[0].childNodes[2].nodeValue);if(E>0){b();return true}else{m("食物不足");return false}}else{m("食物额度不足");return false}}else{var D=parseInt($("#giftLimit2").text());if(D>0){var B=parseInt($("#giftQuality").val());var z=parseInt($("span#sgiftQ"+B)[0].childNodes[2].nodeValue);if(z>0){k();return true}else{m("礼物不足");return false}}else{m("礼物额度不足");return false}}}function s(){var A=$("#AFRestoreHealth1").val();var z=$("#AFRestoreHealth2").val();if(A==1){if(!l(true)){if(z==2){return l(false)}else{return false}}else{return true}}else{if(A==2){if(!l(false)){if(z==1){return l(true)}else{return false}}else{return true}}else{m("补充体力选择错误");return false}}}function r(){if(parseFloat($("#actualHealth").html())<=50){if(!s()){return false}}var A=parseInt($("#weaponQuality").val());if(A>0){var C=parseInt($("span#Q"+A+"WeaponStock").text());if(C<=0){m("武器不足");return false}}var z=$("input[name='AFHitStyle']:checked");if(z.length<=0){m("未选择输出方");return false}var B=z.attr("data-AFSide");var D=z.attr("data-AFValue");d(B,D)}}function setupSpectator(){if(!isActive){$("#ehButtonSpectator").attr("disabled",true);return}if(isPremium){$(".battleMonitorDiv").remove();var c=$("#ehDivSpectator");c.append($("<button>",{type:"button","class":"small button foundation-style",id:"showSpectator",text:"刷新观战玩家",style:"height:20px;width:100px;",click:function(){sendUpdateRequest2(true)}}));var b=$("<div>");c.append(b);b.append('<div class="foundation-style small-3 columns">  <b>Total defenders online:</b> <i id="ehTotaldefenders"  style="display: inline;">0</i>  <br> <div align="center" id="ehDefendersMenu" >No one <br> </div>  </div>');b.append('<div class="foundation-style small-4 columns">  <b>Total spectators online:</b><i id="ehTotalspectators"                         >0</i>  <br> <div align="center" id="ehSpectatorsMenu">No one <br> </div>  </div>');b.append('<div class="foundation-style small-3 columns">  <b>Total attackers online:</b> <i id="ehTotalattackers"  style="display: inline;">0</i>  <br> <div align="center" id="ehAttackersMenu" >No one <br> </div>  </div>')}else{var c=$("#ehDivSpectator");c.append($("<div>",{style:"font-color:red; font-size:24px;",text:"此功能利用了e-sim的小漏洞，有一定危险性，请自行承担后果"}));c.append($("<button>",{type:"button","class":"small button foundation-style",id:"showSpectator",text:"我知道了，还是想看！",click:function(){sendUpdateRequest2(true)}}));var b=$("<div>");c.append(b);b.append('<div class="foundation-style small-3 columns">  <b>Total defenders online:</b> <i id="ehTotaldefenders"  style="display: inline;">0</i>  <br> <div align="center" id="ehDefendersMenu" >No one <br> </div>  </div>');b.append('<div class="foundation-style small-4 columns">  <b>Total spectators online:</b><i id="ehTotalspectators"                         >0</i>  <br> <div align="center" id="ehSpectatorsMenu">No one <br> </div>  </div>');b.append('<div class="foundation-style small-3 columns">  <b>Total attackers online:</b> <i id="ehTotalattackers"  style="display: inline;">0</i>  <br> <div align="center" id="ehAttackersMenu" >No one <br> </div>  </div>')}}function setupAlarm(){if(!isActive){$("#ehButtonAlarm").attr("disabled",true);return}var m=getEhTime();var g=$("<div>");var c=$("<input>",{type:"checkbox",id:"PopupCheckbox"}).appendTo(g);var d=$("<label>",{"class":"checkboxlabel","for":"PopupCheckbox",text:"自动弹窗（首次使用可能会被浏览器拦截，加入白名单即可）"}).appendTo(g);var k=localStorage.getItem("battlePopup");if(k==null){localStorage.setItem("battlePopup","false")}else{c.attr("checked",k=="true")}c.click(function(){if(c.is(":checked")){localStorage.setItem("battlePopup",true)}else{localStorage.setItem("battlePopup",false)}});var f=$("<button>",{type:"button","class":"small button foundation-style",id:"testNotification",text:"测试",click:function(){if($("#PopupCheckbox").is(":checked")&&!window.opener){window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600")}else{alert(battleName+"：测试")}}}).appendTo(g);$("#ehDivAlarm").append(g);var e=$("<div>",{"class":"foundation-style small-2 columns"});e.append($("<i>",{"class":"icon-uptime",style:"font-size:20px;"}));e.append($("<input>",{type:"checkbox","class":"foundation-style",id:"alarmEnable10",value:10})," t10提醒");var l=$("<div>",{"class":"foundation-style small-3 columns"});l.append($("<i>",{"class":"icon-uptime",style:"font-size:20px;"}));l.append($("<input>",{type:"checkbox","class":"foundation-style",id:"alarmEnable5",value:5})," t5提醒");var b=$("<div>",{"class":"foundation-style small-3 columns"});b.append($("<i>",{"class":"icon-uptime",style:"font-size:20px;"}));b.append($("<input>",{type:"checkbox","class":"foundation-style",id:"alarmEnable2",value:2})," t2提醒");var h=$("<div>",{"class":"foundation-style small-2 columns"});h.append($("<i>",{"class":"icon-uptime",style:"font-size:20px;"}));h.append($("<input>",{type:"checkbox","class":"foundation-style",id:"alarmEnable1",value:1})," t1提醒");$("#ehDivAlarm").append(e,l,b,h);if(m<=10*60){$("#alarmEnable10").attr("disabled",true)}else{setTimeout(function(){if($("#alarmEnable10").is(":checked")){if($("#PopupCheckbox").is(":checked")&&!window.opener){window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600")}else{alert(battleName+"倒计时10分钟")}}$("#alarmEnable10").attr("disabled",true)},(m-10*60)*1000)}if(m<=5*60){$("#alarmEnable5").attr("disabled",true)}else{setTimeout(function(){if($("#alarmEnable5").is(":checked")){if($("#PopupCheckbox").is(":checked")&&!window.opener){window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600")}else{alert(battleName+"倒计时5分钟")}}if(localStorage.getItem("autoSendMessageToDiscord")=="true"){var n=$("#sendToDiscordButton");if(n.length==1){n.click()}}$("#alarmEnable5").attr("disabled",true)},(m-5*60)*1000)}if(m<=2*60){$("#alarmEnable2").attr("disabled",true)}else{setTimeout(function(){if($("#alarmEnable2").is(":checked")){if($("#PopupCheckbox").is(":checked")&&!window.opener){window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600")}else{alert(battleName+"倒计时2分钟")}}$("#alarmEnable2").attr("disabled",true)},(m-2*60)*1000)}if(m<=1*60){$("#alarmEnable1").attr("disabled",true)}else{setTimeout(function(){if($("#alarmEnable1").is(":checked")){if($("#PopupCheckbox").is(":checked")&&!window.opener){window.open(location.href,"Battle","resizable,scrollbars,width=1200,height=600")}else{alert(battleName+"倒计时1分钟")}}$("#alarmEnable1").attr("disabled",true)},(m-1*60)*1000)}setInterval(updateClock,1000)}function updateClock(){var c=getEhTime();if(document.title.indexOf("：")!=-1){var d=document.title.split("：")[1]}else{var d=document.title}if(c>99){var b="T"+parseInt(c/60).toString()}else{var b="S"+c.toString()}document.title=b+"："+d}function setupFight(){var h=$("[id^=fightButton]");if(h.length===0){return}var e=".critical { color:red; }";GM_addStyle(e);var k=h.parent().parent();$("[id^=fightButton] > i",k).remove();var f=$("<div>",{id:"fightLeft","class":"foundation-style small-3 columns",style:"font-size:12px;"});var c=$("<div>",{id:"fightRight","class":"foundation-style small-7 columns foundation-text-center"});c.append(k.children());k.append(f,c);var m=$("<div>",{"class":"foundation-style small-5 columns foundation-text-left",html:'<b id="ehCountdown">00:00:00</b>',title:"点击刷新按钮可校准"});var d=$("<div>",{"class":"foundation-style small-1 columns foundation-text-right",html:'x<b id="ehHitsNumber">0</b>',title:"在当前页面上攻击的次数, 刷新页面会清零"});var g=$("<div>",{"class":"foundation-style small-4 columns foundation-text-right",html:'<div id="ehTotalDamage">0</div>',title:"在当前页面上攻击的总伤害, 刷新页面会清零"});var b=$("<div>",{id:"fightHistory"});var l=$("<div>",{html:'<b id="showMsg"></b>'});f.append(m,d,g,b,l);b.append('<div id="ehHistoryExpand" class="small-6"><i class="icon-uniF475" title="展开所有伤害记录"></i></div>','<div id="ehHistoryContract" class="small-6"><i class="icon-uniF474" title="收起输出伤害"></i></div>');$("#ehHistoryExpand").hide().click(function(){$("#fightHistory > div").slice(6).show();$(this).hide()});$("#ehHistoryContract").hide().click(function(){$("#fightHistory > div").slice(6).hide();$("#ehHistoryExpand").show()});$(".pico-content").livequery(function(){var n=$("#DamageDone",$(this));if(n.length>0){var w=parseInt(n.text().replace(/,/g,"").replace(/\xA0/g,""));var y=$(".fightsprite",n.parent().parent());var s={bomb:["grey","无暴击(pain dealer)"],tank:["grey","无坦克(tank)"],syringe:["grey","无类固醇(steroid)"],airplane:["grey","无地点加成"],bookmark:["grey","无军令加成"]};var t={absorbed:["loved",["lightgreen","闪避(avoid)"]],mu:["bookmark",["lightgreen","有军令加成"]],location:["airplane",["lightgreen","有地点加成"]],STEROIDSplus:["syringe",["lightgreen","有类固醇(steroid)"]],STEROIDSminus:["syringe",["pink","类固醇副作用(steroid)"]],TANKplus:["tank",["lightgreen","有坦克(tank)"]],TANKminus:["tank",["pink","坦克副作用(tank)"]],xp1:["xp",1],xp5:["xp",5],PAIN_DEALER_1_Hplus:["bomb",["lightgreen","1小时暴击(pain dealer)"]],PAIN_DEALER_10_Hplus:["bomb",["lightgreen","10小时暴击(pain dealer)"]],PAIN_DEALER_25_Hplus:["bomb",["lightgreen","25小时暴击(pain dealer)"]]};for(var r=0;r<y.length;++r){var x=y.eq(r).attr("class").split(" ").pop();if(x in t){var o=t[x];s[o[0]]=o[1]}}var p="";var q=s.xp;delete s.xp;for(r in s){p='<i style="color:'+s[r][0]+';" class="icon-'+r+'" title="'+s[r][1]+'"></i>'+p}p+='<b title="'+q+'次攻击">x'+q+"</b>";var v=$("div[class^=foundation-style]",b);if(v.length===6){$("#ehHistoryExpand").show()}v.slice(0,2).attr("style","opacity:0.6;");v.slice(2,4).attr("style","opacity:0.3;");if($("#ehHistoryExpand").is(":hidden")===false){v.slice(4,6).hide()}var u=($("#fightResult>div").attr("class").split(" ").pop().indexOf("critical")!==-1);if(u){b.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:p}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right critical",text:n.text()}))}else{b.prepend($("<div>",{"class":"foundation-style small-6 columns foundation-text-right",html:p}),$("<div>",{"class":"foundation-style small-4 columns foundation-text-right",text:n.text()}))}$("#ehHitsNumber").text(parseInt($("#ehHitsNumber").text())+q);$("#ehTotalDamage").text((parseInt($("#ehTotalDamage").text().replace(/,/g,"").replace(/\xA0/g,""))+w).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}})}function getApiOnlinePlayers(){$.ajax({url:"/apiOnlinePlayers.html?countryId=0",success:function(b){var c=JSON.parse(b);var d=[];$.each(c,function(e,f){d.push(JSON.parse(f))});console.log(d)},error:function(b,c){console.log("apiOnlinePlayers抓取错误 (",c,")，该服可能不支持该API")},})}function setupSpectatorDetail(){var d=$("#ehDivSpectatorDetail");var g=$("<button>",{id:"eh2ShowSpectatorDetail",text:"推测观战玩家（必须先查看过观战人员）","class":"foundation-style button",style:"padding:10px; margin:5px;"}).appendTo($("<div>").appendTo(d));var h=$("<button>",{id:"eh2ShowSpectatorBuff",text:"显示玩家状态","class":"foundation-style button",style:"padding:10px; margin:5px;",disabled:true}).insertAfter(g);var l=$("<INPUT TYPE='checkbox' id='eh2CheckCoalition'>按联盟分类玩家</INPUT>").insertAfter(h);var c=$("<div>",{id:"eh2Defenders",style:"text-align:left;"}).appendTo($("<div>",{"class":"foundation-style columns",style:"width:33%;",text:"可能的防御者"}).appendTo(d));var f=$("<div>",{id:"eh2Strangers",style:"text-align:left;"}).appendTo($("<div>",{"class":"foundation-style columns",style:"width:34%;",text:"其他人"}).appendTo(d));var k=$("<div>",{id:"eh2Attackers",style:"text-align:left;"}).appendTo($("<div>",{"class":"foundation-style columns",style:"width:33%;",text:"可能的进攻者"}).appendTo(d));var p={defenderRegions:[],attackerRegions:[]};$("#defenderRegions input").each(function(){p.defenderRegions.push(parseInt($(this).attr("value")))});$("#attackerRegions input").each(function(){p.attackerRegions.push(parseInt($(this).attr("value")))});g.click(function(){g.attr("disabled",true);h.attr("disabled",true);m();b();if($("#eh2CheckCoalition").is(":checked")){n()}else{e()}});function m(){var r=$("#ehSpectatorsMenu").text().replace(/-[ \n\r]*/g,"- ").replace(/[\n\r]+ +/g,"\n").trim().split("\n");var s=[];var q=r.length;$.each(r,function(t,v){var w=v.split(" - ");var x=w[0];var u=countryInfo[w[1]]&&countryInfo[w[1]].id;if(!u){if(--q===0){p.onlineCitizens=s;console.log("相关国家的在线玩家扫描完毕");o()}return}$.ajax({url:"citizensOnline.html?countryId="+u,success:function(A){var z=$("table.dataTable:last tr:gt(0)",A);var y=z.length;console.log(countryInfo[u].name,"共有"+y+"名在线玩家");z.each(function(){if($("td",$(this)).length===1){console.log(countryInfo[u].name,"没有玩家");return false}var D=parseInt($("td:first a",$(this)).attr("href").match(/([0-9]+)$/)[1]);var C=parseInt($("td:last a",$(this)).attr("href").match(/([0-9]+)$/)[1]);var B=s.push({citizenId:D,locationId:C,countryId:u,a:x,b:y,profile:$("td:first a",$(this)),avatar:$("td:first img",$(this)).attr("class","smallAvatar").attr("style","").attr("align","absmiddle")});if(--q===0){p.onlineCitizens=s;console.log("相关国家的在线玩家扫描完毕");o()}})},error:function(y,z){console.log("抓取错误 (",z,")，重新抓取");$.ajax(this)}})})}function b(){$.ajax({url:"battleUnitsStats.html?id="+battleId,success:function(v){var w=$("div.small-5:eq(-2) a",v);var s=w.length;if(s===0){console.log("防御方没有军团");p.defenderMus=[];o()}else{var r=[];w.each(function(){var x=parseInt($(this).attr("href").match(/([0-9]+)$/)[1]);r.push(x);getMuMemberInfo(x,function(){if(--s===0){p.defenderMus=r;console.log("防御方军团玩家扫描完毕");o()}})})}var u=$("div.small-5:last a",v);var t=u.length;if(t===0){console.log("进攻方没有军团");p.attackerMus=[];o()}else{var q=[];u.each(function(){var x=parseInt($(this).attr("href").match(/([0-9]+)$/)[1]);q.push(x);getMuMemberInfo(x,function(){if(--t===0){p.attackerMus=q;console.log("进攻方军团玩家扫描完毕");o()}})})}},error:function(q,r){console.log("抓取错误 (",r,")，重新抓取");$.ajax(this)}})}function e(){if(!defenderId){p.defenderAllies=[]}else{if(defenderId===allies[0]){p.defenderAllies=allies}else{$.ajax({url:"countryPoliticalStatistics.html?countryId="+defenderId,success:function(s){console.log(countryInfo[defenderId].name,"盟友抓取成功");var q=[defenderId];var r=$("div.xflagsMedium",$("table.dataTable:last",s));r.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1);console.log("防守方盟友："+t);q.push(countryInfo[t].id)});p.defenderAllies=q;o()},error:function(q,r){console.log(countryInfo[defenderId].name,"盟友抓取错误 (",r,")，重新抓取");$.ajax(this)},})}}if(!attackerId){p.attackerAllies=[]}else{if(attackerId===allies[0]){p.attackerAllies=allies}else{$.ajax({url:"countryPoliticalStatistics.html?countryId="+attackerId,success:function(s){console.log(countryInfo[attackerId].name,"盟友抓取成功");var q=[attackerId];var r=$("div.xflagsMedium",$("table.dataTable:last",s));r.each(function(){var t=$(this).attr("class").split(" ").pop();t=t.substring(t.indexOf("-")+1);console.log("进攻方盟友："+t);q.push(countryInfo[t].id)});p.attackerAllies=q;o()},error:function(q,r){console.log(countryInfo[attackerId].name,"盟友抓取错误 (",r,")，重新抓取");$.ajax(this)},})}}}function n(){if(!defenderId){p.defenderAllies=[]}else{if(defenderId===allies[0]){p.defenderAllies=allies}else{$.ajax({url:"countryPoliticalStatistics.html?countryId="+defenderId,success:function(w){console.log(countryInfo[defenderId].name,"盟友及联盟抓取成功");var u=[defenderId];var v=$("div.xflagsMedium",$("table.dataTable:last",w));v.each(function(){var x=$(this).attr("class").split(" ").pop();x=x.substring(x.indexOf("-")+1);console.log("防守方盟友："+x);u.push(countryInfo[x].id)});var r=$("h2",w);var t;if(r.length>4){t=r[2]}else{t=r[1]}if(t.innerText.split(" ")[0]!="Coalition"){console.log("防守方没有联盟")}else{console.log("防守方属于联盟 "+t.innerText.split(" ")[1]);var q=$(t,w).nextAll("div.xflagsSmall");q.each(function(){var x=$(this).attr("class").split(" ").pop();x=x.substring(x.indexOf("-")+1);if(countryInfo[defenderId].flagName!=x){console.log("防守方联盟成员国："+x);u.push(countryInfo[x].id)}})}var s=$.unique(u.sort());p.defenderAllies=s;o()},error:function(q,r){console.log(countryInfo[defenderId].name,"盟友及联盟抓取错误 (",r,")，重新抓取");$.ajax(this)},})}}if(!attackerId){p.attackerAllies=[]}else{if(attackerId===allies[0]){p.attackerAllies=allies}else{$.ajax({url:"countryPoliticalStatistics.html?countryId="+attackerId,success:function(w){console.log(countryInfo[attackerId].name,"盟友及联盟抓取成功");var u=[attackerId];var v=$("div.xflagsMedium",$("table.dataTable:last",w));v.each(function(){var x=$(this).attr("class").split(" ").pop();x=x.substring(x.indexOf("-")+1);console.log("进攻方盟友："+x);u.push(countryInfo[x].id)});var r=$("h2",w);var t;if(r.length>4){t=r[2]}else{t=r[1]}if(t.innerText.split(" ")[0]!="Coalition"){console.log("进攻方没有联盟")}else{console.log("进攻方属于联盟 "+t.innerText.split(" ")[1]);var q=$(t,w).nextAll("div.xflagsSmall");q.each(function(){var x=$(this).attr("class").split(" ").pop();x=x.substring(x.indexOf("-")+1);if(countryInfo[attackerId].flagName!=x){console.log("进攻方联盟成员国："+x);u.push(countryInfo[x].id)}})}var s=$.unique(u.sort());p.attackerAllies=s;o()},error:function(q,r){console.log(countryInfo[attackerId].name,"盟友及联盟抓取错误 (",r,")，重新抓取");$.ajax(this)},})}}}function o(){if(!p.onlineCitizens||!p.defenderMus||!p.attackerMus||!p.defenderAllies||!p.attackerAllies){return}c.empty();k.empty();f.empty();var q=[];$.each(p.onlineCitizens,function(x,y){var u=y.citizenId;var r=citizenInfo[u];var v=f;var t=y.a*100/y.b;var s=$("<div>",{id:"citizen"+u,style:"font-size:12px;"});var z=$("<i>",{"class":"icon-bookmark"}).appendTo(s);if(r&&$.inArray(r.militaryUnitId,p.defenderMus)!==-1){v=c;z.attr("style","color:SkyBlue;")}else{if(r&&$.inArray(r.militaryUnitId,p.attackerMus)!==-1){v=k;z.attr("style","color:Crimson;")}else{z.attr("style","color:rgb(77, 77, 77);");t-=0.0001}}if(p.defenderRegions.length!==0){var w=$("<i>",{"class":"icon-airplane"}).appendTo(s);if($.inArray(y.locationId,p.defenderRegions)!==-1){if($.inArray(y.locationId,p.attackerRegions)!==-1){w.attr("style","color:SeaGreen;")}else{if(v===f){v=c}w.attr("style","color:SkyBlue;")}}else{if($.inArray(y.locationId,p.attackerRegions)!==-1){w.attr("style","color:Crimson;");if(v===f){v=k}}else{w.attr("style","color:rgb(77, 77, 77);");t-=0.0002}}}s.append($("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[y.countryId].flagName}),y.avatar,y.profile," ("+parseInt(y.a*100/y.b)+"%)");if(v===f){if($.inArray(y.countryId,p.defenderAllies)!==-1){v=c}else{if($.inArray(y.countryId,p.attackerAllies)!==-1){v=k}else{t-=0.0004}}}q.push([t,s,v])});q.sort(function(s,r){return r[0]-s[0]});$.each(q,function(r,s){if(isResistance&&$(".icon-airplane",s[1]).attr("style")==="color:SeaGreen;"){if(s[2]===c){$(".icon-airplane",s[1]).attr("style","color:SkyBlue;")}else{if(s[2]===k){$(".icon-airplane",s[1]).attr("style","color:Crimson;")}}}s[1].appendTo(s[2])});g.attr("disabled",false);h.attr("disabled",false)}h.click(function(){g.attr("disabled",true);h.attr("disabled",true);c.parent().attr("class","foundation-style column small-5");k.parent().attr("class","foundation-style column small-5");f.parent().attr("style","width:100%;").insertAfter(k.parent());f.attr("style","width:50%; margin:0 auto; text-align:left;");var q="rgb(139, 139, 139);; rgb(177, 11, 11);; rgb(242, 160, 27);; rgb(177, 182, 6);; rgb(33, 157, 33);; rgb(169, 34, 156);; rgb(0, 211, 211);".split("; ");var u="帽 镜 甲 裤 鞋 符 武 副".split(" ");var t="头盔, 眼镜, 盔甲, 作战裤, 作战靴, 幸运符, 武器配件, 副手".split(", ");var r=$("div[id^='citizen']",d);var s=r.length;r.each(function(){var w=$(this);var v=parseInt(w.attr("id").match(/([0-9]+)$/)[1]);fetchAndUpdateOneCitizenPage(v,false,function(){if(citizenPage[v].equipments.length===0){w.remove();return true}var x=[];$.each(citizenPage[v].equipments,function(z,A){A=parseInt(A[1]);x.push($("<span>",{style:"color:"+q[A],text:u[z],title:"Q"+A+" "+t[z]}))});w.prepend(x);var y=[];$.each(citizenPage[v].buffIcons,function(A,z){y.push($("<img>",{src:z,style:"width:18px; vertical-align:middle;"}))});$.each(citizenPage[v].debuffIcons,function(A,z){y.push($("<img>",{src:z,style:"width:18px; vertical-align:middle;"}))});w.append(y);if(--s===0){g.attr("disabled",false);localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}})})})}function enhanceBattleStatistics(){var c=$("div > a.fbShare2").closest("div.columns").empty();console.log(c);var b=$("<button>",{"class":"foundation-style button",text:"显示所有局"}).appendTo(c);var d=$("#battleProgress:first");b.click(function(){var l=c.closest("div.fightContainer ");var h=$('a[href^="battle.html"]').attr("href");var k=$('img[src$="blue_ball.png"]').length+$('img[src$="red_ball.png"]').length;for(var g=k;g>0;--g){var f=$("<div>",{"class":"foundation-radius fightContainer oldRound",id:"ehRound"+g,roundId:g}).insertAfter(l).hide();$("<div>",{"class":"foundation-style small-2 columns topDefenders",id:"defenderBH"}).appendTo(f);var e=$("<div>",{"class":"foundation-style small-6 columns",id:"middle"}).appendTo(f);d.clone().appendTo(e);$("<div>",{"class":"foundation-radius fightContainer foundation-base-font",id:"scores"}).appendTo(e);$("<div>",{"class":"foundation-style small-2 columns topAttackers",id:"attackerBH"}).appendTo(f)}$("div.oldRound").each(function(){var n=$(this);var m=$("#middle",n);var o=$("#scores",m);var p=n.attr("roundId");$.ajax({url:h+"&round="+p,success:function(t){$("#topDefender1",t).children().appendTo($("#defenderBH",n));$("#topAttacker1",t).children().appendTo($("#attackerBH",n));var s=$("#leftStat",t).text().match(/^([\d\.]+)/)[1];$("#battleProgress",n).attr("aria-valuenow",s);$("#battleProgress > div.ui-progressbar-value",n).attr("style","width: "+s+"%");var u=$("#battleProgressStats",t).insertAfter($("#battleProgress",n));var q=$("<div>").appendTo(u);var r=parseInt($("#defenderScore",t).text().replace(/,/g,"").replace(/\xA0/g,""))-parseInt($("#attackerScore",t).text().replace(/,/g,"").replace(/\xA0/g,""));if(r===0){q.text("")}else{if(r>0){q.text(">> "+r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" >>")}else{q.text("<< "+(-r).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" <<")}}$("#defenderScore",t).closest("div").appendTo(o);$("<a>",{"class":"foundation-style small-2 columns",href:h+"&round="+p,text:"Round "+p}).appendTo(o);$("#attackerScore",t).closest("div").appendTo(o);n.show()},error:function(q,r){console.log("第",p,"局伤害抓取错误 (",r,")，重新抓取");$.ajax(this)},})})});calBattleConsumption()}function calBattleConsumption(){var x=[];var D=[];var F=[];var B=[];var w=[];var s=[];var b=[];var g=[];var o=[];var k=[];var e=[];var v=[];var q=[];var n=[];var l=[];G();function t(K){var J=x.indexOf(K);if(J<0){x.push(K);D.push(countryInfo[K].name);F[x.length-1]=new Array();B[x.length-1]=new Array();return x.length-1}else{return J}}function f(K){var J=b.indexOf(K);if(J<0){b.push(K);k[b.length-1]=new Array();e[b.length-1]=new Array();$.ajax({url:"apiMilitaryUnitById.html?id="+K,async:false,success:function(L){var M=JSON.parse(L);g.push(M.name);o.push(M.countryId)},error:function(L,M){console.log("获取军团API错误 (",M,")");g.push("未知军团（"+K+"）");o.push(-1)},});return b.length-1}else{return J}}function A(L,N){var J=JSON.parse(L);var M;var K;for(i=0;i<J.length;++i){M=t(J[i].citizenship);if(J[i].militaryUnit!==undefined){K=f(J[i].militaryUnit)}else{K=-1}if(J[i].weapon==1){if(J[i].citizenId==userId){if(typeof(n[N])=="undefined"){n[N]=1+4*J[i].berserk}else{n[N]+=1+4*J[i].berserk}}if(typeof(F[M][N])=="undefined"){F[M][N]=1+4*J[i].berserk}else{F[M][N]+=1+4*J[i].berserk}if(typeof(w[M])=="undefined"){w[M]=1+4*J[i].berserk}else{w[M]+=1+4*J[i].berserk}if(typeof(J[i].militaryUnit)!="undefined"){if(typeof(k[K][N])=="undefined"){k[K][N]=1+4*J[i].berserk}else{k[K][N]+=1+4*J[i].berserk}if(typeof(v[K])=="undefined"){v[K]=1+4*J[i].berserk}else{v[K]+=1+4*J[i].berserk}}}else{if(J[i].weapon==5){if(J[i].citizenId==userId){if(typeof(l[N])=="undefined"){l[N]=1+4*J[i].berserk}else{l[N]+=1+4*J[i].berserk}}if(typeof(B[M][N])=="undefined"){B[M][N]=1+4*J[i].berserk}else{B[M][N]+=1+4*J[i].berserk}if(typeof(s[M])=="undefined"){s[M]=1+4*J[i].berserk}else{s[M]+=1+4*J[i].berserk}if(typeof(J[i].militaryUnit)!="undefined"){if(typeof(e[K][N])=="undefined"){e[K][N]=1+4*J[i].berserk}else{e[K][N]+=1+4*J[i].berserk}if(typeof(q[K])=="undefined"){q[K]=1+4*J[i].berserk}else{q[K]+=1+4*J[i].berserk}}}}}}function C(K,M){var J=JSON.parse(K);var L;for(i=0;i<J.length;++i){L=t(J[i].citizenship);if(J[i].weapon==1){if(J[i].citizenId==userId){if(typeof(n[M])=="undefined"){n[M]=1+4*J[i].berserk}else{n[M]+=1+4*J[i].berserk}}if(typeof(F[L][M])=="undefined"){F[L][M]=1+4*J[i].berserk}else{F[L][M]+=1+4*J[i].berserk}if(typeof(w[L])=="undefined"){w[L]=1+4*J[i].berserk}else{w[L]+=1+4*J[i].berserk}}else{if(J[i].weapon==5){if(J[i].citizenId==userId){if(typeof(l[M])=="undefined"){l[M]=1+4*J[i].berserk}else{l[M]+=1+4*J[i].berserk}}if(typeof(B[L][M])=="undefined"){B[L][M]=1+4*J[i].berserk}else{B[L][M]+=1+4*J[i].berserk}if(typeof(s[L])=="undefined"){s[L]=1+4*J[i].berserk}else{s[L]+=1+4*J[i].berserk}}}}}function G(){var L=$("div.foundation-radius.fightContainer.foundation-base-font :last");var O=L.clone().insertAfter(L);O.empty();var K=$("<button>",{"class":"foundation-style button",text:"统计战场消耗"}).appendTo(O);var P=$("<input>",{type:"checkbox",id:"calMuConsumptionCheckbox"}).appendTo(O);var N=$("<label>",{"class":"checkboxlabel","for":"calMuConsumptionCheckbox",text:"同时统计军团消耗（需要耐心等待）"}).appendTo(O);var M=$("<input>",{type:"checkbox",id:"showRoundsDetailCheckbox"}).appendTo(O);var J=$("<label>",{"class":"checkboxlabel","for":"showRoundsDetailCheckbox",text:"显示每回合的消耗数量"}).appendTo(O);K.click(function(){K.attr("disabled",true);var Q=P.is(":checked");var R=$('a[href^="battle.html"]').attr("href").split("?id=")[1];var T=$('img[src$="blue_ball.png"]').length+$('img[src$="red_ball.png"]').length;if(T<=0){K.text("第一回合还没结束呢！");return}var S=T;K.text("剩余"+S+"个");u(K,O,R,1,T,Q)})}function u(K,M,L,O,N,J){$.ajax({url:"apiFights.html?battleId="+L+"&roundId="+O,success:function(S){if(J==true){A(S,O)}else{C(S,O)}K.text("剩余"+(N-O)+"个");if(N==O){K.text("加载完成，共"+N+"回合");h(N,M);var R=$('<button type="button">导出</button>').appendTo(M);R.click(function(){y("CBCCountryResult")});if(J==true){d(N,M);var Q=$('<button type="button">导出</button>').appendTo(M);Q.click(function(){y("CBCMuResult")})}m(N,M);var P=$('<button type="button">复制个人消耗记录</button>').appendTo(M);P.click(function(){var V=$("#CBCPersonalResult tr:eq(1) td:eq(0)").text()+"的战场消耗：\r\n";var T=location.origin+"/battle.html?id="+GetQueryString("id")+"&round=";var W;for(var U=1;U<=N;U++){W=$("#CBCPersonalResult tr:eq(1) td:eq("+U+")").text();if(W!=""){V=V+T+$("#CBCPersonalResult tr:eq(0) td:eq("+U+")").text()+"    "+W+"\r\n"}}V=V+"------------------------------------------------------------\r\n总计： ";W=$("#CBCPersonalResult tr:eq(1) td:eq("+(N+1)+")").text();if(W!=""){V=V+W+" Q1  "}W=$("#CBCPersonalResult tr:eq(1) td:eq("+(N+2)+")").text();if(W!="0"){V=V+W+" Q5"}GM_setClipboard(V)})}if(O+1<=N){u(K,M,L,O+1,N,J)}},error:function(P,Q){console.log("抓取错误 (",Q,")，重新抓取");$.ajax(this)},})}function h(M,U){$("<p>国家消耗统计</p>").appendTo(U);var Y=$("<table>",{id:"CBCCountryResult",style:"width:100%;"}).appendTo(U);var W,V;var R=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(Y);var L=$("#showRoundsDetailCheckbox").is(":checked");if(L===true){var Z=$("<td>",{text:"回合"}).appendTo(R);for(W=1;W<=M;++W){$("<td>",{text:W}).appendTo(R)}$("<td>",{text:"总计(Q1)"}).appendTo(R);$("<td>",{text:"总计(Q5)"}).appendTo(R)}else{var Z=$("<td>",{text:"国家"}).appendTo(R);$("<td>",{text:"总计(Q1)"}).appendTo(R);$("<td>",{text:"总计(Q5)"}).appendTo(R)}var X;var N;for(W=0;W<x.length;++W){if(typeof(w[W])!="undefined"||typeof(s[W])!="undefined"){X=$("<tr>",{id:"CBCCountry-"+W,"class":"CBCCountry",style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(Y);N=$("<td>",{text:D[W]}).appendTo(X);$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[x[W]].flagName,style:"vertical-align:middle;"}).prependTo(N);if(L===true){for(V=1;V<=M;++V){if(typeof(F[W][V])=="undefined"){if(typeof(B[W][V])=="undefined"){$("<td>",{text:""}).appendTo(X)}else{$("<td>",{text:B[W][V]+" Q5"}).appendTo(X)}}else{if(typeof(B[W][V])=="undefined"){$("<td>",{text:F[W][V]+" Q1"}).appendTo(X)}else{$("<td>",{text:F[W][V]+" Q1  "+B[W][V]+" Q5"}).appendTo(X)}}}}$("<td>",{text:w[W]}).appendTo(X);$("<td>",{text:s[W]}).appendTo(X)}}if(L===true){p(M+2,M+1)}else{p(2,1)}var J=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(Y);$("<td>",{text:"总消耗"}).appendTo(J);if(L===true){var T;var S;for(var K=1;K<=M;++K){T=0;S=0;for(var Q=0;Q<x.length;++Q){if(typeof(F[Q][K])!="undefined"){T+=F[Q][K]}if(typeof(B[Q][K])!="undefined"){S+=B[Q][K]}}if(T==0){if(S==0){$("<td>",{text:""}).appendTo(J)}else{$("<td>",{text:S+" Q5"}).appendTo(J)}}else{if(S==0){$("<td>",{text:T+" Q1"}).appendTo(J)}else{$("<td>",{text:T+" Q1  "+S+" Q5"}).appendTo(J)}}}}var aa;var P=0;var O=0;for(aa=0;aa<w.length;aa++){if(typeof(w[aa])!="undefined"){P+=w[aa]}}for(aa=0;aa<s.length;aa++){if(typeof(s[aa])!="undefined"){O+=s[aa]}}$("<td>",{text:P}).appendTo(J);$("<td>",{text:O}).appendTo(J)}function d(M,T){$("<p>军团消耗统计</p>").appendTo(T);var X=$("<table>",{id:"CBCMuResult",style:"width:100%;"}).appendTo(T);var W,V;var Q=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(X);var L=$("#showRoundsDetailCheckbox").is(":checked");if(L===true){var Y=$("<td>",{text:"回合"}).appendTo(Q);for(W=1;W<=M;++W){$("<td>",{text:W}).appendTo(Q)}$("<td>",{text:"总计(Q1)"}).appendTo(Q);$("<td>",{text:"总计(Q5)"}).appendTo(Q)}else{var Y=$("<td>",{text:"军团"}).appendTo(Q);$("<td>",{text:"总计(Q1)"}).appendTo(Q);$("<td>",{text:"总计(Q5)"}).appendTo(Q)}var J;var P;for(W=0;W<b.length;++W){if(typeof(v[W])!="undefined"||typeof(q[W])!="undefined"){J=$("<tr>",{id:"CBCMu-"+W,"class":"CBCMu",style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(X);P=$("<td></td>").appendTo(J);$("<a>",{href:"militaryUnit.html?id="+b[W],text:g[W]}).appendTo(P);if(o[W]==-1){$("<div>",{"class":"xflagsSmall xflagsSmall-Adminland",style:"vertical-align:middle;"}).prependTo(P)}else{$("<div>",{"class":"xflagsSmall xflagsSmall-"+countryInfo[o[W]].flagName,style:"vertical-align:middle;"}).prependTo(P)}if(L===true){for(V=1;V<=M;++V){if(typeof(k[W][V])=="undefined"){if(typeof(e[W][V])=="undefined"){$("<td>",{text:""}).appendTo(J)}else{$("<td>",{text:e[W][V]+" Q5"}).appendTo(J)}}else{if(typeof(e[W][V])=="undefined"){$("<td>",{text:k[W][V]+" Q1"}).appendTo(J)}else{$("<td>",{text:k[W][V]+" Q1  "+e[W][V]+" Q5"}).appendTo(J)}}}}$("<td>",{text:v[W]}).appendTo(J);$("<td>",{text:q[W]}).appendTo(J)}}if(L===true){I(M+2,M+1)}else{I(2,1)}var U=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(X);$("<td>",{text:"总消耗"}).appendTo(U);if(L===true){var S;var R;for(var K=1;K<=M;++K){S=0;R=0;for(var aa=0;aa<b.length;++aa){if(typeof(k[aa][K])!="undefined"){S+=k[aa][K]}if(typeof(e[aa][K])!="undefined"){R+=e[aa][K]}}if(S==0){if(R==0){$("<td>",{text:""}).appendTo(U)}else{$("<td>",{text:R+" Q5"}).appendTo(U)}}else{if(R==0){$("<td>",{text:S+" Q1"}).appendTo(U)}else{$("<td>",{text:S+" Q1  "+R+" Q5"}).appendTo(U)}}}}var Z;var O=0;var N=0;for(Z=0;Z<v.length;Z++){if(typeof(v[Z])!="undefined"){O+=v[Z]}}for(Z=0;Z<q.length;Z++){if(typeof(q[Z])!="undefined"){N+=q[Z]}}$("<td>",{text:O}).appendTo(U);$("<td>",{text:N}).appendTo(U)}function m(N,J){$("<p>个人消耗统计</p>").appendTo(J);var U=$("<table>",{id:"CBCPersonalResult",style:"width:100%;"}).appendTo(J);var O,L;var T=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(U);var K=$("<td>",{text:"回合"}).appendTo(T);for(O=1;O<=N;++O){$("<td>",{text:O}).appendTo(T)}$("<td>",{text:"总计(Q1)"}).appendTo(T);$("<td>",{text:"总计(Q5)"}).appendTo(T);var Q=$("<tr>",{style:"line-height:30px;background-color:DarkSlateGray;"}).appendTo(U);var P=$("<td>",{text:citizenInfo[userId].login}).appendTo(Q);for(O=1;O<=N;++O){if(typeof(n[O])=="undefined"){if(typeof(l[O])=="undefined"){$("<td>",{text:""}).appendTo(Q)}else{$("<td>",{text:l[O]+" Q5"}).appendTo(Q)}}else{if(typeof(l[O])=="undefined"){$("<td>",{text:n[O]+" Q1"}).appendTo(Q)}else{$("<td>",{text:n[O]+" Q1  "+l[O]+" Q5"}).appendTo(Q)}}}var S;var R=0;var M=0;for(S=0;S<n.length;S++){if(typeof(n[S])!="undefined"){R+=n[S]}}for(S=0;S<l.length;S++){if(typeof(l[S])!="undefined"){M+=l[S]}}$("<td>",{text:R}).appendTo(Q);$("<td>",{text:M}).appendTo(Q)}function z(J,K){return(Array(K).join(0)+J).slice(-K)}function p(M,N){var P=[];var L;var K;var O;var J;$(".CBCCountry").each(function(Q,R){K=$(this).children("td:eq("+M+")").text();if(K==""){K="0"}L=$(this).children("td:eq("+N+")").text();if(L==""){L="0"}O=parseInt(L)+parseInt(K)*5;J=z(O,6);P.push(J+" "+$(this).attr("id"))});P.sort();$.each(P,function(R,S){var Q=S.split(" ").pop();$("#CBCCountryResult #"+Q).insertAfter($("#CBCCountryResult tr:first"))})}function I(M,N){var P=[];var L;var K;var O;var J;$(".CBCMu").each(function(Q,R){K=$(this).children("td:eq("+M+")").text();if(K==""){K="0"}L=$(this).children("td:eq("+N+")").text();if(L==""){L="0"}O=parseInt(L)+parseInt(K)*5;J=z(O,6);P.push(J+" "+$(this).attr("id"))});P.sort();$.each(P,function(R,S){var Q=S.split(" ").pop();$("#CBCMuResult #"+Q).insertAfter($("#CBCMuResult tr:first"))})}var E;function c(){var J=window.navigator.userAgent;if(J.indexOf("MSIE")>=0){return"ie"}else{if(J.indexOf("Firefox")>=0){return"Firefox"}else{if(J.indexOf("Chrome")>=0){return"Chrome"}else{if(J.indexOf("Opera")>=0){return"Opera"}else{if(J.indexOf("Safari")>=0){return"Safari"}}}}}}function y(L){if(c()=="ie"){var J=document.getElementById(L);var O=new ActiveXObject("Excel.Application");var K=O.Workbooks.Add();var N=K.Worksheets(1);var M=document.body.createTextRange();M.moveToElementText(J);M.select();M.execCommand("Copy");N.Paste();O.Visible=true;try{var Q=O.Application.GetSaveAsFilename("Excel.xls","Excel Spreadsheets (*.xls), *.xls")}catch(P){print("Nested catch caught "+P)}finally{K.SaveAs(Q);K.Close(savechanges=false);O.Quit();O=null;E=window.setInterval("Cleanup();",1)}}else{r(L)}}function H(){window.clearInterval(E);CollectGarbage()}var r=(function(){var L="data:application/vnd.ms-excel;base64,",K='<html><head><meta charset="UTF-8"></head><body><table>{table}</table></body></html>',J=function(N){return window.btoa(unescape(encodeURIComponent(N)))},M=function(N,O){return N.replace(/{(\w+)}/g,function(P,Q){return O[Q]})};return function(P,O){if(!P.nodeType){P=document.getElementById(P)}var N={worksheet:O||"Worksheet",table:P.innerHTML};window.location.href=L+J(M(K,N))}})()}function enhanceCitizensOnline(){if($("td",$("table.dataTable tr:gt(0)")).length===1){return}b();e();c();d();function e(){var s=$(".dataTable :first").parent();var v=$("<div class='foundation-style columns'></div>");s.before(v);var p=$("<b>",{text:"默认使用武器：",title:"不开坦克buff的情况下该服务器大多数玩家使用的武器"}).appendTo(v);var q=$("<select>",{id:"DefaultWeapon",style:"padding:3px; margin:3px;"}).appendTo(v);$("<option>",{value:1,text:"Q1"}).appendTo(q);$("<option>",{value:5,text:"Q5"}).appendTo(q);var u=localStorage.getItem("CitizensOnlineDefaultWeapon");if(u===null){localStorage.setItem("CitizensOnlineDefaultWeapon",1);q.val(1)}else{q.val(u)}q.change(function(){localStorage.setItem("CitizensOnlineDefaultWeapon",q.val())});var x=$("<input>",{type:"checkbox",id:"DefaultMuBonus"}).appendTo(v);var y=$("<label>",{"class":"checkboxlabel","for":"DefaultMuBonus",text:"军令加成",title:"默认精英军团（20%加成）"}).appendTo(v);var w=localStorage.getItem("CitizensOnlineDefaultMuBonus");if(w===null){localStorage.setItem("CitizensOnlineDefaultMuBonus",true);x.attr("checked",true)}else{x.attr("checked",w=="true")}x.click(function(){if(x.is(":checked")){localStorage.setItem("CitizensOnlineDefaultMuBonus",true)}else{localStorage.setItem("CitizensOnlineDefaultMuBonus",false)}});var f=$("<span>",{text:"    更多伤害："}).appendTo(v);var n=$("<select>",{id:"MoreDamage",style:"padding:3px; margin:3px;"}).appendTo(v);for(var r=0;r<=40;r++){$("<option>",{value:(r*10),text:(r*10).toString()+"%"}).appendTo(n)}var m=localStorage.getItem("CitizensOnlineMoreDamage");if(m===null){localStorage.setItem("CitizensOnlineMoreDamage",0);n.val(0)}else{n.val(m)}n.change(function(){localStorage.setItem("CitizensOnlineMoreDamage",n.val())});var k=$("<span>",{text:"更多暴击："}).appendTo(v);var t=$("<select>",{id:"MoreCritical",style:"padding:3px; margin:3px;"}).appendTo(v);for(var r=0;r<=20;r++){$("<option>",{value:(r*10),text:(r*10).toString()+"%"}).appendTo(t)}var o=localStorage.getItem("CitizensOnlineMoreCritical");if(o===null){localStorage.setItem("CitizensOnlineMoreCritical",0);t.val(0)}else{t.val(o)}t.change(function(){localStorage.setItem("CitizensOnlineMoreCritical",t.val())});var h=$("<input type='button' class='foundation-style button' value='获取玩家状态'></input> ");v.append(h);h.click(function(){h.attr("disabled",true);$("table.dataTable tr:eq(0)").append($("<td exid='info'>详细信息</td>"));$("table.dataTable tr:gt(0)").append($('<td exid="info"><span id="buffs">BUFF：</span><br><span id="estBerserkAvg" title="伤害不含建筑加成，默认有本地加成，无被包围加成">连击平均伤害：加载中……</span><br><span id="score1" title="与无装备状态相比">总伤害：加载中……</span><br><span id="score2" title="与无装备状态相比，且不考虑闪避属性(avoid)">爆发力：加载中……</span></td>'));g()});function l(B){B+="";var z=B.split(".");var A=/(\d{1,3})(?=(\d{3})+$)/g;return z[0].replace(A,"$1,")+(z.length==2?"."+z[1]:"")}function g(){var z=$("table.dataTable:last tr:gt(0)");var A=z.length;z.each(function(){var C=parseInt($("td:first a",$(this)).attr("href").match(/([0-9]+)$/)[1]);var B=$(this);fetchAndUpdateOneCitizenPage(C,false,function(){if(citizenPage[C].equipments.length===0){$("td[exid='info']",B).html("组织号");return true}var I=[];$.each(citizenPage[C].buffIcons,function(ai,ah){I.push($("<img>",{src:ah,style:"width:20px; height:20px; vertical-align:middle;"}))});$.each(citizenPage[C].debuffIcons,function(ai,ah){I.push($("<img>",{src:ah,style:"width:20px; height:20px; vertical-align:middle;"}))});if(I.length>0){$("#buffs",B).append(I)}else{$("#buffs",B).append("无")}var M;var K;var E=0;var R=0;var X=0;var L=0;var ac=1;var T=$("#DefaultWeapon").val();if(T==0){ac=0.5}else{ac=1+T*0.2}var Q;if($("#DefaultMuBonus").is(":checked")){Q=1.2}else{Q=1}var Y=1+$("#MoreDamage").val()*0.01;var ad=1+$("#MoreCritical").val()*0.01;var J=citizenPage[C].buffIcons;for(var aa=0;aa<citizenPage[C].debuffIcons.length;aa++){J.push(citizenPage[C].debuffIcons[aa])}for(var Z=0;Z<J.length;Z++){var ae=J[Z].match(/(steroids|tank|spa|vacations|bunker|resistance|painDealer1h|painDealer10h|painDealer25h)\_(positive|negative)/ig);if(ae===null){break}switch(ae[0]){case"painDealer10h_positive":case"painDealer1h_positive":case"painDealer25h_positive":E=1;break;case"steroids_positive":R=1;break;case"steroids_negative":R=-1;break;case"tank_positive":X=1;ac=2;break;case"tank_negative":X=-1;ac=0.5;break;case"bunker_positive":case"resistance_positive":L=1;break;case"bunker_negative":case"resistance_negative":L=1;break;default:break}}var O=1;var G=citizenPage[C].lowHit;var V=citizenPage[C].highHit;var H=citizenPage[C].critical/100;var D=citizenPage[C].miss/100;var S=citizenPage[C].avoid/100;var F;var U=ac;F=H;if(E==1){F=F*2}F=F*ad;if(F>0.8){F=0.8}if(R==1){U=U*1.2}else{if(R==-1){U=U*0.8}}if(X==1){U=U*1.2}if(L==1){U=U*1.25}else{if(L==-1){U=U*0.8}}U=U*Q;U=U*1.2;U=U*Y;var W=Math.round(G*U*5);var N=Math.round(V*U*5);var ab=(W+N)*(1+F)/10;$("#estBerserkAvg",B).html("连击平均伤害："+l(Math.round(ab*5)));var af=citizenPage[C].strength;var P=citizenPage[C].totalDamage;var ag=[{damageRequired:0,name:"Rookie",damageModifier:1},{damageRequired:250,name:"Private",damageModifier:1.1},{damageRequired:1000,name:"Private First Class",damageModifier:1.2},{damageRequired:3000,name:"Corporal",damageModifier:1.3},{damageRequired:5000,name:"Sergeant",damageModifier:1.4},{damageRequired:10000,name:"Staff Sergeant",damageModifier:1.5},{damageRequired:30000,name:"Sergeant First Class",damageModifier:1.6},{damageRequired:60000,name:"Master Sergeant",damageModifier:1.65},{damageRequired:100000,name:"First Sergeant",damageModifier:1.7},{damageRequired:250000,name:"Sergeant Major",damageModifier:1.75},{damageRequired:500000,name:"Command Sergeant Major",damageModifier:1.8},{damageRequired:750000,name:"Sergeant Major of the Army",damageModifier:1.85},{damageRequired:1000000,name:"Second Lieutenant",damageModifier:1.9},{damageRequired:1500000,name:"First Lieutenant",damageModifier:1.93},{damageRequired:2500000,name:"Captain",damageModifier:1.96},{damageRequired:5000000,name:"Major",damageModifier:2},{damageRequired:10000000,name:"Lieutenant Colonel",damageModifier:2.03},{damageRequired:17000000,name:"Colonel",damageModifier:2.06},{damageRequired:25000000,name:"Brigadier General",damageModifier:2.1},{damageRequired:35000000,name:"Major General",damageModifier:2.13},{damageRequired:45000000,name:"Lieutenant General",damageModifier:2.16},{damageRequired:60000000,name:"General",damageModifier:2.19},{damageRequired:80000000,name:"General of the Army",damageModifier:2.21},{damageRequired:100000000,name:"Marshall",damageModifier:2.24},{damageRequired:125000000,name:"Field Marshall",damageModifier:2.27},{damageRequired:175000000,name:"Supreme Marshall",damageModifier:2.3},{damageRequired:250000000,name:"Generalissimus",damageModifier:2.33},{damageRequired:400000000,name:"Supreme Generalissimuss",damageModifier:2.36},{damageRequired:600000000,name:"Imperial Generalissimus",damageModifier:2.4},{damageRequired:800000000,name:"Legendary Generalissimuss",damageModifier:2.42},{damageRequired:1000000000,name:"Imperator",damageModifier:2.44},{damageRequired:1500000000,name:"Imperator Caesar",damageModifier:2.46},{damageRequired:2500000000,name:"Deus Dimidiam",damageModifier:2.48},{damageRequired:5000000000,name:"Deus",damageModifier:2.5},{damageRequired:7500000000,name:"Summi Deus",damageModifier:2.52},{damageRequired:10000000000,name:"Deus Imperialis",damageModifier:2.54},{damageRequired:15000000000,name:"Deus Fabuloso",damageModifier:2.56},{damageRequired:20000000000,name:"Deus Ultimum",damageModifier:2.58}];for(var aa=0;aa<ag.length;++aa){if(ag[aa]["damageRequired"]>P){P=ag[aa-1]["damageModifier"];break}}if(ag[ag.length-1]["damageRequired"]<=P){P=ag[ag.length-1]["damageModifier"]}K=((G+V)/2*(1+F)*(1-D))/(af*P*1.125*0.875);K=K<1?1:K;M=K*0.95/(1-S);$("#score1",B).text("总伤害：+"+((M-1)*100).toFixed(2)+"%");$("#score2",B).text("爆发力：+"+((K-1)*100).toFixed(2)+"%");if(--A===0){localStorage.setItem("citizenPage",JSON.stringify(citizenPage))}})})}}function b(){var g=$("#pagination-digg");if(g.length>0){var h=$("<button>",{text:"加载其他页的在线玩家","class":"foundation-style button",title:"如果需要加载所有在线玩家，请尽快点击该按钮，否则可能会出现重复玩家或丢失玩家"}).appendTo($(".dataTable tr:first td:first"));var f=$("table.dataTable:last");h.click(function(){h.attr("disabled",true);var k=$("li.next");var n=parseInt($("li.active")[0].innerHTML);var l;if(k.length>0){l=parseInt(k.prev().children().attr("href").split("page=")[1])}else{l=n}var m=l-1;h.text("剩余"+m+"个");for(var p=1;p<=l;p++){if(p==n){continue}var o=document.URL;if(o.indexOf("page")>0){o=o.substring(0,o.indexOf("page"))+"page="+p}else{if(o.indexOf("?")>0){o=o+"&page="+p}else{o=o+"?page="+p}}$.ajax({url:o,success:function(q){if($(".time",q).length!==2){console.log(citizenId,"抓取错误，重新抓取");$.ajax(this);return}if($("td",$(".dataTable tr:gt(0)",q)).length===1){return false}var r=$("tr :gt(0)",$(".dataTable",q));r.appendTo(f);h.text("剩余"+(--m)+"个");if(m<=0){h.text("加载完成，共"+l+"页")}},error:function(q,r){console.log("抓取错误 (",r,")，重新抓取");$.ajax(this)},})}})}}function c(){sortIndex=-1;var k,h;var l=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(1)"));var m=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(2)"));var n=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(3)"));var g=$("<button>",{text:"▼"}).appendTo($("table.dataTable:last tr:first td:eq(4)"));l.click(function(){f($("table.dataTable:last tr:gt(0)"),"number",1)});m.click(function(){f($("table.dataTable:last tr:gt(0)"),"formatNumber",2)});n.click(function(){f($("table.dataTable:last tr:gt(0)"),"formatNumber",3)});g.click(function(){f($("table.dataTable:last tr:gt(0)"),"region",4)});function f(s,u,r){var v=new Array();s.each(function(){var x=$(this).find("td");v.push(u+".separator"+$(x[r]).html()+".separator"+$(this).html());$(this).html("")});var t=v.length;if(r==sortIndex){v.reverse()}else{for(var q=0;q<t;q++){u=v[q].split(".separator")[0];for(var o=q+1;o<t;o++){k=v[q].split(".separator")[1];h=v[o].split(".separator")[1];if(u=="number"){k=k==""?0:parseInt(k);h=h==""?0:parseInt(h);if(k<h){var w=v[o];v[o]=v[q];v[q]=w}}else{if(u=="formatNumber"){k=k==""?0:parseInt(k.replace(/,/g,"").replace(/\xA0/g,""));h=h==""?0:parseInt(h.replace(/,/g,"").replace(/\xA0/g,""));if(k<h){var w=v[o];v[o]=v[q];v[q]=w}}else{if(u=="region"){k=k==""?0:parseInt(k.match(/id=([0-9]+)/)[1]);h=h==""?0:parseInt(h.match(/id=([0-9]+)/)[1]);if(k<h){var w=v[o];v[o]=v[q];v[q]=w}}}}}}}var p=$("table.dataTable:last").children();for(var q=0;q<t;q++){$("tr:eq("+(q+1)+")",p).html(v[q].split(".separator")[2])}sortIndex=r}}function d(){var g=$("table.dataTable:last");var o=$("<div></div>");o.insertBefore(g);var f=$("<table align='right'></table>");o.append(f);var l=$("<tr align='right'></tr>");f.append(l);var k=$("<input type='button' id='btnFilter' value='筛选玩家'></input> ");l.append(k);var n=$("<input type='button' id='btnCloseFilter' value='关闭筛选'></input> ");n.hide();l.append(n);var h=$("<input type='button' id='btnDeleteCheckedCitizen' value='隐藏选中玩家'></input> ");h.attr("disabled",true);l.append(h);var m=$("<input type='button' id='btnDeleteUncheckedCitizen' value='保留选中玩家'></input> ");m.attr("disabled",true);l.append(m);k.click(function(){k.hide();n.show();var p=$("<td exid='filter'><input type='checkbox'></input></td>");$("tr:eq(0)",g).append($("<td exid='filter'><input id='filterSelectAll' type='checkbox'></input>全选</td>"));$("tr:gt(0)",g).append(p);h.attr("disabled",false);m.attr("disabled",false);$("#filterSelectAll").click(function(){$("tr:gt(0)",g).each(function(q,r){$("input:checkbox",r).attr("checked",$("#filterSelectAll").is(":checked"))})})});n.click(function(){k.show();n.hide();$("td[exid='filter']",g).remove();h.attr("disabled",true);m.attr("disabled",true)});h.click(function(){$("tr:gt(0)",g).each(function(p,r){var q=$("input:checkbox",r);if(q.is(":checked")===true){r.remove()}})});m.click(function(){$("tr:gt(0)",g).each(function(p,r){var q=$("input:checkbox",r);if(q.is(":checked")===false){r.remove()}})})}}!function(a1){function a0(c){a1.jqplot.ElemContainer.call(this),this.name=c,this._series=[],this.show=!1,this.tickRenderer=a1.jqplot.AxisTickRenderer,this.tickOptions={},this.labelRenderer=a1.jqplot.AxisLabelRenderer,this.labelOptions={},this.label=null,this.showLabel=!0,this.min=null,this.max=null,this.autoscale=!1,this.pad=1.2,this.padMax=null,this.padMin=null,this.ticks=[],this.numberTicks,this.tickInterval,this.renderer=a1.jqplot.LinearAxisRenderer,this.rendererOptions={},this.showTicks=!0,this.showTickMarks=!0,this.showMinorTicks=!0,this.drawMajorGridlines=!0,this.drawMinorGridlines=!1,this.drawMajorTickMarks=!0,this.drawMinorTickMarks=!0,this.useSeriesColor=!1,this.borderWidth=null,this.borderColor=null,this.scaleToHiddenSeries=!1,this._dataBounds={min:null,max:null},this._intervalStats=[],this._offsets={min:null,max:null},this._ticks=[],this._label=null,this.syncTicks=null,this.tickSpacing=75,this._min=null,this._max=null,this._tickInterval=null,this._numberTicks=null,this.__ticks=null,this._options={}}function aZ(c){a1.jqplot.ElemContainer.call(this),this.show=!1,this.location="ne",this.labels=[],this.showLabels=!0,this.showSwatches=!0,this.placement="insideGrid",this.xoffset=0,this.yoffset=0,this.border,this.background,this.textColor,this.fontFamily,this.fontSize,this.rowSpacing="0.5em",this.renderer=a1.jqplot.TableLegendRenderer,this.rendererOptions={},this.preDraw=!1,this.marginTop=null,this.marginRight=null,this.marginBottom=null,this.marginLeft=null,this.escapeHtml=!1,this._series=[],a1.extend(!0,this,c)}function aY(c){a1.jqplot.ElemContainer.call(this),this.text=c,this.show=!0,this.fontFamily,this.fontSize,this.textAlign,this.textColor,this.renderer=a1.jqplot.DivTitleRenderer,this.rendererOptions={},this.escapeHtml=!1}function aX(c){c=c||{},a1.jqplot.ElemContainer.call(this),this.show=!0,this.xaxis="xaxis",this._xaxis,this.yaxis="yaxis",this._yaxis,this.gridBorderWidth=2,this.renderer=a1.jqplot.LineRenderer,this.rendererOptions={},this.data=[],this.gridData=[],this.label="",this.showLabel=!0,this.color,this.negativeColor,this.lineWidth=2.5,this.lineJoin="round",this.lineCap="round",this.linePattern="solid",this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1.25,this.shadowDepth=3,this.shadowAlpha="0.1",this.breakOnNull=!1,this.markerRenderer=a1.jqplot.MarkerRenderer,this.markerOptions={},this.showLine=!0,this.showMarker=!0,this.index,this.fill=!1,this.fillColor,this.fillAlpha,this.fillAndStroke=!1,this.disableStack=!1,this._stack=!1,this.neighborThreshold=4,this.fillToZero=!1,this.fillToValue=0,this.fillAxis="y",this.useNegativeColors=!0,this._stackData=[],this._plotData=[],this._plotValues={x:[],y:[]},this._intervals={x:{},y:{}},this._prevPlotData=[],this._prevGridData=[],this._stackAxis="y",this._primaryAxis="_xaxis",this.canvas=new a1.jqplot.GenericCanvas,this.shadowCanvas=new a1.jqplot.GenericCanvas,this.plugins={},this._sumy=0,this._sumx=0,this._type="",this.step=!1}function aW(){a1.jqplot.ElemContainer.call(this),this.drawGridlines=!0,this.gridLineColor="#cccccc",this.gridLineWidth=1,this.background="#fffdf6",this.borderColor="#999999",this.borderWidth=2,this.drawBorder=!0,this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1.5,this.shadowWidth=3,this.shadowDepth=3,this.shadowColor=null,this.shadowAlpha="0.07",this._left,this._top,this._right,this._bottom,this._width,this._height,this._axes=[],this.renderer=a1.jqplot.CanvasGridRenderer,this.rendererOptions={},this._offsets={top:null,bottom:null,left:null,right:null}}function aV(){function d(k){for(var h,p=0;p<k.length;p++){for(var o,n=[k[p].data,k[p]._stackData,k[p]._plotData,k[p]._prevPlotData],m=0;4>m;m++){if(o=!0,h=n[m],"x"==k[p]._stackAxis){for(var l=0;l<h.length;l++){if("number"!=typeof h[l][1]){o=!1;break}}o&&h.sort(function(f,e){return f[1]-e[1]})}else{for(var l=0;l<h.length;l++){if("number"!=typeof h[l][0]){o=!1;break}}o&&h.sort(function(f,e){return f[0]-e[0]})}}}}function c(s){var r,q,p=s.data.plot,o=p.eventCanvas._elem.offset(),n={x:s.pageX-o.left,y:s.pageY-o.top},m={xaxis:null,yaxis:null,x2axis:null,y2axis:null,y3axis:null,y4axis:null,y5axis:null,y6axis:null,y7axis:null,y8axis:null,y9axis:null,yMidAxis:null},l=["xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"],k=p.axes;for(r=11;r>0;r--){q=l[r-1],k[q].show&&(m[q]=k[q].series_p2u(n[q.charAt(0)]))}return{offsets:o,gridPos:n,dataPos:m}}function b(bn,bm){function bl(h,g,n){var m=(g[1]-n[1])/(g[0]-n[0]),l=g[1]-m*g[0],k=h+g[1];return[(k-l)/m,k]}var bk,bj,bi,bh,bg,bf,be,bd,bc,bb,ba,a9,a8,a7,a6,a5,a4,a3,Z,Y=bm.series;for(bi=bm.seriesStack.length-1;bi>=0;bi--){switch(bk=bm.seriesStack[bi],bh=Y[bk],a4=bh._highlightThreshold,bh.renderer.constructor){case a1.jqplot.BarRenderer:for(bf=bn.x,be=bn.y,bj=0;bj<bh._barPoints.length;bj++){if(a5=bh._barPoints[bj],a6=bh.gridData[bj],bf>a5[0][0]&&bf<a5[2][0]&&(be>a5[2][1]&&be<a5[0][1]||be<a5[2][1]&&be>a5[0][1])){return{seriesIndex:bh.index,pointIndex:bj,gridData:a6,data:bh.data[bj],points:bh._barPoints[bj]}}}break;case a1.jqplot.PyramidRenderer:for(bf=bn.x,be=bn.y,bj=0;bj<bh._barPoints.length;bj++){if(a5=bh._barPoints[bj],a6=bh.gridData[bj],bf>a5[0][0]+a4[0][0]&&bf<a5[2][0]+a4[2][0]&&be>a5[2][1]&&be<a5[0][1]){return{seriesIndex:bh.index,pointIndex:bj,gridData:a6,data:bh.data[bj],points:bh._barPoints[bj]}}}break;case a1.jqplot.DonutRenderer:if(bb=bh.startAngle/180*Math.PI,bf=bn.x-bh._center[0],be=bn.y-bh._center[1],bg=Math.sqrt(Math.pow(bf,2)+Math.pow(be,2)),bf>0&&-be>=0?bd=2*Math.PI-Math.atan(-be/bf):bf>0&&0>-be?bd=-Math.atan(-be/bf):0>bf?bd=Math.PI-Math.atan(-be/bf):0==bf&&-be>0?bd=3*Math.PI/2:0==bf&&0>-be?bd=Math.PI/2:0==bf&&0==be&&(bd=0),bb&&(bd-=bb,0>bd?bd+=2*Math.PI:bd>2*Math.PI&&(bd-=2*Math.PI)),bc=bh.sliceMargin/180*Math.PI,bg<bh._radius&&bg>bh._innerRadius){for(bj=0;bj<bh.gridData.length;bj++){if(ba=bj>0?bh.gridData[bj-1][1]+bc:bc,a9=bh.gridData[bj][1],bd>ba&&a9>bd){return{seriesIndex:bh.index,pointIndex:bj,gridData:[bn.x,bn.y],data:bh.data[bj]}}}}break;case a1.jqplot.PieRenderer:if(bb=bh.startAngle/180*Math.PI,bf=bn.x-bh._center[0],be=bn.y-bh._center[1],bg=Math.sqrt(Math.pow(bf,2)+Math.pow(be,2)),bf>0&&-be>=0?bd=2*Math.PI-Math.atan(-be/bf):bf>0&&0>-be?bd=-Math.atan(-be/bf):0>bf?bd=Math.PI-Math.atan(-be/bf):0==bf&&-be>0?bd=3*Math.PI/2:0==bf&&0>-be?bd=Math.PI/2:0==bf&&0==be&&(bd=0),bb&&(bd-=bb,0>bd?bd+=2*Math.PI:bd>2*Math.PI&&(bd-=2*Math.PI)),bc=bh.sliceMargin/180*Math.PI,bg<bh._radius){for(bj=0;bj<bh.gridData.length;bj++){if(ba=bj>0?bh.gridData[bj-1][1]+bc:bc,a9=bh.gridData[bj][1],bd>ba&&a9>bd){return{seriesIndex:bh.index,pointIndex:bj,gridData:[bn.x,bn.y],data:bh.data[bj]}}}}break;case a1.jqplot.BubbleRenderer:bf=bn.x,be=bn.y;var X=null;if(bh.show){for(var bj=0;bj<bh.gridData.length;bj++){a6=bh.gridData[bj],a7=Math.sqrt((bf-a6[0])*(bf-a6[0])+(be-a6[1])*(be-a6[1])),a7<=a6[2]&&(a8>=a7||null==a8)&&(a8=a7,X={seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]})}if(null!=X){return X}}break;case a1.jqplot.FunnelRenderer:bf=bn.x,be=bn.y;var W,V,U,T=bh._vertices,S=T[0],R=T[T.length-1];for(W=bl(be,S[0],R[3]),V=bl(be,S[1],R[2]),bj=0;bj<T.length;bj++){if(U=T[bj],be>=U[0][1]&&be<=U[3][1]&&bf>=W[0]&&bf<=V[0]){return{seriesIndex:bh.index,pointIndex:bj,gridData:null,data:bh.data[bj]}}}break;case a1.jqplot.LineRenderer:if(bf=bn.x,be=bn.y,bg=bh.renderer,bh.show){if(!(!(bh.fill||bh.renderer.bands.show&&bh.renderer.bands.fill)||bm.plugins.highlighter&&bm.plugins.highlighter.show)){var Q=!1;if(bf>bh._boundingBox[0][0]&&bf<bh._boundingBox[1][0]&&be>bh._boundingBox[1][1]&&be<bh._boundingBox[0][1]){for(var P,O=bh._areaPoints.length,bj=O-1,P=0;O>P;P++){var N=[bh._areaPoints[P][0],bh._areaPoints[P][1]],M=[bh._areaPoints[bj][0],bh._areaPoints[bj][1]];(N[1]<be&&M[1]>=be||M[1]<be&&N[1]>=be)&&N[0]+(be-N[1])/(M[1]-N[1])*(M[0]-N[0])<bf&&(Q=!Q),bj=P}}if(Q){return{seriesIndex:bk,pointIndex:null,gridData:bh.gridData,data:bh.data,points:bh._areaPoints}}break}Z=bh.markerRenderer.size/2+bh.neighborThreshold,a3=Z>0?Z:0;for(var bj=0;bj<bh.gridData.length;bj++){if(a6=bh.gridData[bj],bg.constructor==a1.jqplot.OHLCRenderer){if(bg.candleStick){var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._bodyWidth/2&&bf<=a6[0]+bg._bodyWidth/2&&be>=L(bh.data[bj][2])&&be<=L(bh.data[bj][3])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}else{if(bg.hlc){var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._tickLength&&bf<=a6[0]+bg._tickLength&&be>=L(bh.data[bj][1])&&be<=L(bh.data[bj][2])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}else{var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._tickLength&&bf<=a6[0]+bg._tickLength&&be>=L(bh.data[bj][2])&&be<=L(bh.data[bj][3])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}}}else{if(null!=a6[0]&&null!=a6[1]&&(a7=Math.sqrt((bf-a6[0])*(bf-a6[0])+(be-a6[1])*(be-a6[1])),a3>=a7&&(a8>=a7||null==a8))){return a8=a7,{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}}}break;default:if(bf=bn.x,be=bn.y,bg=bh.renderer,bh.show){Z=bh.markerRenderer.size/2+bh.neighborThreshold,a3=Z>0?Z:0;for(var bj=0;bj<bh.gridData.length;bj++){if(a6=bh.gridData[bj],bg.constructor==a1.jqplot.OHLCRenderer){if(bg.candleStick){var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._bodyWidth/2&&bf<=a6[0]+bg._bodyWidth/2&&be>=L(bh.data[bj][2])&&be<=L(bh.data[bj][3])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}else{if(bg.hlc){var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._tickLength&&bf<=a6[0]+bg._tickLength&&be>=L(bh.data[bj][1])&&be<=L(bh.data[bj][2])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}else{var L=bh._yaxis.series_u2p;if(bf>=a6[0]-bg._tickLength&&bf<=a6[0]+bg._tickLength&&be>=L(bh.data[bj][2])&&be<=L(bh.data[bj][3])){return{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}}}else{if(a7=Math.sqrt((bf-a6[0])*(bf-a6[0])+(be-a6[1])*(be-a6[1])),a3>=a7&&(a8>=a7||null==a8)){return a8=a7,{seriesIndex:bk,pointIndex:bj,gridData:a6,data:bh.data[bj]}}}}}}}return null}this.animate=!1,this.animateReplot=!1,this.axes={xaxis:new a0("xaxis"),yaxis:new a0("yaxis"),x2axis:new a0("x2axis"),y2axis:new a0("y2axis"),y3axis:new a0("y3axis"),y4axis:new a0("y4axis"),y5axis:new a0("y5axis"),y6axis:new a0("y6axis"),y7axis:new a0("y7axis"),y8axis:new a0("y8axis"),y9axis:new a0("y9axis"),yMidAxis:new a0("yMidAxis")},this.baseCanvas=new a1.jqplot.GenericCanvas,this.captureRightClick=!1,this.data=[],this.dataRenderer,this.dataRendererOptions,this.defaults={axesDefaults:{},axes:{xaxis:{},yaxis:{},x2axis:{},y2axis:{},y3axis:{},y4axis:{},y5axis:{},y6axis:{},y7axis:{},y8axis:{},y9axis:{},yMidAxis:{}},seriesDefaults:{},series:[]},this.defaultAxisStart=1,this.drawIfHidden=!1,this.eventCanvas=new a1.jqplot.GenericCanvas,this.fillBetween={series1:null,series2:null,color:null,baseSeries:0,fill:!0},this.fontFamily,this.fontSize,this.grid=new aW,this.legend=new aZ,this.noDataIndicator={show:!1,indicator:"Loading Data...",axes:{xaxis:{min:0,max:10,tickInterval:2,show:!0},yaxis:{min:0,max:12,tickInterval:3,show:!0}}},this.negativeSeriesColors=a1.jqplot.config.defaultNegativeColors,this.options={},this.previousSeriesStack=[],this.plugins={},this.series=[],this.seriesStack=[],this.seriesColors=a1.jqplot.config.defaultColors,this.sortData=!0,this.stackSeries=!1,this.syncXTicks=!0,this.syncYTicks=!0,this.target=null,this.targetId=null,this.textColor,this.title=new aY,this._drawCount=0,this._sumy=0,this._sumx=0,this._stackData=[],this._plotData=[],this._width=null,this._height=null,this._plotDimensions={height:null,width:null},this._gridPadding={top:null,right:null,bottom:null,left:null},this._defaultGridPadding={top:10,right:10,bottom:23,left:10},this._addDomReference=a1.jqplot.config.addDomReference,this.preInitHooks=new a1.jqplot.HooksManager,this.postInitHooks=new a1.jqplot.HooksManager,this.preParseOptionsHooks=new a1.jqplot.HooksManager,this.postParseOptionsHooks=new a1.jqplot.HooksManager,this.preDrawHooks=new a1.jqplot.HooksManager,this.postDrawHooks=new a1.jqplot.HooksManager,this.preDrawSeriesHooks=new a1.jqplot.HooksManager,this.postDrawSeriesHooks=new a1.jqplot.HooksManager,this.preDrawLegendHooks=new a1.jqplot.HooksManager,this.addLegendRowHooks=new a1.jqplot.HooksManager,this.preSeriesInitHooks=new a1.jqplot.HooksManager,this.postSeriesInitHooks=new a1.jqplot.HooksManager,this.preParseSeriesOptionsHooks=new a1.jqplot.HooksManager,this.postParseSeriesOptionsHooks=new a1.jqplot.HooksManager,this.eventListenerHooks=new a1.jqplot.EventListenerManager,this.preDrawSeriesShadowHooks=new a1.jqplot.HooksManager,this.postDrawSeriesShadowHooks=new a1.jqplot.HooksManager,this.colorGenerator=new a1.jqplot.ColorGenerator,this.negativeColorGenerator=new a1.jqplot.ColorGenerator,this.canvasManager=new a1.jqplot.CanvasManager,this.themeEngine=new a1.jqplot.ThemeEngine;this.init=function(z,y,x){x=x||{};for(var w=0;w<a1.jqplot.preInitHooks.length;w++){a1.jqplot.preInitHooks[w].call(this,z,y,x)}for(var w=0;w<this.preInitHooks.hooks.length;w++){this.preInitHooks.hooks[w].call(this,z,y,x)}if(this.targetId="#"+z,this.target=a1("#"+z),this._addDomReference&&this.target.data("jqplot",this),this.target.removeClass("jqplot-error"),!this.target.get(0)){throw new Error("No plot target specified")}if("static"==this.target.css("position")&&this.target.css("position","relative"),this.target.hasClass("jqplot-target")||this.target.addClass("jqplot-target"),this.target.height()){this._height=v=this.target.height()}else{var v;v=x&&x.height?parseInt(x.height,10):this.target.attr("data-height")?parseInt(this.target.attr("data-height"),10):parseInt(a1.jqplot.config.defaultHeight,10),this._height=v,this.target.css("height",v+"px")}if(this.target.width()){this._width=u=this.target.width()}else{var u;u=x&&x.width?parseInt(x.width,10):this.target.attr("data-width")?parseInt(this.target.attr("data-width"),10):parseInt(a1.jqplot.config.defaultWidth,10),this._width=u,this.target.css("width",u+"px")}for(var w=0,t=au.length;t>w;w++){this.axes[au[w]]=new a0(au[w])}if(this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions,this._height<=0||this._width<=0||!this._height||!this._width){throw new Error("Canvas dimension not set")}if(x.dataRenderer&&a1.isFunction(x.dataRenderer)&&(x.dataRendererOptions&&(this.dataRendererOptions=x.dataRendererOptions),this.dataRenderer=x.dataRenderer,y=this.dataRenderer(y,this,this.dataRendererOptions)),x.noDataIndicator&&a1.isPlainObject(x.noDataIndicator)&&a1.extend(!0,this.noDataIndicator,x.noDataIndicator),null==y||0==a1.isArray(y)||0==y.length||0==a1.isArray(y[0])||0==y[0].length){if(0==this.noDataIndicator.show){throw new Error("No data specified")}for(var s in this.noDataIndicator.axes){for(var r in this.noDataIndicator.axes[s]){this.axes[s][r]=this.noDataIndicator.axes[s][r]}}this.postDrawHooks.add(function(){var k=this.eventCanvas.getHeight(),A=this.eventCanvas.getWidth(),o=a1('<div class="jqplot-noData-container" style="position:absolute;"></div>');this.target.append(o),o.height(k),o.width(A),o.css("top",this.eventCanvas._offsets.top),o.css("left",this.eventCanvas._offsets.left);var n=a1('<div class="jqplot-noData-contents" style="text-align:center; position:relative; margin-left:auto; margin-right:auto;"></div>');o.append(n),n.html(this.noDataIndicator.indicator);var m=n.height(),l=n.width();n.height(m),n.width(l),n.css("top",(k-m)/2+"px")})}this.data=a1.extend(!0,[],y),this.parseOptions(x),this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this.title.init(),this.legend.init(),this._sumy=0,this._sumx=0,this.computePlotData();for(var w=0;w<this.series.length;w++){this.seriesStack.push(w),this.previousSeriesStack.push(w),this.series[w].shadowCanvas._plotDimensions=this._plotDimensions,this.series[w].canvas._plotDimensions=this._plotDimensions;for(var q=0;q<a1.jqplot.preSeriesInitHooks.length;q++){a1.jqplot.preSeriesInitHooks[q].call(this.series[w],z,this.data,this.options.seriesDefaults,this.options.series[w],this)}for(var q=0;q<this.preSeriesInitHooks.hooks.length;q++){this.preSeriesInitHooks.hooks[q].call(this.series[w],z,this.data,this.options.seriesDefaults,this.options.series[w],this)}this.series[w]._plotDimensions=this._plotDimensions,this.series[w].init(w,this.grid.borderWidth,this);for(var q=0;q<a1.jqplot.postSeriesInitHooks.length;q++){a1.jqplot.postSeriesInitHooks[q].call(this.series[w],z,this.data,this.options.seriesDefaults,this.options.series[w],this)}for(var q=0;q<this.postSeriesInitHooks.hooks.length;q++){this.postSeriesInitHooks.hooks[q].call(this.series[w],z,this.data,this.options.seriesDefaults,this.options.series[w],this)}this._sumy+=this.series[w]._sumy,this._sumx+=this.series[w]._sumx}for(var p,h,w=0,t=au.length;t>w;w++){p=au[w],h=this.axes[p],h._plotDimensions=this._plotDimensions,h.init(),null==this.axes[p].borderColor&&("x"!==p.charAt(0)&&h.useSeriesColor===!0&&h.show?h.borderColor=h._series[0].color:h.borderColor=this.grid.borderColor)}this.sortData&&d(this.series),this.grid.init(),this.grid._axes=this.axes,this.legend._series=this.series;for(var w=0;w<a1.jqplot.postInitHooks.length;w++){a1.jqplot.postInitHooks[w].call(this,z,this.data,x)}for(var w=0;w<this.postInitHooks.hooks.length;w++){this.postInitHooks.hooks[w].call(this,z,this.data,x)}},this.resetAxesScale=function(h,o){var n=o||{},m=h||this.axes;if(m===!0&&(m=this.axes),a1.isArray(m)){for(var l=0;l<m.length;l++){this.axes[m[l]].resetScale(n[m[l]])}}else{if("object"==typeof m){for(var k in m){this.axes[k].resetScale(n[k])}}}},this.reInitialize=function(B,A){for(var z=a1.extend(!0,{},this.options,A),y=this.targetId.substr(1),x=null==B?this.data:B,w=0;w<a1.jqplot.preInitHooks.length;w++){a1.jqplot.preInitHooks[w].call(this,y,x,z)}for(var w=0;w<this.preInitHooks.hooks.length;w++){this.preInitHooks.hooks[w].call(this,y,x,z)}if(this._height=this.target.height(),this._width=this.target.width(),this._height<=0||this._width<=0||!this._height||!this._width){throw new Error("Target dimension not set")}this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions;for(var v,u,t,s,w=0,r=au.length;r>w;w++){v=au[w],s=this.axes[v],u=s._ticks;for(var t=0,q=u.length;q>t;t++){var h=u[t]._elem;h&&(a1.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==av&&window.G_vmlCanvasManager.uninitElement(h.get(0)),h.emptyForce(),h=null,u._elem=null)}u=null,delete s.ticks,delete s._ticks,this.axes[v]=new a0(v),this.axes[v]._plotWidth=this._width,this.axes[v]._plotHeight=this._height}B&&(z.dataRenderer&&a1.isFunction(z.dataRenderer)&&(z.dataRendererOptions&&(this.dataRendererOptions=z.dataRendererOptions),this.dataRenderer=z.dataRenderer,B=this.dataRenderer(B,this,this.dataRendererOptions)),this.data=a1.extend(!0,[],B)),A&&this.parseOptions(z),this.title._plotWidth=this._width,this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this.title.init(),this.legend.init(),this._sumy=0,this._sumx=0,this.seriesStack=[],this.previousSeriesStack=[],this.computePlotData();for(var w=0,r=this.series.length;r>w;w++){this.seriesStack.push(w),this.previousSeriesStack.push(w),this.series[w].shadowCanvas._plotDimensions=this._plotDimensions,this.series[w].canvas._plotDimensions=this._plotDimensions;for(var t=0;t<a1.jqplot.preSeriesInitHooks.length;t++){a1.jqplot.preSeriesInitHooks[t].call(this.series[w],y,this.data,this.options.seriesDefaults,this.options.series[w],this)}for(var t=0;t<this.preSeriesInitHooks.hooks.length;t++){this.preSeriesInitHooks.hooks[t].call(this.series[w],y,this.data,this.options.seriesDefaults,this.options.series[w],this)}this.series[w]._plotDimensions=this._plotDimensions,this.series[w].init(w,this.grid.borderWidth,this);for(var t=0;t<a1.jqplot.postSeriesInitHooks.length;t++){a1.jqplot.postSeriesInitHooks[t].call(this.series[w],y,this.data,this.options.seriesDefaults,this.options.series[w],this)}for(var t=0;t<this.postSeriesInitHooks.hooks.length;t++){this.postSeriesInitHooks.hooks[t].call(this.series[w],y,this.data,this.options.seriesDefaults,this.options.series[w],this)}this._sumy+=this.series[w]._sumy,this._sumx+=this.series[w]._sumx}for(var w=0,r=au.length;r>w;w++){v=au[w],s=this.axes[v],s._plotDimensions=this._plotDimensions,s.init(),null==s.borderColor&&("x"!==v.charAt(0)&&s.useSeriesColor===!0&&s.show?s.borderColor=s._series[0].color:s.borderColor=this.grid.borderColor)}this.sortData&&d(this.series),this.grid.init(),this.grid._axes=this.axes,this.legend._series=this.series;for(var w=0,r=a1.jqplot.postInitHooks.length;r>w;w++){a1.jqplot.postInitHooks[w].call(this,y,this.data,z)}for(var w=0,r=this.postInitHooks.hooks.length;r>w;w++){this.postInitHooks.hooks[w].call(this,y,this.data,z)}},this.quickInit=function(){if(this._height=this.target.height(),this._width=this.target.width(),this._height<=0||this._width<=0||!this._height||!this._width){throw new Error("Target dimension not set")}this._plotDimensions.height=this._height,this._plotDimensions.width=this._width,this.grid._plotDimensions=this._plotDimensions,this.title._plotDimensions=this._plotDimensions,this.baseCanvas._plotDimensions=this._plotDimensions,this.eventCanvas._plotDimensions=this._plotDimensions,this.legend._plotDimensions=this._plotDimensions;for(var h in this.axes){this.axes[h]._plotWidth=this._width,this.axes[h]._plotHeight=this._height}this.title._plotWidth=this._width,this.textColor&&this.target.css("color",this.textColor),this.fontFamily&&this.target.css("font-family",this.fontFamily),this.fontSize&&this.target.css("font-size",this.fontSize),this._sumy=0,this._sumx=0,this.computePlotData();for(var o=0;o<this.series.length;o++){"line"===this.series[o]._type&&this.series[o].renderer.bands.show&&this.series[o].renderer.initBands.call(this.series[o],this.series[o].renderer.options,this),this.series[o]._plotDimensions=this._plotDimensions,this.series[o].canvas._plotDimensions=this._plotDimensions,this._sumy+=this.series[o]._sumy,this._sumx+=this.series[o]._sumx}for(var n,m=0;12>m;m++){n=au[m];for(var l=this.axes[n]._ticks,o=0;o<l.length;o++){var k=l[o]._elem;k&&(a1.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==av&&window.G_vmlCanvasManager.uninitElement(k.get(0)),k.emptyForce(),k=null,l._elem=null)}l=null,this.axes[n]._plotDimensions=this._plotDimensions,this.axes[n]._ticks=[]}this.sortData&&d(this.series),this.grid._axes=this.axes,this.legend._series=this.series},this.computePlotData=function(){this._plotData=[],this._stackData=[];var y,x,w;for(x=0,w=this.series.length;w>x;x++){y=this.series[x],this._plotData.push([]),this._stackData.push([]);var v=y.data;this._plotData[x]=a1.extend(!0,[],v),this._stackData[x]=a1.extend(!0,[],v),y._plotData=this._plotData[x],y._stackData=this._stackData[x];var u={x:[],y:[]};if(this.stackSeries&&!y.disableStack){y._stack=!0;for(var t="x"===y._stackAxis?0:1,s=0,r=v.length;r>s;s++){var q=v[s][t];if(null==q&&(q=0),this._plotData[x][s][t]=q,this._stackData[x][s][t]=q,x>0){for(var p=x;p--;){var o=this._plotData[p][s][t];if(q*o>=0){this._plotData[x][s][t]+=o,this._stackData[x][s][t]+=o;break}}}}}else{for(var n=0;n<y.data.length;n++){u.x.push(y.data[n][0]),u.y.push(y.data[n][1])}this._stackData.push(y.data),this.series[x]._stackData=y.data,this._plotData.push(y.data),y._plotData=y.data,y._plotValues=u}for(x>0&&(y._prevPlotData=this.series[x-1]._plotData),y._sumy=0,y._sumx=0,n=y.data.length-1;n>-1;n--){y._sumy+=y.data[n][1],y._sumx+=y.data[n][0]}}},this.populatePlotData=function(C,B){this._plotData=[],this._stackData=[],C._stackData=[],C._plotData=[];var A={x:[],y:[]};if(this.stackSeries&&!C.disableStack){C._stack=!0;for(var z,y,x,w,v="x"===C._stackAxis?0:1,u=a1.extend(!0,[],C.data),t=a1.extend(!0,[],C.data),s=0;B>s;s++){for(var r=this.series[s].data,q=0;q<r.length;q++){x=r[q],z=null!=x[0]?x[0]:0,y=null!=x[1]?x[1]:0,u[q][0]+=z,u[q][1]+=y,w=v?y:z,C.data[q][v]*w>=0&&(t[q][v]+=w)}}for(var p=0;p<t.length;p++){A.x.push(t[p][0]),A.y.push(t[p][1])}this._plotData.push(t),this._stackData.push(u),C._stackData=u,C._plotData=t,C._plotValues=A}else{for(var p=0;p<C.data.length;p++){A.x.push(C.data[p][0]),A.y.push(C.data[p][1])}this._stackData.push(C.data),this.series[B]._stackData=C.data,this._plotData.push(C.data),C._plotData=C.data,C._plotValues=A}for(B>0&&(C._prevPlotData=this.series[B-1]._plotData),C._sumy=0,C._sumx=0,p=C.data.length-1;p>-1;p--){C._sumy+=C.data[p][1],C._sumx+=C.data[p][0]}},this.getNextSeriesColor=function(f){var e=0,g=f.seriesColors;return function(){return e<g.length?g[e++]:(e=0,g[e++])}}(this),this.parseOptions=function(y){for(var x=0;x<this.preParseOptionsHooks.hooks.length;x++){this.preParseOptionsHooks.hooks[x].call(this,y)}for(var x=0;x<a1.jqplot.preParseOptionsHooks.length;x++){a1.jqplot.preParseOptionsHooks[x].call(this,y)}this.options=a1.extend(!0,{},this.defaults,y);var w=this.options;if(this.animate=w.animate,this.animateReplot=w.animateReplot,this.stackSeries=w.stackSeries,a1.isPlainObject(w.fillBetween)){for(var v,u=["series1","series2","color","baseSeries","fill"],x=0,t=u.length;t>x;x++){v=u[x],null!=w.fillBetween[v]&&(this.fillBetween[v]=w.fillBetween[v])}}w.seriesColors&&(this.seriesColors=w.seriesColors),w.negativeSeriesColors&&(this.negativeSeriesColors=w.negativeSeriesColors),w.captureRightClick&&(this.captureRightClick=w.captureRightClick),this.defaultAxisStart=y&&null!=y.defaultAxisStart?y.defaultAxisStart:this.defaultAxisStart,this.colorGenerator.setColors(this.seriesColors),this.negativeColorGenerator.setColors(this.negativeSeriesColors),a1.extend(!0,this._gridPadding,w.gridPadding),this.sortData=null!=w.sortData?w.sortData:this.sortData;for(var x=0;12>x;x++){var s=au[x],r=this.axes[s];r._options=a1.extend(!0,{},w.axesDefaults,w.axes[s]),a1.extend(!0,r,w.axesDefaults,w.axes[s]),r._plotWidth=this._width,r._plotHeight=this._height}var q=function(h,z,n){var m,l,k=[];if(z=z||"vertical",a1.isArray(h[0])){a1.extend(!0,k,h)}else{for(m=0,l=h.length;l>m;m++){"vertical"==z?k.push([n+m,h[m]]):k.push([h[m],n+m])}}return k};this.series=[];for(var x=0;x<this.data.length;x++){for(var p=a1.extend(!0,{index:x},{seriesColors:this.seriesColors,negativeSeriesColors:this.negativeSeriesColors},this.options.seriesDefaults,this.options.series[x],{rendererOptions:{animation:{show:this.animate}}}),u=new aX(p),o=0;o<a1.jqplot.preParseSeriesOptionsHooks.length;o++){a1.jqplot.preParseSeriesOptionsHooks[o].call(u,this.options.seriesDefaults,this.options.series[x])}for(var o=0;o<this.preParseSeriesOptionsHooks.hooks.length;o++){this.preParseSeriesOptionsHooks.hooks[o].call(u,this.options.seriesDefaults,this.options.series[x])}a1.extend(!0,u,p);var e="vertical";switch(u.renderer===a1.jqplot.BarRenderer&&u.rendererOptions&&"horizontal"==u.rendererOptions.barDirection&&(e="horizontal",u._stackAxis="x",u._primaryAxis="_yaxis"),u.data=q(this.data[x],e,this.defaultAxisStart),u.xaxis){case"xaxis":u._xaxis=this.axes.xaxis;break;case"x2axis":u._xaxis=this.axes.x2axis}u._yaxis=this.axes[u.yaxis],u._xaxis._series.push(u),u._yaxis._series.push(u),u.show?(u._xaxis.show=!0,u._yaxis.show=!0):(u._xaxis.scaleToHiddenSeries&&(u._xaxis.show=!0),u._yaxis.scaleToHiddenSeries&&(u._yaxis.show=!0)),u.label||(u.label="Series "+(x+1).toString()),this.series.push(u);for(var o=0;o<a1.jqplot.postParseSeriesOptionsHooks.length;o++){a1.jqplot.postParseSeriesOptionsHooks[o].call(this.series[x],this.options.seriesDefaults,this.options.series[x])}for(var o=0;o<this.postParseSeriesOptionsHooks.hooks.length;o++){this.postParseSeriesOptionsHooks.hooks[o].call(this.series[x],this.options.seriesDefaults,this.options.series[x])}}a1.extend(!0,this.grid,this.options.grid);for(var x=0,t=au.length;t>x;x++){var s=au[x],r=this.axes[s];null==r.borderWidth&&(r.borderWidth=this.grid.borderWidth)}"string"==typeof this.options.title?this.title.text=this.options.title:"object"==typeof this.options.title&&a1.extend(!0,this.title,this.options.title),this.title._plotWidth=this._width,this.legend.setOptions(this.options.legend);for(var x=0;x<a1.jqplot.postParseOptionsHooks.length;x++){a1.jqplot.postParseOptionsHooks[x].call(this,y)}for(var x=0;x<this.postParseOptionsHooks.hooks.length;x++){this.postParseOptionsHooks.hooks[x].call(this,y)}},this.destroy=function(){this.canvasManager.freeAllCanvases(),this.eventCanvas&&this.eventCanvas._elem&&this.eventCanvas._elem.unbind(),this.target.empty(),this.target[0].innerHTML=""},this.replot=function(g){var m=g||{},l=m.data||null,k=m.clear===!1?!1:!0,h=m.resetAxes||!1;delete m.data,delete m.clear,delete m.resetAxes,this.target.trigger("jqplotPreReplot"),k&&this.destroy(),l||!a1.isEmptyObject(m)?this.reInitialize(l,m):this.quickInit(),h&&this.resetAxesScale(h,m.axes),this.draw(),this.target.trigger("jqplotPostReplot")},this.redraw=function(f){f=null!=f?f:!0,this.target.trigger("jqplotPreRedraw"),f&&(this.canvasManager.freeAllCanvases(),this.eventCanvas._elem.unbind(),this.target.empty());for(var e in this.axes){this.axes[e]._ticks=[]}this.computePlotData(),this._sumy=0,this._sumx=0;for(var h=0,g=this.series.length;g>h;h++){this._sumy+=this.series[h]._sumy,this._sumx+=this.series[h]._sumx}this.draw(),this.target.trigger("jqplotPostRedraw")},this.draw=function(){if(this.drawIfHidden||this.target.is(":visible")){this.target.trigger("jqplotPreDraw");var a9,a8,a7;for(a9=0,a7=a1.jqplot.preDrawHooks.length;a7>a9;a9++){a1.jqplot.preDrawHooks[a9].call(this)}for(a9=0,a7=this.preDrawHooks.hooks.length;a7>a9;a9++){this.preDrawHooks.hooks[a9].apply(this,this.preDrawSeriesHooks.args[a9])}this.target.append(this.baseCanvas.createElement({left:0,right:0,top:0,bottom:0},"jqplot-base-canvas",null,this)),this.baseCanvas.setContext(),this.target.append(this.title.draw()),this.title.pack({top:0,left:0});var a6=this.legend.draw({},this),a5={top:0,left:0,bottom:0,right:0};if("outsideGrid"==this.legend.placement){switch(this.target.append(a6),this.legend.location){case"n":a5.top+=this.legend.getHeight();break;case"s":a5.bottom+=this.legend.getHeight();break;case"ne":case"e":case"se":a5.right+=this.legend.getWidth();break;case"nw":case"w":case"sw":a5.left+=this.legend.getWidth();break;default:a5.right+=this.legend.getWidth()}a6=a6.detach()}var a4,a3=this.axes;for(a9=0;12>a9;a9++){a4=au[a9],this.target.append(a3[a4].draw(this.baseCanvas._ctx,this)),a3[a4].set()}a3.yaxis.show&&(a5.left+=a3.yaxis.getWidth());var Z,Y=["y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis"],X=[0,0,0,0,0,0,0,0],W=0;for(Z=0;8>Z;Z++){a3[Y[Z]].show&&(W+=a3[Y[Z]].getWidth(),X[Z]=W)}if(a5.right+=W,a3.x2axis.show&&(a5.top+=a3.x2axis.getHeight()),this.title.show&&(a5.top+=this.title.getHeight()),a3.xaxis.show&&(a5.bottom+=a3.xaxis.getHeight()),this.options.gridDimensions&&a1.isPlainObject(this.options.gridDimensions)){var V=parseInt(this.options.gridDimensions.width,10)||0,U=parseInt(this.options.gridDimensions.height,10)||0,T=(this._width-a5.left-a5.right-V)/2,S=(this._height-a5.top-a5.bottom-U)/2;S>=0&&T>=0&&(a5.top+=S,a5.bottom+=S,a5.left+=T,a5.right+=T)}var Q=["top","bottom","left","right"];for(var Z in Q){null==this._gridPadding[Q[Z]]&&a5[Q[Z]]>0?this._gridPadding[Q[Z]]=a5[Q[Z]]:null==this._gridPadding[Q[Z]]&&(this._gridPadding[Q[Z]]=this._defaultGridPadding[Q[Z]])}var O=this._gridPadding;for("outsideGrid"===this.legend.placement&&(O={top:this.title.getHeight(),left:0,right:0,bottom:0},"s"===this.legend.location&&(O.left=this._gridPadding.left,O.right=this._gridPadding.right)),a3.xaxis.pack({position:"absolute",bottom:this._gridPadding.bottom-a3.xaxis.getHeight(),left:0,width:this._width},{min:this._gridPadding.left,max:this._width-this._gridPadding.right}),a3.yaxis.pack({position:"absolute",top:0,left:this._gridPadding.left-a3.yaxis.getWidth(),height:this._height},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top}),a3.x2axis.pack({position:"absolute",top:this._gridPadding.top-a3.x2axis.getHeight(),left:0,width:this._width},{min:this._gridPadding.left,max:this._width-this._gridPadding.right}),a9=8;a9>0;a9--){a3[Y[a9-1]].pack({position:"absolute",top:0,right:this._gridPadding.right-X[a9-1]},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top})}var M=(this._width-this._gridPadding.left-this._gridPadding.right)/2+this._gridPadding.left-a3.yMidAxis.getWidth()/2;a3.yMidAxis.pack({position:"absolute",top:0,left:M,zIndex:9,textAlign:"center"},{min:this._height-this._gridPadding.bottom,max:this._gridPadding.top}),this.target.append(this.grid.createElement(this._gridPadding,this)),this.grid.draw();var K=this.series,J=K.length;for(a9=0,a7=J;a7>a9;a9++){a8=this.seriesStack[a9],this.target.append(K[a8].shadowCanvas.createElement(this._gridPadding,"jqplot-series-shadowCanvas",null,this)),K[a8].shadowCanvas.setContext(),K[a8].shadowCanvas._elem.data("seriesIndex",a8)}for(a9=0,a7=J;a7>a9;a9++){a8=this.seriesStack[a9],this.target.append(K[a8].canvas.createElement(this._gridPadding,"jqplot-series-canvas",null,this)),K[a8].canvas.setContext(),K[a8].canvas._elem.data("seriesIndex",a8)}this.target.append(this.eventCanvas.createElement(this._gridPadding,"jqplot-event-canvas",null,this)),this.eventCanvas.setContext(),this.eventCanvas._ctx.fillStyle="rgba(0,0,0,0)",this.eventCanvas._ctx.fillRect(0,0,this.eventCanvas._ctx.canvas.width,this.eventCanvas._ctx.canvas.height),this.bindCustomEvents(),this.legend.preDraw?(this.eventCanvas._elem.before(a6),this.legend.pack(O),this.legend._elem?this.drawSeries({legendInfo:{location:this.legend.location,placement:this.legend.placement,width:this.legend.getWidth(),height:this.legend.getHeight(),xoffset:this.legend.xoffset,yoffset:this.legend.yoffset}}):this.drawSeries()):(this.drawSeries(),J&&a1(K[J-1].canvas._elem).after(a6),this.legend.pack(O));for(var a9=0,a7=a1.jqplot.eventListenerHooks.length;a7>a9;a9++){this.eventCanvas._elem.bind(a1.jqplot.eventListenerHooks[a9][0],{plot:this},a1.jqplot.eventListenerHooks[a9][1])}for(var a9=0,a7=this.eventListenerHooks.hooks.length;a7>a9;a9++){this.eventCanvas._elem.bind(this.eventListenerHooks.hooks[a9][0],{plot:this},this.eventListenerHooks.hooks[a9][1])}var I=this.fillBetween;if("number"==typeof I.series1){I.fill&&I.series1!==I.series2&&I.series1<J&&I.series2<J&&"line"===K[I.series1]._type&&"line"===K[I.series2]._type&&this.doFillBetweenLines()}else{if(null!=I.series1&&null!=I.series2){var H=!1;if(I.series1.length===I.series2.length){for(var G=0,F=0,E=0;E<I.series1.length;E++){if(G=I.series1[E],F=I.series2[E],!(G!==F&&J>G&&J>F&&"line"===K[G]._type&&"line"===K[F]._type)){H=!1;break}H=!0}}I.fill&&H&&this.doFillBetweenLines()}}for(var a9=0,a7=a1.jqplot.postDrawHooks.length;a7>a9;a9++){a1.jqplot.postDrawHooks[a9].call(this)}for(var a9=0,a7=this.postDrawHooks.hooks.length;a7>a9;a9++){this.postDrawHooks.hooks[a9].apply(this,this.postDrawHooks.args[a9])}this.target.is(":visible")&&(this._drawCount+=1);var R,P,N,L;for(a9=0,a7=J;a7>a9;a9++){R=K[a9],P=R.renderer,N=".jqplot-point-label.jqplot-series-"+a9,P.animation&&P.animation._supported&&P.animation.show&&(this._drawCount<2||this.animateReplot)&&(L=this.target.find(N),L.stop(!0,!0).hide(),R.canvas._elem.stop(!0,!0).hide(),R.shadowCanvas._elem.stop(!0,!0).hide(),R.canvas._elem.jqplotEffect("blind",{mode:"show",direction:P.animation.direction},P.animation.speed),R.shadowCanvas._elem.jqplotEffect("blind",{mode:"show",direction:P.animation.direction},P.animation.speed),L.fadeIn(0.8*P.animation.speed))}L=null,this.target.trigger("jqplotPostDraw",[this])}},aV.prototype.doFillBetweenLines=function(){function l(B,A){var z=r[B],y=r[A];if(y.renderer.smooth){var x=y.renderer._smoothedData.slice(0).reverse()}else{var x=y.gridData.slice(0).reverse()}if(z.renderer.smooth){var w=z.renderer._smoothedData.concat(x)}else{var w=z.gridData.concat(x)}var v=null!==k.color?k.color:r[q].fillColor,u=null!==k.baseSeries?k.baseSeries:B,t=r[u].renderer.shapeRenderer,s={fillStyle:v,fill:!0,closePath:!0};t.draw(z.shadowCanvas._ctx,w,s)}var k=this.fillBetween,r=this.series,q=k.series1,p=k.series2,o=0,n=0;if("number"==typeof q&&"number"==typeof p){o=p>q?q:p,n=p>q?p:q,l(o,n)}else{for(var m=0;m<q.length;m++){o=q[m]<p[m]?q[m]:p[m],n=p[m]>q[m]?p[m]:q[m],l(o,n)}}},this.bindCustomEvents=function(){this.eventCanvas._elem.bind("click",{plot:this},this.onClick),this.eventCanvas._elem.bind("dblclick",{plot:this},this.onDblClick),this.eventCanvas._elem.bind("mousedown",{plot:this},this.onMouseDown),this.eventCanvas._elem.bind("mousemove",{plot:this},this.onMouseMove),this.eventCanvas._elem.bind("mouseenter",{plot:this},this.onMouseEnter),this.eventCanvas._elem.bind("mouseleave",{plot:this},this.onMouseLeave),this.captureRightClick?(this.eventCanvas._elem.bind("mouseup",{plot:this},this.onRightClick),this.eventCanvas._elem.get(0).oncontextmenu=function(){return !1}):this.eventCanvas._elem.bind("mouseup",{plot:this},this.onMouseUp)},this.onClick=function(g){var m=c(g),l=g.data.plot,k=b(m.gridPos,l),h=a1.Event("jqplotClick");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])},this.onDblClick=function(g){var m=c(g),l=g.data.plot,k=b(m.gridPos,l),h=a1.Event("jqplotDblClick");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])},this.onMouseDown=function(g){var m=c(g),l=g.data.plot,k=b(m.gridPos,l),h=a1.Event("jqplotMouseDown");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])},this.onMouseUp=function(e){var g=c(e),f=a1.Event("jqplotMouseUp");f.pageX=e.pageX,f.pageY=e.pageY,a1(this).trigger(f,[g.gridPos,g.dataPos,null,e.data.plot])},this.onRightClick=function(g){var m=c(g),l=g.data.plot,k=b(m.gridPos,l);if(l.captureRightClick){if(3==g.which){var h=a1.Event("jqplotRightClick");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])}else{var h=a1.Event("jqplotMouseUp");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])}}},this.onMouseMove=function(g){var m=c(g),l=g.data.plot,k=b(m.gridPos,l),h=a1.Event("jqplotMouseMove");h.pageX=g.pageX,h.pageY=g.pageY,a1(this).trigger(h,[m.gridPos,m.dataPos,k,l])},this.onMouseEnter=function(f){var k=c(f),h=f.data.plot,g=a1.Event("jqplotMouseEnter");g.pageX=f.pageX,g.pageY=f.pageY,g.relatedTarget=f.relatedTarget,a1(this).trigger(g,[k.gridPos,k.dataPos,null,h])},this.onMouseLeave=function(f){var k=c(f),h=f.data.plot,g=a1.Event("jqplotMouseLeave");g.pageX=f.pageX,g.pageY=f.pageY,g.relatedTarget=f.relatedTarget,a1(this).trigger(g,[k.gridPos,k.dataPos,null,h])},this.drawSeries=function(g,m){var l,k,h;if(m="number"==typeof g&&null==m?g:m,g="object"==typeof g?g:{},m!=av){k=this.series[m],h=k.shadowCanvas._ctx,h.clearRect(0,0,h.canvas.width,h.canvas.height),k.drawShadow(h,g,this),h=k.canvas._ctx,h.clearRect(0,0,h.canvas.width,h.canvas.height),k.draw(h,g,this),k.renderer.constructor==a1.jqplot.BezierCurveRenderer&&m<this.series.length-1&&this.drawSeries(m+1)}else{for(l=0;l<this.series.length;l++){k=this.series[l],h=k.shadowCanvas._ctx,h.clearRect(0,0,h.canvas.width,h.canvas.height),k.drawShadow(h,g,this),h=k.canvas._ctx,h.clearRect(0,0,h.canvas.width,h.canvas.height),k.draw(h,g,this)}}g=m=l=k=h=null},this.moveSeriesToFront=function(g){g=parseInt(g,10);var m=a1.inArray(g,this.seriesStack);if(-1!=m){if(m==this.seriesStack.length-1){return void (this.previousSeriesStack=this.seriesStack.slice(0))}var l=this.seriesStack[this.seriesStack.length-1],k=this.series[g].canvas._elem.detach(),h=this.series[g].shadowCanvas._elem.detach();this.series[l].shadowCanvas._elem.after(h),this.series[l].canvas._elem.after(k),this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack.splice(m,1),this.seriesStack.push(g)}},this.moveSeriesToBack=function(g){g=parseInt(g,10);var m=a1.inArray(g,this.seriesStack);if(0!=m&&-1!=m){var l=this.seriesStack[0],k=this.series[g].canvas._elem.detach(),h=this.series[g].shadowCanvas._elem.detach();this.series[l].shadowCanvas._elem.before(h),this.series[l].canvas._elem.before(k),this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack.splice(m,1),this.seriesStack.unshift(g)}},this.restorePreviousSeriesOrder=function(){var h,g,n,m,l,k;if(this.seriesStack!=this.previousSeriesStack){for(h=1;h<this.previousSeriesStack.length;h++){l=this.previousSeriesStack[h],k=this.previousSeriesStack[h-1],g=this.series[l].canvas._elem.detach(),n=this.series[l].shadowCanvas._elem.detach(),this.series[k].shadowCanvas._elem.after(n),this.series[k].canvas._elem.after(g)}m=this.seriesStack.slice(0),this.seriesStack=this.previousSeriesStack.slice(0),this.previousSeriesStack=m}},this.restoreOriginalSeriesOrder=function(){var f,e,h,g=[];for(f=0;f<this.series.length;f++){g.push(f)}if(this.seriesStack!=g){for(this.previousSeriesStack=this.seriesStack.slice(0),this.seriesStack=g,f=1;f<this.seriesStack.length;f++){e=this.series[f].canvas._elem.detach(),h=this.series[f].shadowCanvas._elem.detach(),this.series[f-1].shadowCanvas._elem.after(h),this.series[f-1].canvas._elem.after(e)}}},this.activateTheme=function(e){this.themeEngine.activate(this,e)}}function aU(d,c){return(3.4182054+c)*Math.pow(d,-0.3534992)}function aT(d){var c=(Math.exp(2*d)-1)/(Math.exp(2*d)+1);return c}function aS(a4){function a3(d,c){return d-c==0?Math.pow(10,10):d-c}var Z=this.renderer.smooth,Y=this.canvas.getWidth(),X=this._xaxis.series_p2u,W=this._yaxis.series_p2u,V=null,U=a4.length/Y,T=[],S=[];V=isNaN(parseFloat(Z))?aU(U,0.5):parseFloat(Z);for(var R=[],Q=[],P=0,O=a4.length;O>P;P++){R.push(a4[P][1]),Q.push(a4[P][0])}for(var N,L,J,I,H=a4.length-1,G=1,F=a4.length;F>G;G++){for(var E=[],D=[],C=0;2>C;C++){var P=G-1+C;0==P||P==H?E[C]=Math.pow(10,10):R[P+1]-R[P]==0||R[P]-R[P-1]==0?E[C]=0:(Q[P+1]-Q[P])/(R[P+1]-R[P])+(Q[P]-Q[P-1])/(R[P]-R[P-1])==0?E[C]=0:(R[P+1]-R[P])*(R[P]-R[P-1])<0?E[C]=0:E[C]=2/(a3(Q[P+1],Q[P])/(R[P+1]-R[P])+a3(Q[P],Q[P-1])/(R[P]-R[P-1]))}1==G?E[0]=1.5*(R[1]-R[0])/a3(Q[1],Q[0])-E[1]/2:G==H&&(E[1]=1.5*(R[H]-R[H-1])/a3(Q[H],Q[H-1])-E[0]/2),D[0]=-2*(E[1]+2*E[0])/a3(Q[G],Q[G-1])+6*(R[G]-R[G-1])/Math.pow(a3(Q[G],Q[G-1]),2),D[1]=2*(2*E[1]+E[0])/a3(Q[G],Q[G-1])-6*(R[G]-R[G-1])/Math.pow(a3(Q[G],Q[G-1]),2),I=1/6*(D[1]-D[0])/a3(Q[G],Q[G-1]),J=0.5*(Q[G]*D[0]-Q[G-1]*D[1])/a3(Q[G],Q[G-1]),L=(R[G]-R[G-1]-J*(Math.pow(Q[G],2)-Math.pow(Q[G-1],2))-I*(Math.pow(Q[G],3)-Math.pow(Q[G-1],3)))/a3(Q[G],Q[G-1]),N=R[G-1]-L*Q[G-1]-J*Math.pow(Q[G-1],2)-I*Math.pow(Q[G-1],3);for(var h,M,K=(Q[G]-Q[G-1])/V,C=0,O=V;O>C;C++){h=[],M=Q[G-1]+C*K,h.push(M),h.push(N+L*M+J*Math.pow(M,2)+I*Math.pow(M,3)),T.push(h),S.push([X(h[0]),W(h[1])])}}return T.push(a4[P]),S.push([X(a4[P][0]),W(a4[P][1])]),[T,S]}function aR(bn){var bm,bl,bk,bj,bi,bh,bg,bf,be,bd,bc,bb,ba,a9,a8,a7,a6,a5,a4=this.renderer.smooth,a3=this.renderer.tension,Z=this.canvas.getWidth(),Y=this._xaxis.series_p2u,X=this._yaxis.series_p2u,W=null,V=null,U=null,T=null,S=null,R=null,Q=null,P=bn.length/Z,O=[],N=[];W=isNaN(parseFloat(a4))?aU(P,0.5):parseFloat(a4),isNaN(parseFloat(a3))||(a3=parseFloat(a3));for(var M=0,h=bn.length-1;h>M;M++){for(null===a3?(S=Math.abs((bn[M+1][1]-bn[M][1])/(bn[M+1][0]-bn[M][0])),a9=0.3,a8=0.6,a7=(a8-a9)/2,a6=2.5,a5=-1.4,Q=S/a6+a5,U=a7*aT(Q)-a7*aT(a5)+a9,M>0&&(R=Math.abs((bn[M][1]-bn[M-1][1])/(bn[M][0]-bn[M-1][0]))),Q=R/a6+a5,T=a7*aT(Q)-a7*aT(a5)+a9,V=(U+T)/2):V=a3,bm=0;W>bm;bm++){bl=bm/W,bk=(1+2*bl)*Math.pow(1-bl,2),bj=bl*Math.pow(1-bl,2),bi=Math.pow(bl,2)*(3-2*bl),bh=Math.pow(bl,2)*(bl-1),bn[M-1]?(bg=V*(bn[M+1][0]-bn[M-1][0]),bf=V*(bn[M+1][1]-bn[M-1][1])):(bg=V*(bn[M+1][0]-bn[M][0]),bf=V*(bn[M+1][1]-bn[M][1])),bn[M+2]?(be=V*(bn[M+2][0]-bn[M][0]),bd=V*(bn[M+2][1]-bn[M][1])):(be=V*(bn[M+1][0]-bn[M][0]),bd=V*(bn[M+1][1]-bn[M][1])),bc=bk*bn[M][0]+bi*bn[M+1][0]+bj*bg+bh*be,bb=bk*bn[M][1]+bi*bn[M+1][1]+bj*bf+bh*bd,ba=[bc,bb],O.push(ba),N.push([Y(bc),X(bb)])}}return O.push(bn[h]),N.push([Y(bn[h][0]),X(bn[h][1])]),[O,N]}function aQ(f,k,h){for(var g=0;g<this.series.length;g++){this.series[g].renderer.constructor==a1.jqplot.LineRenderer&&this.series[g].highlightMouseOver&&(this.series[g].highlightMouseDown=!1)}}function aP(){this.plugins.lineRenderer&&this.plugins.lineRenderer.highlightCanvas&&(this.plugins.lineRenderer.highlightCanvas.resetCanvas(),this.plugins.lineRenderer.highlightCanvas=null),this.plugins.lineRenderer.highlightedSeriesIndex=null,this.plugins.lineRenderer.highlightCanvas=new a1.jqplot.GenericCanvas,this.eventCanvas._elem.before(this.plugins.lineRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-lineRenderer-highlight-canvas",this._plotDimensions,this)),this.plugins.lineRenderer.highlightCanvas.setContext(),this.eventCanvas._elem.bind("mouseleave",{plot:this},function(b){aN(b.data.plot)})}function aO(k,h,p,o){var n=k.series[h],m=k.plugins.lineRenderer.highlightCanvas;m._ctx.clearRect(0,0,m._ctx.canvas.width,m._ctx.canvas.height),n._highlightedPoint=p,k.plugins.lineRenderer.highlightedSeriesIndex=h;var l={fillStyle:n.highlightColor};"line"===n.type&&n.renderer.bands.show&&(l.fill=!0,l.closePath=!0),n.renderer.shapeRenderer.draw(m._ctx,o,l),m=null}function aN(e){var d=e.plugins.lineRenderer.highlightCanvas;d._ctx.clearRect(0,0,d._ctx.canvas.width,d._ctx.canvas.height);for(var f=0;f<e.series.length;f++){e.series[f]._highlightedPoint=null}e.plugins.lineRenderer.highlightedSeriesIndex=null,e.target.trigger("jqplotDataUnhighlight"),d=null}function aM(l,k,r,q,p){if(q){var o=[q.seriesIndex,q.pointIndex,q.data],n=jQuery.Event("jqplotDataMouseOver");if(n.pageX=l.pageX,n.pageY=l.pageY,p.target.trigger(n,o),p.series[o[0]].highlightMouseOver&&o[0]!=p.plugins.lineRenderer.highlightedSeriesIndex){var m=jQuery.Event("jqplotDataHighlight");m.which=l.which,m.pageX=l.pageX,m.pageY=l.pageY,p.target.trigger(m,o),aO(p,q.seriesIndex,q.pointIndex,q.points)}}else{null==q&&aN(p)}}function aL(k,h,p,o,n){if(o){var m=[o.seriesIndex,o.pointIndex,o.data];if(n.series[m[0]].highlightMouseDown&&m[0]!=n.plugins.lineRenderer.highlightedSeriesIndex){var l=jQuery.Event("jqplotDataHighlight");l.which=k.which,l.pageX=k.pageX,l.pageY=k.pageY,n.target.trigger(l,m),aO(n,o.seriesIndex,o.pointIndex,o.points)}}else{null==o&&aN(n)}}function aK(h,g,n,m,l){var k=l.plugins.lineRenderer.highlightedSeriesIndex;null!=k&&l.series[k].highlightMouseDown&&aN(l)}function aJ(k,h,p,o,n){if(o){var m=[o.seriesIndex,o.pointIndex,o.data],l=jQuery.Event("jqplotDataClick");l.which=k.which,l.pageX=k.pageX,l.pageY=k.pageY,n.target.trigger(l,m)}}function aI(l,k,r,q,p){if(q){var o=[q.seriesIndex,q.pointIndex,q.data],n=p.plugins.lineRenderer.highlightedSeriesIndex;null!=n&&p.series[n].highlightMouseDown&&aN(p);var m=jQuery.Event("jqplotDataRightClick");m.which=l.which,m.pageX=l.pageX,m.pageY=l.pageY,p.target.trigger(m,o)}}function aH(e){var d;if(e=Math.abs(e),e>=10){d="%d"}else{if(e>1){d=e===parseInt(e,10)?"%d":"%.1f"}else{var f=-Math.floor(Math.log(e)/Math.LN10);d="%."+f+"f"}}return d}function aG(I,H,G){for(var F,E,D,C,B,A,z,y=Math.floor(G/2),x=Math.ceil(1.5*G),w=Number.MAX_VALUE,v=H-I,u=a1.jqplot.getSignificantFigures,t=0,s=x-y+1;s>t;t++){A=y+t,F=v/(A-1),E=u(F),F=Math.abs(G-A)+E.digitsRight,w>F?(w=F,D=A,z=E.digitsRight):F===w&&E.digitsRight<z&&(D=A,z=E.digitsRight)}return C=Math.max(z,Math.max(u(I).digitsRight,u(H).digitsRight)),B=0===C?"%d":"%."+C+"f",F=v/(D-1),[I,H,D,B,F]}function aF(h,g){g=g||7;var n,m=h/(g-1),l=Math.pow(10,Math.floor(Math.log(m)/Math.LN10)),k=m/l;return n=1>l?k>5?10*l:k>2?5*l:k>1?2*l:l:k>5?10*l:k>4?5*l:k>3?4*l:k>2?3*l:k>1?2*l:l}function aE(h,g){g=g||1;var n,m=Math.floor(Math.log(h)/Math.LN10),l=Math.pow(10,m),k=h/l;return k/=g,n=0.38>=k?0.1:1.6>=k?0.2:4>=k?0.5:8>=k?1:16>=k?2:5,n*l}function aD(k,h){var p,o,n=Math.floor(Math.log(k)/Math.LN10),m=Math.pow(10,n),l=k/m;return l/=h,o=0.38>=l?0.1:1.6>=l?0.2:4>=l?0.5:8>=l?1:16>=l?2:5,p=o*m,[p,o,m]}function aC(d,c){return d-c}function aA(e){if(null==e||"object"!=typeof e){return e}var d=new e.constructor;for(var f in e){d[f]=aA(e[f])}return d}function az(e,d){if(null!=d&&"object"==typeof d){for(var f in d){"highlightColors"==f&&(e[f]=aA(d[f])),null!=d[f]&&"object"==typeof d[f]?(e.hasOwnProperty(f)||(e[f]={}),az(e[f],d[f])):e[f]=d[f]}}}function ay(f,e){if(e.indexOf){return e.indexOf(f)}for(var h=0,g=e.length;g>h;h++){if(e[h]===f){return h}}return -1}function ax(b){return null===b?"[object Null]":Object.prototype.toString.call(b)}function aw(f,k,h,g){return a1.isPlainObject(f)?f:(f={effect:f},k===av&&(k={}),a1.isFunction(k)&&(g=k,h=null,k={}),("number"===a1.type(k)||a1.fx.speeds[k])&&(g=h,h=k,k={}),a1.isFunction(h)&&(g=h,h=null),k&&a1.extend(f,k),h=h||k.duration,f.duration=a1.fx.off?0:"number"==typeof h?h:h in a1.fx.speeds?a1.fx.speeds[h]:a1.fx.speeds._default,f.complete=g||k.complete,f)}var av;a1.fn.emptyForce=function(){for(var d,e=0;null!=(d=a1(this)[e]);e++){if(1===d.nodeType&&a1.cleanData(d.getElementsByTagName("*")),a1.jqplot.use_excanvas){d.outerHTML=""}else{for(;d.firstChild;){d.removeChild(d.firstChild)}}d=null}return a1(this)},a1.fn.removeChildForce=function(b){for(;b.firstChild;){this.removeChildForce(b.firstChild),b.removeChild(b.firstChild)}},a1.fn.jqplot=function(){for(var f=[],k=[],h=0,g=arguments.length;g>h;h++){a1.isArray(arguments[h])?f.push(arguments[h]):a1.isPlainObject(arguments[h])&&k.push(arguments[h])}return this.each(function(q){var p,o,n,m,l=a1(this),c=f.length,b=k.length;n=c>q?f[q]:c?f[c-1]:null,m=b>q?k[q]:b?k[b-1]:null,p=l.attr("id"),p===av&&(p="jqplot_target_"+a1.jqplot.targetCounter++,l.attr("id",p)),o=a1.jqplot(p,n,m),l.data("jqplot",o)})},a1.jqplot=function(g,q,p){var o=null,n=null;3===arguments.length?(o=q,n=p):2===arguments.length&&(a1.isArray(q)?o=q:a1.isPlainObject(q)&&(n=q)),null===o&&null!==n&&n.data&&(o=n.data);var m=new aV;if(a1("#"+g).removeClass("jqplot-error"),!a1.jqplot.config.catchErrors){return m.init(g,o,n),m.draw(),m.themeEngine.init.call(m),m}try{return m.init(g,o,n),m.draw(),m.themeEngine.init.call(m),m}catch(l){var k=a1.jqplot.config.errorMessage||l.message;a1("#"+g).append('<div class="jqplot-error-message">'+k+"</div>"),a1("#"+g).addClass("jqplot-error"),document.getElementById(g).style.background=a1.jqplot.config.errorBackground,document.getElementById(g).style.border=a1.jqplot.config.errorBorder,document.getElementById(g).style.fontFamily=a1.jqplot.config.errorFontFamily,document.getElementById(g).style.fontSize=a1.jqplot.config.errorFontSize,document.getElementById(g).style.fontStyle=a1.jqplot.config.errorFontStyle,document.getElementById(g).style.fontWeight=a1.jqplot.config.errorFontWeight}},a1.jqplot.version="1.0.9",a1.jqplot.revision="d96a669",a1.jqplot.targetCounter=1,a1.jqplot.CanvasManager=function(){"undefined"==typeof a1.jqplot.CanvasManager.canvases&&(a1.jqplot.CanvasManager.canvases=[],a1.jqplot.CanvasManager.free=[]);var c=[];this.getCanvas=function(){var k,h=!0;if(!a1.jqplot.use_excanvas){for(var g=0,b=a1.jqplot.CanvasManager.canvases.length;b>g;g++){if(a1.jqplot.CanvasManager.free[g]===!0){h=!1,k=a1.jqplot.CanvasManager.canvases[g],a1.jqplot.CanvasManager.free[g]=!1,c.push(g);break}}}return h&&(k=document.createElement("canvas"),c.push(a1.jqplot.CanvasManager.canvases.length),a1.jqplot.CanvasManager.canvases.push(k),a1.jqplot.CanvasManager.free.push(!1)),k},this.initCanvas=function(g){if(a1.jqplot.use_excanvas){return window.G_vmlCanvasManager.initElement(g)}var m=g.getContext("2d"),l=1;window.devicePixelRatio>1&&(m.webkitBackingStorePixelRatio===av||m.webkitBackingStorePixelRatio<2)&&(l=window.devicePixelRatio);var k=g.width,h=g.height;return g.width=l*g.width,g.height=l*g.height,g.style.width=k+"px",g.style.height=h+"px",m.save(),m.scale(l,l),g},this.freeAllCanvases=function(){for(var b=0,d=c.length;d>b;b++){this.freeCanvas(c[b])}c=[]},this.freeCanvas=function(d){if(a1.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==av){window.G_vmlCanvasManager.uninitElement(a1.jqplot.CanvasManager.canvases[d]),a1.jqplot.CanvasManager.canvases[d]=null}else{var e=a1.jqplot.CanvasManager.canvases[d];e.getContext("2d").clearRect(0,0,e.width,e.height),a1(e).unbind().removeAttr("class").removeAttr("style"),a1(e).css({left:"",top:"",position:""}),e.width=0,e.height=0,a1.jqplot.CanvasManager.free[d]=!0}}},a1.jqplot.log=function(){window.console&&window.console.log.apply(window.console,arguments)},a1.jqplot.config={addDomReference:!1,enablePlugins:!1,defaultHeight:300,defaultWidth:400,UTCAdjust:!1,timezoneOffset:new Date(60000*(new Date).getTimezoneOffset()),errorMessage:"",errorBackground:"",errorBorder:"",errorFontFamily:"",errorFontSize:"",errorFontStyle:"",errorFontWeight:"",catchErrors:!1,defaultTickFormatString:"%.1f",defaultColors:["#4bb2c5","#EAA228","#c5b47f","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7"],defaultNegativeColors:["#498991","#C08840","#9F9274","#546D61","#646C4A","#6F6621","#6E3F5F","#4F64B0","#A89050","#C45923","#187399","#945381","#959E5C","#C7AF7B","#478396","#907294"],dashLength:4,gapLength:4,dotGapLength:2.5,srcLocation:"jqplot/src/",pluginLocation:"jqplot/src/plugins/"},a1.jqplot.arrayMax=function(b){return Math.max.apply(Math,b)},a1.jqplot.arrayMin=function(b){return Math.min.apply(Math,b)},a1.jqplot.enablePlugins=a1.jqplot.config.enablePlugins,a1.jqplot.support_canvas=function(){return"undefined"==typeof a1.jqplot.support_canvas.result&&(a1.jqplot.support_canvas.result=!!document.createElement("canvas").getContext),a1.jqplot.support_canvas.result},a1.jqplot.support_canvas_text=function(){return"undefined"==typeof a1.jqplot.support_canvas_text.result&&(window.G_vmlCanvasManager!==av&&window.G_vmlCanvasManager._version>887?a1.jqplot.support_canvas_text.result=!0:a1.jqplot.support_canvas_text.result=!(!document.createElement("canvas").getContext||"function"!=typeof document.createElement("canvas").getContext("2d").fillText)),a1.jqplot.support_canvas_text.result},a1.jqplot.use_excanvas=a1.support.boxModel&&a1.support.objectAll&&$support.leadingWhitespace||a1.jqplot.support_canvas()?!1:!0,a1.jqplot.preInitHooks=[],a1.jqplot.postInitHooks=[],a1.jqplot.preParseOptionsHooks=[],a1.jqplot.postParseOptionsHooks=[],a1.jqplot.preDrawHooks=[],a1.jqplot.postDrawHooks=[],a1.jqplot.preDrawSeriesHooks=[],a1.jqplot.postDrawSeriesHooks=[],a1.jqplot.preDrawLegendHooks=[],a1.jqplot.addLegendRowHooks=[],a1.jqplot.preSeriesInitHooks=[],a1.jqplot.postSeriesInitHooks=[],a1.jqplot.preParseSeriesOptionsHooks=[],a1.jqplot.postParseSeriesOptionsHooks=[],a1.jqplot.eventListenerHooks=[],a1.jqplot.preDrawSeriesShadowHooks=[],a1.jqplot.postDrawSeriesShadowHooks=[],a1.jqplot.ElemContainer=function(){this._elem,this._plotWidth,this._plotHeight,this._plotDimensions={height:null,width:null}},a1.jqplot.ElemContainer.prototype.createElement=function(k,q,p,o,n){this._offsets=q;var m=p||"jqplot",l=document.createElement(k);return this._elem=a1(l),this._elem.addClass(m),this._elem.css(o),this._elem.attr(n),l=null,this._elem},a1.jqplot.ElemContainer.prototype.getWidth=function(){return this._elem?this._elem.outerWidth(!0):null},a1.jqplot.ElemContainer.prototype.getHeight=function(){return this._elem?this._elem.outerHeight(!0):null},a1.jqplot.ElemContainer.prototype.getPosition=function(){return this._elem?this._elem.position():{top:null,left:null,bottom:null,right:null}},a1.jqplot.ElemContainer.prototype.getTop=function(){return this.getPosition().top},a1.jqplot.ElemContainer.prototype.getLeft=function(){return this.getPosition().left},a1.jqplot.ElemContainer.prototype.getBottom=function(){return this._elem.css("bottom")},a1.jqplot.ElemContainer.prototype.getRight=function(){return this._elem.css("right")},a0.prototype=new a1.jqplot.ElemContainer,a0.prototype.constructor=a0,a0.prototype.init=function(){a1.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.tickOptions.axis=this.name,null==this.tickOptions.showMark&&(this.tickOptions.showMark=this.showTicks),null==this.tickOptions.showMark&&(this.tickOptions.showMark=this.showTickMarks),null==this.tickOptions.showLabel&&(this.tickOptions.showLabel=this.showTicks),null==this.label||""==this.label?this.showLabel=!1:this.labelOptions.label=this.label,0==this.showLabel&&(this.labelOptions.show=!1),0==this.pad&&(this.pad=1),0==this.padMax&&(this.padMax=1),0==this.padMin&&(this.padMin=1),null==this.padMax&&(this.padMax=(this.pad-1)/2+1),null==this.padMin&&(this.padMin=(this.pad-1)/2+1),this.pad=this.padMax+this.padMin-1,(null!=this.min||null!=this.max)&&(this.autoscale=!1),null==this.syncTicks&&this.name.indexOf("y")>-1?this.syncTicks=!0:null==this.syncTicks&&(this.syncTicks=!1),this.renderer.init.call(this,this.rendererOptions)},a0.prototype.draw=function(d,c){return this.__ticks&&(this.__ticks=null),this.renderer.draw.call(this,d,c)},a0.prototype.set=function(){this.renderer.set.call(this)},a0.prototype.pack=function(d,c){this.show&&this.renderer.pack.call(this,d,c),null==this._min&&(this._min=this.min,this._max=this.max,this._tickInterval=this.tickInterval,this._numberTicks=this.numberTicks,this.__ticks=this._ticks)},a0.prototype.reset=function(){this.renderer.reset.call(this)},a0.prototype.resetScale=function(c){a1.extend(!0,this,{min:null,max:null,numberTicks:null,tickInterval:null,_ticks:[],ticks:[]},c),this.resetDataBounds()},a0.prototype.resetDataBounds=function(){var s=this._dataBounds;s.min=null,s.max=null;for(var r,q,p,o=this.show?!0:!1,n=0;n<this._series.length;n++){if(q=this._series[n],q.show||this.scaleToHiddenSeries){p=q._plotData,"line"===q._type&&q.renderer.bands.show&&"x"!==this.name.charAt(0)&&(p=[[0,q.renderer.bands._min],[1,q.renderer.bands._max]]);var m=1,l=1;null!=q._type&&"ohlc"==q._type&&(m=3,l=2);for(var k=0,r=p.length;r>k;k++){"xaxis"==this.name||"x2axis"==this.name?((null!=p[k][0]&&p[k][0]<s.min||null==s.min)&&(s.min=p[k][0]),(null!=p[k][0]&&p[k][0]>s.max||null==s.max)&&(s.max=p[k][0])):((null!=p[k][m]&&p[k][m]<s.min||null==s.min)&&(s.min=p[k][m]),(null!=p[k][l]&&p[k][l]>s.max||null==s.max)&&(s.max=p[k][l]))}o&&q.renderer.constructor!==a1.jqplot.BarRenderer?o=!1:o&&this._options.hasOwnProperty("forceTickAt0")&&0==this._options.forceTickAt0?o=!1:o&&q.renderer.constructor===a1.jqplot.BarRenderer&&("vertical"==q.barDirection&&"xaxis"!=this.name&&"x2axis"!=this.name?(null!=this._options.pad||null!=this._options.padMin)&&(o=!1):"horizontal"!=q.barDirection||"xaxis"!=this.name&&"x2axis"!=this.name||(null!=this._options.pad||null!=this._options.padMin)&&(o=!1))}}o&&this.renderer.constructor===a1.jqplot.LinearAxisRenderer&&s.min>=0&&(this.padMin=1,this.forceTickAt0=!0)},aZ.prototype=new a1.jqplot.ElemContainer,aZ.prototype.constructor=aZ,aZ.prototype.setOptions=function(c){if(a1.extend(!0,this,c),"inside"==this.placement&&(this.placement="insideGrid"),this.xoffset>0){if("insideGrid"==this.placement){switch(this.location){case"nw":case"w":case"sw":null==this.marginLeft&&(this.marginLeft=this.xoffset+"px"),this.marginRight="0px";break;case"ne":case"e":case"se":default:null==this.marginRight&&(this.marginRight=this.xoffset+"px"),this.marginLeft="0px"}}else{if("outside"==this.placement){switch(this.location){case"nw":case"w":case"sw":null==this.marginRight&&(this.marginRight=this.xoffset+"px"),this.marginLeft="0px";break;case"ne":case"e":case"se":default:null==this.marginLeft&&(this.marginLeft=this.xoffset+"px"),this.marginRight="0px"}}}this.xoffset=0}if(this.yoffset>0){if("outside"==this.placement){switch(this.location){case"sw":case"s":case"se":null==this.marginTop&&(this.marginTop=this.yoffset+"px"),this.marginBottom="0px";break;case"ne":case"n":case"nw":default:null==this.marginBottom&&(this.marginBottom=this.yoffset+"px"),this.marginTop="0px"}}else{if("insideGrid"==this.placement){switch(this.location){case"sw":case"s":case"se":null==this.marginBottom&&(this.marginBottom=this.yoffset+"px"),this.marginTop="0px";break;case"ne":case"n":case"nw":default:null==this.marginTop&&(this.marginTop=this.yoffset+"px"),this.marginBottom="0px"}}}this.yoffset=0}},aZ.prototype.init=function(){a1.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},aZ.prototype.draw=function(e,g){for(var f=0;f<a1.jqplot.preDrawLegendHooks.length;f++){a1.jqplot.preDrawLegendHooks[f].call(this,e)}return this.renderer.draw.call(this,e,g)},aZ.prototype.pack=function(b){this.renderer.pack.call(this,b)},aY.prototype=new a1.jqplot.ElemContainer,aY.prototype.constructor=aY,aY.prototype.init=function(){a1.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},aY.prototype.draw=function(b){return this.renderer.draw.call(this,b)},aY.prototype.pack=function(){this.renderer.pack.call(this)},aX.prototype=new a1.jqplot.ElemContainer,aX.prototype.constructor=aX,aX.prototype.init=function(k,r,q){this.index=k,this.gridBorderWidth=r;var p,o,n=this.data,m=[];for(p=0,o=n.length;o>p;p++){if(this.breakOnNull){m.push(n[p])}else{if(null==n[p]||null==n[p][0]||null==n[p][1]){continue}m.push(n[p])}}if(this.data=m,this.color||(this.color=q.colorGenerator.get(this.index)),this.negativeColor||(this.negativeColor=q.negativeColorGenerator.get(this.index)),this.fillColor||(this.fillColor=this.color),this.fillAlpha){var l=a1.jqplot.normalize2rgb(this.fillColor),l=a1.jqplot.getColorComponents(l);this.fillColor="rgba("+l[0]+","+l[1]+","+l[2]+","+this.fillAlpha+")"}a1.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions,q),this.markerRenderer=new this.markerRenderer,this.markerOptions.color||(this.markerOptions.color=this.color),null==this.markerOptions.show&&(this.markerOptions.show=this.showMarker),this.showMarker=this.markerOptions.show,this.markerRenderer.init(this.markerOptions)},aX.prototype.draw=function(k,q,p){var o=q==av?{}:q;k=k==av?this.canvas._ctx:k;var n,m,l;for(n=0;n<a1.jqplot.preDrawSeriesHooks.length;n++){a1.jqplot.preDrawSeriesHooks[n].call(this,k,o)}for(this.show&&(this.renderer.setGridData.call(this,p),o.preventJqPlotSeriesDrawTrigger||a1(k.canvas).trigger("jqplotSeriesDraw",[this.data,this.gridData]),m=[],m=o.data?o.data:this._stack?this._plotData:this.data,l=o.gridData||this.renderer.makeGridData.call(this,m,p),"line"===this._type&&this.renderer.smooth&&this.renderer._smoothedData.length&&(l=this.renderer._smoothedData),this.renderer.draw.call(this,k,l,o,p)),n=0;n<a1.jqplot.postDrawSeriesHooks.length;n++){a1.jqplot.postDrawSeriesHooks[n].call(this,k,o,p)}k=q=p=n=m=l=null},aX.prototype.drawShadow=function(k,q,p){var o=q==av?{}:q;k=k==av?this.shadowCanvas._ctx:k;var n,m,l;for(n=0;n<a1.jqplot.preDrawSeriesShadowHooks.length;n++){a1.jqplot.preDrawSeriesShadowHooks[n].call(this,k,o)}for(this.shadow&&(this.renderer.setGridData.call(this,p),m=[],m=o.data?o.data:this._stack?this._plotData:this.data,l=o.gridData||this.renderer.makeGridData.call(this,m,p),this.renderer.drawShadow.call(this,k,l,o,p)),n=0;n<a1.jqplot.postDrawSeriesShadowHooks.length;n++){a1.jqplot.postDrawSeriesShadowHooks[n].call(this,k,o)}k=q=p=n=m=l=null},aX.prototype.toggleDisplay=function(f,e){var h,g;h=f.data.series?f.data.series:this,f.data.speed&&(g=f.data.speed),g?h.canvas._elem.is(":hidden")||!h.show?(h.show=!0,h.canvas._elem.removeClass("jqplot-series-hidden"),h.shadowCanvas._elem&&h.shadowCanvas._elem.fadeIn(g),h.canvas._elem.fadeIn(g,e),h.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+h.index).fadeIn(g)):(h.show=!1,h.canvas._elem.addClass("jqplot-series-hidden"),h.shadowCanvas._elem&&h.shadowCanvas._elem.fadeOut(g),h.canvas._elem.fadeOut(g,e),h.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+h.index).fadeOut(g)):h.canvas._elem.is(":hidden")||!h.show?(h.show=!0,h.canvas._elem.removeClass("jqplot-series-hidden"),h.shadowCanvas._elem&&h.shadowCanvas._elem.show(),h.canvas._elem.show(0,e),h.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+h.index).show()):(h.show=!1,h.canvas._elem.addClass("jqplot-series-hidden"),h.shadowCanvas._elem&&h.shadowCanvas._elem.hide(),h.canvas._elem.hide(0,e),h.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+h.index).hide())},aW.prototype=new a1.jqplot.ElemContainer,aW.prototype.constructor=aW,aW.prototype.init=function(){a1.isFunction(this.renderer)&&(this.renderer=new this.renderer),this.renderer.init.call(this,this.rendererOptions)},aW.prototype.createElement=function(d,c){return this._offsets=d,this.renderer.createElement.call(this,c)},aW.prototype.draw=function(){this.renderer.draw.call(this)},a1.jqplot.GenericCanvas=function(){a1.jqplot.ElemContainer.call(this),this._ctx},a1.jqplot.GenericCanvas.prototype=new a1.jqplot.ElemContainer,a1.jqplot.GenericCanvas.prototype.constructor=a1.jqplot.GenericCanvas,a1.jqplot.GenericCanvas.prototype.createElement=function(h,o,n,m){this._offsets=h;var l="jqplot";o!=av&&(l=o);var k;return k=m.canvasManager.getCanvas(),null!=n&&(this._plotDimensions=n),k.width=this._plotDimensions.width-this._offsets.left-this._offsets.right,k.height=this._plotDimensions.height-this._offsets.top-this._offsets.bottom,this._elem=a1(k),this._elem.css({position:"absolute",left:this._offsets.left,top:this._offsets.top}),this._elem.addClass(l),k=m.canvasManager.initCanvas(k),k=null,this._elem},a1.jqplot.GenericCanvas.prototype.setContext=function(){return this._ctx=this._elem.get(0).getContext("2d"),this._ctx},a1.jqplot.GenericCanvas.prototype.resetCanvas=function(){this._elem&&(a1.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==av&&window.G_vmlCanvasManager.uninitElement(this._elem.get(0)),this._elem.emptyForce()),this._ctx=null},a1.jqplot.HooksManager=function(){this.hooks=[],this.args=[]},a1.jqplot.HooksManager.prototype.addOnce=function(g,f){f=f||[];for(var l=!1,k=0,h=this.hooks.length;h>k;k++){this.hooks[k]==g&&(l=!0)}l||(this.hooks.push(g),this.args.push(f))},a1.jqplot.HooksManager.prototype.add=function(d,c){c=c||[],this.hooks.push(d),this.args.push(c)},a1.jqplot.EventListenerManager=function(){this.hooks=[]},a1.jqplot.EventListenerManager.prototype.addOnce=function(h,g){for(var n,m,l=!1,m=0,k=this.hooks.length;k>m;m++){n=this.hooks[m],n[0]==h&&n[1]==g&&(l=!0)}l||this.hooks.push([h,g])},a1.jqplot.EventListenerManager.prototype.add=function(d,c){this.hooks.push([d,c])};var au=["yMidAxis","xaxis","yaxis","x2axis","y2axis","y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis"];a1.jqplot.computeHighlightColors=function(k){var q;if(a1.isArray(k)){q=[];for(var p=0;p<k.length;p++){for(var o=a1.jqplot.getColorComponents(k[p]),n=[o[0],o[1],o[2]],m=n[0]+n[1]+n[2],l=0;3>l;l++){n[l]=m>660?0.85*n[l]:0.73*n[l]+90,n[l]=parseInt(n[l],10),n[l]>255?255:n[l]}n[3]=0.3+0.35*o[3],q.push("rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")")}}else{for(var o=a1.jqplot.getColorComponents(k),n=[o[0],o[1],o[2]],m=n[0]+n[1]+n[2],l=0;3>l;l++){n[l]=m>660?0.85*n[l]:0.73*n[l]+90,n[l]=parseInt(n[l],10),n[l]>255?255:n[l]}n[3]=0.3+0.35*o[3],q="rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"}return q},a1.jqplot.ColorGenerator=function(d){d=d||a1.jqplot.config.defaultColors;var e=0;this.next=function(){return e<d.length?d[e++]:(e=0,d[e++])},this.previous=function(){return e>0?d[e--]:(e=d.length-1,d[e])},this.get=function(b){var f=b-d.length*Math.floor(b/d.length);return d[f]},this.setColors=function(b){d=b},this.reset=function(){e=0},this.getIndex=function(){return e},this.setIndex=function(b){e=b}},a1.jqplot.hex2rgb=function(e,d){e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2));var f;return f="rgba("+parseInt(e.slice(0,2),16)+", "+parseInt(e.slice(2,4),16)+", "+parseInt(e.slice(4,6),16),d&&(f+=", "+d),f+=")"},a1.jqplot.rgb2hex=function(h){for(var g=/rgba?\( *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *(?:, *[0-9.]*)?\)/,n=h.match(g),m="#",l=1;4>l;l++){var k;-1!=n[l].search(/%/)?(k=parseInt(255*n[l]/100,10).toString(16),1==k.length&&(k="0"+k)):(k=parseInt(n[l],10).toString(16),1==k.length&&(k="0"+k)),m+=k}return m},a1.jqplot.normalize2rgb=function(d,e){if(-1!=d.search(/^ *rgba?\(/)){return d}if(-1!=d.search(/^ *#?[0-9a-fA-F]?[0-9a-fA-F]/)){return a1.jqplot.hex2rgb(d,e)}throw new Error("Invalid color spec")},a1.jqplot.getColorComponents=function(h){h=a1.jqplot.colorKeywordMap[h]||h;for(var o=a1.jqplot.normalize2rgb(h),n=/rgba?\( *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *, *([0-9]{1,3}\.?[0-9]*%?) *,? *([0-9.]* *)?\)/,m=o.match(n),l=[],k=1;4>k;k++){-1!=m[k].search(/%/)?l[k-1]=parseInt(255*m[k]/100,10):l[k-1]=parseInt(m[k],10)}return l[3]=parseFloat(m[4])?parseFloat(m[4]):1,l},a1.jqplot.colorKeywordMap={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb( 0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb( 0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb( 0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb( 95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb( 0, 255, 255)",darkblue:"rgb( 0, 0, 139)",darkcyan:"rgb( 0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb( 0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb( 85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb( 72, 61, 139)",darkslategray:"rgb( 47, 79, 79)",darkslategrey:"rgb( 47, 79, 79)",darkturquoise:"rgb( 0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb( 0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb( 30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb( 34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",grey:"rgb(128, 128, 128)",green:"rgb( 0, 128, 0)",greenyellow:"rgb(173, 255, 47)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb( 75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb( 32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb( 0, 255, 0)",limegreen:"rgb( 50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb( 0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb( 60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb( 0, 250, 154)",mediumturquoise:"rgb( 72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb( 25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb( 0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb( 65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb( 46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb( 0, 255, 127)",steelblue:"rgb( 70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb( 0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",turquoise:"rgb( 64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)"},a1.jqplot.AxisLabelRenderer=function(c){a1.jqplot.ElemContainer.call(this),this.axis,this.show=!0,this.label="",this.fontFamily=null,this.fontSize=null,this.textColor=null,this._elem,this.escapeHTML=!1,a1.extend(!0,this,c)},a1.jqplot.AxisLabelRenderer.prototype=new a1.jqplot.ElemContainer,a1.jqplot.AxisLabelRenderer.prototype.constructor=a1.jqplot.AxisLabelRenderer,a1.jqplot.AxisLabelRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.AxisLabelRenderer.prototype.draw=function(d,e){return this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=a1('<div style="position:absolute;" class="jqplot-'+this.axis+'-label"></div>'),Number(this.label)&&this._elem.css("white-space","nowrap"),this.escapeHTML?this._elem.text(this.label):this._elem.html(this.label),this.fontFamily&&this._elem.css("font-family",this.fontFamily),this.fontSize&&this._elem.css("font-size",this.fontSize),this.textColor&&this._elem.css("color",this.textColor),this._elem},a1.jqplot.AxisLabelRenderer.prototype.pack=function(){},a1.jqplot.AxisTickRenderer=function(c){a1.jqplot.ElemContainer.call(this),this.mark="outside",this.axis,this.showMark=!0,this.showGridline=!0,this.isMinorTick=!1,this.size=4,this.markSize=6,this.show=!0,this.showLabel=!0,this.label=null,this.value=null,this._styles={},this.formatter=a1.jqplot.DefaultTickFormatter,this.prefix="",this.suffix="",this.formatString="",this.fontFamily,this.fontSize,this.textColor,this.escapeHTML=!1,this._elem,this._breakTick=!1,a1.extend(!0,this,c)},a1.jqplot.AxisTickRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.AxisTickRenderer.prototype=new a1.jqplot.ElemContainer,a1.jqplot.AxisTickRenderer.prototype.constructor=a1.jqplot.AxisTickRenderer,a1.jqplot.AxisTickRenderer.prototype.setTick=function(e,d,f){return this.value=e,this.axis=d,f&&(this.isMinorTick=!0),this},a1.jqplot.AxisTickRenderer.prototype.draw=function(){null===this.label&&(this.label=this.prefix+this.formatter(this.formatString,this.value)+this.suffix);var d={position:"absolute"};Number(this.label)&&(d.whitSpace="nowrap"),this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=a1(document.createElement("div")),this._elem.addClass("jqplot-"+this.axis+"-tick"),this.escapeHTML?this._elem.text(this.label):this._elem.html(this.label),this._elem.css(d);for(var e in this._styles){this._elem.css(e,this._styles[e])}return this.fontFamily&&this._elem.css("font-family",this.fontFamily),this.fontSize&&this._elem.css("font-size",this.fontSize),this.textColor&&this._elem.css("color",this.textColor),this._breakTick&&this._elem.addClass("jqplot-breakTick"),this._elem},a1.jqplot.DefaultTickFormatter=function(d,e){return"number"==typeof e?(d||(d=a1.jqplot.config.defaultTickFormatString),a1.jqplot.sprintf(d,e)):String(e)},a1.jqplot.PercentTickFormatter=function(d,e){return"number"==typeof e?(e=100*e,d||(d=a1.jqplot.config.defaultTickFormatString),a1.jqplot.sprintf(d,e)):String(e)},a1.jqplot.AxisTickRenderer.prototype.pack=function(){},a1.jqplot.CanvasGridRenderer=function(){this.shadowRenderer=new a1.jqplot.ShadowRenderer},a1.jqplot.CanvasGridRenderer.prototype.init=function(d){this._ctx,a1.extend(!0,this,d);var e={lineJoin:"miter",lineCap:"round",fill:!1,isarc:!1,angle:this.shadowAngle,offset:this.shadowOffset,alpha:this.shadowAlpha,depth:this.shadowDepth,lineWidth:this.shadowWidth,closePath:!1,strokeStyle:this.shadowColor};this.renderer.shadowRenderer.init(e)},a1.jqplot.CanvasGridRenderer.prototype.createElement=function(f){var k;this._elem&&(a1.jqplot.use_excanvas&&window.G_vmlCanvasManager.uninitElement!==av&&(k=this._elem.get(0),window.G_vmlCanvasManager.uninitElement(k),k=null),this._elem.emptyForce(),this._elem=null),k=f.canvasManager.getCanvas();var h=this._plotDimensions.width,g=this._plotDimensions.height;return k.width=h,k.height=g,this._elem=a1(k),this._elem.addClass("jqplot-grid-canvas"),this._elem.css({position:"absolute",left:0,top:0}),k=f.canvasManager.initCanvas(k),this._top=this._offsets.top,this._bottom=g-this._offsets.bottom,this._left=this._offsets.left,this._right=h-this._offsets.right,this._width=this._right-this._left,this._height=this._bottom-this._top,k=null,this._elem},a1.jqplot.CanvasGridRenderer.prototype.draw=function(){function Q(c,m,l,k,h){P.save(),h=h||{},(null==h.lineWidth||0!=h.lineWidth)&&(a1.extend(!0,P,h),P.beginPath(),P.moveTo(c,m),P.lineTo(l,k),P.stroke(),P.restore())}this._ctx=this._elem.get(0).getContext("2d");var P=this._ctx,O=this._axes;P.save(),P.clearRect(0,0,this._plotDimensions.width,this._plotDimensions.height),P.fillStyle=this.backgroundColor||this.background,P.fillRect(this._left,this._top,this._width,this._height),P.save(),P.lineJoin="miter",P.lineCap="butt",P.lineWidth=this.gridLineWidth,P.strokeStyle=this.gridLineColor;for(var N,M,L,K,J=["xaxis","yaxis","x2axis","y2axis"],I=4;I>0;I--){var H=J[I-1],G=O[H],F=G._ticks,E=F.length;if(G.show){if(G.drawBaseline){var D={};switch(null!==G.baselineWidth&&(D.lineWidth=G.baselineWidth),null!==G.baselineColor&&(D.strokeStyle=G.baselineColor),H){case"xaxis":Q(this._left,this._bottom,this._right,this._bottom,D);break;case"yaxis":Q(this._left,this._bottom,this._left,this._top,D);break;case"x2axis":Q(this._left,this._bottom,this._right,this._bottom,D);break;case"y2axis":Q(this._right,this._bottom,this._right,this._top,D)}}for(var C=E;C>0;C--){var B=F[C-1];if(B.show){var A=Math.round(G.u2p(B.value))+0.5;switch(H){case"xaxis":if(B.showGridline&&this.drawGridlines&&(!B.isMinorTick&&G.drawMajorGridlines||B.isMinorTick&&G.drawMinorGridlines)&&Q(A,this._top,A,this._bottom),B.showMark&&B.mark&&(!B.isMinorTick&&G.drawMajorTickMarks||B.isMinorTick&&G.drawMinorTickMarks)){L=B.markSize,K=B.mark;var A=Math.round(G.u2p(B.value))+0.5;switch(K){case"outside":N=this._bottom,M=this._bottom+L;break;case"inside":N=this._bottom-L,M=this._bottom;break;case"cross":N=this._bottom-L,M=this._bottom+L;break;default:N=this._bottom,M=this._bottom+L}this.shadow&&this.renderer.shadowRenderer.draw(P,[[A,N],[A,M]],{lineCap:"butt",lineWidth:this.gridLineWidth,offset:0.75*this.gridLineWidth,depth:2,fill:!1,closePath:!1}),Q(A,N,A,M)}break;case"yaxis":if(B.showGridline&&this.drawGridlines&&(!B.isMinorTick&&G.drawMajorGridlines||B.isMinorTick&&G.drawMinorGridlines)&&Q(this._right,A,this._left,A),B.showMark&&B.mark&&(!B.isMinorTick&&G.drawMajorTickMarks||B.isMinorTick&&G.drawMinorTickMarks)){L=B.markSize,K=B.mark;var A=Math.round(G.u2p(B.value))+0.5;switch(K){case"outside":N=this._left-L,M=this._left;break;case"inside":N=this._left,M=this._left+L;break;case"cross":N=this._left-L,M=this._left+L;break;default:N=this._left-L,M=this._left}this.shadow&&this.renderer.shadowRenderer.draw(P,[[N,A],[M,A]],{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:0.75*this.gridLineWidth,fill:!1,closePath:!1}),Q(N,A,M,A,{strokeStyle:G.borderColor})}break;case"x2axis":if(B.showGridline&&this.drawGridlines&&(!B.isMinorTick&&G.drawMajorGridlines||B.isMinorTick&&G.drawMinorGridlines)&&Q(A,this._bottom,A,this._top),B.showMark&&B.mark&&(!B.isMinorTick&&G.drawMajorTickMarks||B.isMinorTick&&G.drawMinorTickMarks)){L=B.markSize,K=B.mark;var A=Math.round(G.u2p(B.value))+0.5;switch(K){case"outside":N=this._top-L,M=this._top;break;case"inside":N=this._top,M=this._top+L;break;case"cross":N=this._top-L,M=this._top+L;break;default:N=this._top-L,M=this._top}this.shadow&&this.renderer.shadowRenderer.draw(P,[[A,N],[A,M]],{lineCap:"butt",lineWidth:this.gridLineWidth,offset:0.75*this.gridLineWidth,depth:2,fill:!1,closePath:!1}),Q(A,N,A,M)}break;case"y2axis":if(B.showGridline&&this.drawGridlines&&(!B.isMinorTick&&G.drawMajorGridlines||B.isMinorTick&&G.drawMinorGridlines)&&Q(this._left,A,this._right,A),B.showMark&&B.mark&&(!B.isMinorTick&&G.drawMajorTickMarks||B.isMinorTick&&G.drawMinorTickMarks)){L=B.markSize,K=B.mark;var A=Math.round(G.u2p(B.value))+0.5;switch(K){case"outside":N=this._right,M=this._right+L;break;case"inside":N=this._right-L,M=this._right;break;case"cross":N=this._right-L,M=this._right+L;break;default:N=this._right,M=this._right+L}this.shadow&&this.renderer.shadowRenderer.draw(P,[[N,A],[M,A]],{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:0.75*this.gridLineWidth,fill:!1,closePath:!1}),Q(N,A,M,A,{strokeStyle:G.borderColor})}}}}B=null}G=null,F=null}J=["y3axis","y4axis","y5axis","y6axis","y7axis","y8axis","y9axis","yMidAxis"];for(var I=7;I>0;I--){var G=O[J[I-1]],F=G._ticks;if(G.show){var z=F[G.numberTicks-1],y=F[0],x=G.getLeft(),w=[[x,z.getTop()+z.getHeight()/2],[x,y.getTop()+y.getHeight()/2+1]];this.shadow&&this.renderer.shadowRenderer.draw(P,w,{lineCap:"butt",fill:!1,closePath:!1}),Q(w[0][0],w[0][1],w[1][0],w[1][1],{lineCap:"butt",strokeStyle:G.borderColor,lineWidth:G.borderWidth});for(var C=F.length;C>0;C--){var B=F[C-1];L=B.markSize,K=B.mark;var A=Math.round(G.u2p(B.value))+0.5;if(B.showMark&&B.mark){switch(K){case"outside":N=x,M=x+L;break;case"inside":N=x-L,M=x;break;case"cross":N=x-L,M=x+L;break;default:N=x,M=x+L}w=[[N,A],[M,A]],this.shadow&&this.renderer.shadowRenderer.draw(P,w,{lineCap:"butt",lineWidth:1.5*this.gridLineWidth,offset:0.75*this.gridLineWidth,fill:!1,closePath:!1}),Q(N,A,M,A,{strokeStyle:G.borderColor})}B=null}y=null}G=null,F=null}if(P.restore(),this.shadow){var w=[[this._left,this._bottom],[this._right,this._bottom],[this._right,this._top]];this.renderer.shadowRenderer.draw(P,w)}0!=this.borderWidth&&this.drawBorder&&(Q(this._left,this._top,this._right,this._top,{lineCap:"round",strokeStyle:O.x2axis.borderColor,lineWidth:O.x2axis.borderWidth}),Q(this._right,this._top,this._right,this._bottom,{lineCap:"round",strokeStyle:O.y2axis.borderColor,lineWidth:O.y2axis.borderWidth}),Q(this._right,this._bottom,this._left,this._bottom,{lineCap:"round",strokeStyle:O.xaxis.borderColor,lineWidth:O.xaxis.borderWidth}),Q(this._left,this._bottom,this._left,this._top,{lineCap:"round",strokeStyle:O.yaxis.borderColor,lineWidth:O.yaxis.borderWidth})),P.restore(),P=null,O=null},a1.jqplot.DivTitleRenderer=function(){},a1.jqplot.DivTitleRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.DivTitleRenderer.prototype.draw=function(){this._elem&&(this._elem.emptyForce(),this._elem=null);var e=(this.renderer,document.createElement("div"));if(this._elem=a1(e),this._elem.addClass("jqplot-title"),this.text){if(this.text){var g;this.color?g=this.color:this.textColor&&(g=this.textColor);var f={position:"absolute",top:"0px",left:"0px"};this._plotWidth&&(f.width=this._plotWidth+"px"),this.fontSize&&(f.fontSize=this.fontSize),"string"==typeof this.textAlign?f.textAlign=this.textAlign:f.textAlign="center",g&&(f.color=g),this.paddingBottom&&(f.paddingBottom=this.paddingBottom),this.fontFamily&&(f.fontFamily=this.fontFamily),this._elem.css(f),this.escapeHtml?this._elem.text(this.text):this._elem.html(this.text)}}else{this.show=!1,this._elem.height(0),this._elem.width(0)}return e=null,this._elem},a1.jqplot.DivTitleRenderer.prototype.pack=function(){};var at=0.1;a1.jqplot.LinePattern=function(G,F){var E={dotted:[at,a1.jqplot.config.dotGapLength],dashed:[a1.jqplot.config.dashLength,a1.jqplot.config.gapLength],solid:null};if("string"==typeof F){if("."===F[0]||"-"===F[0]){var D=F;F=[];for(var C=0,B=D.length;B>C;C++){if("."===D[C]){F.push(at)}else{if("-"!==D[C]){continue}F.push(a1.jqplot.config.dashLength)}F.push(a1.jqplot.config.gapLength)}}else{F=E[F]}}if(!F||!F.length){return G}var A=0,z=F[0],y=0,x=0,w=0,v=0,u=function(b,d){G.moveTo(b,d),y=b,x=d,w=b,v=d},t=function(h,p){var o=G.lineWidth,n=h-y,k=p-x,c=Math.sqrt(n*n+k*k);if(c>0&&o>0){for(n/=c,k/=c;;){var b=o*z;if(!(c>b)){y=h,x=p,0==(1&A)?G.lineTo(y,x):G.moveTo(y,x),z-=c/o;break}y+=b*n,x+=b*k,0==(1&A)?G.lineTo(y,x):G.moveTo(y,x),c-=b,A++,A>=F.length&&(A=0),z=F[A]}}},s=function(){G.beginPath()},r=function(){t(w,v)};return{moveTo:u,lineTo:t,beginPath:s,closePath:r}},a1.jqplot.LineRenderer=function(){this.shapeRenderer=new a1.jqplot.ShapeRenderer,this.shadowRenderer=new a1.jqplot.ShadowRenderer},a1.jqplot.LineRenderer.prototype.init=function(k,q){k=k||{},this._type="line",this.renderer.animation={show:!1,direction:"left",speed:2500,_supported:!0},this.renderer.smooth=!1,this.renderer.tension=null,this.renderer.constrainSmoothing=!0,this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[],this.renderer.bandData=[],this.renderer.bands={show:!1,hiData:[],lowData:[],color:this.color,showLines:!1,fill:!0,fillColor:null,_min:null,_max:null,interval:"3%"};var p={highlightMouseOver:k.highlightMouseOver,highlightMouseDown:k.highlightMouseDown,highlightColor:k.highlightColor};delete k.highlightMouseOver,delete k.highlightMouseDown,delete k.highlightColor,a1.extend(!0,this.renderer,k),this.renderer.options=k,this.renderer.bandData.length>1&&(!k.bands||null==k.bands.show)?this.renderer.bands.show=!0:k.bands&&null==k.bands.show&&null!=k.bands.interval&&(this.renderer.bands.show=!0),this.fill&&(this.renderer.bands.show=!1),this.renderer.bands.show&&this.renderer.initBands.call(this,this.renderer.options,q),this._stack&&(this.renderer.smooth=!1);var o={lineJoin:this.lineJoin,lineCap:this.lineCap,fill:this.fill,isarc:!1,strokeStyle:this.color,fillStyle:this.fillColor,lineWidth:this.lineWidth,linePattern:this.linePattern,closePath:this.fill};this.renderer.shapeRenderer.init(o);var n=k.shadowOffset;null==n&&(n=this.lineWidth>2.5?1.25*(1+0.6*(Math.atan(this.lineWidth/2.5)/0.785398163-1)):1.25*Math.atan(this.lineWidth/2.5)/0.785398163);var m={lineJoin:this.lineJoin,lineCap:this.lineCap,fill:this.fill,isarc:!1,angle:this.shadowAngle,offset:n,alpha:this.shadowAlpha,depth:this.shadowDepth,lineWidth:this.lineWidth,linePattern:this.linePattern,closePath:this.fill};if(this.renderer.shadowRenderer.init(m),this._areaPoints=[],this._boundingBox=[[],[]],!this.isTrendline&&this.fill||this.renderer.bands.show){if(this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColor=null,p.highlightMouseDown&&null==p.highlightMouseOver&&(p.highlightMouseOver=!1),a1.extend(!0,this,{highlightMouseOver:p.highlightMouseOver,highlightMouseDown:p.highlightMouseDown,highlightColor:p.highlightColor}),!this.highlightColor){var l=this.renderer.bands.show?this.renderer.bands.fillColor:this.fillColor;this.highlightColor=a1.jqplot.computeHighlightColors(l)}this.highlighter&&(this.highlighter.show=!1)}!this.isTrendline&&q&&(q.plugins.lineRenderer={},q.postInitHooks.addOnce(aQ),q.postDrawHooks.addOnce(aP),q.eventListenerHooks.addOnce("jqplotMouseMove",aM),q.eventListenerHooks.addOnce("jqplotMouseDown",aL),q.eventListenerHooks.addOnce("jqplotMouseUp",aK),q.eventListenerHooks.addOnce("jqplotClick",aJ),q.eventListenerHooks.addOnce("jqplotRightClick",aI))},a1.jqplot.LineRenderer.prototype.initBands=function(Q,P){var O=Q.bandData||[],N=this.renderer.bands;N.hiData=[],N.lowData=[];var M=this.data;if(N._max=null,N._min=null,2==O.length){if(a1.isArray(O[0][0])){for(var L,K=0,J=0,I=0,H=O[0].length;H>I;I++){L=O[0][I],(null!=L[1]&&L[1]>N._max||null==N._max)&&(N._max=L[1]),(null!=L[1]&&L[1]<N._min||null==N._min)&&(N._min=L[1])}for(var I=0,H=O[1].length;H>I;I++){L=O[1][I],(null!=L[1]&&L[1]>N._max||null==N._max)&&(N._max=L[1],J=1),(null!=L[1]&&L[1]<N._min||null==N._min)&&(N._min=L[1],K=1)}J===K&&(N.show=!1),N.hiData=O[J],N.lowData=O[K]}else{if(O[0].length===M.length&&O[1].length===M.length){for(var G=O[0][0]>O[1][0]?0:1,F=G?0:1,I=0,H=M.length;H>I;I++){N.hiData.push([M[I][0],O[G][I]]),N.lowData.push([M[I][0],O[F][I]])}}else{N.show=!1}}}else{if(O.length>2&&!a1.isArray(O[0][0])){for(var G=O[0][0]>O[0][1]?0:1,F=G?0:1,I=0,H=O.length;H>I;I++){N.hiData.push([M[I][0],O[I][G]]),N.lowData.push([M[I][0],O[I][F]])}}else{var E=N.interval,D=null,C=null,B=null,A=null;if(a1.isArray(E)?(D=E[0],C=E[1]):D=E,isNaN(D)?"%"===D.charAt(D.length-1)&&(B="multiply",D=parseFloat(D)/100+1):(D=parseFloat(D),B="add"),null!==C&&isNaN(C)?"%"===C.charAt(C.length-1)&&(A="multiply",C=parseFloat(C)/100+1):null!==C&&(C=parseFloat(C),A="add"),null!==D){if(null===C&&(C=-D,A=B,"multiply"===A&&(C+=2)),C>D){var z=D;D=C,C=z,z=B,B=A,A=z}for(var I=0,H=M.length;H>I;I++){switch(B){case"add":N.hiData.push([M[I][0],M[I][1]+D]);break;case"multiply":N.hiData.push([M[I][0],M[I][1]*D])}switch(A){case"add":N.lowData.push([M[I][0],M[I][1]+C]);break;case"multiply":N.lowData.push([M[I][0],M[I][1]*C])}}}else{N.show=!1}}}for(var y=N.hiData,x=N.lowData,I=0,H=y.length;H>I;I++){(null!=y[I][1]&&y[I][1]>N._max||null==N._max)&&(N._max=y[I][1])}for(var I=0,H=x.length;H>I;I++){(null!=x[I][1]&&x[I][1]<N._min||null==N._min)&&(N._min=x[I][1])}if(null===N.fillColor){var w=a1.jqplot.getColorComponents(N.color);w[3]=0.5*w[3],N.fillColor="rgba("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"}},a1.jqplot.LineRenderer.prototype.setGridData=function(u){var t=this._xaxis.series_u2p,s=this._yaxis.series_u2p,r=this._plotData,q=this._prevPlotData;this.gridData=[],this._prevGridData=[],this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[];for(var p=this.renderer.bands,o=!1,n=0,m=r.length;m>n;n++){null!=r[n][0]&&null!=r[n][1]?this.gridData.push([t.call(this._xaxis,r[n][0]),s.call(this._yaxis,r[n][1])]):null==r[n][0]?(o=!0,this.gridData.push([null,s.call(this._yaxis,r[n][1])])):null==r[n][1]&&(o=!0,this.gridData.push([t.call(this._xaxis,r[n][0]),null])),null!=q[n]&&null!=q[n][0]&&null!=q[n][1]?this._prevGridData.push([t.call(this._xaxis,q[n][0]),s.call(this._yaxis,q[n][1])]):null!=q[n]&&null==q[n][0]?this._prevGridData.push([null,s.call(this._yaxis,q[n][1])]):null!=q[n]&&null!=q[n][0]&&null==q[n][1]&&this._prevGridData.push([t.call(this._xaxis,q[n][0]),null])}if(o&&(this.renderer.smooth=!1,"line"===this._type&&(p.show=!1)),"line"===this._type&&p.show){for(var n=0,m=p.hiData.length;m>n;n++){this.renderer._hiBandGridData.push([t.call(this._xaxis,p.hiData[n][0]),s.call(this._yaxis,p.hiData[n][1])])}for(var n=0,m=p.lowData.length;m>n;n++){this.renderer._lowBandGridData.push([t.call(this._xaxis,p.lowData[n][0]),s.call(this._yaxis,p.lowData[n][1])])}}if("line"===this._type&&this.renderer.smooth&&this.gridData.length>2){var k;this.renderer.constrainSmoothing?(k=aS.call(this,this.gridData),this.renderer._smoothedData=k[0],this.renderer._smoothedPlotData=k[1],p.show&&(k=aS.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=k[0],k=aS.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=k[0]),k=null):(k=aR.call(this,this.gridData),this.renderer._smoothedData=k[0],this.renderer._smoothedPlotData=k[1],p.show&&(k=aR.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=k[0],k=aR.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=k[0]),k=null)}},a1.jqplot.LineRenderer.prototype.makeGridData=function(u,t){var s=this._xaxis.series_u2p,r=this._yaxis.series_u2p,q=[];this.renderer._smoothedData=[],this.renderer._smoothedPlotData=[],this.renderer._hiBandGridData=[],this.renderer._lowBandGridData=[],this.renderer._hiBandSmoothedData=[],this.renderer._lowBandSmoothedData=[];for(var p=this.renderer.bands,o=!1,n=0;n<u.length;n++){null!=u[n][0]&&null!=u[n][1]?(this.step&&n>0&&q.push([s.call(this._xaxis,u[n][0]),r.call(this._yaxis,u[n-1][1])]),q.push([s.call(this._xaxis,u[n][0]),r.call(this._yaxis,u[n][1])])):null==u[n][0]?(o=!0,q.push([null,r.call(this._yaxis,u[n][1])])):null==u[n][1]&&(o=!0,q.push([s.call(this._xaxis,u[n][0]),null]))}if(o&&(this.renderer.smooth=!1,"line"===this._type&&(p.show=!1)),"line"===this._type&&p.show){for(var n=0,m=p.hiData.length;m>n;n++){this.renderer._hiBandGridData.push([s.call(this._xaxis,p.hiData[n][0]),r.call(this._yaxis,p.hiData[n][1])])}for(var n=0,m=p.lowData.length;m>n;n++){this.renderer._lowBandGridData.push([s.call(this._xaxis,p.lowData[n][0]),r.call(this._yaxis,p.lowData[n][1])])}}if("line"===this._type&&this.renderer.smooth&&q.length>2){var k;this.renderer.constrainSmoothing?(k=aS.call(this,q),this.renderer._smoothedData=k[0],this.renderer._smoothedPlotData=k[1],p.show&&(k=aS.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=k[0],k=aS.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=k[0]),k=null):(k=aR.call(this,q),this.renderer._smoothedData=k[0],this.renderer._smoothedPlotData=k[1],p.show&&(k=aR.call(this,this.renderer._hiBandGridData),this.renderer._hiBandSmoothedData=k[0],k=aR.call(this,this.renderer._lowBandGridData),this.renderer._lowBandSmoothedData=k[0]),k=null)}return q},a1.jqplot.LineRenderer.prototype.draw=function(a9,a8,a7,a6){var a5,a4,a3,Z,Y,X=a1.extend(!0,{},a7),W=X.shadow!=av?X.shadow:this.shadow,V=X.showLine!=av?X.showLine:this.showLine,U=X.fill!=av?X.fill:this.fill,T=X.fillAndStroke!=av?X.fillAndStroke:this.fillAndStroke;if(a9.save(),a8.length){if(V){if(U){if(this.fillToZero){var S=this.negativeColor;this.useNegativeColors||(S=X.fillStyle);var Q=!1,O=X.fillStyle;if(T){var M=a8.slice(0)}if(0!=this.index&&this._stack){for(var K=this._prevGridData,a5=K.length;a5>0;a5--){a8.push(K[a5-1])}W&&this.renderer.shadowRenderer.draw(a9,a8,X),this._areaPoints=a8,this.renderer.shapeRenderer.draw(a9,a8,X)}else{var J=[],I=this.renderer.smooth?this.renderer._smoothedPlotData:this._plotData;this._areaPoints=[];var H=this._yaxis.series_u2p(this.fillToValue);this._xaxis.series_u2p(this.fillToValue);if(X.closePath=!0,"y"==this.fillAxis){J.push([a8[0][0],H]),this._areaPoints.push([a8[0][0],H]);for(var a5=0;a5<a8.length-1;a5++){if(J.push(a8[a5]),this._areaPoints.push(a8[a5]),I[a5][1]*I[a5+1][1]<=0){I[a5][1]<0?(Q=!0,X.fillStyle=S):(Q=!1,X.fillStyle=O);var G=a8[a5][0]+(a8[a5+1][0]-a8[a5][0])*(H-a8[a5][1])/(a8[a5+1][1]-a8[a5][1]);J.push([G,H]),this._areaPoints.push([G,H]),W&&this.renderer.shadowRenderer.draw(a9,J,X),this.renderer.shapeRenderer.draw(a9,J,X),J=[[G,H]]}}I[a8.length-1][1]<0?(Q=!0,X.fillStyle=S):(Q=!1,X.fillStyle=O),J.push(a8[a8.length-1]),this._areaPoints.push(a8[a8.length-1]),J.push([a8[a8.length-1][0],H]),this._areaPoints.push([a8[a8.length-1][0],H])}W&&this.renderer.shadowRenderer.draw(a9,J,X),this.renderer.shapeRenderer.draw(a9,J,X)}}else{if(T){var M=a8.slice(0)}if(0!=this.index&&this._stack){for(var K=this._prevGridData,a5=K.length;a5>0;a5--){a8.push(K[a5-1])}}else{var F=a9.canvas.height;a8.unshift([a8[0][0],F]);var E=a8.length;a8.push([a8[E-1][0],F])}this._areaPoints=a8,W&&this.renderer.shadowRenderer.draw(a9,a8,X),this.renderer.shapeRenderer.draw(a9,a8,X)}if(T){var R=a1.extend(!0,{},X,{fill:!1,closePath:!1});if(this.renderer.shapeRenderer.draw(a9,M,R),this.markerRenderer.show){for(this.renderer.smooth&&(M=this.gridData),a5=0;a5<M.length;a5++){this.markerRenderer.draw(M[a5][0],M[a5][1],a9,X.markerOptions)}}}}else{if(this.renderer.bands.show){var P,N=a1.extend(!0,{},X);this.renderer.bands.showLines&&(P=this.renderer.smooth?this.renderer._hiBandSmoothedData:this.renderer._hiBandGridData,this.renderer.shapeRenderer.draw(a9,P,X),P=this.renderer.smooth?this.renderer._lowBandSmoothedData:this.renderer._lowBandGridData,this.renderer.shapeRenderer.draw(a9,P,N)),this.renderer.bands.fill&&(P=this.renderer.smooth?this.renderer._hiBandSmoothedData.concat(this.renderer._lowBandSmoothedData.reverse()):this.renderer._hiBandGridData.concat(this.renderer._lowBandGridData.reverse()),this._areaPoints=P,N.closePath=!0,N.fill=!0,N.fillStyle=this.renderer.bands.fillColor,this.renderer.shapeRenderer.draw(a9,P,N))}W&&this.renderer.shadowRenderer.draw(a9,a8,X),this.renderer.shapeRenderer.draw(a9,a8,X)}}var a4=Z=a3=Y=null;for(a5=0;a5<this._areaPoints.length;a5++){var L=this._areaPoints[a5];(a4>L[0]||null==a4)&&(a4=L[0]),(Y<L[1]||null==Y)&&(Y=L[1]),(Z<L[0]||null==Z)&&(Z=L[0]),(a3>L[1]||null==a3)&&(a3=L[1])}if("line"===this.type&&this.renderer.bands.show&&(Y=this._yaxis.series_u2p(this.renderer.bands._min),a3=this._yaxis.series_u2p(this.renderer.bands._max)),this._boundingBox=[[a4,Y],[Z,a3]],this.markerRenderer.show&&!U){for(this.renderer.smooth&&(a8=this.gridData),a5=0;a5<a8.length;a5++){null!=a8[a5][0]&&null!=a8[a5][1]&&this.markerRenderer.draw(a8[a5][0],a8[a5][1],a9,X.markerOptions)}}}a9.restore()},a1.jqplot.LineRenderer.prototype.drawShadow=function(e,d,f){},a1.jqplot.LinearAxisRenderer=function(){},a1.jqplot.LinearAxisRenderer.prototype.init=function(c){this.breakPoints=null,this.breakTickLabel="&asymp;",this.drawBaseline=!0,this.baselineWidth=null,this.baselineColor=null,this.forceTickAt0=!1,this.forceTickAt100=!1,this.tickInset=0,this.minorTicks=0,this.alignTicks=!1,this._autoFormatString="",this._overrideFormatString=!1,this._scalefact=1,a1.extend(!0,this,c),this.breakPoints&&(a1.isArray(this.breakPoints)?(this.breakPoints.length<2||this.breakPoints[1]<=this.breakPoints[0])&&(this.breakPoints=null):this.breakPoints=null),null!=this.numberTicks&&this.numberTicks<2&&(this.numberTicks=2),this.resetDataBounds()},a1.jqplot.LinearAxisRenderer.prototype.draw=function(h,o){if(this.show){this.renderer.createTicks.call(this,o);if(this._elem&&(this._elem.emptyForce(),this._elem=null),this._elem=a1(document.createElement("div")),this._elem.addClass("jqplot-axis jqplot-"+this.name),this._elem.css("position","absolute"),"xaxis"==this.name||"x2axis"==this.name?this._elem.width(this._plotDimensions.width):this._elem.height(this._plotDimensions.height),this.labelOptions.axis=this.name,this._label=new this.labelRenderer(this.labelOptions),this._label.show){var n=this._label.draw(h,o);n.appendTo(this._elem),n=null}for(var m,l=this._ticks,k=0;k<l.length;k++){m=l[k],m.show&&m.showLabel&&(!m.isMinorTick||this.showMinorTicks)&&this._elem.append(m.draw(h,o))}m=null,l=null}return this._elem},a1.jqplot.LinearAxisRenderer.prototype.reset=function(){this.min=this._options.min,this.max=this._options.max,this.tickInterval=this._options.tickInterval,this.numberTicks=this._options.numberTicks,this._autoFormatString="",this._overrideFormatString&&this.tickOptions&&this.tickOptions.formatString&&(this.tickOptions.formatString="")},a1.jqplot.LinearAxisRenderer.prototype.set=function(){var k,r=0,q=0,p=0,o=null==this._label?!1:this._label.show;if(this.show){for(var n,m=this._ticks,l=0;l<m.length;l++){n=m[l],n._breakTick||!n.show||!n.showLabel||n.isMinorTick&&!this.showMinorTicks||(k="xaxis"==this.name||"x2axis"==this.name?n._elem.outerHeight(!0):n._elem.outerWidth(!0),k>r&&(r=k))}n=null,m=null,o&&(q=this._label._elem.outerWidth(!0),p=this._label._elem.outerHeight(!0)),"xaxis"==this.name?(r+=p,this._elem.css({height:r+"px",left:"0px",bottom:"0px"})):"x2axis"==this.name?(r+=p,this._elem.css({height:r+"px",left:"0px",top:"0px"})):"yaxis"==this.name?(r+=q,this._elem.css({width:r+"px",left:"0px",top:"0px"}),o&&this._label.constructor==a1.jqplot.AxisLabelRenderer&&this._label._elem.css("width",q+"px")):(r+=q,this._elem.css({width:r+"px",right:"0px",top:"0px"}),o&&this._label.constructor==a1.jqplot.AxisLabelRenderer&&this._label._elem.css("width",q+"px"))}},a1.jqplot.LinearAxisRenderer.prototype.createTicks=function(bR){var bQ,bP,bO,bN,bM=this._ticks,bL=this.ticks,bK=this.name,bJ=this._dataBounds,bI="x"===this.name.charAt(0)?this._plotDimensions.width:this._plotDimensions.height,bH=this.min,bG=this.max,bF=this.numberTicks,bE=this.tickInterval,bD=30;if(this._scalefact=(Math.max(bI,bD+1)-bD)/300,bL.length){for(bN=0;bN<bL.length;bN++){var bC=bL[bN],bB=new this.tickRenderer(this.tickOptions);a1.isArray(bC)?(bB.value=bC[0],this.breakPoints?bC[0]==this.breakPoints[0]?(bB.label=this.breakTickLabel,bB._breakTick=!0,bB.showGridline=!1,bB.showMark=!1):bC[0]>this.breakPoints[0]&&bC[0]<=this.breakPoints[1]?(bB.show=!1,bB.showGridline=!1,bB.label=bC[1]):bB.label=bC[1]:bB.label=bC[1],bB.setTick(bC[0],this.name),this._ticks.push(bB)):a1.isPlainObject(bC)?(a1.extend(!0,bB,bC),bB.axis=this.name,this._ticks.push(bB)):(bB.value=bC,this.breakPoints&&(bC==this.breakPoints[0]?(bB.label=this.breakTickLabel,bB._breakTick=!0,bB.showGridline=!1,bB.showMark=!1):bC>this.breakPoints[0]&&bC<=this.breakPoints[1]&&(bB.show=!1,bB.showGridline=!1)),bB.setTick(bC,this.name),this._ticks.push(bB))}this.numberTicks=bL.length,this.min=this._ticks[0].value,this.max=this._ticks[this.numberTicks-1].value,this.tickInterval=(this.max-this.min)/(this.numberTicks-1)}else{bI="xaxis"==bK||"x2axis"==bK?this._plotDimensions.width:this._plotDimensions.height;var bA=this.numberTicks;this.alignTicks&&("x2axis"===this.name&&bR.axes.xaxis.show?bA=bR.axes.xaxis.numberTicks:"y"===this.name.charAt(0)&&"yaxis"!==this.name&&"yMidAxis"!==this.name&&bR.axes.yaxis.show&&(bA=bR.axes.yaxis.numberTicks)),bQ=null!=this.min?this.min:bJ.min,bP=null!=this.max?this.max:bJ.max;var bz,by,bx,bw=bP-bQ;if(null!=this.tickOptions&&this.tickOptions.formatString||(this._overrideFormatString=!0),null==this.min||null==this.max&&null==this.tickInterval&&!this.autoscale){this.forceTickAt0&&(bQ>0&&(bQ=0),0>bP&&(bP=0)),this.forceTickAt100&&(bQ>100&&(bQ=100),100>bP&&(bP=100));var bv=!1,bu=!1;null!=this.min?bv=!0:null!=this.max&&(bu=!0);var bt=a1.jqplot.LinearTickGenerator(bQ,bP,this._scalefact,bA,bv,bu),bs=null!=this.min?bQ:bQ+bw*(this.padMin-1),br=null!=this.max?bP:bP-bw*(this.padMax-1);(bs>bQ||bP>br)&&(bs=null!=this.min?bQ:bQ-bw*(this.padMin-1),br=null!=this.max?bP:bP+bw*(this.padMax-1),bt=a1.jqplot.LinearTickGenerator(bs,br,this._scalefact,bA,bv,bu)),this.min=bt[0],this.max=bt[1],this.numberTicks=bt[2],this._autoFormatString=bt[3],this.tickInterval=bt[4]}else{if(bQ==bP){var bq=0.05;bQ>0&&(bq=Math.max(Math.log(bQ)/Math.LN10,0.05)),bQ-=bq,bP+=bq}if(this.autoscale&&null==this.min&&null==this.max){for(var bp,bo,bn,bm=!1,bl=!1,bN=0;bN<this._series.length;bN++){var bk=this._series[bN],bj="x"==bk.fillAxis?bk._xaxis.name:bk._yaxis.name;if(this.name==bj){for(var bi=bk._plotValues[bk.fillAxis],bh=bi[0],bg=bi[0],bf=1;bf<bi.length;bf++){bi[bf]<bh?bh=bi[bf]:bi[bf]>bg&&(bg=bi[bf])}var be=(bg-bh)/bg;bk.renderer.constructor==a1.jqplot.BarRenderer?bh>=0&&(bk.fillToZero||be>0.1)?bm=!0:(bm=!1,bl=bk.fill&&bk.fillToZero&&0>bh&&bg>0?!0:!1):bk.fill?bh>=0&&(bk.fillToZero||be>0.1)?bm=!0:0>bh&&bg>0&&bk.fillToZero?(bm=!1,bl=!0):(bm=!1,bl=!1):0>bh&&(bm=!1)}}if(bm){this.numberTicks=2+Math.ceil((bI-(this.tickSpacing-1))/this.tickSpacing),this.min=0,bH=0,bo=bP/(this.numberTicks-1),bx=Math.pow(10,Math.abs(Math.floor(Math.log(bo)/Math.LN10))),bo/bx==parseInt(bo/bx,10)&&(bo+=bx),this.tickInterval=Math.ceil(bo/bx)*bx,this.max=this.tickInterval*(this.numberTicks-1)}else{if(bl){this.numberTicks=2+Math.ceil((bI-(this.tickSpacing-1))/this.tickSpacing);var bd=Math.ceil(Math.abs(bQ)/bw*(this.numberTicks-1)),bc=this.numberTicks-1-bd;bo=Math.max(Math.abs(bQ/bd),Math.abs(bP/bc)),bx=Math.pow(10,Math.abs(Math.floor(Math.log(bo)/Math.LN10))),this.tickInterval=Math.ceil(bo/bx)*bx,this.max=this.tickInterval*bc,this.min=-this.tickInterval*bd}else{null==this.numberTicks&&(this.tickInterval?this.numberTicks=3+Math.ceil(bw/this.tickInterval):this.numberTicks=2+Math.ceil((bI-(this.tickSpacing-1))/this.tickSpacing)),null==this.tickInterval?(bo=bw/(this.numberTicks-1),bx=1>bo?Math.pow(10,Math.abs(Math.floor(Math.log(bo)/Math.LN10))):1,this.tickInterval=Math.ceil(bo*bx*this.pad)/bx):bx=1/this.tickInterval,bp=this.tickInterval*(this.numberTicks-1),bn=(bp-bw)/2,null==this.min&&(this.min=Math.floor(bx*(bQ-bn))/bx),null==this.max&&(this.max=this.min+bp)}}var bb,ba=a1.jqplot.getSignificantFigures(this.tickInterval);if(ba.digitsLeft>=ba.significantDigits){bb="%d"}else{var bx=Math.max(0,5-ba.digitsLeft);bx=Math.min(bx,ba.digitsRight),bb="%."+bx+"f"}this._autoFormatString=bb}else{bz=null!=this.min?this.min:bQ-bw*(this.padMin-1),by=null!=this.max?this.max:bP+bw*(this.padMax-1),bw=by-bz,null==this.numberTicks&&(null!=this.tickInterval?this.numberTicks=Math.ceil((by-bz)/this.tickInterval)+1:bI>100?this.numberTicks=parseInt(3+(bI-100)/75,10):this.numberTicks=2),null==this.tickInterval&&(this.tickInterval=bw/(this.numberTicks-1)),null==this.max&&(by=bz+this.tickInterval*(this.numberTicks-1)),null==this.min&&(bz=by-this.tickInterval*(this.numberTicks-1));var bb,ba=a1.jqplot.getSignificantFigures(this.tickInterval);if(ba.digitsLeft>=ba.significantDigits){bb="%d"}else{var bx=Math.max(0,5-ba.digitsLeft);bx=Math.min(bx,ba.digitsRight),bb="%."+bx+"f"}this._autoFormatString=bb,this.min=bz,this.max=by}if(this.renderer.constructor==a1.jqplot.LinearAxisRenderer&&""==this._autoFormatString){bw=this.max-this.min;var a9=new this.tickRenderer(this.tickOptions),a8=a9.formatString||a1.jqplot.config.defaultTickFormatString,a8=a8.match(a1.jqplot.sprintf.regex)[0],a7=0;if(a8){if(a8.search(/[fFeEgGpP]/)>-1){var a6=a8.match(/\%\.(\d{0,})?[eEfFgGpP]/);a7=a6?parseInt(a6[1],10):6}else{a8.search(/[di]/)>-1&&(a7=0)}var a5=Math.pow(10,-a7);if(this.tickInterval<a5&&null==bF&&null==bE){if(this.tickInterval=a5,null==bG&&null==bH){this.min=Math.floor(this._dataBounds.min/a5)*a5,this.min==this._dataBounds.min&&(this.min=this._dataBounds.min-this.tickInterval),this.max=Math.ceil(this._dataBounds.max/a5)*a5,this.max==this._dataBounds.max&&(this.max=this._dataBounds.max+this.tickInterval);var a4=(this.max-this.min)/this.tickInterval;a4=a4.toFixed(11),a4=Math.ceil(a4),this.numberTicks=a4+1}else{if(null==bG){var a4=(this._dataBounds.max-this.min)/this.tickInterval;a4=a4.toFixed(11),this.numberTicks=Math.ceil(a4)+2,this.max=this.min+this.tickInterval*(this.numberTicks-1)}else{if(null==bH){var a4=(this.max-this._dataBounds.min)/this.tickInterval;a4=a4.toFixed(11),this.numberTicks=Math.ceil(a4)+2,this.min=this.max-this.tickInterval*(this.numberTicks-1)}else{this.numberTicks=Math.ceil((bG-bH)/this.tickInterval)+1,this.min=Math.floor(bH*Math.pow(10,a7))/Math.pow(10,a7),this.max=Math.ceil(bG*Math.pow(10,a7))/Math.pow(10,a7),this.numberTicks=Math.ceil((this.max-this.min)/this.tickInterval)+1}}}}}}}this._overrideFormatString&&""!=this._autoFormatString&&(this.tickOptions=this.tickOptions||{},this.tickOptions.formatString=this._autoFormatString);for(var bB,a3,bN=0;bN<this.numberTicks;bN++){if(bO=this.min+bN*this.tickInterval,bB=new this.tickRenderer(this.tickOptions),bB.setTick(bO,this.name),this._ticks.push(bB),bN<this.numberTicks-1){for(var bf=0;bf<this.minorTicks;bf++){bO+=this.tickInterval/(this.minorTicks+1),a3=a1.extend(!0,{},this.tickOptions,{name:this.name,value:bO,label:"",isMinorTick:!0}),bB=new this.tickRenderer(a3),this._ticks.push(bB)}}bB=null}}this.tickInset&&(this.min=this.min-this.tickInset*this.tickInterval,this.max=this.max+this.tickInset*this.tickInterval),bM=null},a1.jqplot.LinearAxisRenderer.prototype.resetTickValues=function(e){if(a1.isArray(e)&&e.length==this._ticks.length){for(var g,f=0;f<e.length;f++){g=this._ticks[f],g.value=e[f],g.label=g.formatter(g.formatString,e[f]),g.label=g.prefix+g.label,g._elem.html(g.label)}g=null,this.min=a1.jqplot.arrayMin(e),this.max=a1.jqplot.arrayMax(e),this.pack()}},a1.jqplot.LinearAxisRenderer.prototype.pack=function(K,J){K=K||{},J=J||this._offsets;var I=this._ticks,H=this.max,G=this.min,F=J.max,E=J.min,D=null==this._label?!1:this._label.show;for(var C in K){this._elem.css(C,K[C])}this._offsets=J;var B=F-E,A=H-G;if(this.breakPoints?(A=A-this.breakPoints[1]+this.breakPoints[0],this.p2u=function(b){return(b-E)*A/B+G},this.u2p=function(b){return b>this.breakPoints[0]&&b<this.breakPoints[1]&&(b=this.breakPoints[0]),b<=this.breakPoints[0]?(b-G)*B/A+E:(b-this.breakPoints[1]+this.breakPoints[0]-G)*B/A+E},"x"==this.name.charAt(0)?(this.series_u2p=function(b){return b>this.breakPoints[0]&&b<this.breakPoints[1]&&(b=this.breakPoints[0]),b<=this.breakPoints[0]?(b-G)*B/A:(b-this.breakPoints[1]+this.breakPoints[0]-G)*B/A},this.series_p2u=function(b){return b*A/B+G}):(this.series_u2p=function(b){return b>this.breakPoints[0]&&b<this.breakPoints[1]&&(b=this.breakPoints[0]),b>=this.breakPoints[1]?(b-H)*B/A:(b+this.breakPoints[1]-this.breakPoints[0]-H)*B/A},this.series_p2u=function(b){return b*A/B+H})):(this.p2u=function(b){return(b-E)*A/B+G},this.u2p=function(b){return(b-G)*B/A+E},"xaxis"==this.name||"x2axis"==this.name?(this.series_u2p=function(b){return(b-G)*B/A},this.series_p2u=function(b){return b*A/B+G}):(this.series_u2p=function(b){return(b-H)*B/A},this.series_p2u=function(b){return b*A/B+H})),this.show){if("xaxis"==this.name||"x2axis"==this.name){for(var z=0;z<I.length;z++){var y=I[z];if(y.show&&y.showLabel){var x;if(y.constructor==a1.jqplot.CanvasAxisTickRenderer&&y.angle){var w="xaxis"==this.name?1:-1;switch(y.labelPosition){case"auto":x=w*y.angle<0?-y.getWidth()+y._textRenderer.height*Math.sin(-y._textRenderer.angle)/2:-y._textRenderer.height*Math.sin(y._textRenderer.angle)/2;break;case"end":x=-y.getWidth()+y._textRenderer.height*Math.sin(-y._textRenderer.angle)/2;break;case"start":x=-y._textRenderer.height*Math.sin(y._textRenderer.angle)/2;break;case"middle":x=-y.getWidth()/2+y._textRenderer.height*Math.sin(-y._textRenderer.angle)/2;break;default:x=-y.getWidth()/2+y._textRenderer.height*Math.sin(-y._textRenderer.angle)/2}}else{x=-y.getWidth()/2}var v=this.u2p(y.value)+x+"px";y._elem.css("left",v),y.pack()}}if(D){var u=this._label._elem.outerWidth(!0);this._label._elem.css("left",E+B/2-u/2+"px"),"xaxis"==this.name?this._label._elem.css("bottom","0px"):this._label._elem.css("top","0px"),this._label.pack()}}else{for(var z=0;z<I.length;z++){var y=I[z];if(y.show&&y.showLabel){var x;if(y.constructor==a1.jqplot.CanvasAxisTickRenderer&&y.angle){var w="yaxis"==this.name?1:-1;switch(y.labelPosition){case"auto":case"end":x=w*y.angle<0?-y._textRenderer.height*Math.cos(-y._textRenderer.angle)/2:-y.getHeight()+y._textRenderer.height*Math.cos(y._textRenderer.angle)/2;break;case"start":x=y.angle>0?-y._textRenderer.height*Math.cos(-y._textRenderer.angle)/2:-y.getHeight()+y._textRenderer.height*Math.cos(y._textRenderer.angle)/2;break;case"middle":x=-y.getHeight()/2;break;default:x=-y.getHeight()/2}}else{x=-y.getHeight()/2}var v=this.u2p(y.value)+x+"px";y._elem.css("top",v),y.pack()}}if(D){var t=this._label._elem.outerHeight(!0);this._label._elem.css("top",F-B/2-t/2+"px"),"yaxis"==this.name?this._label._elem.css("left","0px"):this._label._elem.css("right","0px"),this._label.pack()}}}I=null};a1.jqplot.LinearTickGenerator=function(E,D,C,B,A,z){if(A=null===A?!1:A,z=null===z||A?!1:z,E===D&&(D=D?0:1),C=C||1,E>D){var y=D;D=E,E=y}var x=[],w=aE(D-E,C),v=a1.jqplot.getSignificantFigures;if(null==B){if(A||z){if(A){x[0]=E,x[2]=Math.ceil((D-E)/w+1),x[1]=E+(x[2]-1)*w;var u=v(E).digitsRight,t=v(w).digitsRight;t>u?x[3]=aH(w):x[3]="%."+u+"f",x[4]=w}else{if(z){x[1]=D,x[2]=Math.ceil((D-E)/w+1),x[0]=D-(x[2]-1)*w;var s=v(D).digitsRight,t=v(w).digitsRight;t>s?x[3]=aH(w):x[3]="%."+s+"f",x[4]=w}}}else{x[0]=Math.floor(E/w)*w,x[1]=Math.ceil(D/w)*w,x[2]=Math.round((x[1]-x[0])/w+1),x[3]=aH(w),x[4]=w}}else{var r=[];if(r[0]=Math.floor(E/w)*w,r[1]=Math.ceil(D/w)*w,r[2]=Math.round((r[1]-r[0])/w+1),r[3]=aH(w),r[4]=w,r[2]===B){x=r}else{var q=aF(r[1]-r[0],B);x[0]=r[0],x[2]=B,x[4]=q,x[3]=aH(q),x[1]=x[0]+(x[2]-1)*x[4]}}return x},a1.jqplot.LinearTickGenerator.bestLinearInterval=aE,a1.jqplot.LinearTickGenerator.bestInterval=aF,a1.jqplot.LinearTickGenerator.bestLinearComponents=aD,a1.jqplot.LinearTickGenerator.bestConstrainedInterval=aG,a1.jqplot.MarkerRenderer=function(c){this.show=!0,this.style="filledCircle",this.lineWidth=2,this.size=9,this.color="#666666",this.shadow=!0,this.shadowAngle=45,this.shadowOffset=1,this.shadowDepth=3,this.shadowAlpha="0.07",this.shadowRenderer=new a1.jqplot.ShadowRenderer,this.shapeRenderer=new a1.jqplot.ShapeRenderer,a1.extend(!0,this,c)},a1.jqplot.MarkerRenderer.prototype.init=function(e){a1.extend(!0,this,e);var g={angle:this.shadowAngle,offset:this.shadowOffset,alpha:this.shadowAlpha,lineWidth:this.lineWidth,depth:this.shadowDepth,closePath:!0};-1!=this.style.indexOf("filled")&&(g.fill=!0),-1!=this.style.indexOf("ircle")&&(g.isarc=!0,g.closePath=!1),this.shadowRenderer.init(g);var f={fill:!1,isarc:!1,strokeStyle:this.color,fillStyle:this.color,lineWidth:this.lineWidth,closePath:!0};-1!=this.style.indexOf("filled")&&(f.fill=!0),-1!=this.style.indexOf("ircle")&&(f.isarc=!0,f.closePath=!1),this.shapeRenderer.init(f)},a1.jqplot.MarkerRenderer.prototype.drawDiamond=function(s,r,q,p,o){var n=1.2,m=this.size/2/n,l=this.size/2*n,k=[[s-m,r],[s,r+l],[s+m,r],[s,r-l]];this.shadow&&this.shadowRenderer.draw(q,k),this.shapeRenderer.draw(q,k,o)},a1.jqplot.MarkerRenderer.prototype.drawPlus=function(w,v,u,t,s){var r=1,q=this.size/2*r,p=this.size/2*r,o=[[w,v-p],[w,v+p]],n=[[w+q,v],[w-q,v]],m=a1.extend(!0,{},this.options,{closePath:!1});this.shadow&&(this.shadowRenderer.draw(u,o,{closePath:!1}),this.shadowRenderer.draw(u,n,{closePath:!1})),this.shapeRenderer.draw(u,o,m),this.shapeRenderer.draw(u,n,m)},a1.jqplot.MarkerRenderer.prototype.drawX=function(w,v,u,t,s){var r=1,q=this.size/2*r,p=this.size/2*r,o=a1.extend(!0,{},this.options,{closePath:!1}),n=[[w-q,v-p],[w+q,v+p]],m=[[w-q,v+p],[w+q,v-p]];this.shadow&&(this.shadowRenderer.draw(u,n,{closePath:!1}),this.shadowRenderer.draw(u,m,{closePath:!1})),this.shapeRenderer.draw(u,n,o),this.shapeRenderer.draw(u,m,o)},a1.jqplot.MarkerRenderer.prototype.drawDash=function(l,k,r,q,p){var o=1,n=this.size/2*o,m=(this.size/2*o,[[l-n,k],[l+n,k]]);this.shadow&&this.shadowRenderer.draw(r,m),this.shapeRenderer.draw(r,m,p)},a1.jqplot.MarkerRenderer.prototype.drawLine=function(h,g,n,m,l){var k=[h,g];this.shadow&&this.shadowRenderer.draw(n,k),this.shapeRenderer.draw(n,k,l)},a1.jqplot.MarkerRenderer.prototype.drawSquare=function(s,r,q,p,o){var n=1,m=this.size/2/n,l=this.size/2*n,k=[[s-m,r-l],[s-m,r+l],[s+m,r+l],[s+m,r-l]];this.shadow&&this.shadowRenderer.draw(q,k),this.shapeRenderer.draw(q,k,o)},a1.jqplot.MarkerRenderer.prototype.drawCircle=function(l,k,r,q,p){var o=this.size/2,n=2*Math.PI,m=[l,k,o,0,n,!0];this.shadow&&this.shadowRenderer.draw(r,m),this.shapeRenderer.draw(r,m,p)},a1.jqplot.MarkerRenderer.prototype.draw=function(f,e,h,g){if(g=g||{},null==g.show||0!=g.show){switch(g.color&&!g.fillStyle&&(g.fillStyle=g.color),g.color&&!g.strokeStyle&&(g.strokeStyle=g.color),this.style){case"diamond":this.drawDiamond(f,e,h,!1,g);break;case"filledDiamond":this.drawDiamond(f,e,h,!0,g);break;case"circle":this.drawCircle(f,e,h,!1,g);break;case"filledCircle":this.drawCircle(f,e,h,!0,g);break;case"square":this.drawSquare(f,e,h,!1,g);break;case"filledSquare":this.drawSquare(f,e,h,!0,g);break;case"x":this.drawX(f,e,h,!0,g);break;case"plus":this.drawPlus(f,e,h,!0,g);break;case"dash":this.drawDash(f,e,h,!0,g);break;case"line":this.drawLine(f,e,h,!1,g);break;default:this.drawDiamond(f,e,h,!1,g)}}},a1.jqplot.ShadowRenderer=function(c){this.angle=45,this.offset=1,this.alpha=0.07,this.lineWidth=1.5,this.lineJoin="miter",this.lineCap="round",this.closePath=!1,this.fill=!1,this.depth=3,this.strokeStyle="rgba(0,0,0,0.1)",this.isarc=!1,a1.extend(!0,this,c)},a1.jqplot.ShadowRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.ShadowRenderer.prototype.draw=function(G,F,E){G.save();var D=null!=E?E:{},C=null!=D.fill?D.fill:this.fill,B=null!=D.fillRect?D.fillRect:this.fillRect,A=null!=D.closePath?D.closePath:this.closePath,z=null!=D.offset?D.offset:this.offset,y=null!=D.alpha?D.alpha:this.alpha,x=null!=D.depth?D.depth:this.depth,w=null!=D.isarc?D.isarc:this.isarc,v=null!=D.linePattern?D.linePattern:this.linePattern;G.lineWidth=null!=D.lineWidth?D.lineWidth:this.lineWidth,G.lineJoin=null!=D.lineJoin?D.lineJoin:this.lineJoin,G.lineCap=null!=D.lineCap?D.lineCap:this.lineCap,G.strokeStyle=D.strokeStyle||this.strokeStyle||"rgba(0,0,0,"+y+")",G.fillStyle=D.fillStyle||this.fillStyle||"rgba(0,0,0,"+y+")";for(var u=0;x>u;u++){var t=a1.jqplot.LinePattern(G,v);if(G.translate(Math.cos(this.angle*Math.PI/180)*z,Math.sin(this.angle*Math.PI/180)*z),t.beginPath(),w){G.arc(F[0],F[1],F[2],F[3],F[4],!0)}else{if(B){B&&G.fillRect(F[0],F[1],F[2],F[3])}else{if(F&&F.length){for(var s=!0,r=0;r<F.length;r++){null!=F[r][0]&&null!=F[r][1]?s?(t.moveTo(F[r][0],F[r][1]),s=!1):t.lineTo(F[r][0],F[r][1]):s=!0}}}}A&&t.closePath(),C?G.fill():G.stroke()}G.restore()},a1.jqplot.ShapeRenderer=function(c){this.lineWidth=1.5,this.linePattern="solid",this.lineJoin="miter",this.lineCap="round",this.closePath=!1,this.fill=!1,this.isarc=!1,this.fillRect=!1,this.strokeRect=!1,this.clearRect=!1,this.strokeStyle="#999999",this.fillStyle="#999999",a1.extend(!0,this,c)},a1.jqplot.ShapeRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.ShapeRenderer.prototype.draw=function(C,B,A){C.save();var z=null!=A?A:{},y=null!=z.fill?z.fill:this.fill,x=null!=z.closePath?z.closePath:this.closePath,w=null!=z.fillRect?z.fillRect:this.fillRect,v=null!=z.strokeRect?z.strokeRect:this.strokeRect,u=null!=z.clearRect?z.clearRect:this.clearRect,t=null!=z.isarc?z.isarc:this.isarc,s=null!=z.linePattern?z.linePattern:this.linePattern,r=a1.jqplot.LinePattern(C,s);if(C.lineWidth=z.lineWidth||this.lineWidth,C.lineJoin=z.lineJoin||this.lineJoin,C.lineCap=z.lineCap||this.lineCap,C.strokeStyle=z.strokeStyle||z.color||this.strokeStyle,C.fillStyle=z.fillStyle||this.fillStyle,C.beginPath(),t){return C.arc(B[0],B[1],B[2],B[3],B[4],!0),x&&C.closePath(),y?C.fill():C.stroke(),void C.restore()}if(u){return C.clearRect(B[0],B[1],B[2],B[3]),void C.restore()}if(w||v){if(w&&C.fillRect(B[0],B[1],B[2],B[3]),v){return C.strokeRect(B[0],B[1],B[2],B[3]),void C.restore()}}else{if(B&&B.length){for(var q=!0,p=0;p<B.length;p++){null!=B[p][0]&&null!=B[p][1]?q?(r.moveTo(B[p][0],B[p][1]),q=!1):r.lineTo(B[p][0],B[p][1]):q=!0}x&&r.closePath(),y?C.fill():C.stroke()}}C.restore()},a1.jqplot.TableLegendRenderer=function(){},a1.jqplot.TableLegendRenderer.prototype.init=function(c){a1.extend(!0,this,c)},a1.jqplot.TableLegendRenderer.prototype.addrow=function(u,t,s,r){var q,p,o,n,m,l=s?this.rowSpacing+"px":"0px";o=document.createElement("tr"),q=a1(o),q.addClass("jqplot-table-legend"),o=null,r?q.prependTo(this._elem):q.appendTo(this._elem),this.showSwatches&&(p=a1(document.createElement("td")),p.addClass("jqplot-table-legend jqplot-table-legend-swatch"),p.css({textAlign:"center",paddingTop:l}),n=a1(document.createElement("div")),n.addClass("jqplot-table-legend-swatch-outline"),m=a1(document.createElement("div")),m.addClass("jqplot-table-legend-swatch"),m.css({backgroundColor:t,borderColor:t}),q.append(p.append(n.append(m)))),this.showLabels&&(p=a1(document.createElement("td")),p.addClass("jqplot-table-legend jqplot-table-legend-label"),p.css("paddingTop",l),q.append(p),this.escapeHtml?p.text(u):p.html(u)),p=null,n=null,m=null,q=null,o=null},a1.jqplot.TableLegendRenderer.prototype.draw=function(){if(this._elem&&(this._elem.emptyForce(),this._elem=null),this.show){var w=this._series,v=document.createElement("table");this._elem=a1(v),this._elem.addClass("jqplot-table-legend");var u={position:"absolute"};this.background&&(u.background=this.background),this.border&&(u.border=this.border),this.fontSize&&(u.fontSize=this.fontSize),this.fontFamily&&(u.fontFamily=this.fontFamily),this.textColor&&(u.textColor=this.textColor),null!=this.marginTop&&(u.marginTop=this.marginTop),null!=this.marginBottom&&(u.marginBottom=this.marginBottom),null!=this.marginLeft&&(u.marginLeft=this.marginLeft),null!=this.marginRight&&(u.marginRight=this.marginRight);for(var t,s=!1,r=!1,q=0;q<w.length;q++){if(t=w[q],(t._stack||t.renderer.constructor==a1.jqplot.BezierCurveRenderer)&&(r=!0),t.show&&t.showLabel){var p=this.labels[q]||t.label.toString();if(p){var o=t.color;r&&q<w.length-1?s=!0:r&&q==w.length-1&&(s=!1),this.renderer.addrow.call(this,p,o,s,r),s=!0}for(var n=0;n<a1.jqplot.addLegendRowHooks.length;n++){var m=a1.jqplot.addLegendRowHooks[n].call(this,t);m&&(this.renderer.addrow.call(this,m.label,m.color,s),s=!0)}p=null}}}return this._elem},a1.jqplot.TableLegendRenderer.prototype.pack=function(e){if(this.show){if("insideGrid"==this.placement){switch(this.location){case"nw":var d=e.left,f=e.top;this._elem.css("left",d),this._elem.css("top",f);break;case"n":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2,f=e.top;this._elem.css("left",d),this._elem.css("top",f);break;case"ne":var d=e.right,f=e.top;this._elem.css({right:d,top:f});break;case"e":var d=e.right,f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({right:d,top:f});break;case"se":var d=e.right,f=e.bottom;this._elem.css({right:d,bottom:f});break;case"s":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2,f=e.bottom;this._elem.css({left:d,bottom:f});break;case"sw":var d=e.left,f=e.bottom;this._elem.css({left:d,bottom:f});break;case"w":var d=e.left,f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({left:d,top:f});break;default:var d=e.right,f=e.bottom;this._elem.css({right:d,bottom:f})}}else{if("outside"==this.placement){switch(this.location){case"nw":var d=this._plotDimensions.width-e.left,f=e.top;this._elem.css("right",d),this._elem.css("top",f);break;case"n":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2,f=this._plotDimensions.height-e.top;this._elem.css("left",d),this._elem.css("bottom",f);break;case"ne":var d=this._plotDimensions.width-e.right,f=e.top;this._elem.css({left:d,top:f});break;case"e":var d=this._plotDimensions.width-e.right,f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({left:d,top:f});break;case"se":var d=this._plotDimensions.width-e.right,f=e.bottom;this._elem.css({left:d,bottom:f});break;case"s":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2,f=this._plotDimensions.height-e.bottom;this._elem.css({left:d,top:f});break;case"sw":var d=this._plotDimensions.width-e.left,f=e.bottom;this._elem.css({right:d,bottom:f});break;case"w":var d=this._plotDimensions.width-e.left,f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({right:d,top:f});break;default:var d=e.right,f=e.bottom;this._elem.css({right:d,bottom:f})}}else{switch(this.location){case"nw":this._elem.css({left:0,top:e.top});break;case"n":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2;this._elem.css({left:d,top:e.top});break;case"ne":this._elem.css({right:0,top:e.top});break;case"e":var f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({right:e.right,top:f});break;case"se":this._elem.css({right:e.right,bottom:e.bottom});break;case"s":var d=(e.left+(this._plotDimensions.width-e.right))/2-this.getWidth()/2;this._elem.css({left:d,bottom:e.bottom});break;case"sw":this._elem.css({left:e.left,bottom:e.bottom});break;case"w":var f=(e.top+(this._plotDimensions.height-e.bottom))/2-this.getHeight()/2;this._elem.css({left:e.left,top:f});break;default:this._elem.css({right:e.right,bottom:e.bottom})}}}}},a1.jqplot.ThemeEngine=function(){this.themes={},this.activeTheme=null},a1.jqplot.ThemeEngine.prototype.init=function(){var k,q,p,o=new a1.jqplot.Theme({_name:"Default"});for(k in o.target){"textColor"==k?o.target[k]=this.target.css("color"):o.target[k]=this.target.css(k)}if(this.title.show&&this.title._elem){for(k in o.title){"textColor"==k?o.title[k]=this.title._elem.css("color"):o.title[k]=this.title._elem.css(k)}}for(k in o.grid){o.grid[k]=this.grid[k]}if(null==o.grid.backgroundColor&&null!=this.grid.background&&(o.grid.backgroundColor=this.grid.background),this.legend.show&&this.legend._elem){for(k in o.legend){"textColor"==k?o.legend[k]=this.legend._elem.css("color"):o.legend[k]=this.legend._elem.css(k)}}var n;for(q=0;q<this.series.length;q++){n=this.series[q],n.renderer.constructor==a1.jqplot.LineRenderer?o.series.push(new ao):n.renderer.constructor==a1.jqplot.BarRenderer?o.series.push(new am):n.renderer.constructor==a1.jqplot.PieRenderer?o.series.push(new al):n.renderer.constructor==a1.jqplot.DonutRenderer?o.series.push(new ak):n.renderer.constructor==a1.jqplot.FunnelRenderer?o.series.push(new aj):n.renderer.constructor==a1.jqplot.MeterGaugeRenderer?o.series.push(new ai):o.series.push({});for(k in o.series[q]){o.series[q][k]=n[k]}}var m,l;for(k in this.axes){if(l=this.axes[k],m=o.axes[k]=new ar,m.borderColor=l.borderColor,m.borderWidth=l.borderWidth,l._ticks&&l._ticks[0]){for(p in m.ticks){l._ticks[0].hasOwnProperty(p)?m.ticks[p]=l._ticks[0][p]:l._ticks[0]._elem&&(m.ticks[p]=l._ticks[0]._elem.css(p))}}if(l._label&&l._label.show){for(p in m.label){l._label[p]?m.label[p]=l._label[p]:l._label._elem&&("textColor"==p?m.label[p]=l._label._elem.css("color"):m.label[p]=l._label._elem.css(p))}}}this.themeEngine._add(o),this.themeEngine.activeTheme=this.themeEngine.themes[o._name]},a1.jqplot.ThemeEngine.prototype.get=function(b){return b?this.themes[b]:this.activeTheme},a1.jqplot.ThemeEngine.prototype.getThemeNames=function(){var d=[];for(var c in this.themes){d.push(c)}return d.sort(aC)},a1.jqplot.ThemeEngine.prototype.getThemes=function(){var f=[],e=[];for(var h in this.themes){f.push(h)}f.sort(aC);for(var g=0;g<f.length;g++){e.push(this.themes[f[g]])}return e},a1.jqplot.ThemeEngine.prototype.activate=function(G,F){var E=!1;if(!F&&this.activeTheme&&this.activeTheme._name&&(F=this.activeTheme._name),!this.themes.hasOwnProperty(F)){throw new Error("No theme of that name")}var D=this.themes[F];this.activeTheme=D;var C,B=["xaxis","x2axis","yaxis","y2axis"];for(s=0;s<B.length;s++){var A=B[s];null!=D.axesStyles.borderColor&&(G.axes[A].borderColor=D.axesStyles.borderColor),null!=D.axesStyles.borderWidth&&(G.axes[A].borderWidth=D.axesStyles.borderWidth)}for(var z in G.axes){var y=G.axes[z];if(y.show){var x=D.axes[z]||{},w=D.axesStyles,v=a1.jqplot.extend(!0,{},x,w);if(C=null!=D.axesStyles.borderColor?D.axesStyles.borderColor:v.borderColor,null!=v.borderColor&&(y.borderColor=v.borderColor,E=!0),C=null!=D.axesStyles.borderWidth?D.axesStyles.borderWidth:v.borderWidth,null!=v.borderWidth&&(y.borderWidth=v.borderWidth,E=!0),y._ticks&&y._ticks[0]){for(var u in v.ticks){C=v.ticks[u],null!=C&&(y.tickOptions[u]=C,y._ticks=[],E=!0)}}if(y._label&&y._label.show){for(var u in v.label){C=v.label[u],null!=C&&(y.labelOptions[u]=C,E=!0)}}}}for(var t in D.grid){null!=D.grid[t]&&(G.grid[t]=D.grid[t])}if(E||G.grid.draw(),G.legend.show){for(t in D.legend){null!=D.legend[t]&&(G.legend[t]=D.legend[t])}}if(G.title.show){for(t in D.title){null!=D.title[t]&&(G.title[t]=D.title[t])}}var s;for(s=0;s<D.series.length;s++){var r={};for(t in D.series[s]){C=null!=D.seriesStyles[t]?D.seriesStyles[t]:D.series[s][t],null!=C&&(r[t]=C,"color"==t?(G.series[s].renderer.shapeRenderer.fillStyle=C,G.series[s].renderer.shapeRenderer.strokeStyle=C,G.series[s][t]=C):"lineWidth"==t||"linePattern"==t?(G.series[s].renderer.shapeRenderer[t]=C,G.series[s][t]=C):"markerOptions"==t?(az(G.series[s].markerOptions,C),az(G.series[s].markerRenderer,C)):G.series[s][t]=C,E=!0)}}E&&(G.target.empty(),G.draw());for(t in D.target){null!=D.target[t]&&G.target.css(t,D.target[t])}},a1.jqplot.ThemeEngine.prototype._add=function(d,c){if(c&&(d._name=c),d._name||(d._name=Date.parse(new Date)),this.themes.hasOwnProperty(d._name)){throw new Error("jqplot.ThemeEngine Error: Theme already in use")}this.themes[d._name]=d},a1.jqplot.ThemeEngine.prototype.remove=function(b){return"Default"==b?!1:delete this.themes[b]},a1.jqplot.ThemeEngine.prototype.newTheme=function(e,g){"object"==typeof e&&(g=g||e,e=null),e=g&&g._name?g._name:e||Date.parse(new Date);var f=this.copy(this.themes.Default._name,e);return a1.jqplot.extend(f,g),f},a1.jqplot.clone=aA,a1.jqplot.merge=az,a1.jqplot.extend=function(){var k,r=arguments[0]||{},q=1,p=arguments.length,o=!1;for("boolean"==typeof r&&(o=r,r=arguments[1]||{},q=2),"object"!=typeof r&&"[object Function]"===!toString.call(r)&&(r={});p>q;q++){if(null!=(k=arguments[q])){for(var n in k){var m=r[n],l=k[n];r!==l&&(o&&l&&"object"==typeof l&&!l.nodeType?r[n]=a1.jqplot.extend(o,m||(null!=l.length?[]:{}),l):l!==av&&(r[n]=l))}}}return r},a1.jqplot.ThemeEngine.prototype.rename=function(e,d){if("Default"==e||"Default"==d){throw new Error("jqplot.ThemeEngine Error: Cannot rename from/to Default")}if(this.themes.hasOwnProperty(d)){throw new Error("jqplot.ThemeEngine Error: New name already in use.")}if(this.themes.hasOwnProperty(e)){var f=this.copy(e,d);return this.remove(e),f}throw new Error("jqplot.ThemeEngine Error: Old name or new name invalid")},a1.jqplot.ThemeEngine.prototype.copy=function(g,m,l){if("Default"==m){throw new Error("jqplot.ThemeEngine Error: Cannot copy over Default theme")}if(!this.themes.hasOwnProperty(g)){var k="jqplot.ThemeEngine Error: Source name invalid";throw new Error(k)}if(this.themes.hasOwnProperty(m)){var k="jqplot.ThemeEngine Error: Target name invalid";throw new Error(k)}var h=aA(this.themes[g]);return h._name=m,a1.jqplot.extend(!0,h,l),this._add(h),h},a1.jqplot.Theme=function(d,e){"object"==typeof d&&(e=e||d,d=null),d=d||Date.parse(new Date),this._name=d,this.target={backgroundColor:null},this.legend={textColor:null,fontFamily:null,fontSize:null,border:null,background:null},this.title={textColor:null,fontFamily:null,fontSize:null,textAlign:null},this.seriesStyles={},this.series=[],this.grid={drawGridlines:null,gridLineColor:null,gridLineWidth:null,backgroundColor:null,borderColor:null,borderWidth:null,shadow:null},this.axesStyles={label:{},ticks:{}},this.axes={},"string"==typeof e?this._name=e:"object"==typeof e&&a1.jqplot.extend(!0,this,e)};var ar=function(){this.borderColor=null,this.borderWidth=null,this.ticks=new aq,this.label=new ap},aq=function(){this.show=null,this.showGridline=null,this.showLabel=null,this.showMark=null,this.size=null,this.textColor=null,this.whiteSpace=null,this.fontSize=null,this.fontFamily=null},ap=function(){this.textColor=null,this.whiteSpace=null,this.fontSize=null,this.fontFamily=null,this.fontWeight=null},ao=function(){this.color=null,this.lineWidth=null,this.linePattern=null,this.shadow=null,this.fillColor=null,this.showMarker=null,this.markerOptions=new an},an=function(){this.show=null,this.style=null,this.lineWidth=null,this.size=null,this.color=null,this.shadow=null},am=function(){this.color=null,this.seriesColors=null,this.lineWidth=null,this.shadow=null,this.barPadding=null,this.barMargin=null,this.barWidth=null,this.highlightColors=null},al=function(){this.seriesColors=null,this.padding=null,this.sliceMargin=null,this.fill=null,this.shadow=null,this.startAngle=null,this.lineWidth=null,this.highlightColors=null},ak=function(){this.seriesColors=null,this.padding=null,this.sliceMargin=null,this.fill=null,this.shadow=null,this.startAngle=null,this.lineWidth=null,this.innerDiameter=null,this.thickness=null,this.ringMargin=null,this.highlightColors=null},aj=function(){this.color=null,this.lineWidth=null,this.shadow=null,this.padding=null,this.sectionMargin=null,this.seriesColors=null,this.highlightColors=null},ai=function(){this.padding=null,this.backgroundColor=null,this.ringColor=null,this.tickColor=null,this.ringWidth=null,this.intervalColors=null,this.intervalInnerRadius=null,this.intervalOuterRadius=null,this.hubRadius=null,this.needleThickness=null,this.needlePad=null};a1.fn.jqplotChildText=function(){return a1(this).contents().filter(function(){return 3==this.nodeType}).text()},a1.fn.jqplotGetComputedFontStyle=function(){for(var g=window.getComputedStyle?window.getComputedStyle(this[0],""):this[0].currentStyle,f=g["font-style"]?["font-style","font-weight","font-size","font-family"]:["fontStyle","fontWeight","fontSize","fontFamily"],l=[],k=0;k<f.length;++k){var h=String(g[f[k]]);h&&"normal"!=h&&l.push(h)}return l.join(" ")},a1.fn.jqplotToImageCanvas=function(S){function R(d){var e=parseInt(a1(d).css("line-height"),10);return isNaN(e)&&(e=1.2*parseInt(a1(d).css("font-size"),10)),e}function Q(a5,a4,a3,Z,Y,X){for(var W=R(a5),V=a1(a5).innerWidth(),U=(a1(a5).innerHeight(),a3.split(/\s+/)),T=U.length,w="",v=[],u=Y,t=Z,s=0;T>s;s++){w+=U[s],a4.measureText(w).width>V&&w.length>U[s].length&&(v.push(s),w="",s--)}if(0===v.length){"center"===a1(a5).css("textAlign")&&(t=Z+(X-a4.measureText(w).width)/2-B),a4.fillText(a3,t,Y)}else{w=U.slice(0,v[0]).join(" "),"center"===a1(a5).css("textAlign")&&(t=Z+(X-a4.measureText(w).width)/2-B),a4.fillText(w,t,u),u+=W;for(var s=1,c=v.length;c>s;s++){w=U.slice(v[s-1],v[s]).join(" "),"center"===a1(a5).css("textAlign")&&(t=Z+(X-a4.measureText(w).width)/2-B),a4.fillText(w,t,u),u+=W}w=U.slice(v[s-1],U.length).join(" "),"center"===a1(a5).css("textAlign")&&(t=Z+(X-a4.measureText(w).width)/2-B),a4.fillText(w,t,u)}}function P(u,t,s){var r=u.tagName.toLowerCase(),q=a1(u).position(),p=window.getComputedStyle?window.getComputedStyle(u,""):u.currentStyle,o=t+q.left+parseInt(p.marginLeft,10)+parseInt(p.borderLeftWidth,10)+parseInt(p.paddingLeft,10),m=s+q.top+parseInt(p.marginTop,10)+parseInt(p.borderTopWidth,10)+parseInt(p.paddingTop,10),e=H.width;if("div"!=r&&"span"!=r||a1(u).hasClass("jqplot-highlighter-tooltip")){if("table"===r&&a1(u).hasClass("jqplot-table-legend")){x.strokeStyle=a1(u).css("border-top-color"),x.fillStyle=a1(u).css("background-color"),x.fillRect(o,m,a1(u).innerWidth(),a1(u).innerHeight()),parseInt(a1(u).css("border-top-width"),10)>0&&x.strokeRect(o,m,a1(u).innerWidth(),a1(u).innerHeight()),a1(u).find("div.jqplot-table-legend-swatch-outline").each(function(){var h=a1(this);x.strokeStyle=h.css("border-top-color");var w=o+h.position().left,v=m+h.position().top;x.strokeRect(w,v,h.innerWidth(),h.innerHeight()),w+=parseInt(h.css("padding-left"),10),v+=parseInt(h.css("padding-top"),10);var n=h.innerHeight()-2*parseInt(h.css("padding-top"),10),l=h.innerWidth()-2*parseInt(h.css("padding-left"),10),k=h.children("div.jqplot-table-legend-swatch");x.fillStyle=k.css("background-color"),x.fillRect(w,v,l,n)}),a1(u).find("td.jqplot-table-legend-label").each(function(){var f=a1(this),h=o+f.position().left,g=m+f.position().top+parseInt(f.css("padding-top"),10);x.font=f.jqplotGetComputedFontStyle(),x.fillStyle=f.css("color"),Q(f,x,f.text(),h,g,e)})}else{"canvas"==r&&x.drawImage(u,o,m)}}else{a1(u).children().each(function(){P(this,o,m)});var d=a1(u).jqplotChildText();d&&(x.font=a1(u).jqplotGetComputedFontStyle(),x.fillStyle=a1(u).css("color"),Q(u,x,d,o,m,e))}}S=S||{};var O=null==S.x_offset?0:S.x_offset,N=null==S.y_offset?0:S.y_offset,M=null==S.backgroundColor?"rgb(255,255,255)":S.backgroundColor;if(0==a1(this).width()||0==a1(this).height()){return null}if(a1.jqplot.use_excanvas){return null}for(var L,K,J,I,H=document.createElement("canvas"),G=a1(this).outerHeight(!0),F=a1(this).outerWidth(!0),E=a1(this).offset(),D=E.left,C=E.top,B=0,A=0,z=["jqplot-table-legend","jqplot-xaxis-tick","jqplot-x2axis-tick","jqplot-yaxis-tick","jqplot-y2axis-tick","jqplot-y3axis-tick","jqplot-y4axis-tick","jqplot-y5axis-tick","jqplot-y6axis-tick","jqplot-y7axis-tick","jqplot-y8axis-tick","jqplot-y9axis-tick","jqplot-xaxis-label","jqplot-x2axis-label","jqplot-yaxis-label","jqplot-y2axis-label","jqplot-y3axis-label","jqplot-y4axis-label","jqplot-y5axis-label","jqplot-y6axis-label","jqplot-y7axis-label","jqplot-y8axis-label","jqplot-y9axis-label"],y=0;y<z.length;y++){a1(this).find("."+z[y]).each(function(){L=a1(this).offset().top-C,K=a1(this).offset().left-D,I=K+a1(this).outerWidth(!0)+B,J=L+a1(this).outerHeight(!0)+A,-B>K&&(F=F-B-K,B=-K),-A>L&&(G=G-A-L,A=-L),I>F&&(F=I),J>G&&(G=J)})}H.width=F+Number(O),H.height=G+Number(N);var x=H.getContext("2d");return x.save(),x.fillStyle=M,x.fillRect(0,0,H.width,H.height),x.restore(),x.translate(B,A),x.textAlign="left",x.textBaseline="top",a1(this).children().each(function(){P(this,O,N)}),H},a1.fn.jqplotToImageStr=function(d){var e=a1(this).jqplotToImageCanvas(d);return e?e.toDataURL("image/png"):null},a1.fn.jqplotToImageElem=function(e){var g=document.createElement("img"),f=a1(this).jqplotToImageStr(e);return g.src=f,g},a1.fn.jqplotToImageElemStr=function(d){var e="<img src="+a1(this).jqplotToImageStr(d)+" />";return e},a1.fn.jqplotSaveImage=function(){var c=a1(this).jqplotToImageStr({});c&&(window.location.href=c.replace("image/png","image/octet-stream"))},a1.fn.jqplotViewImage=function(){var d=a1(this).jqplotToImageElemStr({});a1(this).jqplotToImageStr({});if(d){var e=window.open("");e.document.open("image/png"),e.document.write(d),e.document.close(),e=null}};var ah=function(){switch(this.syntax=ah.config.syntax,this._type="jsDate",this.proxy=new Date,this.options={},this.locale=ah.regional.getLocale(),this.formatString="",this.defaultCentury=ah.config.defaultCentury,arguments.length){case 0:break;case 1:if("[object Object]"==ax(arguments[0])&&"jsDate"!=arguments[0]._type){var e=this.options=arguments[0];this.syntax=e.syntax||this.syntax,this.defaultCentury=e.defaultCentury||this.defaultCentury,this.proxy=ah.createDate(e.date)}else{this.proxy=ah.createDate(arguments[0])}break;default:for(var d=[],f=0;f<arguments.length;f++){d.push(arguments[f])}this.proxy=new Date,this.proxy.setFullYear.apply(this.proxy,d.slice(0,3)),d.slice(3).length&&this.proxy.setHours.apply(this.proxy,d.slice(3))}};ah.config={defaultLocale:"en",syntax:"perl",defaultCentury:1900},ah.prototype.add=function(e,d){var f=ae[d]||ae.day;return"number"==typeof f?this.proxy.setTime(this.proxy.getTime()+f*e):f.add(this,e),this},ah.prototype.clone=function(){return new ah(this.proxy.getTime())},ah.prototype.getUtcOffset=function(){return 60000*this.proxy.getTimezoneOffset()},ah.prototype.diff=function(g,f,l){if(g=new ah(g),null===g){return null}var k=ae[f]||ae.day;if("number"==typeof k){var h=(this.proxy.getTime()-g.proxy.getTime())/k}else{var h=k.diff(this.proxy,g.proxy)}return l?h:Math[h>0?"floor":"ceil"](h)},ah.prototype.getAbbrDayName=function(){return ah.regional[this.locale].dayNamesShort[this.proxy.getDay()]},ah.prototype.getAbbrMonthName=function(){return ah.regional[this.locale].monthNamesShort[this.proxy.getMonth()]},ah.prototype.getAMPM=function(){return this.proxy.getHours()>=12?"PM":"AM"},ah.prototype.getAmPm=function(){return this.proxy.getHours()>=12?"pm":"am"},ah.prototype.getCentury=function(){return parseInt(this.proxy.getFullYear()/100,10)},ah.prototype.getDate=function(){return this.proxy.getDate()},ah.prototype.getDay=function(){return this.proxy.getDay()},ah.prototype.getDayOfWeek=function(){var b=this.proxy.getDay();return 0===b?7:b},ah.prototype.getDayOfYear=function(){var d=this.proxy,c=d-new Date(""+d.getFullYear()+"/1/1 GMT");return c+=60000*d.getTimezoneOffset(),d=null,parseInt(c/60000/60/24,10)+1},ah.prototype.getDayName=function(){return ah.regional[this.locale].dayNames[this.proxy.getDay()]},ah.prototype.getFullWeekOfYear=function(){var f=this.proxy,e=this.getDayOfYear(),h=6-f.getDay(),g=parseInt((e+h)/7,10);return g},ah.prototype.getFullYear=function(){return this.proxy.getFullYear()},ah.prototype.getGmtOffset=function(){var d=this.proxy.getTimezoneOffset()/60,c=0>d?"+":"-";return d=Math.abs(d),c+af(Math.floor(d),2)+":"+af(d%1*60,2)},ah.prototype.getHours=function(){return this.proxy.getHours()},ah.prototype.getHours12=function(){var b=this.proxy.getHours();return b>12?b-12:0==b?12:b},ah.prototype.getIsoWeek=function(){var f=this.proxy,e=this.getWeekOfYear(),h=new Date(""+f.getFullYear()+"/1/1").getDay(),g=e+(h>4||1>=h?0:1);return 53==g&&new Date(""+f.getFullYear()+"/12/31").getDay()<4?g=1:0===g&&(f=new ah(new Date(""+(f.getFullYear()-1)+"/12/31")),g=f.getIsoWeek()),f=null,g},ah.prototype.getMilliseconds=function(){return this.proxy.getMilliseconds()},ah.prototype.getMinutes=function(){return this.proxy.getMinutes()},ah.prototype.getMonth=function(){return this.proxy.getMonth()},ah.prototype.getMonthName=function(){return ah.regional[this.locale].monthNames[this.proxy.getMonth()]},ah.prototype.getMonthNumber=function(){return this.proxy.getMonth()+1},ah.prototype.getSeconds=function(){return this.proxy.getSeconds()},ah.prototype.getShortYear=function(){return this.proxy.getYear()%100},ah.prototype.getTime=function(){return this.proxy.getTime()},ah.prototype.getTimezoneAbbr=function(){return this.proxy.toString().replace(/^.*\(([^)]+)\)$/,"$1")},ah.prototype.getTimezoneName=function(){var b=/(?:\((.+)\)$| ([A-Z]{3}) )/.exec(this.toString());return b[1]||b[2]||"GMT"+this.getGmtOffset()},ah.prototype.getTimezoneOffset=function(){return this.proxy.getTimezoneOffset()},ah.prototype.getWeekOfYear=function(){var e=this.getDayOfYear(),d=7-this.getDayOfWeek(),f=parseInt((e+d)/7,10);return f},ah.prototype.getUnix=function(){return Math.round(this.proxy.getTime()/1000,0)},ah.prototype.getYear=function(){return this.proxy.getYear()},ah.prototype.next=function(b){return b=b||"day",this.clone().add(1,b)},ah.prototype.set=function(){switch(arguments.length){case 0:this.proxy=new Date;break;case 1:if("[object Object]"==ax(arguments[0])&&"jsDate"!=arguments[0]._type){var e=this.options=arguments[0];this.syntax=e.syntax||this.syntax,this.defaultCentury=e.defaultCentury||this.defaultCentury,this.proxy=ah.createDate(e.date)}else{this.proxy=ah.createDate(arguments[0])}break;default:for(var d=[],f=0;f<arguments.length;f++){d.push(arguments[f])}this.proxy=new Date,this.proxy.setFullYear.apply(this.proxy,d.slice(0,3)),d.slice(3).length&&this.proxy.setHours.apply(this.proxy,d.slice(3))}return this},ah.prototype.setDate=function(b){return this.proxy.setDate(b),this},ah.prototype.setFullYear=function(){return this.proxy.setFullYear.apply(this.proxy,arguments),this},ah.prototype.setHours=function(){return this.proxy.setHours.apply(this.proxy,arguments),this},ah.prototype.setMilliseconds=function(b){return this.proxy.setMilliseconds(b),this},ah.prototype.setMinutes=function(){return this.proxy.setMinutes.apply(this.proxy,arguments),this},ah.prototype.setMonth=function(){return this.proxy.setMonth.apply(this.proxy,arguments),this},ah.prototype.setSeconds=function(){return this.proxy.setSeconds.apply(this.proxy,arguments),this},ah.prototype.setTime=function(b){return this.proxy.setTime(b),this},ah.prototype.setYear=function(){return this.proxy.setYear.apply(this.proxy,arguments),this},ah.prototype.strftime=function(b){return b=b||this.formatString||ah.regional[this.locale].formatString,ah.strftime(this,b,this.syntax)},ah.prototype.toString=function(){return this.proxy.toString()},ah.prototype.toYmdInt=function(){return 10000*this.proxy.getFullYear()+100*this.getMonthNumber()+this.proxy.getDate()},ah.regional={en:{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],formatString:"%Y-%m-%d %H:%M:%S"},fr:{monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],formatString:"%Y-%m-%d %H:%M:%S"},de:{monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],formatString:"%Y-%m-%d %H:%M:%S"},es:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S&aacute;bado"],dayNamesShort:["Dom","Lun","Mar","Mi&eacute;","Juv","Vie","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},ru:{monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],formatString:"%Y-%m-%d %H:%M:%S"},ar:{monthNames:["كانون الثاني","شباط","آذار","نيسان","آذار","حزيران","تموز","آب","أيلول","تشرين الأول","تشرين الثاني","كانون الأول"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"],dayNamesShort:["سبت","أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة"],formatString:"%Y-%m-%d %H:%M:%S"},pt:{monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S&aacute;bado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},"pt-BR":{monthNames:["Janeiro","Fevereiro","Mar&ccedil;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Ter&ccedil;a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S&aacute;bado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S&aacute;b"],formatString:"%Y-%m-%d %H:%M:%S"},pl:{monthNames:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],monthNamesShort:["Sty","Lut","Mar","Kwi","Maj","Cze","Lip","Sie","Wrz","Paź","Lis","Gru"],dayNames:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],dayNamesShort:["Ni","Pn","Wt","Śr","Cz","Pt","Sb"],formatString:"%Y-%m-%d %H:%M:%S"},nl:{monthNames:["Januari","Februari","Maart","April","Mei","Juni","July","Augustus","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:",".Zaterdag,dayNamesShort:["Zo","Ma","Di","Wo","Do","Vr","Za"],formatString:"%Y-%m-%d %H:%M:%S"},sv:{monthNames:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],monthNamesShort:["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],dayNames:["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],dayNamesShort:["sön","mån","tis","ons","tor","fre","lör"],formatString:"%Y-%m-%d %H:%M:%S"},it:{monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedi","Martedi","Mercoledi","Giovedi","Venerdi","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],formatString:"%d-%m-%Y %H:%M:%S"}},ah.regional["en-US"]=ah.regional["en-GB"]=ah.regional.en,ah.regional.getLocale=function(){var b=ah.config.defaultLocale;return document&&document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang&&(b=document.getElementsByTagName("html")[0].lang,ah.regional.hasOwnProperty(b)||(b=ah.config.defaultLocale)),b};var ag=86400000,af=function(f,e){f=String(f);var h=e-f.length,g=String(Math.pow(10,h)).slice(1);return g.concat(f)},ae={millisecond:1,second:1000,minute:60000,hour:3600000,day:ag,week:7*ag,month:{add:function(e,d){ae.year.add(e,Math[d>0?"floor":"ceil"](d/12));var f=e.getMonth()+d%12;12==f?(f=0,e.setYear(e.getFullYear()+1)):-1==f&&(f=11,e.setYear(e.getFullYear()-1)),e.setMonth(f)},diff:function(g,f){var l=g.getFullYear()-f.getFullYear(),k=g.getMonth()-f.getMonth()+12*l,h=g.getDate()-f.getDate();return k+h/30}},year:{add:function(d,c){d.setYear(d.getFullYear()+Math[c>0?"floor":"ceil"](c))},diff:function(d,c){return ae.month.diff(d,c)/12}}};for(var ad in ae){"s"!=ad.substring(ad.length-1)&&(ae[ad+"s"]=ae[ad])}var ac=function(g,f,l){if(ah.formats[l].shortcuts[f]){return ah.strftime(g,ah.formats[l].shortcuts[f],l)}var k=(ah.formats[l].codes[f]||"").split("."),h=g["get"+k[0]]?g["get"+k[0]]():"";return k[1]&&(h=af(h,k[1])),h};ah.strftime=function(s,r,q,p){var o="perl",n=ah.regional.getLocale();q&&ah.formats.hasOwnProperty(q)?o=q:q&&ah.regional.hasOwnProperty(q)&&(n=q),p&&ah.formats.hasOwnProperty(p)?o=p:p&&ah.regional.hasOwnProperty(p)&&(n=p),("[object Object]"!=ax(s)||"jsDate"!=s._type)&&(s=new ah(s),s.locale=n),r||(r=s.formatString||ah.regional[n].formatString);for(var m,l=r||"%Y-%m-%d",k="";l.length>0;){(m=l.match(ah.formats[o].codes.matcher))?(k+=l.slice(0,m.index),k+=(m[1]||"")+ac(s,m[2],o),l=l.slice(m.index+m[0].length)):(k+=l,l="")}return k},ah.formats={ISO:"%Y-%m-%dT%H:%M:%S.%N%G",SQL:"%Y-%m-%d %H:%M:%S"},ah.formats.perl={codes:{matcher:/()%(#?(%|[a-z]))/i,Y:"FullYear",y:"ShortYear.2",m:"MonthNumber.2","#m":"MonthNumber",B:"MonthName",b:"AbbrMonthName",d:"Date.2","#d":"Date",e:"Date",A:"DayName",a:"AbbrDayName",w:"Day",H:"Hours.2","#H":"Hours",I:"Hours12.2","#I":"Hours12",p:"AMPM",M:"Minutes.2","#M":"Minutes",S:"Seconds.2","#S":"Seconds",s:"Unix",N:"Milliseconds.3","#N":"Milliseconds",O:"TimezoneOffset",Z:"TimezoneName",G:"GmtOffset"},shortcuts:{F:"%Y-%m-%d",T:"%H:%M:%S",X:"%H:%M:%S",x:"%m/%d/%y",D:"%m/%d/%y","#c":"%a %b %e %H:%M:%S %Y",v:"%e-%b-%Y",R:"%H:%M",r:"%I:%M:%S %p",t:"	",n:"\n","%":"%"}},ah.formats.php={codes:{matcher:/()%((%|[a-z]))/i,a:"AbbrDayName",A:"DayName",d:"Date.2",e:"Date",j:"DayOfYear.3",u:"DayOfWeek",w:"Day",U:"FullWeekOfYear.2",V:"IsoWeek.2",W:"WeekOfYear.2",b:"AbbrMonthName",B:"MonthName",m:"MonthNumber.2",h:"AbbrMonthName",C:"Century.2",y:"ShortYear.2",Y:"FullYear",H:"Hours.2",I:"Hours12.2",l:"Hours12",p:"AMPM",P:"AmPm",M:"Minutes.2",S:"Seconds.2",s:"Unix",O:"TimezoneOffset",z:"GmtOffset",Z:"TimezoneAbbr"},shortcuts:{D:"%m/%d/%y",F:"%Y-%m-%d",T:"%H:%M:%S",X:"%H:%M:%S",x:"%m/%d/%y",R:"%H:%M",r:"%I:%M:%S %p",t:"	",n:"\n","%":"%"}},ah.createDate=function(x){function w(F,E){var D,C,B,A,z=parseFloat(E[1]),y=parseFloat(E[2]),l=parseFloat(E[3]),k=ah.config.defaultCentury;return z>31?(C=l,B=y,D=k+z):(C=y,B=z,D=k+l),A=B+"/"+C+"/"+D,F.replace(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})/,A)}if(null==x){return new Date}if(x instanceof Date){return x}if("number"==typeof x){return new Date(x)}var v=String(x).replace(/^\s*(.+)\s*$/g,"$1");v=v.replace(/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,4})/,"$1/$2/$3"),v=v.replace(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{4})/i,"$1 $2 $3");var u=v.match(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{2})\D*/i);if(u&&u.length>3){var t=parseFloat(u[3]),s=ah.config.defaultCentury+t;s=String(s),v=v.replace(/^(3[01]|[0-2]?\d)[-\/]([a-z]{3,})[-\/](\d{2})\D*/i,u[1]+" "+u[2]+" "+s)}u=v.match(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})[^0-9]/),u&&u.length>3&&(v=w(v,u));var u=v.match(/^([0-9]{1,2})[-\/]([0-9]{1,2})[-\/]([0-9]{1,2})$/);u&&u.length>3&&(v=w(v,u));for(var r,q,p,o=0,n=ah.matchers.length,m=v;n>o;){if(q=Date.parse(m),!isNaN(q)){return new Date(q)}if(r=ah.matchers[o],"function"==typeof r){if(p=r.call(ah,m),p instanceof Date){return p}}else{m=v.replace(r[0],r[1])}o++}return NaN},ah.daysInMonth=function(d,c){return 2==c?29==new Date(d,1,29).getDate()?29:28:[av,31,av,31,30,31,30,31,31,30,31,30,31][c]},ah.matchers=[[/(3[01]|[0-2]\d)\s*\.\s*(1[0-2]|0\d)\s*\.\s*([1-9]\d{3})/,"$2/$1/$3"],[/([1-9]\d{3})\s*-\s*(1[0-2]|0\d)\s*-\s*(3[01]|[0-2]\d)/,"$2/$3/$1"],function(f){var e=f.match(/^(?:(.+)\s+)?([012]?\d)(?:\s*\:\s*(\d\d))?(?:\s*\:\s*(\d\d(\.\d*)?))?\s*(am|pm)?\s*$/i);if(e){if(e[1]){var h=this.createDate(e[1]);if(isNaN(h)){return}}else{var h=new Date;h.setMilliseconds(0)}var g=parseFloat(e[2]);return e[6]&&(g="am"==e[6].toLowerCase()?12==g?0:g:12==g?12:g+12),h.setHours(g,parseInt(e[3]||0,10),parseInt(e[4]||0,10),1000*(parseFloat(e[5]||0)||0)),h}return f},function(f){var e=f.match(/^(?:(.+))[T|\s+]([012]\d)(?:\:(\d\d))(?:\:(\d\d))(?:\.\d+)([\+\-]\d\d\:\d\d)$/i);if(e){if(e[1]){var h=this.createDate(e[1]);if(isNaN(h)){return}}else{var h=new Date;h.setMilliseconds(0)}var g=parseFloat(e[2]);return h.setHours(g,parseInt(e[3],10),parseInt(e[4],10),1000*parseFloat(e[5])),h}return f},function(s){var r=s.match(/^([0-3]?\d)\s*[-\/.\s]{1}\s*([a-zA-Z]{3,9})\s*[-\/.\s]{1}\s*([0-3]?\d)$/);if(r){var q,p,o,n=new Date,m=ah.config.defaultCentury,l=parseFloat(r[1]),k=parseFloat(r[3]);l>31?(p=k,q=m+l):(p=l,q=m+k);var o=ay(r[2],ah.regional[ah.regional.getLocale()].monthNamesShort);return -1==o&&(o=ay(r[2],ah.regional[ah.regional.getLocale()].monthNames)),n.setFullYear(q,o,p),n.setHours(0,0,0,0),n}return s}],a1.jsDate=ah,a1.jqplot.sprintf=function(){function k(g,f,t,s){var h=g.length>=f?"":Array(1+f-g.length>>>0).join(t);return s?g+h:h+g}function r(e){for(var g=new String(e),f=10;f>0&&g!=(g=g.replace(/^(\d+)(\d{3})/,"$1"+a1.jqplot.sprintf.thousandsSeparator+"$2"));f--){}return g}function q(b,y,x,w,v,u){var t=w-b.length;if(t>0){var s=" ";u&&(s="&nbsp;"),b=x||!v?k(b,w,s,x):b.slice(0,y.length)+k("",t,"0",!0)+b.slice(y.length)}return b}function p(y,x,w,v,u,t,s,d){var b=y>>>0;return w=w&&b&&{2:"0b",8:"0",16:"0x"}[x]||"",y=w+k(b.toString(x),t||0,"0",!1),q(y,w,v,u,s,d)}function o(h,d,v,u,t,s){return null!=u&&(h=h.slice(0,u)),q(h,"",d,v,t,s)}var n=arguments,m=0,l=n[m++];return l.replace(a1.jqplot.sprintf.regex,function(Y,X,W,V,U,T,S){if("%%"==Y){return"%"}for(var R=!1,P="",N=!1,L=!1,J=!1,H=!1,g=0;W&&g<W.length;g++){switch(W.charAt(g)){case" ":P=" ";break;case"+":P="+";break;case"-":R=!0;break;case"0":N=!0;break;case"#":L=!0;break;case"&":J=!0;break;case"'":H=!0}}if(V=V?"*"==V?+n[m++]:"*"==V.charAt(0)?+n[V.slice(1,-1)]:+V:0,0>V&&(V=-V,R=!0),!isFinite(V)){throw new Error("$.jqplot.sprintf: (minimum-)width must be finite")}T=T?"*"==T?+n[m++]:"*"==T.charAt(0)?+n[T.slice(1,-1)]:+T:"fFeE".indexOf(S)>-1?6:"d"==S?0:void 0;var e=X?n[X.slice(0,-1)]:n[m++];switch(S){case"s":return null==e?"":o(String(e),R,V,T,N,J);case"c":return o(String.fromCharCode(+e),R,V,T,N,J);case"b":return p(e,2,L,R,V,T,N,J);case"o":return p(e,8,L,R,V,T,N,J);case"x":return p(e,16,L,R,V,T,N,J);case"X":return p(e,16,L,R,V,T,N,J).toUpperCase();case"u":return p(e,10,L,R,V,T,N,J);case"i":var d=parseInt(+e,10);if(isNaN(d)){return""}var c=0>d?"-":P,b=H?r(String(Math.abs(d))):String(Math.abs(d));return e=c+k(b,T,"0",!1),q(e,c,R,V,N,J);case"d":var d=Math.round(+e);if(isNaN(d)){return""}var c=0>d?"-":P,b=H?r(String(Math.abs(d))):String(Math.abs(d));return e=c+k(b,T,"0",!1),q(e,c,R,V,N,J);case"e":case"E":case"f":case"F":case"g":case"G":var d=+e;if(isNaN(d)){return""}var c=0>d?"-":P,Q=["toExponential","toFixed","toPrecision"]["efg".indexOf(S.toLowerCase())],O=["toString","toUpperCase"]["eEfFgG".indexOf(S)%2],b=Math.abs(d)[Q](T),M=b.toString().split(".");M[0]=H?r(M[0]):M[0],b=M.join(a1.jqplot.sprintf.decimalMark),e=c+b;var K=q(e,c,R,V,N,J)[O]();return K;case"p":case"P":var d=+e;if(isNaN(d)){return""}var c=0>d?"-":P,M=String(Number(Math.abs(d)).toExponential()).split(/e|E/),I=-1!=M[0].indexOf(".")?M[0].length-1:String(d).length,h=M[1]<0?-M[1]-1:0;if(Math.abs(d)<1){e=T>=I+h?c+Math.abs(d).toPrecision(I):T-1>=I?c+Math.abs(d).toExponential(I-1):c+Math.abs(d).toExponential(T-1)}else{var f=T>=I?I:T;e=c+Math.abs(d).toPrecision(f)}var O=["toString","toUpperCase"]["pP".indexOf(S)%2];return q(e,c,R,V,N,J)[O]();case"n":return"";default:return Y}})},a1.jqplot.sprintf.thousandsSeparator=",",a1.jqplot.sprintf.decimalMark=".",a1.jqplot.sprintf.regex=/%%|%(\d+\$)?([-+#0&\' ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([nAscboxXuidfegpEGP])/g,a1.jqplot.getSignificantFigures=function(k){var h=String(Number(Math.abs(k)).toExponential()).split(/e|E/),p=-1!=h[0].indexOf(".")?h[0].length-1:h[0].length,o=h[1]<0?-h[1]-1:0,n=parseInt(h[1],10),m=n+1>0?n+1:0,l=m>=p?0:p-n-1;return{significantDigits:p,digitsLeft:m,digitsRight:l,zeros:o,exponent:n}},a1.jqplot.getPrecision=function(c){return a1.jqplot.getSignificantFigures(c).digitsRight};var ab=a1.uiBackCompat!==!1;a1.jqplot.effects={effect:{}};var aa="jqplot.storage.";a1.extend(a1.jqplot.effects,{version:"1.9pre",save:function(e,d){for(var f=0;f<d.length;f++){null!==d[f]&&e.data(aa+d[f],e[0].style[d[f]])}},restore:function(e,d){for(var f=0;f<d.length;f++){null!==d[f]&&e.css(d[f],e.data(aa+d[f]))}},setMode:function(d,c){return"toggle"===c&&(c=d.is(":hidden")?"show":"hide"),c},createWrapper:function(g){if(g.parent().is(".ui-effects-wrapper")){return g.parent()}var m={width:g.outerWidth(!0),height:g.outerHeight(!0),"float":g.css("float")},l=a1("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),k={width:g.width(),height:g.height()},h=document.activeElement;return g.wrap(l),(g[0]===h||a1.contains(g[0],h))&&a1(h).focus(),l=g.parent(),"static"===g.css("position")?(l.css({position:"relative"}),g.css({position:"relative"})):(a1.extend(m,{position:g.css("position"),zIndex:g.css("z-index")}),a1.each(["top","left","bottom","right"],function(b,c){m[c]=g.css(c),isNaN(parseInt(m[c],10))&&(m[c]="auto")}),g.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),g.css(k),l.css(m).show()},removeWrapper:function(d){var e=document.activeElement;return d.parent().is(".ui-effects-wrapper")&&(d.parent().replaceWith(d),(d[0]===e||a1.contains(d[0],e))&&a1(e).focus()),d}}),a1.fn.extend({jqplotEffect:function(u,t,s,r){function q(g){function w(){a1.isFunction(k)&&k.call(v[0]),a1.isFunction(g)&&g()}var v=a1(this),k=p.complete,h=p.mode;(v.is(":hidden")?"hide"===h:"show"===h)?w():m.call(v[0],p,w)}var p=aw.apply(this,arguments),o=p.mode,n=p.queue,m=a1.jqplot.effects.effect[p.effect],l=!m&&ab&&a1.jqplot.effects[p.effect];return a1.fx.off||!m&&!l?o?this[o](p.duration,p.complete):this.each(function(){p.complete&&p.complete.call(this)}):m?n===!1?this.each(q):this.queue(n||"fx",q):l.call(this,{options:p,duration:p.duration,callback:p.complete,mode:p.mode})}});var aB=/up|down|vertical/,a2=/up|left|vertical|horizontal/;a1.jqplot.effects.effect.blind=function(E,D){var C,B,A,z=a1(this),y=["position","top","bottom","left","right","height","width"],x=a1.jqplot.effects.setMode(z,E.mode||"hide"),w=E.direction||"up",v=aB.test(w),u=v?"height":"width",t=v?"top":"left",s=a2.test(w),r={},q="show"===x;z.parent().is(".ui-effects-wrapper")?a1.jqplot.effects.save(z.parent(),y):a1.jqplot.effects.save(z,y),z.show(),A=parseInt(z.css("top"),10),C=a1.jqplot.effects.createWrapper(z).css({overflow:"hidden"}),B=v?C[u]()+A:C[u](),r[u]=q?String(B):"0",s||(z.css(v?"bottom":"right",0).css(v?"top":"left","").css({position:"absolute"}),r[t]=q?"0":String(B)),q&&(C.css(u,0),s||C.css(t,B)),C.animate(r,{duration:E.duration,easing:E.easing,queue:!1,complete:function(){"hide"===x&&z.hide(),a1.jqplot.effects.restore(z,y),a1.jqplot.effects.removeWrapper(z),D()}})}}(jQuery);

